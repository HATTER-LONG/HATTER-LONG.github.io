<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ï¼ˆä¸‰ï¼‰LLVMç¼–è¯‘å™¨--Clang_AST_å­¦ä¹ </title>
      <link href="/2022/06/03/san-llvm-bian-yi-qi-clang-ast-xue-xi/"/>
      <url>/2022/06/03/san-llvm-bian-yi-qi-clang-ast-xue-xi/</url>
      
        <content type="html"><![CDATA[<h1 id="Clang-AST-å­¦ä¹ "><a href="#Clang-AST-å­¦ä¹ " class="headerlink" title="Clang AST å­¦ä¹ "></a>Clang AST å­¦ä¹ </h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ä¹‹å‰æ­å»ºç¯å¢ƒæ˜¯å°±å·²ç»æåˆ°è¿‡ï¼ŒClang ä¸ä»…ä»…å¯ä»¥ä½œä¸ºä¸€ä¸ªç¼–è¯‘å™¨å‰ç«¯ï¼ŒåŒæ—¶è¿˜å¯ä»¥é€šè¿‡åº“çš„å½¢å¼æä¾›ä»£ç è§£æåŠŸèƒ½ï¼Œå°† C/C++ ç¨‹åºæºç è½¬æ¢ä¸º abstract syntax tree ï¼ˆASTï¼‰è¯­æ³•æ ‘ä»¥åŠæä¾›ç›¸åº”æ¥å£å»æ“ä½œ AST è¯­æ³•æ ‘ã€‚<a href="http://swtv.kaist.ac.kr/courses/cs453-fall09">å‚è€ƒèµ„æ–™</a></p><h2 id="AST-ç»“æ„åŸºç¡€"><a href="#AST-ç»“æ„åŸºç¡€" class="headerlink" title="AST ç»“æ„åŸºç¡€"></a>AST ç»“æ„åŸºç¡€</h2><ul><li>AST ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ Decl æˆ– Stmt ç±»çš„ä¸€ä¸ªå®ä¾‹:<ul><li>Decl : è¡¨ç¤ºå£°æ˜ã€‚Decl ä¸‹çº§è¿˜åŒ…å«ä¸åŒç±»å‹çš„å­ç±»ç”¨äºæ ‡è¯†ä¸åŒçš„å£°æ˜ç±»å‹ï¼›<ul><li>ä¾‹å¦‚ FunctionDecl ç±»ç”¨äºå‡½æ•°å£°æ˜ï¼ŒParmVarDecl ç±»ç”¨äºå‡½æ•°å‚æ•°å£°æ˜ã€‚</li></ul></li><li>Stmt : è¡¨ç¤ºè¯­å¥ï¼ˆä»£ç å—ï¼‰ã€‚åŒæ ·å­˜åœ¨ Stmt çš„å­ç±»ï¼Œå¯¹äºä¸åŒçš„è¯­å¥ç±»å‹ï¼›<ul><li>ä¾‹å¦‚ IfStmt ç”¨äºæ ‡è¯† if è¯­å¥, ReturnStmt ç±»ç”¨äºæ ‡è¯†å‡½æ•°è¿”å›ã€‚</li></ul></li></ul></li></ul><h3 id="Example-AST"><a href="#Example-AST" class="headerlink" title="Example AST"></a>Example AST</h3><p>å…ˆæ¥ä¸€æ®µæ¼”ç¤ºä»£ç ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//Example.c</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> global<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">myPrint</span><span class="token punctuation">(</span><span class="token keyword">int</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>param <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"param is 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>        global <span class="token operator">+</span><span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> param <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token function">myPrint</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Decl"><a href="#Decl" class="headerlink" title="Decl"></a>Decl</h3><ol><li><p>ä¸€ä¸ªå‡½æ•°çš„æ ¹èŠ‚ç‚¹æ˜¯ä¸€ä¸ª FunctionDecl å®ä¾‹ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_1.png" alt="FunctionDeclèŠ‚ç‚¹"></p></li><li><p>ä¸€ä¸ª FunctionDecl å¯ä»¥é€šè¿‡ä¸€ä¸ª ParmVarDecl æ¥æ ‡è¯†å‚æ•°ï¼Œæ³¨æ„ ParmVarDecl ä¸ FunctionDecl æ˜¯åŒçº§çš„ï¼Œéƒ½å±äº Decl å­ç±»ã€‚</p></li><li><p>å‡½æ•°ä½“æ˜¯ä¸€ä¸ª Stmt å®ä¾‹ï¼Œå…¶ä¸­å‡½æ•°ä½“ä½¿ç”¨ CompoundStmt æ¥æ ‡è¯†ï¼ŒåŒæ ·çš„å®ƒä¹Ÿæ˜¯ Stmt çš„ä¸€ä¸ªå­ç±»ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_2.png" alt="Function_ParamVar_Decl_Stmt"></p></li><li><p>VarDecl ç”¨äºæ ‡è¯†å±€éƒ¨å’Œå…¨å±€å˜é‡çš„å£°æ˜ï¼Œæ³¨æ„å¦‚æœå˜é‡å£°æ˜æ—¶æœ‰ä¸ªåˆå§‹å€¼ï¼Œé‚£ä¹ˆ VarDecl å°±ä¼šæœ‰ä¸€ä¸ªåˆå§‹å€¼çš„å­èŠ‚ç‚¹ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_3.png" alt="VarDecl"></p></li><li><p>FunctionDeclã€ParmVarDecl å’Œ VarDecl éƒ½æœ‰ä¸€ä¸ªåç§°å’Œä¸€ä¸ªå£°æ˜ç±»å‹ï¼Œåœ¨éå†èŠ‚ç‚¹æŸ¥æ‰¾æˆ‘ä»¬æƒ³è¦çš„ä»£ç å—æ˜¯éå¸¸å¥½ç”¨çš„ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_4.png" alt="Name&amp;Type"></p></li></ol><h3 id="Stmt"><a href="#Stmt" class="headerlink" title="Stmt"></a>Stmt</h3><ol><li><p>Stmt ç”¨äºæ ‡è¯†ä»£ç è¯­å¥ï¼ŒåŒ…å«çš„å­ç±»ï¼š</p><ol><li>CompoundStmt ç±» ç”¨æ¥æ ‡è¯†ä»£ç å—ï¼›</li><li>DeclStmt ç±» ç”¨æ¥æ ‡è¯†å±€éƒ¨å˜é‡å£°æ˜ï¼›</li><li>ReturnStmt ç±» æ ‡è¯†å‡½æ•°è¿”å›ã€‚</li></ol><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_5.png" alt="Stmt"></p></li><li><p>Expr ä½œä¸º Stmt çš„å­ç±»ï¼Œç”¨äºæ ‡è¯†è¡¨è¾¾å¼ï¼š</p><ol><li>CallExpr æ ‡è¯†å‡½æ•°è°ƒç”¨ï¼›</li><li>ImplicitCastExpr ç”¨äºæ ‡è¯†éšå¼å¼ºè½¬æ¢çš„ç±»å‹ï¼›</li><li>DeclRefExpr æ ‡è¯†å¼•ç”¨å£°æ˜çš„å˜é‡å’Œå‡½æ•°ï¼›</li><li>IntegerLiteral ç”¨äºæ•´å‹æ–‡å­—ã€‚</li></ol><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_6.png" alt="Expr"></p></li><li><p>Stmt å¯èƒ½åŒ…å«ä¸€äº›æœ‰ç€é™„åŠ ä¿¡æ¯çš„å­èŠ‚ç‚¹ï¼Œä¾‹å¦‚ CompoundStmt æ ‡è¯†åœ¨ä¸€ä¸ªå¤§æ‹¬å·ä¸­ä»£ç å—çš„è¯­å¥ï¼Œå…¶ä¸­çš„æ¯ä¸ªè¯­å¥éƒ½æ˜¯ä¸€ä¸ªåŒ…å«å…¶ä»–ä¿¡æ¯çš„å­èŠ‚ç‚¹ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_7.png" alt="CompoundStmt"></p></li><li><p>åœ¨åŒ…å«é™„åŠ ä¿¡æ¯çš„å­èŠ‚ç‚¹ä¸­ï¼Œä¾‹å¦‚ CallExpr å‡½æ•°è°ƒç”¨ç±»ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå­å…ƒç´ æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œå…¶ä»–çš„å­å…ƒç´ æ˜¯å‡½æ•°å‚æ•°ï¼Œå…¶ä»–èŠ‚ç‚¹åŒç†ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_8.png" alt="CallExpr"></p></li><li><p>Expr ç±» ä¼šæœ‰ä¸€ä¸ªè¡¨è¾¾å¼çš„ç±»å‹ï¼Œä¾‹å¦‚ CallExpr ä¸­çš„èŠ‚ç‚¹æœ‰ä¸ª void çš„ç±»å‹ã€‚ä¸€äº› Expr çš„å­ç±»ä¼šåŒ…å«ä¸€ä¸ªå€¼ï¼Œä¾‹å¦‚ åˆå§‹åŒ–çš„å±€éƒ¨æˆ–å…¨å±€å˜é‡ IntegerLiteral å­èŠ‚ç‚¹ï¼Œå°±æœ‰ä¸€ä¸ª 1 â€˜intâ€™ ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_9.png" alt="Expræ‰©å±•"></p></li><li><p>ç°åœ¨è®©æˆ‘ä»¬å…³æ³¨ä¸‹æ›´å¤æ‚ä¸€ç‚¹çš„ myPrint å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°åœ¨å…¶å‡½æ•°ä½“ä¸­åŒ…å«äº† IfStmt å’Œ ForStmt ä¸¤ç§ Stmt å­ç±»ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_10.png" alt="ifStmt&amp;forStmt"></p></li><li><p>IfStmt æœ‰ 4 ä¸­å­èŠ‚ç‚¹ï¼š</p><ol><li><p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¥‡æ€ªçš„çš„æ¡ä»¶å˜é‡ï¼ˆ-&gt;NULLï¼‰ï¼Œè¿™æ˜¯å› ä¸º c++ ä¸­å¯ä»¥åœ¨ if è¯­å¥çš„ condition å£°æ˜ä¸€ä¸ªå˜é‡(è€Œä¸æ˜¯åœ¨ C ä¸­);</p><ul><li><p>åšä¸ªå®éªŒï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±å¾ˆæ¸…æ™°äº†ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_11.png" alt="æµ‹è¯•confditionå®šä¹‰"></p></li></ul></li><li><p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­èŠ‚ç‚¹;</p></li><li><p>ç„¶åæ˜¯è¯¥ if åˆ¤æ–­çš„ä»£ç æ®µ;</p></li><li><p>æœ€åæ˜¯ Else çš„ä»£ç æ®µã€‚</p></li></ol><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_12.png" alt="ifStmt"></p></li><li><p>ForStmt æœ‰ 5 ä¸ªå­èŠ‚ç‚¹ï¼š</p><ol><li><p>for å¾ªç¯åˆ¤æ–­çš„åˆå§‹åŒ–è¯­å¥ï¼Œfor(<code>int i = 0</code>; i &lt; 10; i++)ï¼›</p></li><li><p>VarDecl ç±»æ ‡è¯†çš„ for çš„æ¡ä»¶å˜é‡å®šä¹‰ï¼›</p><ul><li><p>è¯´çš„æœ‰ç‚¹éš¾æ‡‚ï¼Œåšä¸ªå®éªŒ</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_13.png" alt="æµ‹è¯•foræ¡ä»¶å®šä¹‰"></p></li></ul></li><li><p>for åˆ¤æ–­æ¡ä»¶ï¼Œfor(int i = 0; <code>i &lt; 10</code>; i++)ï¼›</p></li><li><p>++æ®µï¼Œfor(int i = 0; i &lt; 10; <code>i++</code>)ï¼›</p></li><li><p>Stmt æ ‡è¯† for ä¸­çš„å¾ªç¯ä»£ç å—ã€‚</p></li></ol><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_14.png" alt="ForStmt"></p></li><li><p>BinaryOperator äºŒå…ƒæ“ä½œç¬¦ï¼Œå­˜åœ¨ä¸¤ä¸ªå­èŠ‚ç‚¹; UnaryOperator ä¸€å…ƒæ“ä½œç¬¦ï¼Œåªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_15.png" alt="ä¸€å…ƒ&amp;äºŒå…ƒ"></p></li></ol><h2 id="éå†-Clang-AST"><a href="#éå†-Clang-AST" class="headerlink" title="éå† Clang AST"></a>éå† Clang AST</h2><ul><li><p>é€šè¿‡<a href="http://clang.llvm.org/docs/RAVFrontendAction.html">å®˜æ–¹çš„ä¸€ç¯‡æ•™ç¨‹</a>ä»¥åŠ<a href="https://www.cnblogs.com/zhangke007/p/4714245.html">ä¸‹å›¾</a> å¯ä»¥äº†è§£åˆ°æ„å»ºã€éå† AST æ ‘éœ€è¦çš„å‡ ä¸ªåŠŸèƒ½ç±»ï¼Œåˆ†åˆ«æ˜¯ <a href="http://clang.llvm.org/doxygen/classclang_1_1CompilerInstance.html#details">CompilerInstance</a>ã€FrontendActionã€ParseASTã€ASTConsumerã€RecursiveASTVisitorã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_18.png" alt="parseAst"></p></li></ul><ol><li><p>CompilerInstance: ç”¨äºç®¡ç† Clang ç¼–è¯‘å™¨å•ä¸ªå®ä¾‹çš„ Helper ç±»ã€‚å®ƒä¸»è¦æœ‰ä¸¤ä¸ªç”¨å¤„ï¼š</p><ol><li>å®ƒç®¡ç†è¿è¡Œç¼–è¯‘å™¨æ‰€éœ€çš„å„ç§å¯¹è±¡ï¼Œä¾‹å¦‚é¢„å¤„ç†å™¨ï¼Œç›®æ ‡ä¿¡æ¯å’Œ AST ä¸Šä¸‹æ–‡ã€‚</li><li>å®ƒæä¾›äº†ç”¨äºæ„é€ å’Œæ“ä½œé€šç”¨ Clang å¯¹è±¡çš„å®ç”¨ç¨‹åºä¾‹ç¨‹ã€‚</li></ol></li><li><p>ä» CompilerInstance å¯ä»¥äº†è§£åˆ°ä¸¤ç‚¹ç”¨å¤„ï¼š ç¬¬ä¸€ç‚¹å¯¹æˆ‘ä»¬æ„å»º AST ç”¨å¤„ä¸å¤§ï¼Œä¸»è¦æ˜¯ç¬¬äºŒç‚¹ä¸­æ˜¯ç®¡ç†å’Œæ“ä½œ Clang Tool å·¥å…·å®ç”¨çš„ç¨‹åºå†ç¨‹ï¼Œè¿™ç‚¹å¾ˆæœ‰å¯å‘ã€‚<a href="http://clang.llvm.org/docs/RAVFrontendAction.html">å®˜æ–¹æ•™ç¨‹</a>æ˜¯é€šè¿‡ ASTFrontendActions æ¥å®ç° AST æ ‘éå†ã€‚å…¶ä¸­æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼š</p><ul><li>åœ¨ç¼–å†™åŸºäº Clang çš„å·¥å…·ï¼ˆä¾‹å¦‚ Clang æ’ä»¶ï¼‰æˆ–åŸºäº LibTooling çš„ç‹¬ç«‹å·¥å…·æ—¶ï¼Œå¸¸è§çš„å…¥å£ç‚¹æ˜¯ FrontendActionã€‚å…¶å…è®¸åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æ‰§è¡Œç”¨æˆ·ç‰¹å®šçš„æ“ä½œã€‚å¦‚æœæƒ³è¦åœ¨ Clang AST æ ‘ä¸Šè¿è¡Œå·¥å…·ï¼Œæä¾›äº†æ–¹ä¾¿çš„æ¥å£ ASTFrontendActionï¼Œè¯¥æ¥å£è´Ÿè´£æ‰§è¡Œæ“ä½œã€‚å‰©ä¸‹çš„å”¯ä¸€éƒ¨åˆ†æ˜¯å®ç° CreateASTConsumer æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ºæ¯ä¸ªç¿»è¯‘å•å…ƒè¿”å› ASTConsumerã€‚</li></ul></li><li><p>ä» FrontendAction å¯ä»¥äº†è§£åˆ°å¦‚æœæƒ³è¿è¡ŒåŸºäº libTooling çš„å·¥å…·ï¼Œç›´æ¥å®ç°ä¸€ä¸ª ASTFrontendAction å…¥å£ä»¥åŠ ASTConsumer å³å¯ï¼Œè¿™æ ·å®Œå…¨æ²¡æœ‰ ParseAST ä»€ä¹ˆäº‹æƒ…äº†å‘€ï¼Ÿï¼Ÿä¸ºäº†ææ¸…æ¥šæˆ‘ä»¬è¿˜æ˜¯ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹ clang::ParseAST() å®ƒåˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œè¿™ä¸ªæ–¹æ³•æä¾›äº†æ„å»ºå’Œéå† AST çš„åŠŸèƒ½ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/// Parse the entire file specified, notifying the ASTConsumer as</span><span class="token comment" spellcheck="true">/// the file is parsed.</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// This operation inserts the parsed decls into the translation</span><span class="token comment" spellcheck="true">/// unit held by Ctx.</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// \param PrintStats Whether to print LLVM statistics related to parsing.</span><span class="token comment" spellcheck="true">/// \param TUKind The kind of translation unit being parsed.</span><span class="token comment" spellcheck="true">/// \param CompletionConsumer If given, an object to consume code completion</span><span class="token comment" spellcheck="true">/// results.</span><span class="token comment" spellcheck="true">/// \param SkipFunctionBodies Whether to skip parsing of function bodies.</span><span class="token comment" spellcheck="true">/// This option can be used, for example, to speed up searches for</span><span class="token comment" spellcheck="true">/// declarations/definitions when indexing.</span><span class="token keyword">void</span> <span class="token function">ParseAST</span><span class="token punctuation">(</span>Preprocessor <span class="token operator">&amp;</span>pp<span class="token punctuation">,</span> ASTConsumer <span class="token operator">*</span>C<span class="token punctuation">,</span>            ASTContext <span class="token operator">&amp;</span>Ctx<span class="token punctuation">,</span> <span class="token keyword">bool</span> PrintStats <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            TranslationUnitKind TUKind <span class="token operator">=</span> TU_Complete<span class="token punctuation">,</span>            CodeCompleteConsumer <span class="token operator">*</span>CompletionConsumer <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span>            <span class="token keyword">bool</span> SkipFunctionBodies <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å…¶ä¸­æ³¨æ„ <code>ASTConsumer *C</code> ï¼Œæ ¹æ®æ³¨é‡Šæè¿°å¯çŸ¥è§£æå®Œæˆçš„æºç æ–‡ä»¶ä¼šé€šè¿‡ ASTConsumer æ¥å›ä¼ ç»™æˆ‘ä»¬ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨è¿™ä¸ªæ¥å£æ—¶æˆ‘ä»¬è¦å®ç°ä¸€ä¸ª ASTConsumer ç”¨æ¥è·å–ã€éå† AST æ ‘ã€‚æŸ¥çœ‹ ASTConsumer çš„å®šä¹‰å¯ä»¥å‘ç°è®¸å¤šå›è°ƒæ¥å£ï¼ŒåŒ…æ‹¬ä¸åŒç±»å‹ã€å±‚çº§ AST ç»“æ„ï¼Œè¿™ä¸‹çœŸç›¸å¤§ç™½äº†ï¼ŒParseAST() æ¥å£å¯ä»¥è¯´æ˜¯ Clang AST æ ‘è§£æå’Œæ„å»ºçš„æ ¸å¿ƒäº†ï¼Œä½†æ˜¯å®ƒçš„ç‰¹æ€§å…¶å®ä¸»è¦åœ¨äºè§£æä»¥åŠé€šè¿‡é’©å­ ASTConsumer æ¥æŠŠåˆ†æåçš„ AST èŠ‚ç‚¹å›ä¼ ç»™æˆ‘ä»¬ï¼Œè€Œæˆ‘ä»¬åœ¨ä½¿ç”¨ ASTFrontendAction æ—¶æ˜¯ä¼šé‡å†™ CreateASTConsumer æ–¹æ³•ï¼Œç›¸å½“äº ASTFrontendAction ä¼šå¸®æˆ‘ä»¬è°ƒç”¨ ParseAST() æ¥å£å¹¶å°†æˆ‘ä»¬çš„ ASTConsumer å®ä¾‹æ³¨å†Œè¿›å»ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å®Œå…¨ä¸ç”¨å…³å¿ƒå®ƒ ğŸ˜€ï¼Œä¸‹è¾¹ä¸¾ä¸€ä¸ªç¼–å†™è‡ªå·± ASTConsumer ä¸ ASTFrontendAction çš„ä¾‹å­ï¼Œé€šè¿‡ç»§æ‰¿ ASTConsumerã€ASTFrontendAction ç„¶åé‡å†™ç›¸å…³å‡½æ•°æ¥å£å³å¯ï¼š</li></ul><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//ASTConsumer.h</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">/// HandleTopLevelDecl - Handle the specified top-level declaration.  This is</span><span class="token comment" spellcheck="true">/// called by the parser to process every top-level Decl*.</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// \returns true to continue parsing, or false to abort parsing.</span><span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">HandleTopLevelDecl</span><span class="token punctuation">(</span>DeclGroupRef D<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">///////////////////////////////////////////////////////////////////////////</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//FrontendAction.h</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">/// Provide a default implementation which returns aborts;</span><span class="token comment" spellcheck="true">/// this method should never be called by FrontendAction clients.</span>std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>ASTConsumer<span class="token operator">></span> <span class="token function">CreateASTConsumer</span><span class="token punctuation">(</span>CompilerInstance <span class="token operator">&amp;</span>CI<span class="token punctuation">,</span>                                                StringRef InFile<span class="token punctuation">)</span> override<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/// Callback at the end of processing a single input.</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// This is guaranteed to only be called following a successful call to</span><span class="token comment" spellcheck="true">/// BeginSourceFileAction (and BeginSourceFile).</span><span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">EndSourceFileAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">///////////////////////////////////////////////////////////////////////////</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//example.cpp</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/AST/ASTConsumer.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Parse/ParseAST.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/AST/DeclGroup.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Frontend/FrontendActions.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Rewrite/Core/Rewriter.h></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> clang<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyASTConsumer</span> <span class="token operator">:</span> <span class="token keyword">public</span> ASTConsumer<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MyASTConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">HandleTopLevelDecl</span><span class="token punctuation">(</span>DeclGroupRef DR<span class="token punctuation">)</span> override    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//for (DeclGroupRef::iterator b = DR.begin(), e = DR.end(); b != e; ++b)</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> b <span class="token operator">:</span> DR<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// variable b has each decleration in DR</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// For each source file provided to the tool, a new FrontendAction is created.</span><span class="token keyword">class</span> <span class="token class-name">MyFrontendAction</span> <span class="token operator">:</span> <span class="token keyword">public</span> ASTFrontendAction<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MyFrontendAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">EndSourceFileAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// EndSourceFileAction</span>    <span class="token punctuation">}</span>    std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>ASTConsumer<span class="token operator">></span> <span class="token function">CreateASTConsumer</span><span class="token punctuation">(</span>CompilerInstance<span class="token operator">&amp;</span> CI<span class="token punctuation">,</span> StringRef file<span class="token punctuation">)</span> override    <span class="token punctuation">{</span>        <span class="token keyword">return</span> std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>MyASTConsumer<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ASTConsumer ä¸­æœ‰å¾ˆå¤š HOOK å‡½æ•°ï¼Œæˆ‘è¿™é‡Œä»¥ HandleTopLevelDecl æ¥å£ä¸ºä¾‹ï¼Œå®ƒä¼šè¿”å›ç»™æˆ‘ä»¬ top-level çš„èŠ‚ç‚¹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éå†è¿™ä¸ªèŠ‚ç‚¹ä»¥ä¸‹æ‰€æœ‰çš„ä¿¡æ¯ã€‚è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸ªæ–°çš„ç±»æ¨¡æ¿ RecursiveASTVisitorï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªç±»æ¨¡æ¿ç”Ÿæˆä¸€ä¸ªè‡ªå·±çš„ visitor ç”¨æ¥éå†æŸä¸ªèŠ‚ç‚¹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//example.cpp</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/AST/ASTConsumer.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/AST/DeclGroup.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/AST/RecursiveASTVisitor.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Parse/ParseAST.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Rewrite/Core/Rewriter.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"spdlog/spdlog.h"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> clang<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyASTVisitor</span> <span class="token operator">:</span> <span class="token keyword">public</span> RecursiveASTVisitor<span class="token operator">&lt;</span>MyASTVisitor<span class="token operator">></span><span class="token punctuation">{</span>    <span class="token keyword">bool</span> <span class="token function">VisitStmt</span><span class="token punctuation">(</span>Stmt<span class="token operator">*</span> s<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        spdlog<span class="token operator">::</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\t{} \n"</span><span class="token punctuation">,</span> s<span class="token operator">-</span><span class="token operator">></span><span class="token function">getStmtClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">VisitFunctionDecl</span><span class="token punctuation">(</span>FunctionDecl<span class="token operator">*</span> f<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token operator">-</span><span class="token operator">></span><span class="token function">hasBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            Stmt<span class="token operator">*</span> FuncBody <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            spdlog<span class="token operator">::</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"{}\n"</span><span class="token punctuation">,</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyASTConsumer</span> <span class="token operator">:</span> <span class="token keyword">public</span> ASTConsumer<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MyASTConsumer</span><span class="token punctuation">(</span>Rewriter<span class="token operator">&amp;</span> R<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">HandleTopLevelDecl</span><span class="token punctuation">(</span>DeclGroupRef DR<span class="token punctuation">)</span> override    <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> b <span class="token operator">:</span> DR<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            MyASTVisitor Visitor<span class="token punctuation">;</span>            Visitor<span class="token punctuation">.</span><span class="token function">TraverseDecl</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä»‹ç»ä¸‹ RecursiveASTVisitor ç±»æ¨¡æ¿ï¼Œå®ƒä¼šæŒ‰ç…§æ·±åº¦ä¼˜å…ˆçš„æœç´¢é¡ºåºéå†æ¯ä¸ª Stmt èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¯¹ AST æ ‘ä¸­çš„æ¯ä¸ª Stmt èŠ‚ç‚¹è°ƒç”¨ç±»æ¨¡æ¿ä¸­ VisitStmt() æ–¹æ³•ï¼Œå¦‚æœ VisitStmt è¿”å› false çš„è¯ï¼Œåˆ™é€’å½’éå†å°†ç»“æŸã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_16.png" alt="RecursiveASTVisitor"></p></li><li><p>æœ€åè¿˜å‰©ä¸‹ä¸€ä¸ªç–‘é—®ç‚¹å°±æ˜¯ï¼ŒCompilerInstance è¯¥æ€ä¹ˆç”¨èµ·æ¥å‘¢ï¼Ÿè¿™é‡Œå°±è¦æåˆ°å¦ä¸€ä¸ªç±»äº† <a href="http://clang.llvm.org/doxygen/classclang_1_1tooling_1_1ClangTool.html">ClangTool</a>ï¼Œè¿™ä¸ªç±»å¯ä»¥è®©æˆ‘ä»¬ç¼–å†™çš„åŠŸèƒ½æ¨¡å—åƒ clang-tidyã€clang-format ç­‰ç­‰ï¼Œå˜èº«æˆå‘½ä»¤è¡Œç¨‹åºã€‚å¤§è‡´æ¥è¯´å°±æ˜¯å°†æˆ‘ä»¬çš„ MyFrontendAction ä¼ ç»™å®ƒï¼Œä¼šè‡ªåŠ¨çš„åˆ›å»º CompilerInstance æ¥è¿è¡Œï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•åœ¨ä¸‹è¾¹çš„ä¾‹å­é‡Œä¼šç»™å‡ºã€‚è‡³æ­¤ç¼–å†™å·¥å…·æ¥è§£æ AST æ ‘çš„æ–¹æ³•ä»‹ç»å®Œæ¯•äº†ã€‚</p></li></ol><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><ul><li><p>æ¥ä¸‹æ¥å°†é€šè¿‡ä¸Šè¾¹çš„çŸ¥è¯†ï¼Œåˆ†æä¸‹ä¹‹å‰å·²ç»å‡ºåœºè¿‡çš„ä¸€ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œä¸€ä¸ªéå†æ‰“å°å‡º AST ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥åˆ¤æ–­ if åˆ†æ”¯çš„ä»£ç ï¼š</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/3_17.png" alt="example"></p></li></ul><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//example.h</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Frontend/FrontendActions.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Rewrite/Core/Rewriter.h></span></span><span class="token keyword">namespace</span> clang<span class="token punctuation">{</span><span class="token comment" spellcheck="true">// For each source file provided to the tool, a new FrontendAction is created.</span><span class="token keyword">class</span> <span class="token class-name">MyFrontendAction</span> <span class="token operator">:</span> <span class="token keyword">public</span> ASTFrontendAction<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MyFrontendAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">EndSourceFileAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override<span class="token punctuation">;</span>    std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>ASTConsumer<span class="token operator">></span> <span class="token function">CreateASTConsumer</span><span class="token punctuation">(</span>CompilerInstance<span class="token operator">&amp;</span> CI<span class="token punctuation">,</span> StringRef file<span class="token punctuation">)</span> override<span class="token punctuation">;</span><span class="token keyword">private</span><span class="token operator">:</span>    Rewriter TheRewriter<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// namespace clang</span><span class="token keyword">int</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//example.cpp</span><span class="token comment" spellcheck="true">//-------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">// Tooling sample. Demonstrates:</span><span class="token comment" spellcheck="true">//</span><span class="token comment" spellcheck="true">// * How to write a simple source tool using libTooling.</span><span class="token comment" spellcheck="true">// * How to use RecursiveASTVisitor to find interesting AST nodes.</span><span class="token comment" spellcheck="true">// * How to use the Rewriter API to rewrite the source code.</span><span class="token comment" spellcheck="true">//</span><span class="token comment" spellcheck="true">// Eli Bendersky (eliben@gmail.com)</span><span class="token comment" spellcheck="true">// This code is in the public domain</span><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sstream></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/AST/AST.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/AST/ASTConsumer.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/AST/RecursiveASTVisitor.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/Frontend/ASTConsumers.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/Frontend/CompilerInstance.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/Tooling/CommonOptionsParser.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/Tooling/Tooling.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"llvm/ADT/STLExtras.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"llvm/Support/raw_ostream.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Function/LoopConvert.h"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> clang<span class="token punctuation">;</span><span class="token keyword">using</span> <span class="token keyword">namespace</span> clang<span class="token operator">::</span>driver<span class="token punctuation">;</span><span class="token keyword">using</span> <span class="token keyword">namespace</span> clang<span class="token operator">::</span>tooling<span class="token punctuation">;</span><span class="token keyword">static</span> llvm<span class="token operator">::</span>cl<span class="token operator">::</span>OptionCategory <span class="token function">ToolingSampleCategory</span><span class="token punctuation">(</span><span class="token string">"Tooling Sample"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// By implementing RecursiveASTVisitor, we can specify which AST nodes</span><span class="token comment" spellcheck="true">// we're interested in by overriding relevant methods.</span><span class="token keyword">class</span> <span class="token class-name">MyASTVisitor</span> <span class="token operator">:</span> <span class="token keyword">public</span> RecursiveASTVisitor<span class="token operator">&lt;</span>MyASTVisitor<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MyASTVisitor</span><span class="token punctuation">(</span>Rewriter<span class="token operator">&amp;</span> R<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">TheRewriter</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">VisitStmt</span><span class="token punctuation">(</span>Stmt<span class="token operator">*</span> s<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// Only care about If statements.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isa<span class="token operator">&lt;</span>IfStmt<span class="token operator">></span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">auto</span><span class="token operator">*</span> IfStatement <span class="token operator">=</span> cast<span class="token operator">&lt;</span>IfStmt<span class="token operator">></span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>            Stmt<span class="token operator">*</span> Then <span class="token operator">=</span> IfStatement<span class="token operator">-</span><span class="token operator">></span><span class="token function">getThen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            TheRewriter<span class="token punctuation">.</span><span class="token function">InsertText</span><span class="token punctuation">(</span>Then<span class="token operator">-</span><span class="token operator">></span><span class="token function">getBeginLoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"// the 'if' part\n"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            Stmt<span class="token operator">*</span> Else <span class="token operator">=</span> IfStatement<span class="token operator">-</span><span class="token operator">></span><span class="token function">getElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>Else<span class="token punctuation">)</span>                TheRewriter<span class="token punctuation">.</span><span class="token function">InsertText</span><span class="token punctuation">(</span>Else<span class="token operator">-</span><span class="token operator">></span><span class="token function">getBeginLoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"// the 'else' part\n"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">VisitFunctionDecl</span><span class="token punctuation">(</span>FunctionDecl<span class="token operator">*</span> f<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// Only function definitions (with bodies), not declarations.</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token operator">-</span><span class="token operator">></span><span class="token function">hasBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            Stmt<span class="token operator">*</span> FuncBody <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// Type name as string</span>            QualType QT <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            std<span class="token operator">::</span>string TypeStr <span class="token operator">=</span> QT<span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// Function name</span>            DeclarationName DeclName <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getNameInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            std<span class="token operator">::</span>string FuncName <span class="token operator">=</span> DeclName<span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// Add comment before</span>            std<span class="token operator">::</span>stringstream SSBefore<span class="token punctuation">;</span>            SSBefore <span class="token operator">&lt;&lt;</span> <span class="token string">"// Begin function "</span> <span class="token operator">&lt;&lt;</span> FuncName <span class="token operator">&lt;&lt;</span> <span class="token string">" returning "</span> <span class="token operator">&lt;&lt;</span> TypeStr <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>            SourceLocation ST <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getSourceRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            TheRewriter<span class="token punctuation">.</span><span class="token function">InsertText</span><span class="token punctuation">(</span>ST<span class="token punctuation">,</span> SSBefore<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// And after</span>            std<span class="token operator">::</span>stringstream SSAfter<span class="token punctuation">;</span>            SSAfter <span class="token operator">&lt;&lt;</span> <span class="token string">"\n// End function "</span> <span class="token operator">&lt;&lt;</span> FuncName<span class="token punctuation">;</span>            ST <span class="token operator">=</span> FuncBody<span class="token operator">-</span><span class="token operator">></span><span class="token function">getEndLoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocWithOffset</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            TheRewriter<span class="token punctuation">.</span><span class="token function">InsertText</span><span class="token punctuation">(</span>ST<span class="token punctuation">,</span> SSAfter<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    Rewriter<span class="token operator">&amp;</span> TheRewriter<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Implementation of the ASTConsumer interface for reading an AST produced</span><span class="token comment" spellcheck="true">// by the Clang parser.</span><span class="token keyword">class</span> <span class="token class-name">MyASTConsumer</span> <span class="token operator">:</span> <span class="token keyword">public</span> ASTConsumer<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MyASTConsumer</span><span class="token punctuation">(</span>Rewriter<span class="token operator">&amp;</span> R<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Visitor</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// Override the method that gets called for each parsed top-level</span>    <span class="token comment" spellcheck="true">// declaration.</span>    <span class="token keyword">bool</span> <span class="token function">HandleTopLevelDecl</span><span class="token punctuation">(</span>DeclGroupRef DR<span class="token punctuation">)</span> override    <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> b <span class="token operator">:</span> DR<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// Traverse the declaration using our AST visitor.</span>            Visitor<span class="token punctuation">.</span><span class="token function">TraverseDecl</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>            b<span class="token operator">-</span><span class="token operator">></span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    MyASTVisitor Visitor<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>ASTConsumer<span class="token operator">></span> MyFrontendAction<span class="token operator">::</span><span class="token function">CreateASTConsumer</span><span class="token punctuation">(</span>CompilerInstance<span class="token operator">&amp;</span> CI<span class="token punctuation">,</span> StringRef file<span class="token punctuation">)</span><span class="token punctuation">{</span>    llvm<span class="token operator">::</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"** Creating AST consumer for: "</span> <span class="token operator">&lt;&lt;</span> file <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>    TheRewriter<span class="token punctuation">.</span><span class="token function">setSourceMgr</span><span class="token punctuation">(</span>CI<span class="token punctuation">.</span><span class="token function">getSourceManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CI<span class="token punctuation">.</span><span class="token function">getLangOpts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>MyASTConsumer<span class="token operator">></span><span class="token punctuation">(</span>TheRewriter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> MyFrontendAction<span class="token operator">::</span><span class="token function">EndSourceFileAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    SourceManager<span class="token operator">&amp;</span> SM <span class="token operator">=</span> TheRewriter<span class="token punctuation">.</span><span class="token function">getSourceMgr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    llvm<span class="token operator">::</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"** EndSourceFileAction for: "</span> <span class="token operator">&lt;&lt;</span> SM<span class="token punctuation">.</span><span class="token function">getFileEntryForID</span><span class="token punctuation">(</span>SM<span class="token punctuation">.</span><span class="token function">getMainFileID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Now emit the rewritten buffer.</span>    TheRewriter<span class="token punctuation">.</span><span class="token function">getEditBuffer</span><span class="token punctuation">(</span>SM<span class="token punctuation">.</span><span class="token function">getMainFileID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>llvm<span class="token operator">::</span><span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>    CommonOptionsParser <span class="token function">op</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> ToolingSampleCategory<span class="token punctuation">)</span><span class="token punctuation">;</span>    ClangTool <span class="token function">Tool</span><span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token function">getCompilations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> op<span class="token punctuation">.</span><span class="token function">getSourcePathList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ClangTool::run accepts a FrontendActionFactory, which is then used to</span>    <span class="token comment" spellcheck="true">// create new objects implementing the FrontendAction interface. Here we use</span>    <span class="token comment" spellcheck="true">// the helper newFrontendActionFactory to create a default factory that will</span>    <span class="token comment" spellcheck="true">// return a new MyFrontendAction object every time.</span>    <span class="token comment" spellcheck="true">// To further customize this, we could create our own factory class.</span>    <span class="token keyword">return</span> Tool<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>newFrontendActionFactory<span class="token operator">&lt;</span>MyFrontendAction<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><p>ä½¿ç”¨å‘½ä»¤è¡Œæ¥åˆå§‹åŒ– Clang å·¥å…·ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨ CommonOptionsParser ç±»ã€‚æŸ¥çœ‹æ³¨é‡Šå¯ä»¥äº†è§£åˆ°ï¼Œè¿™ä¸ªç±»æ˜¯æ‰€æœ‰å‘½ä»¤è¡Œ clang å·¥å…·å…¬ç”¨çš„å‘½ä»¤è§£æå™¨ï¼Œå®ƒå¯ä»¥è§£æå‘½ä»¤è¡Œå‘½ä»¤å‚æ•°ï¼Œä¾‹å¦‚æŒ‡å®š <code>compilation commands database</code> é“¾æ¥è·¯å¾„ï¼Œæˆ–è€…ç”¨æˆ·æ‰§è¡Œæ—¶æŒ‡å®šçš„å…¶ä»–æŒ‡ä»¤ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/// A parser for options common to all command-line Clang tools.</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// Parses a common subset of command-line arguments, locates and loads a</span><span class="token comment" spellcheck="true">/// compilation commands database and runs a tool with user-specified action. It</span><span class="token comment" spellcheck="true">/// also contains a help message for the common command-line options.</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// An example of usage:</span><span class="token comment" spellcheck="true">/// \code</span><span class="token comment" spellcheck="true">/// #include "clang/Frontend/FrontendActions.h"</span><span class="token comment" spellcheck="true">/// #include "clang/Tooling/CommonOptionsParser.h"</span><span class="token comment" spellcheck="true">/// #include "clang/Tooling/Tooling.h"</span><span class="token comment" spellcheck="true">/// #include "llvm/Support/CommandLine.h"</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// using namespace clang::tooling;</span><span class="token comment" spellcheck="true">/// using namespace llvm;</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// static cl::OptionCategory MyToolCategory("My tool options");</span><span class="token comment" spellcheck="true">/// static cl::extrahelp CommonHelp(CommonOptionsParser::HelpMessage);</span><span class="token comment" spellcheck="true">/// static cl::extrahelp MoreHelp("\nMore help text...\n");</span><span class="token comment" spellcheck="true">/// static cl::opt&lt;bool> YourOwnOption(...);</span><span class="token comment" spellcheck="true">/// ...</span><span class="token comment" spellcheck="true">///</span><span class="token comment" spellcheck="true">/// int main(int argc, const char **argv) {</span><span class="token comment" spellcheck="true">///   CommonOptionsParser OptionsParser(argc, argv, MyToolCategory);</span><span class="token comment" spellcheck="true">///   ClangTool Tool(OptionsParser.getCompilations(),</span><span class="token comment" spellcheck="true">///                  OptionsParser.getSourcePathList());</span><span class="token comment" spellcheck="true">///   return Tool.run(newFrontendActionFactory&lt;SyntaxOnlyAction>().get());</span><span class="token comment" spellcheck="true">/// }</span><span class="token comment" spellcheck="true">/// \endcode</span><span class="token keyword">class</span> <span class="token class-name">CommonOptionsParser</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>ClangTool::run accepts a FrontendActionFactory</code> è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æƒ³è¦è¿è¡Œè‡ªå·±ç¼–å†™çš„ FrontendAction å…¥å£äº†ï¼Œå°†å…¶ä¼ å…¥å³å¯ã€‚</p></li><li><p>å½“æ„å»º AST æ ‘åä¼šè°ƒç”¨ MyFrontendAction::CreateASTConsumer æ¥ä½¿ç”¨æˆ‘ä»¬å®¢åˆ¶åŒ–å®ç°çš„ ASTConsumerï¼Œå¹¶å°†ç›¸å…³èŠ‚ç‚¹è¿”å›ç»™æˆ‘ä»¬ã€‚MyFrontendAction ä¸­å¯ä»¥å‘ç°æœ‰ä¸€ä¸ª TheRewriter æˆå‘˜ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å†™å™¨ï¼Œä¸»è¦æ˜¯ç”¨æ¥å°†æˆ‘ä»¬ if else æ·»åŠ å®Œæ³¨é‡Šçš„ä»£ç è¿›è¡Œå›å†™ã€‚</p></li><li><p>HandleTopLevelDecl ä¼šå›è°ƒç»™æˆ‘ä»¬ç›¸åº”çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œä½¿ç”¨ MyASTVisitor æ¥å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½å³å¯ã€‚</p></li></ol><h2 id="å…¶ä»–æ³¨æ„"><a href="#å…¶ä»–æ³¨æ„" class="headerlink" title="å…¶ä»–æ³¨æ„"></a>å…¶ä»–æ³¨æ„</h2><ul><li><p>é€šè¿‡é‡å†™äº† <a href="https://clang.llvm.org/doxygen/classclang_1_1ASTConsumer.html#ad34fb88d1588902a847926224c8c939b">virtual bool HandleTopLevelDecl (DeclGroupRef D)</a> æ¥å®ç°äº†éå† top-level çš„ Declï¼Œè¿™ä¸ªæ¥å£æœ‰ä¸ªç‰¹ç‚¹æ˜¯æ¯æ¬¡åˆ†æåˆ°ä¸€ä¸ªé¡¶å±‚å®šä¹‰æ—¶å°±ä¼šå›è°ƒï¼Œä¹Ÿå°±æ˜¯è¯´è°ƒç”¨è¿™ä¸ªæ¥å£æ—¶æ–‡ä»¶è¿˜æ²¡æœ‰åˆ†æå®Œæˆï¼Œç›¸å½“äºä¸€è¾¹åˆ†æï¼Œä¸€è¾¹è°ƒç”¨ï¼Œ</p><ul><li><a href="https://clang.llvm.org/doxygen/classclang_1_1DeclGroupRef.html">DeclGroupRef</a> ä¸€ç»„å®šä¹‰çš„åˆ—è¡¨èŠ‚ç‚¹å¼•ç”¨ã€‚</li></ul></li><li><p>è¿˜æœ‰ä¸€ä¸ª <a href="https://clang.llvm.org/doxygen/classclang_1_1ASTConsumer.html#a2bea2db1d0e8af16c60ee7847f0d46ff">virtual void HandleTranslationUnit (ASTContext &amp;Ctx)</a> å½“æ•´ä¸ªç¿»è¯‘å•å…ƒçš„ AST å·²è¢«è§£ææ—¶ï¼Œå°†è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p><ul><li><a href="https://clang.llvm.org/doxygen/classclang_1_1ASTContext.html">ASTContext</a> åŒ…å«åœ¨æ•´ä¸ªæ–‡ä»¶çš„è¯­ä¹‰åˆ†æä¸­æ‰€æŸ¥æ‰¾åˆ°çš„é•¿å¯¿ AST èŠ‚ç‚¹ï¼Œä¾‹å¦‚ç±»å‹ä»¥åŠå®šä¹‰ã€‚ä¹Ÿå°±æ˜¯è¯´åŒ…å«äº†æ–‡ä»¶åˆ†æåæ‰€æœ‰ AST å…³é”®èŠ‚ç‚¹ä¿¡æ¯ã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> LLVM ç¼–è¯‘å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLVM ç¼–è¯‘å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ï¼ˆäºŒï¼‰LLVMç¼–è¯‘å™¨--æ„å»º_Clang_libTooling_å·¥å…·</title>
      <link href="/2022/06/03/er-llvm-bian-yi-qi-gou-jian-clang-libtooling-gong-ju/"/>
      <url>/2022/06/03/er-llvm-bian-yi-qi-gou-jian-clang-libtooling-gong-ju/</url>
      
        <content type="html"><![CDATA[<h1 id="æ„å»ºè‡ªå·±çš„-Clang-libTooling-å·¥å…·"><a href="#æ„å»ºè‡ªå·±çš„-Clang-libTooling-å·¥å…·" class="headerlink" title="æ„å»ºè‡ªå·±çš„ Clang libTooling å·¥å…·"></a>æ„å»ºè‡ªå·±çš„ Clang libTooling å·¥å…·</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»å°±æ˜¯å¦‚ä½•é€šè¿‡ llvm æºç å»æ„å»ºå±äºè‡ªå·±çš„ Clang Tooling å·¥å…·ï¼Œç”±äºä¹‹å‰ç¯å¢ƒæ˜¯æ­å»ºåœ¨ Windows ä¸‹ï¼Œæ‰€ä»¥æœ¬ç¯‡ä¸»è¦ä¹Ÿæ˜¯åœ¨ Windows ä¸‹è¿›è¡Œï¼Œå¦‚æœä½ ä½¿ç”¨å…¶ä»–å¹³å°ä¸å¿…æ‹…å¿ƒï¼Œå·®å¼‚ä¸å¤§ã€‚</li></ul><h2 id="ä»€ä¹ˆæ˜¯-Clang-libTooling-å·¥å…·"><a href="#ä»€ä¹ˆæ˜¯-Clang-libTooling-å·¥å…·" class="headerlink" title="ä»€ä¹ˆæ˜¯ Clang libTooling å·¥å…·"></a>ä»€ä¹ˆæ˜¯ Clang libTooling å·¥å…·</h2><ul><li>Clang æˆ‘æƒ³ä¼šçœ‹è¿™ç¯‡æ–‡ç« çš„äººåº”è¯¥éƒ½ä¸ä¼šå®Œå…¨é™Œç”Ÿï¼Œç°åœ¨ Clang ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨çš„å‰ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•ä½¿ç”¨ Clang å¼ºå¤§çš„æºç è§£æã€æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚å¦‚æœæƒ³è¦è¯¦ç»†äº†è§£ç‚¹<a href="http://clang.llvm.org/docs/">è¿™é‡Œçš„å®˜æ–¹æ–‡æ¡£</a>å’Œ<a href="https://www.jianshu.com/p/403dd226c420">å¤§ä½¬çš„ BLOG</a>ï¼š<ol><li>libclang : å®ƒè¿˜å¯ä»¥ä½œä¸ºä¸€ä¸ªåŠŸèƒ½åº“æä¾›ä¸€äº›ç”¨äºæºç è§£æ AST çš„ç¨³å®šé«˜çº§ C è¯­è¨€æŠ½è±¡æ¥å£ã€‚</li><li>clang libTooling : C++ æ¥å£ï¼Œæ—¨åœ¨ç¼–å†™ç‹¬ç«‹å·¥å…·ï¼Œä»¥åŠé›†æˆåˆ°è¿è¡Œ clang å·¥å…·çš„æœåŠ¡ä¸­ã€‚</li><li>clang plugin : Clang æ’ä»¶å…è®¸æ‚¨åœ¨ AST ä¸Šæ·»åŠ è¿è¡Œå…¶ä»–æ“ä½œä½œä¸ºç¼–è¯‘çš„ä¸€éƒ¨åˆ†ã€‚æ’ä»¶æ˜¯ç”±ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶åŠ è½½çš„åŠ¨æ€åº“ï¼Œå®ƒä»¬å¾ˆå®¹æ˜“é›†æˆåˆ°æ„å»ºç¯å¢ƒä¸­ã€‚</li></ol></li></ul><h2 id="Itâ€™s-time-up"><a href="#Itâ€™s-time-up" class="headerlink" title="Itâ€™s time up"></a>Itâ€™s time up</h2><ul><li>æœ¬æ–‡ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š<ol><li>é€šè¿‡ llvm å·¥ç¨‹æ„å»ºä¸€ä¸ªå¯ä»¥æä¾›è‡ªå·±éœ€è¦çš„åŠŸèƒ½å·¥å…·ã€‚</li><li>å¦‚ä½•å°†è¯¥å·¥å…·ä»¥æ¨¡å—çš„å½¢å¼é›†æˆåˆ°è‡ªå·±çš„å·¥ç¨‹ä¸­ã€‚</li><li>ç›´æ¥é€šè¿‡æºç åœ¨è‡ªå·±çš„å·¥ç¨‹ä¸­è¿›è¡Œç¼–è¯‘ã€‚</li></ol></li></ul><h3 id="æ„å»ºä¸€ä¸ªä»£ç è§£æå·¥å…·"><a href="#æ„å»ºä¸€ä¸ªä»£ç è§£æå·¥å…·" class="headerlink" title="æ„å»ºä¸€ä¸ªä»£ç è§£æå·¥å…·"></a>æ„å»ºä¸€ä¸ªä»£ç è§£æå·¥å…·</h3><p>å…¶å®<a href="https://juejin.im/post/5c3075bae51d455270151f41">å‚è€ƒ</a>è¿™ç¯‡æ–‡æ¡£æè¿°çš„å¾ˆè¯¦ç»†äº†ï¼Œå¦‚æœä½ å·²ç»æ­£ç¡®é€šè¿‡æºç æ­å»ºäº† LLVM ç¯å¢ƒï¼Œé‚£ä¹ˆæ“ä½œèµ·æ¥æ˜¯éå¸¸ç®€å•çš„ã€‚</p><ol><li><p>é¦–å…ˆï¼Œåœ¨ clang/tools/ ç›®å½•ä¸‹æ–°åŠ ä¸€ä¸ªè‡ªå·±éœ€è¦çš„å·¥å…·ç›®å½•ï¼Œè¿™é‡Œä»¥ <code>QtPlugin</code> ä¸ºä¾‹ï¼Œç„¶åæ·»åŠ è‡ªå·±çš„æºæ–‡ä»¶ä»¥åŠ CmakeLists.txtã€‚</p><ul><li><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/2_1.png" alt="åˆ›å»ºè‡ªå·±çš„å·¥å…·æ–‡ä»¶å¤¹"></li></ul></li><li><p>ä¿®æ”¹çˆ¶ç›®å½•ä¸‹çš„ CMakeLists.txt æ·»åŠ åˆšåˆšåˆ›å»ºçš„ QtPlugin ç›®å½•ã€‚</p><ul><li><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/2_2.png" alt="æ·»åŠ è‡ªå·±çš„å·¥å…·æ–‡ä»¶å¤¹"></li></ul></li><li><p>æ¥ä¸‹æ¥ç¼–å†™è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ä»£ç ï¼Œç„¶ååˆ›å»ºç¼–å†™ QtPlugin ç›®å½•ä¸‹çš„ CmakeLists.txt å‚è€ƒç€åŒä¸€çº§ç›®å½•ä¸­å…¶ä»– tools æ¥å°±è¡Œã€‚</p><pre class="line-numbers language-sh"><code class="language-sh">set(LLVM_LINK_COMPONENTS    Support)add_clang_executable(QTPluginTooling    QtPlugin.cpp)clang_target_link_libraries(QTPluginTooling    PRIVATE    clangAST    clangBasic    clangDriver    clangFormat    clangLex    clangParse    clangSema    clangFrontend    clangTooling    clangToolingCore    clangRewrite    clangRewriteFrontend)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ¥ä¸‹æ¥ç¡®ä¿ä½ çš„ CMakeTools å‚æ•°é…ç½®é¡¹ clang æ¨¡å—å¤„äº enable çŠ¶æ€(è¯¦æƒ…å‚è§é…ç½® LLVM ç¯å¢ƒé…ç½®)ï¼Œé€šè¿‡ç‚¹å‡»ç”Ÿæˆï¼ŒCMakeTools å·¥å…·ç›´æ¥ç¼–è¯‘ç”Ÿæˆå³å¯ã€‚æœ€ç»ˆå¯ä»¥åœ¨ build/bin ç›®å½•ä¸‹æ‰¾åˆ°ä½ åˆšåˆšç”Ÿæˆçš„å·¥å…·ã€‚</p></li></ol><h3 id="å°†å·¥å…·é›†æˆåˆ°ä½ çš„å·¥ç¨‹ä¸­"><a href="#å°†å·¥å…·é›†æˆåˆ°ä½ çš„å·¥ç¨‹ä¸­" class="headerlink" title="å°†å·¥å…·é›†æˆåˆ°ä½ çš„å·¥ç¨‹ä¸­"></a>å°†å·¥å…·é›†æˆåˆ°ä½ çš„å·¥ç¨‹ä¸­</h3><p>Emmmmâ€¦ å¯èƒ½ä½ è§‰å¾—ç”Ÿæˆä¸ªå¯æ‰§è¡Œå¾—å·¥å…·å¹¶ä¸æ»¡è¶³ï¼Œæƒ³è¦è®© clang å¼ºå¤§å¾—åŠŸèƒ½åœ¨è‡ªå·±é¡¹ç›®ä¸­æ›´åŠ <code>ç´§å¯†</code>çš„ä½¿ç”¨ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥é›†æˆ clang å·²ç»æä¾›çš„ libTooling ç­‰åŠŸèƒ½åº“ï¼Œç”šè‡³è‡ªå·±ç”Ÿæˆå®šåˆ¶çš„åŠŸèƒ½æ¨¡å—ï¼Œä»¥åº“å¾—å½¢å¼æä¾›åŠŸèƒ½åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚</p><ul><li><a href="https://github.com/eliben/llvm-clang-samples">è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆæ£’çš„ github é¡¹ç›®å…³äº LLVM-clang çš„ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œå¯æƒœçš„æ˜¯ç”±äº LLVM-clang å‘å±•çš„è¿…é€Ÿï¼ŒC++ æ¥å£å¹¶ä¸ç¨³å®šï¼Œ10.0.0 ç‰ˆæœ¬çš„ç¨‹åºå¯èƒ½åœ¨ä¸‹ä¸€ç‰ˆæœ¬ç¼–è¯‘éƒ½ä¼šå¤±è´¥æ‰ï¼Œå› æ­¤æœ¬å°èŠ‚ä¼šé€‰å–ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå¯ä»¥åœ¨ 10.0.0 ä¸‹ç¼–è¯‘é€šè¿‡ï¼Œç”ŸæˆåŠŸèƒ½åº“åé›†æˆåˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚<blockquote><p>å½“å‰ LLVM å·²ç»å‘å¸ƒäº† 14ï¼Œå¦‚æœæœ‰ç¼–è¯‘é”™è¯¯çš„é—®é¢˜è¯·é‚®ä»¶å‘Šè¯‰æˆ‘ï¼Œè°¢è°¢ï½</p></blockquote></li></ul><ol><li><p>è¿˜è®°å¾—ä¸Šä¸€èŠ‚ä¸­çš„ clang æ–‡ä»¶å¤¹ä¹ˆï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­ç¼–å†™äº†ç¨‹åºä»¥åŠ CmakeLists.txt æœ€ç»ˆç”Ÿæˆäº†å¯ä»¥æ‰§è¡Œçš„å°å·¥å…·ã€‚è€Œè¿™ä¸€èŠ‚æˆ‘ä»¬çš„ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªåº“ï¼Œè¿™é‡Œæˆ‘æ˜¯å°†å·¥å…·æºç ç›®å½•æ”¾åˆ°äº†ä¸ clang åŒçº§çš„ç›®å½•ä¸‹ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª clang-tool-extra æ–‡ä»¶å¤¹å†…ï¼Œå¯ä»¥å‘ç°è¿™ä¸ªç›®å½•ä¸‹å°±æ˜¯ä¸€äº› clang æä¾›å¾—æ‰©å±•åŠŸèƒ½åº“ï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè‡ªå·±å¾—å·¥å…·æ–‡ä»¶å¤¹ï¼Œå¹¶å¦‚å›¾ä¸­ä¸€æ ·åˆ›å»ºéœ€è¦çš„æºæ–‡ä»¶ä»¥åŠ CmakeLists.txt ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/2_3.png" alt="æ–°å»ºå·¥å…·ç›®å½•"></p></li><li><p>ä¸º LoopConvert.cpp å’Œ LoopConvert.h æ·»åŠ æºä»£ç ï¼Œ<a href="https://github.com/eliben/llvm-clang-samples/blob/master/src_clang/tooling_sample.cpp">å‚è€ƒçš„æºä»£ç </a>ï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªåº“ï¼Œå› æ­¤å°† main å‡½æ•°å˜æˆä¸€ä¸ª C æ¥å£åŠŸèƒ½å‡½æ•°ï¼Œä»¥åŠå°†åŠŸèƒ½ç±»å¾—å®šä¹‰æŠ½å‡ºåˆ° .h å¤´æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿æˆ‘ä»¬è‡ªå·±çš„é¡¹ç›®è°ƒç”¨ç›¸åº”å¾—åŠŸèƒ½ã€‚llvm-clang-samples é¡¹ç›®ä¸­çš„æºä»£ç æœ‰ä¸€äº›æ¥å£å…¼å®¹æ€§çš„é”™è¯¯å·²ç»ä¿®å¤ï¼Œä¸‹è¾¹æ˜¯æºç ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//  LoopConvert.h</span><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Frontend/FrontendActions.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;clang/Rewrite/Core/Rewriter.h></span></span><span class="token keyword">namespace</span> clang <span class="token punctuation">{</span><span class="token comment" spellcheck="true">// For each source file provided to the tool, a new FrontendAction is created.</span><span class="token keyword">class</span> <span class="token class-name">MyFrontendAction</span> <span class="token operator">:</span> <span class="token keyword">public</span> ASTFrontendAction <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span><span class="token function">MyFrontendAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">EndSourceFileAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override<span class="token punctuation">;</span>std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>ASTConsumer<span class="token operator">></span> <span class="token function">CreateASTConsumer</span><span class="token punctuation">(</span>CompilerInstance <span class="token operator">&amp;</span>CI<span class="token punctuation">,</span>                                                StringRef file<span class="token punctuation">)</span> override<span class="token punctuation">;</span><span class="token keyword">private</span><span class="token operator">:</span>Rewriter TheRewriter<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// namespace clang</span><span class="token keyword">int</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//  LoopConvert.cpp</span><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">// Tooling sample. Demonstrates:</span><span class="token comment" spellcheck="true">//</span><span class="token comment" spellcheck="true">// * How to write a simple source tool using libTooling.</span><span class="token comment" spellcheck="true">// * How to use RecursiveASTVisitor to find interesting AST nodes.</span><span class="token comment" spellcheck="true">// * How to use the Rewriter API to rewrite the source code.</span><span class="token comment" spellcheck="true">//</span><span class="token comment" spellcheck="true">// Eli Bendersky (eliben@gmail.com)</span><span class="token comment" spellcheck="true">// This code is in the public domain</span><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sstream></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/AST/AST.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/AST/ASTConsumer.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/AST/RecursiveASTVisitor.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/Frontend/ASTConsumers.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/Frontend/CompilerInstance.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/Tooling/CommonOptionsParser.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clang/Tooling/Tooling.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"llvm/Support/raw_ostream.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;llvm\ADT\STLExtras.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"LoopConvert.h"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> clang<span class="token punctuation">;</span><span class="token keyword">using</span> <span class="token keyword">namespace</span> clang<span class="token operator">::</span>driver<span class="token punctuation">;</span><span class="token keyword">using</span> <span class="token keyword">namespace</span> clang<span class="token operator">::</span>tooling<span class="token punctuation">;</span><span class="token keyword">static</span> llvm<span class="token operator">::</span>cl<span class="token operator">::</span>OptionCategory <span class="token function">ToolingSampleCategory</span><span class="token punctuation">(</span><span class="token string">"Tooling Sample"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// By implementing RecursiveASTVisitor, we can specify which AST nodes</span><span class="token comment" spellcheck="true">// we're interested in by overriding relevant methods.</span><span class="token keyword">class</span> <span class="token class-name">MyASTVisitor</span> <span class="token operator">:</span> <span class="token keyword">public</span> RecursiveASTVisitor<span class="token operator">&lt;</span>MyASTVisitor<span class="token operator">></span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span><span class="token function">MyASTVisitor</span><span class="token punctuation">(</span>Rewriter <span class="token operator">&amp;</span>R<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">TheRewriter</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">bool</span> <span class="token function">VisitStmt</span><span class="token punctuation">(</span>Stmt <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Only care about If statements.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isa<span class="token operator">&lt;</span>IfStmt<span class="token operator">></span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    IfStmt <span class="token operator">*</span>IfStatement <span class="token operator">=</span> cast<span class="token operator">&lt;</span>IfStmt<span class="token operator">></span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>    Stmt <span class="token operator">*</span>Then <span class="token operator">=</span> IfStatement<span class="token operator">-</span><span class="token operator">></span><span class="token function">getThen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    TheRewriter<span class="token punctuation">.</span><span class="token function">InsertText</span><span class="token punctuation">(</span>Then<span class="token operator">-</span><span class="token operator">></span><span class="token function">getBeginLoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"// the 'if' part\n"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                            <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Stmt <span class="token operator">*</span>Else <span class="token operator">=</span> IfStatement<span class="token operator">-</span><span class="token operator">></span><span class="token function">getElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Else<span class="token punctuation">)</span>        TheRewriter<span class="token punctuation">.</span><span class="token function">InsertText</span><span class="token punctuation">(</span>Else<span class="token operator">-</span><span class="token operator">></span><span class="token function">getBeginLoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"// the 'else' part\n"</span><span class="token punctuation">,</span>                            <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">bool</span> <span class="token function">VisitFunctionDecl</span><span class="token punctuation">(</span>FunctionDecl <span class="token operator">*</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Only function definitions (with bodies), not declarations.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token operator">-</span><span class="token operator">></span><span class="token function">hasBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    Stmt <span class="token operator">*</span>FuncBody <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Type name as string</span>    QualType QT <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token operator">::</span>string TypeStr <span class="token operator">=</span> QT<span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Function name</span>    DeclarationName DeclName <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getNameInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    std<span class="token operator">::</span>string FuncName <span class="token operator">=</span> DeclName<span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Add comment before</span>    std<span class="token operator">::</span>stringstream SSBefore<span class="token punctuation">;</span>    SSBefore <span class="token operator">&lt;&lt;</span> <span class="token string">"// Begin function "</span> <span class="token operator">&lt;&lt;</span> FuncName <span class="token operator">&lt;&lt;</span> <span class="token string">" returning "</span> <span class="token operator">&lt;&lt;</span> TypeStr            <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>    SourceLocation ST <span class="token operator">=</span> f<span class="token operator">-</span><span class="token operator">></span><span class="token function">getSourceRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    TheRewriter<span class="token punctuation">.</span><span class="token function">InsertText</span><span class="token punctuation">(</span>ST<span class="token punctuation">,</span> SSBefore<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// And after</span>    std<span class="token operator">::</span>stringstream SSAfter<span class="token punctuation">;</span>    SSAfter <span class="token operator">&lt;&lt;</span> <span class="token string">"\n// End function "</span> <span class="token operator">&lt;&lt;</span> FuncName<span class="token punctuation">;</span>    ST <span class="token operator">=</span> FuncBody<span class="token operator">-</span><span class="token operator">></span><span class="token function">getEndLoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocWithOffset</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    TheRewriter<span class="token punctuation">.</span><span class="token function">InsertText</span><span class="token punctuation">(</span>ST<span class="token punctuation">,</span> SSAfter<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>Rewriter <span class="token operator">&amp;</span>TheRewriter<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Implementation of the ASTConsumer interface for reading an AST produced</span><span class="token comment" spellcheck="true">// by the Clang parser.</span><span class="token keyword">class</span> <span class="token class-name">MyASTConsumer</span> <span class="token operator">:</span> <span class="token keyword">public</span> ASTConsumer <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span><span class="token function">MyASTConsumer</span><span class="token punctuation">(</span>Rewriter <span class="token operator">&amp;</span>R<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Visitor</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// Override the method that gets called for each parsed top-level</span><span class="token comment" spellcheck="true">// declaration.</span><span class="token keyword">bool</span> <span class="token function">HandleTopLevelDecl</span><span class="token punctuation">(</span>DeclGroupRef DR<span class="token punctuation">)</span> override <span class="token punctuation">{</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>DeclGroupRef<span class="token operator">::</span>iterator b <span class="token operator">=</span> DR<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e <span class="token operator">=</span> DR<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> b <span class="token operator">!=</span> e<span class="token punctuation">;</span> <span class="token operator">++</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Traverse the declaration using our AST visitor.</span>    Visitor<span class="token punctuation">.</span><span class="token function">TraverseDecl</span><span class="token punctuation">(</span><span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>MyASTVisitor Visitor<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>std<span class="token operator">::</span>unique_ptr<span class="token operator">&lt;</span>ASTConsumer<span class="token operator">></span>MyFrontendAction<span class="token operator">::</span><span class="token function">CreateASTConsumer</span><span class="token punctuation">(</span>CompilerInstance <span class="token operator">&amp;</span>CI<span class="token punctuation">,</span> StringRef file<span class="token punctuation">)</span> <span class="token punctuation">{</span>    llvm<span class="token operator">::</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"** Creating AST consumer for: "</span> <span class="token operator">&lt;&lt;</span> file <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>    TheRewriter<span class="token punctuation">.</span><span class="token function">setSourceMgr</span><span class="token punctuation">(</span>CI<span class="token punctuation">.</span><span class="token function">getSourceManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CI<span class="token punctuation">.</span><span class="token function">getLangOpts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> std<span class="token operator">::</span>make_unique<span class="token operator">&lt;</span>MyASTConsumer<span class="token operator">></span><span class="token punctuation">(</span>TheRewriter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> MyFrontendAction<span class="token operator">::</span><span class="token function">EndSourceFileAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    SourceManager <span class="token operator">&amp;</span>SM <span class="token operator">=</span> TheRewriter<span class="token punctuation">.</span><span class="token function">getSourceMgr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    llvm<span class="token operator">::</span><span class="token function">errs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"** EndSourceFileAction for: "</span>                <span class="token operator">&lt;&lt;</span> SM<span class="token punctuation">.</span><span class="token function">getFileEntryForID</span><span class="token punctuation">(</span>SM<span class="token punctuation">.</span><span class="token function">getMainFileID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Now emit the rewritten buffer.</span>    TheRewriter<span class="token punctuation">.</span><span class="token function">getEditBuffer</span><span class="token punctuation">(</span>SM<span class="token punctuation">.</span><span class="token function">getMainFileID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>llvm<span class="token operator">::</span><span class="token function">outs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>    CommonOptionsParser <span class="token function">op</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> ToolingSampleCategory<span class="token punctuation">)</span><span class="token punctuation">;</span>    ClangTool <span class="token function">Tool</span><span class="token punctuation">(</span>op<span class="token punctuation">.</span><span class="token function">getCompilations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> op<span class="token punctuation">.</span><span class="token function">getSourcePathList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// ClangTool::run accepts a FrontendActionFactory, which is then used to</span>    <span class="token comment" spellcheck="true">// create new objects implementing the FrontendAction interface. Here we use</span>    <span class="token comment" spellcheck="true">// the helper newFrontendActionFactory to create a default factory that will</span>    <span class="token comment" spellcheck="true">// return a new MyFrontendAction object every time.</span>    <span class="token comment" spellcheck="true">// To further customize this, we could create our own factory class.</span>    <span class="token keyword">return</span> Tool<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>newFrontendActionFactory<span class="token operator">&lt;</span>MyFrontendAction<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç¼–å†™ CmakeLists.txt ï¼Œè¿™éƒ¨åˆ†å‚è€ƒå…¶ä»–ç›®å½•ä¸‹çš„å·¥å…·ç¼–å†™å³å¯ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">set(LLVM_LINK_COMPONENTS    Support)add_clang_library(LoopConvertTooling    LoopConvert.cpp    LINK_LIBS    clangAST    clangBasic    clangDriver    clangFormat    clangLex    clangParse    clangSema    clangFrontend    clangTooling    clangToolingCore    clangRewrite    clangRewriteFrontend)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨ clang-tools-extra ç›®å½•ä¸‹çš„ CmakeLists.txt ä¸‹æ·»åŠ æˆ‘ä»¬æ–°å¢å·¥å…·çš„ç›®å½•ã€‚<code>add_subdirectory(LoopConvert)</code>ã€‚</p></li><li><p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œç¡®ä¿ clang-tools-extra ç¼–è¯‘æŒ‡ä»¤æ˜¯ enable ï¼Œç‚¹å‡» CmakeTools çš„ç”ŸæˆæŒ‰é’®å³å¯ï¼Œæœ€ç»ˆå³å¯åœ¨ build/lib ç›®å½•ä¸‹ç”Ÿæˆæˆ‘ä»¬å®šåˆ¶çš„çš„åŠŸèƒ½åº“ï¼Œå³ LoopConvertTooling.libï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">[main] æ­£åœ¨ç”Ÿæˆæ–‡ä»¶å¤¹: llvm-project-10.0.0[build] æ­£åœ¨å¯åŠ¨ç”Ÿæˆ[proc] æ‰§è¡Œå‘½ä»¤: "F:\Visual Studio\Common7\IDE\CommonExtensions\Microsoft\CMake\CMake\bin\cmake.EXE" --build f:/LLVM10/llvm-project-10.0.0/build --config Release --target all -- -j 14[build] [1/2  50% :: 16.844] Building CXX object tools\clang\tools\extra\LoopConvert\CMakeFiles\obj.LoopConvertTooling.dir\LoopConvert.cpp.obj[build] [2/2 100% :: 17.265] Linking CXX static library lib\LoopConvertTooling.lib[build] ç”Ÿæˆå·²å®Œæˆï¼Œé€€å‡ºä»£ç ä¸º 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="ä½¿ç”¨ç¼–è¯‘å‡ºçš„-libTooling"><a href="#ä½¿ç”¨ç¼–è¯‘å‡ºçš„-libTooling" class="headerlink" title="ä½¿ç”¨ç¼–è¯‘å‡ºçš„ libTooling"></a>ä½¿ç”¨ç¼–è¯‘å‡ºçš„ libTooling</h3><ol><li><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•å°†æˆ‘ä»¬ç”Ÿæˆçš„ LoopConvertTooling åº“é›†æˆåˆ°æˆ‘ä»¬è‡ªå·±çš„é¡¹ç›®ä¸­å»ç©è€äº†ï¼Œé¦–å…ˆä¸¾ä¸ªæ —å­ï¼Œä¸‹è¾¹æ˜¯æˆ‘çš„æµ‹è¯•ä»£ç ï¼Œç®€å•çš„è°ƒç”¨äº†æµ‹è¯•ç”¨çš„ C æ¥å£ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token comment" spellcheck="true">//  main.cpp</span><span class="token comment" spellcheck="true">//------------------------------------------------------------------------------</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"LoopConvert.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"spdlog/spdlog.h"</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>argc <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        spdlog<span class="token operator">::</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"You input wrong number arguments!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    FILE <span class="token operator">*</span>result <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        spdlog<span class="token operator">::</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Can't open the file: {}.\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">Function</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é¦–å…ˆè¦ç¡®ä¿æœ‰ç¯å¢ƒå˜é‡æˆ–è€…æŒ‡å®šè·¯å¾„å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬åˆšæ‰ç”Ÿæˆçš„ LoopConvertTooling åº“å’Œ LoopConvert.h å¤´æ–‡ä»¶ã€‚å¦‚å›¾æˆ‘å°†å…¶æ‹·åˆ°äº†æˆ‘çš„å·¥ç¨‹ç›®å½•ä¸‹ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/2_4.png" alt="ç›¸å…³æ–‡ä»¶"></p></li><li><p>æ¥ä¸‹æ¥æ˜¯ç¼–å†™ç”¨äºç¼–è¯‘&amp;é“¾æ¥ç›¸å…³åŠŸèƒ½åº“çš„ CMakeLists.txt æ–‡ä»¶ã€‚find_package ç”¨äºä¼šåœ¨ CMAKE_PREFIX_PATH ç¯å¢ƒå˜é‡è·¯å¾„ä¸­æŸ¥æ‰¾ç›¸åº”çš„åº“æ–‡ä»¶ã€‚link_directories ä¸ include_directories ä¼šè‡ªåŠ¨åœ¨æŒ‡å®šçš„è·¯å¾„ä¸­æŸ¥æ‰¾å¤´æ–‡ä»¶å’Œåº“ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/2_5.png" alt="ç¯å¢ƒå˜é‡"></p><pre class="line-numbers language-sh"><code class="language-sh">find_package(LLVM REQUIRED CONFIG)find_package(Clang REQUIRED CONFIG)#æŒ‡å®šè¿ç»“åº“çš„è·¯å¾„link_directories(${CLANG_LIB_PATH} ./Lib)#æŒ‡å®šå¤´æ–‡ä»¶æŸ¥æ‰¾è·¯å¾„include_directories(Include ${CLANG_INCLUDE_PATH})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æœ€ç»ˆåœ¨ target_link_libraries ä¸­é“¾æ¥å¦‚ä¸‹çš„åº“ã€‚ <code>${LLVMSupport}</code> ä¸ <code>${clangxxx}</code> è¿™äº›éƒ½è¦åœ¨æˆåŠŸ find_package åæ‰èƒ½æ­£ç¡®ä½¿ç”¨ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">target_link_libraries(${PROJECT_NAME} PRIVATE${linkLib}LoopConvertTooling${clangAST}${clangBasic}${clangDriver}${clangFormat}${clangLex}${clangParse}${clangSema}${clangFrontend}${clangTooling}${clangToolingCore}${clangRewrite}${clangRewriteFrontend}${LLVMSupport})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æœ€ç»ˆç¼–è¯‘æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ—¶ clang-cl ä¸ºå‰ç«¯ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ cl.exe ç¼–è¯‘çš„è¯ä¼šæœ‰å¤§é‡ warning è­¦å‘Šï¼ŒåŸå› æ˜¯ clang ä¸ msvc-cl æœ‰ä¸€äº›åŸºç¡€å˜é‡å®šä¹‰ä¸åŒé€ æˆï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">[cms-client] æ­£åœ¨ä½¿ç”¨â€œNinjaâ€CMake ç”Ÿæˆå™¨è¿›è¡Œé…ç½®[cms-client] æ­£åœ¨ä½¿ç”¨â€œNinjaâ€CMake ç”Ÿæˆå™¨è¿›è¡Œé…ç½®[cmake] The CXX compiler identification is Clang 10.0.0[cmake] Check for working CXX compiler: F:/LLVM10/Lib/bin/clang-cl.exe[cmake] Check for working CXX compiler: F:/LLVM10/Lib/bin/clang-cl.exe -- works[cmake] Detecting CXX compiler ABI info[cmake] Detecting CXX compiler ABI info - done[cmake] Detecting CXX compile features[cmake] Detecting CXX compile features - done[cmake] Looking for C++ include pthread.h[cmake] Looking for C++ include pthread.h - not found[cmake] Found Threads: TRUE[cmake] Configuring done[cmake] Generating done[build] æ­£åœ¨å¯åŠ¨ç”Ÿæˆ[proc] æ‰§è¡Œå‘½ä»¤: "F:\Visual Studio\Common7\IDE\CommonExtensions\Microsoft\CMake\CMake\bin\cmake.EXE" --build f:/WorkSpace/AutoTestProject/AUTestTools/build --config Release --target all -- -j 14[build] [2/15   6% :: 0.103] Automatic MOC and UIC for target ProjectUnitTest[build] [2/13  15% :: 0.275] Automatic MOC and UIC for target Automated_UnitTest[build] [12/13  23% :: 0.377] Building CXX object CMakeFiles\Automated_UnitTest.dir\Src\test.cpp.obj[build] [12/13  30% :: 0.401] Building CXX object CMakeFiles\Automated_UnitTest.dir\qrc_image.cpp.obj[build] [12/13  38% :: 2.254] Building CXX object CMakeFiles\Automated_UnitTest.dir\Src\window\DiagramWindow\Arrow.cpp.obj[build] [12/13  46% :: 2.352] Building CXX object CMakeFiles\Automated_UnitTest.dir\Automated_UnitTest_autogen\mocs_compilation.cpp.obj[build] [12/13  53% :: 4.049] Building CXX object CMakeFiles\Automated_UnitTest.dir\Src\window\DiagramWindow\DiagramTextItem.cpp.obj[build] [12/13  61% :: 4.158] Building CXX object CMakeFiles\Automated_UnitTest.dir\Src\main.cpp.obj[build] [12/13  69% :: 4.235] Building CXX object CMakeFiles\Automated_UnitTest.dir\Src\window\DiagramWindow\DiagramScene.cpp.obj[build] [12/13  76% :: 4.295] Building CXX object CMakeFiles\Automated_UnitTest.dir\Src\window\DiagramWindow\DiagramItem.cpp.obj[build] [12/13  84% :: 5.678] Building CXX object CMakeFiles\Automated_UnitTest.dir\Src\window\mainwindow.cpp.obj[build] [12/13  92% :: 6.419] Building CXX object CMakeFiles\Automated_UnitTest.dir\Src\window\DiagramWindow\DiagramSceneWindow.cpp.obj[build] [13/13 100% :: 6.760] Linking CXX executable Automated_UnitTest.exe[build] ç”Ÿæˆå·²å®Œæˆï¼Œé€€å‡ºä»£ç ä¸º 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ‰§è¡Œä¸€ä¸‹ç”Ÿæˆçš„ .exe ç¨‹åºï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//æµ‹è¯•ç”¨çš„è¾“å…¥æ–‡ä»¶ test.cpp</span><span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token class-name">Cpp11Enum</span><span class="token punctuation">{</span>    RED <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>    BLUE <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> Wowza<span class="token punctuation">{</span>    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Wowza</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> Badabang <span class="token operator">:</span> Wowza<span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> override<span class="token punctuation">;</span>    <span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> Badabang <span class="token operator">&amp;</span>o<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">testif_else</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span>    <span class="token punctuation">{</span>        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">></span><span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span>T <span class="token operator">&amp;&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-sh"><code class="language-sh">F:\WorkSpace\AutoTestProject\AUTestTools>"F:\WorkSpace\AutoTestProject\AUTestTools\build\test\ProjectUnitTest.exe" ./Src/test.cppError while trying to load a compilation database:Could not auto-detect compilation database for file "./Src/test.cpp"No compilation database found in F:\WorkSpace\AutoTestProject\AUTestTools\Src or any parent directoryfixed-compilation-database: Error while opening fixed database: no such file or directoryjson-compilation-database: Error while opening JSON database: no such file or directoryRunning without flags.** Creating AST consumer for: F:\WorkSpace\AutoTestProject\AUTestTools\Src\test.cppEnumDecl 0x1a5b6119e60 <F:\WorkSpace\AutoTestProject\AUTestTools\Src\test.cpp:1:1, line:5:1> line:1:12 class Cpp11Enum 'int'|-EnumConstantDecl 0x1a5b6119f68 <line:3:5, col:11> col:5 RED 'Cpp11Enum'| `-ConstantExpr 0x1a5b6119f48 <col:11> 'int' Int: 10|   `-IntegerLiteral 0x1a5b6119f20 <col:11> 'int' 10`-EnumConstantDecl 0x1a5b611a008 <line:4:5, col:12> col:5 BLUE 'Cpp11Enum'`-ConstantExpr 0x1a5b6119fe8 <col:12> 'int' Int: 20    `-IntegerLiteral 0x1a5b6119fc0 <col:12> 'int' 20CXXRecordDecl 0x1a5b611a060 <F:\WorkSpace\AutoTestProject\AUTestTools\Src\test.cpp:7:1, line:11:1> line:7:8 struct Wowza definition|-DefinitionData polymorphic abstract has_constexpr_non_copy_move_ctor can_const_default_init| |-DefaultConstructor exists non_trivial constexpr needs_implicit defaulted_is_constexpr| |-CopyConstructor simple non_trivial has_const_param needs_implicit implicit_has_const_param| |-MoveConstructor| |-CopyAssignment non_trivial has_const_param implicit_has_const_param| |-MoveAssignment| `-Destructor non_trivial user_declared|-CXXRecordDecl 0x1a5b611a178 <col:1, col:8> col:8 implicit referenced struct Wowza|-CXXDestructorDecl 0x1a5b611a2a8 <line:9:5, col:30> col:13 ~Wowza 'void ()' virtual default noexcept-unevaluated 0x1a5b611a2a8|-CXXMethodDecl 0x1a5b611a468 <line:10:5, col:35> col:18 foo 'void (int)' virtual pure| `-ParmVarDecl 0x1a5b611a3a8 <col:22, col:30> col:26 i 'int' cinit|   `-IntegerLiteral 0x1a5b611ad40 <col:30> 'int' 0`-CXXMethodDecl 0x1a5b611a568 <line:7:8> col:8 implicit operator= 'Wowza &(const Wowza &)' inline default noexcept-unevaluated 0x1a5b611a568`-ParmVarDecl 0x1a5b611a678 <col:8> col:8 'const Wowza &'CXXRecordDecl 0x1a5b611ad68 <F:\WorkSpace\AutoTestProject\AUTestTools\Src\test.cpp:13:1, line:18:1> line:13:8 struct Badabang definition|-DefinitionData polymorphic has_constexpr_non_copy_move_ctor can_const_default_init| |-DefaultConstructor exists non_trivial constexpr needs_implicit defaulted_is_constexpr| |-CopyConstructor simple non_trivial has_const_param needs_overload_resolution implicit_has_const_param| |-MoveConstructor exists simple non_trivial needs_overload_resolution| |-CopyAssignment non_trivial has_const_param implicit_has_const_param| |-MoveAssignment exists simple non_trivial needs_overload_resolution| `-Destructor simple non_trivial needs_overload_resolution|-public 'Wowza'|-CXXRecordDecl 0x1a5b611af18 <col:1, col:8> col:8 implicit referenced struct Badabang|-CXXMethodDecl 0x1a5b611b080 <line:15:5, col:19> col:10 foo 'void (int)'| |-Overrides: [ 0x1a5b611a468 Wowza::foo 'void (int)' ]| |-ParmVarDecl 0x1a5b611afc0 <col:14> col:17 'int'| `-OverrideAttr 0x1a5b611b128 <col:19>|-CXXMethodDecl 0x1a5b611b2a8 <line:17:5, col:40> col:10 operator== 'bool (const Badabang &) const'| `-ParmVarDecl 0x1a5b611b1b8 <col:21, col:37> col:37 o 'const Badabang &'|-CXXConstructorDecl 0x1a5b611b500 <line:13:8> col:8 implicit constexpr Badabang 'void (const Badabang &)' inline default noexcept-unevaluated 0x1a5b611b500| `-ParmVarDecl 0x1a5b611b618 <col:8> col:8 'const Badabang &'|-CXXConstructorDecl 0x1a5b611b6b8 <col:8> col:8 implicit constexpr Badabang 'void (Badabang &&)' inline default noexcept-unevaluated 0x1a5b611b6b8| `-ParmVarDecl 0x1a5b611b7c8 <col:8> col:8 'Badabang &&'|-CXXMethodDecl 0x1a5b611b868 <col:8> col:8 implicit operator= 'Badabang &(const Badabang &)' inline default noexcept-unevaluated 0x1a5b611b868| `-ParmVarDecl 0x1a5b611b978 <col:8> col:8 'const Badabang &'|-CXXMethodDecl 0x1a5b611b9e8 <col:8> col:8 implicit operator= 'Badabang &(Badabang &&)' inline default noexcept-unevaluated 0x1a5b611b9e8| `-ParmVarDecl 0x1a5b611baf8 <col:8> col:8 'Badabang &&'`-CXXDestructorDecl 0x1a5b611bb80 <col:8> col:8 implicit ~Badabang 'void () noexcept' inline default`-Overrides: [ 0x1a5b611a2a8 Wowza::~Wowza 'void () noexcept' ]FunctionDecl 0x1a5b611bca8 <F:\WorkSpace\AutoTestProject\AUTestTools\Src\test.cpp:20:1, line:34:1> line:20:6 testif_else 'void ()'`-CompoundStmt 0x1a5b611d128 <line:21:1, line:34:1>`-IfStmt 0x1a5b611d100 <line:22:5, line:33:5> has_else    |-ImplicitCastExpr 0x1a5b611bdb8 <line:22:9> 'bool' <IntegralToBoolean>    | `-IntegerLiteral 0x1a5b611bd90 <col:9> 'int' 1    |-CompoundStmt 0x1a5b611ced0 <line:23:5, line:25:5>    | `-DeclStmt 0x1a5b611ceb8 <line:24:9, col:19>    |   `-VarDecl 0x1a5b611bde8 <col:9, col:17> col:13 a 'int' cinit    |     `-IntegerLiteral 0x1a5b611ce90 <col:17> 'int' 10    `-IfStmt 0x1a5b611d0d8 <line:26:10, line:33:5> has_else    |-ImplicitCastExpr 0x1a5b611cf10 <line:26:14> 'bool' <IntegralToBoolean>    | `-IntegerLiteral 0x1a5b611cee8 <col:14> 'int' 2    |-CompoundStmt 0x1a5b611cfe8 <line:27:5, line:29:5>    | `-DeclStmt 0x1a5b611cfd0 <line:28:9, col:19>    |   `-VarDecl 0x1a5b611cf40 <col:9, col:17> col:13 b 'int' cinit    |     `-IntegerLiteral 0x1a5b611cfa8 <col:17> 'int' 20    `-CompoundStmt 0x1a5b611d0c0 <line:31:5, line:33:5>        `-DeclStmt 0x1a5b611d0a8 <line:32:9, col:19>        `-VarDecl 0x1a5b611d018 <col:9, col:17> col:13 c 'int' cinit            `-IntegerLiteral 0x1a5b611d080 <col:17> 'int' 20FunctionTemplateDecl 0x1a5b611d408 <F:\WorkSpace\AutoTestProject\AUTestTools\Src\test.cpp:35:1, line:36:15> col:6 bar|-TemplateTypeParmDecl 0x1a5b611d140 <line:35:11, col:20> col:20 referenced typename depth 0 index 0 T`-FunctionDecl 0x1a5b611d368 <line:36:1, col:15> col:6 bar 'void (T &&)'`-ParmVarDecl 0x1a5b611d278 <col:10, col:14> col:14 t 'T &&'** EndSourceFileAction for: F:\WorkSpace\AutoTestProject\AUTestTools\Src\test.cppenum class Cpp11Enum{    RED = 10,    BLUE = 20};struct Wowza{    virtual ~Wowza() = default;    virtual void foo(int i = 0) = 0;};struct Badabang : Wowza{    void foo(int) override;    bool operator==(const Badabang &o) const;};// Begin function testif_else returning voidvoid testif_else(){    if (1)    // the 'if' part    {        int a = 10;    }    else // the 'else' part    if (2)    // the 'if' part    {        int b = 20;    }    else    // the 'else' part    {        int c = 20;    }}// End function testif_else<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="ä½¿ç”¨-clang-cl-ä¸ºå‰ç«¯"><a href="#ä½¿ç”¨-clang-cl-ä¸ºå‰ç«¯" class="headerlink" title="ä½¿ç”¨ clang-cl ä¸ºå‰ç«¯"></a>ä½¿ç”¨ clang-cl ä¸ºå‰ç«¯</h3><ul><li><p>ä½¿ç”¨ clang-cl ä¸»è¦éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå°±æ˜¯éœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½® include ä¸ libï¼ŒæŒ‡å‘ä½ çš„ msvc-cl çš„ include ä¸ lib è·¯å¾„ï¼ŒLLVM å’Œ clang çš„ include ä¸ lib è·¯å¾„ã€‚åœ¨ windows ä¸‹çš„è¯ è¿˜éœ€è¦æ·»åŠ  windows sdk ç›¸å…³çš„ include ä¸ lib è·¯å¾„ã€‚ä»¥é˜²å¤´æ–‡ä»¶æ‰¾ä¸åˆ°ç¼–è¯‘å¤±è´¥ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/2_6.png"><br><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/2_7.png"></p></li></ul><h2 id="ä»¥æºç çš„æ–¹å¼é›†æˆåˆ°é¡¹ç›®ä¸­"><a href="#ä»¥æºç çš„æ–¹å¼é›†æˆåˆ°é¡¹ç›®ä¸­" class="headerlink" title="ä»¥æºç çš„æ–¹å¼é›†æˆåˆ°é¡¹ç›®ä¸­"></a>ä»¥æºç çš„æ–¹å¼é›†æˆåˆ°é¡¹ç›®ä¸­</h2><ul><li><p>å¯èƒ½ä½ é‡åˆ°äº†å’Œæˆ‘ä¸€æ ·çš„å›°æ‰°ï¼Œå°±æ˜¯æƒ³è¦è°ƒè¯•ä¸€ä¸ªå…³äºæºç  AST æ ‘ç›¸å…³çš„åŠŸèƒ½ï¼Œéœ€è¦å…ˆåœ¨ llvm-project é¡¹ç›®ä¸­å°†ä½ çš„åŠŸèƒ½æ¨¡å—ç¼–è¯‘æˆåº“ï¼Œç„¶ååœ¨é“¾æ¥åˆ°ä½ çš„é¡¹ç›®ä¸­å»ï¼Œä¸è¯´ llvm-project ä½“ç§¯å·¨å¤§ï¼Œæ‰“å¼€é¡¹ç›®æµªè´¹æ—¶é—´ï¼Œå•å•è¿™æ“ä½œä¹Ÿæ˜¯å¤Ÿç¹çäº†ã€‚å› æ­¤ï¼Œè¿™é‡Œæˆ‘æ•´ç†äº†ä¸‹å¦‚ä½•ä½¿ç”¨æºç åœ¨ä½ çš„é¡¹ç›®ä¸­å»ç¼–è¯‘ã€‚</p><ul><li><p>é¦–å…ˆï¼Œç¡®ä¿ä½ é¡¹ç›®ä¸­å¯ä»¥é€šè¿‡ <code>find_package</code> æŸ¥æ‰¾åˆ° Clang ä¸ LLVMï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨åº“çš„æ–¹å¼é“¾æ¥é€šè¿‡ã€‚</p></li><li><p>ç„¶åï¼Œéœ€è¦ç¼–å†™åŸºäº libTooling å·¥å…·çš„æºç ï¼Œè¿™é‡Œæˆ‘å°†ä¹‹å‰ä½¿ç”¨è¿‡çš„ loopConvert.cpp æ‹·è´è¿‡æ¥ç›´æ¥ç”¨ã€‚æ¥ä¸‹æ¥å°±æ˜¯ä¿®æ”¹ CMakeLists.txt äº†ã€‚å‚è€ƒå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-sh"><code class="language-sh">find_package(LLVM REQUIRED CONFIG)find_package(Clang REQUIRED CONFIG)set(AUTESTSRCmain.cppLoopConvert.cpp)set(CLANG_LINK_LIBRARIESlibclangclangToolingclangARCMigrateclangASTclangASTMatchersclangAnalysisclangBasicclangCodeGenclangDriverclangEditclangFrontendclangFrontendToolclangLexclangParseclangRewriteclangRewriteFrontendclangSemaclangSerializationclangCodeGen)function(clang_target_link target type)if (CLANG_LINK_CLANG_DYLIB)    target_link_libraries(${target} ${type} clang_shared)else()    target_link_libraries(${target} ${type} ${ARGN})endif()endfunction()add_executable(${PROJECT_NAME} ${HEAD_FILES} ${AUTESTSRC})clang_target_link(${PROJECT_NAME} PRIVATE ${CLANG_LINK_LIBRARIES})<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li></ul><h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2><p>è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸçš„ç”Ÿæˆäº†å®šåˆ¶å·¥å…·ã€å®šåˆ¶çš„ libTooling å·¥å…·ä»¥åŠé€šè¿‡æºç çš„æ–¹å¼é›†æˆåˆ°è‡ªå·±çš„é¡¹ç›®ä¸­äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> LLVM ç¼–è¯‘å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLVM ç¼–è¯‘å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ï¼ˆä¸€ï¼‰LLVMç¼–è¯‘å™¨--ç¯å¢ƒé…ç½®</title>
      <link href="/2022/06/02/yi-llvm-bian-yi-qi-huan-jing-pei-zhi/"/>
      <url>/2022/06/02/yi-llvm-bian-yi-qi-huan-jing-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h1 id="Windows-ä¸‹é€šè¿‡-CMAKE-æ­å»º-LLVM-ç¯å¢ƒ"><a href="#Windows-ä¸‹é€šè¿‡-CMAKE-æ­å»º-LLVM-ç¯å¢ƒ" class="headerlink" title="Windows ä¸‹é€šè¿‡ CMAKE æ­å»º LLVM ç¯å¢ƒ"></a>Windows ä¸‹é€šè¿‡ CMAKE æ­å»º LLVM ç¯å¢ƒ</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li>helloï¼Œåˆå¼€äº†ä¸€ä¸ªæ–°ç³»åˆ—çš„å‘ï¼Œä¸å†™ BLOG çœŸæ˜¯ä¸çŸ¥é“ï¼Œä»¥å‰æˆ‘è®°äº†è¿™ä¹ˆå¤šä¹±ä¸ƒå…«ç³Ÿå¥‡æ€ªçš„ç¬”è®° ğŸ˜…ã€‚å°±åƒæœ¬æ–‡æ ‡é¢˜ä¸»è¦å†™ç€ Windows ä¸‹æ­å»ºç¯å¢ƒä¸€æ ·è¯¡å¼‚ï¼Œä¸è¿‡åè¿‡æ¥æƒ³æƒ³ Macosã€Linux ä¸‹å®‰è£… LLVM ç¡®å®å¤ªç®€å•äº†ï¼ŒåŒ…ç®¡ç†å¾ˆå¥½çš„å®Œæˆäº†å·¥ä½œï¼ŒWindows æ›´èƒ½ä½“ç°æŠ€æœ¯ä¸æ˜¯ã€‚So æœ¬æ–‡ä¸ä¼šå†æˆ‘ä½¿ç”¨çš„ Macos ä¸Šé‡æ–°ä¿®è®¢å•¦ï¼ï¼å¸Œæœ›èƒ½å¯¹æœ‰å’Œæˆ‘ç›¸åŒå¥‡æ€ªéœ€æ±‚çš„ä½ æœ‰æ‰€å¸®åŠ©ã€‚</li><li><a href="https://github.com/HATTER-LONG/AUTestTools">æºç¬”è®°é¡¹ç›®</a>ï¼Œè§‰å¾—ä¸é”™æ¥ä¸ª star å§ã€‚</li></ul><blockquote><p>æœ¬æ–‡è®°å½•äº 2020 å¹´ï¼Œå› æ­¤ç‰ˆæœ¬æœ‰äº›è€äº†ï¼Œä¸è¿‡ç¼–è¯‘æ–¹å¼ä¸ä½¿ç”¨æ¥å£å¹¶æ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œäº²æµ‹åœ¨æœ¬æ–‡å‘å‡ºæ—¶ LLVM 14 ä¸Šæ˜¯å¯ä»¥æ­£å¸¸ç¼–è¯‘çš„ä½¿ç”¨çš„ã€‚</p></blockquote><blockquote><p>æœ¬ç³»åˆ—æ–‡ç« æˆ‘åœ¨ CSDN ä¸Šä¹Ÿä¼ è¿‡ï¼Œä¸è¿‡ CSDN åƒé¦™å¤ªéš¾çœ‹äº†ï¼Œåç»­ä¹Ÿä¸ä¼šåœ¨ä¸Šè¾¹æ›´æ–°ç»´æŠ¤äº†ï¼Œå°±è¿™æ ·ã€‚</p></blockquote><blockquote><p>ä»¥ä¸‹æ­£æ–‡ã€‚</p></blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨ Windows ä¸‹é€šè¿‡ vscode ä½¿ç”¨ Cmake+Ninja æ¥ç¼–è¯‘ LLVM æºç ï¼Œä»è€Œæ­å»º LLVM ç¯å¢ƒä»¥åŠç”Ÿæˆ clang çš„ Tools ç›¸å…³åº“ã€‚</p><h2 id="å‰å› "><a href="#å‰å› " class="headerlink" title="å‰å› "></a>å‰å› </h2><ol><li><p>ä¸ºå•¥è¦ç¼–è¯‘æºç ï¼Œé¢„ç¼–è¯‘åŒ…å®ƒä¸é¦™ä¹ˆï¼Ÿ</p><ul><li>ç¡®å® LLVM å®˜æ–¹å·²ç»æä¾›äº† Win32 ç‰ˆæœ¬çš„é¢„ç¼–è¯‘åŒ…ï¼Œä½†æ˜¯æˆ‘å°è¯•å®‰è£…äº† 9.0.1 ç‰ˆæœ¬ä¸ 10.0.0 ç‰ˆæœ¬ï¼Œå®ƒå±…ç„¶éƒ½æ²¡æœ‰ clang çš„ libTooling ç›¸å…³çš„åº“ï¼Œè¿™å°±å¾ˆéš¾å—äº†æ‰€ä»¥ä¸ºäº†èƒ½ä½¿ç”¨ clang Tools åªå¥½ä»å¤´åšèµ·ï¼Œå¦‚æœå“ªä½åŒå­¦çŸ¥é“ä¸ºå•¥ä¸æä¾› libtooling è¿™äº›åº“çš„åŸå› è¯·å‘Šè¯‰ä¸‹ï¼Œè°¢è°¢~ğŸ˜‚ã€‚<blockquote><p>å°±æ˜¯å› ä¸º Windows ä¸Šä½¿ç”¨ LLVM å°±æ˜¯é¸¡è‚‹ï¼Œæ²¡äººç”¨å‘— ğŸ˜“ã€‚</p></blockquote></li></ul></li><li><p>ä¸ºå•¥éå¾—åœ¨ Windows ä¸‹ï¼ŒLinux ä¸æ˜¯æ›´æ–¹ä¾¿ï¼Ÿ</p><ul><li>æˆ‘åœ¨ Linux ä¸‹ä¹Ÿæ­å»ºäº†ä¸€ä¸‹ 9.0.1 ç‰ˆæœ¬ï¼Œç›´æ¥åœ¨ LLVM å®˜ç½‘ä¸Šä¸‹è½½å¯¹åº”ç‰ˆæœ¬ä¸ç³»ç»Ÿçš„é¢„ç¼–è¯‘åŒ…ï¼Œè§£å‹åŠç”¨ã€åº“åˆå…¨åˆå¥½ç”¨ ğŸ˜€ã€‚</li><li>ä½†æ˜¯ç”±äºæˆ‘ä½¿ç”¨çš„ Ubuntu WSL å­ç³»ç»Ÿï¼Œé€šè¿‡ Vscode çš„ WSL æ’ä»¶è¿æ¥ä¸Šåå‘ç°å¯¹ c++ æ’ä»¶æ”¯æŒè²Œä¼¼æœ‰é—®é¢˜ï¼Œä»£ç é¢œè‰²æ¸²æŸ“ä¿¡æ¯ä¸å…¨ï¼Œä¸æ¸…æ¥šæ˜¯ GCC ç¼–è¯‘å™¨é—®é¢˜è¿˜æ˜¯å•¥åŸå› ï¼Œå¯¼è‡´å¼ºè¿«ç—‡æ‚£è€…ä¸æƒ³åœ¨ WSL ç³»ç»Ÿç›´æ¥å¼€å‘ï¼ŒçŸ¥é“åŸå› çš„å¤§ä½¬æ±‚å‘ŠçŸ¥ï¼Œåæ­£å½“å‰çš„é¡¹ç›®æ˜¯é€šè¿‡ CMake ç®¡ç†ï¼Œæ‰€ä»¥å†³å®šåœ¨ windows ä¸‹å¼€å‘å®Œæˆååœ¨ç§»æ¤åˆ° Linux ä¸‹ã€‚<blockquote><p>è¿™ä¸ªé—®é¢˜å·²ç»è§£å†³äº†ï¼Œæ˜¯ vscode cpp æ’ä»¶çš„é—®é¢˜ï¼Œgithub é¡¹ç›®ä¸Šæœ‰ issue æè¿°äº†æ­¤é—®é¢˜ï¼Œæœ€æ–°ç‰ˆæœ¬å·²ç»ä¿®å¤ã€‚æ‰€ä»¥è¯´éå¾—åœ¨ Windows ä¸Šç¼–è¯‘çº¯ç²¹å°±æ˜¯ä¸ªä¼ªéœ€æ±‚ï¼Œæƒ³å¿…æ²¡è°æœ‰ç±»ä¼¼çš„éœ€æ±‚äº†ã€‚</p></blockquote></li></ul></li><li><p>åºŸè¯å°±è¯´è¿™ä¹ˆå¤šç°åœ¨å¼€å§‹ã€‚</p></li></ol><hr><h2 id="ç³»ç»Ÿç¯å¢ƒ"><a href="#ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="ç³»ç»Ÿç¯å¢ƒ"></a>ç³»ç»Ÿç¯å¢ƒ</h2><ol><li><p>Win10 æ“ä½œç³»ç»Ÿï¼Œå·²ç»å®‰è£…äº† VS2017 å…¨å®¶æ¡¶ã€‚åŒ…æ‹¬æœ€æœ€é‡è¦çš„ msvc2017_64 å·¥å…·åŒ…ã€Vscodeã€ä»¥åŠ camke(version 3.12.18081601-MSVC_2) å·¥å…·ã€‚å½“ç„¶å¦‚æœä½ ä¸æƒ³è£…é‚£ä¹ˆå·¨å¤§çš„ IDEï¼Œä¹Ÿå¯ä»¥å•ç‹¬å®‰è£… mingw + cmake ç½‘ä¸Šçš„æ•™ç¨‹ä¹Ÿå¾ˆå¤šã€‚</p></li><li><p>ç¯å¢ƒå˜é‡æ­£ç¡®é…ç½®ï¼Œä¾‹å¦‚åœ¨ powershell æˆ– cmd ä¸­æ•² cmake.exe -version å¯ä»¥æ‰“å°å‡ºå®‰è£…çš„å·¥å…·ç‰ˆæœ¬ï¼Œç¡®ä¿ä½ çš„ç¼–è¯‘å™¨ç›¸å…³å·¥å…·ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p></li></ol><h2 id="Letâ€™s-Begin"><a href="#Letâ€™s-Begin" class="headerlink" title="Letâ€™s Begin"></a>Letâ€™s Begin</h2><h3 id="è·å–-LLVM-Project-æºç "><a href="#è·å–-LLVM-Project-æºç " class="headerlink" title="è·å– LLVM Project æºç "></a>è·å– LLVM Project æºç </h3><p>æŸ¥æ‰¾äº†ä¸€äº›ç½‘ä¸Šçš„èµ„æ–™å‘ç°ä¸‹è½½æºç è¶…çº§éº»çƒ¦ï¼Œè¦ä¹ˆæ˜¯éœ€è¦å®‰è£… svn ã€è¦ä¹ˆå»å®˜ç½‘ä¸‹è½½ï¼Œå¹¶ä¸”éœ€è¦ä¸‹è½½è¿™ä¸ªæºç ç„¶ååœ¨ä¸‹é‚£ä¸ªæºç ï¼Œä¸€çœ¼çœ‹è¿‡å»å°±è¿·å¤±åœ¨äº†æœªçŸ¥çš„æµ·æ´‹é‡Œå˜ã€‚å› æ­¤åœ¨è¿™é‡Œæ¨èç›´æ¥ä¸‹è½½ llvm-project æºç åˆé›†å¤§ç¤¼åŒ…ï¼Œå¯ä»¥é¿å…å¾ˆå¤šé—®é¢˜ã€‚</p><ol><li><p>å¦‚æœä½ æ˜¯åœ¨æ‹…å¿§æºç ç¼–è¯‘å‡ºæ¥è¿‡å¤§ä»¥åŠå¤šä½™ä½ ä¸éœ€è¦çš„æ¨¡å—ï¼Œé‚£ä¹ˆä¸ç”¨æ‹…å¿ƒï¼Œllvm çš„è´´å¿ƒçš„å‡†å¤‡äº†è£å‰ªç¼–è¯‘å‘½ä»¤ï¼Œå¸®åŠ©ä½ åªæ„å»ºéœ€è¦çš„æ¨¡å—ã€‚</p><ul><li>è€ƒè™‘åˆ°å½“æ—¶æˆ‘ä¸‹è½½æ—¶è‰°è¾›çš„ç½‘é€Ÿï¼Œ<a href="https://pan.baidu.com/s/1xxCf43Gg-S3idpyCZ1WbQA">ä½ ä¹Ÿå¯ä»¥é€šè¿‡è¿™é‡Œä¸‹è½½ 10.0.0 ç‰ˆæœ¬çš„æºç </a>ï¼Œæå–ç ï¼šu0sfã€‚<blockquote><p>çœ‹çœ‹å½“æ—¶é’æ¶©çš„æˆ‘ï¼Œä»£ç†ç½‘ç«™å’Œé•œåƒç½‘ç«™ä¸‹è½½ä¸é¦™ä¹ˆ ğŸ˜“ã€‚è¿™é‡Œæ¨èä¸ª<a href="https://hub.fastgit.xyz/">ä»£ç†ç«™</a>ï¼Œä¸‹è½½é€Ÿåº¦è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œä¸Šè¾¹è¿™ä¸ªç½‘ç›˜æˆ‘ä¹Ÿæ‡’å¾—å»ä¿®æ”¹äº†ï¼ŒçœŸæœ‰éœ€æ±‚é‚®ä»¶æˆ‘å¥½äº†ï¼Œæˆ‘å†æ›´æ–°ã€‚</p></blockquote></li></ul></li><li><p>æ­¤æ—¶ä½ å·²ç»æ‹¿åˆ°äº†æºç åŒ…ï¼Œå¼€å¼€å¿ƒå¿ƒçš„å³é”® -&gt; è§£å‹åˆ°å½“å‰æ–‡ä»¶å¤¹ -&gt; ç­‰å¾… -&gt; â€¦.. -&gt; é”™è¯¯ï¼šæ— æ³•åˆ›å»ºæ–‡ä»¶ã€‚ What???</p><ul><li><p>æˆ‘é‡åˆ°çš„é—®é¢˜ä¸»è¦æ˜¯ç”±äºå‹ç¼©åŒ…ä¸­åŒ…å«è½¯è¿æ¥ï¼Œå½“å‰ Windows ä¸‹æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒåˆ›å»ºï¼Œå¯¼è‡´é”™è¯¯ã€‚æœ€ç»ˆæˆ‘æ˜¯ç›´æ¥é€šè¿‡ WSL å­ç³»ç»Ÿï¼Œä½¿ç”¨å‘½ä»¤ tar è§£å‹çš„ã€‚æ‰€ä»¥å¦‚æœåœ¨ Windows ä¸‹è§£å‹å¤±è´¥çš„è¯å¯ä»¥å°è¯•åœ¨ Linux ä¸­è§£å‹ç„¶ååœ¨æ‹·è´å‡ºæ¥ã€‚</p><blockquote><p>Soï¼Œä¸è¦åœ¨ Windows ä¸Šç¼–è¯‘æºç ï¼Œå°±æ˜¯ä¸ªå‘ã€‚ç›´æ¥é¢„ç¼–è¯‘åŒ…ä¸é¦™ä¹ˆã€‚</p></blockquote></li></ul><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/1_1.png" alt="å‘½ä»¤"></p></li></ol><h3 id="ä½¿ç”¨-Vscode-æ‰“å¼€-amp-ç¼–è¯‘-LLVM-Project"><a href="#ä½¿ç”¨-Vscode-æ‰“å¼€-amp-ç¼–è¯‘-LLVM-Project" class="headerlink" title="ä½¿ç”¨ Vscode æ‰“å¼€&amp;ç¼–è¯‘ LLVM Project"></a>ä½¿ç”¨ Vscode æ‰“å¼€&amp;ç¼–è¯‘ LLVM Project</h3><p>åœ¨æ‰“å¼€ä¹‹å‰ï¼Œéœ€è¦ä»‹ç»ä¸€ä¸ªå¾ˆé‡è¦çš„å·¥å…·ï¼Œå®ƒå°±æ˜¯ CmakeToolsï¼Œä½œä¸º Vscode çš„æ’ä»¶ï¼Œåœ¨ç®¡ç†ä½¿ç”¨ cmake æ„å»ºçš„å·¥ç¨‹éå¸¸å¥½ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿çš„é…ç½®ä½¿ç”¨çš„ç¼–è¯‘å™¨ã€ç¼–è¯‘æ¨¡å¼ã€ä½¿ç”¨ GDBã€<strong>æ§åˆ¶ç”Ÿæˆæ¨¡å—</strong>ã€‚å› æ­¤å¦‚æœä½ ä¸æƒ³è€—è´¹ç²¾åŠ›å»ç®¡ç†å·¥ç¨‹æˆ–è€…è¾“å…¥ç¼–è¯‘å‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘å¼ºçƒˆå»ºè®®ä½ å®‰è£…ä¸€ä¸ªã€‚</p><ol><li><p>å®‰è£…å¥½ CmakeTools å·¥å…·åï¼Œé€šè¿‡ vscode æ‰“å¼€ llvm-project çš„æºç æ–‡ä»¶å¤¹ã€‚å¦‚æœä½ çš„ç¯å¢ƒå˜é‡æ­£ç¡®ï¼Œç¼–è¯‘å™¨ã€cmake å·¥å…·èƒ½æ­£ç¡®æœç´¢åˆ°ï¼Œé‚£ä¹ˆ CmakeTools ä¼šè‡ªåŠ¨ä½¿ç”¨ cmake å·¥å…·é…ç½®å½“å‰é¡¹ç›®ï¼Œä½†æ˜¯ç”±äº llvm-project çš„æºç æ ¹ç›®å½•ä¸­å¹¶æ²¡æœ‰ CMakeLists.txtï¼Œå› æ­¤ CmakeTools å·¥å…·ä¼šæç¤ºä¸€ä¸ªé”™è¯¯ã€‚</p><ul><li><p>è§£å†³çš„åŠæ³•å°±åœ¨æ ¹ç›®å½•ä¸­çš„ <code>README.md</code> ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å‡ ä¸ªæ­¥éª¤ï¼Œå…¶ä¸­ mkdir build çš„æ­¥éª¤å…¶å® CmakeTools é»˜è®¤å°±ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹æ ¹ç›®å½•åˆ›å»º build ç”¨äºä¿å­˜ç¼–è¯‘ä¸­é—´æ–‡ä»¶å› æ­¤ç•¥è¿‡ã€‚ä¸»è¦çœ‹åˆ°å…¶ä¸­ cmake å‘½ä»¤å¯¹åº”çš„ ../llvm ç›®å½•ï¼Œå¯çŸ¥ä½œä¸ºå…¥å£çš„ CMakeLists.txt å°±åœ¨ llvm ç›®å½•ä¸­ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/1_2.png" alt="ç¼–è¯‘"></p></li><li><p>å› æ­¤é…ç½® cmaketools çš„æ ¹ç›®å½•ä¸º llvm ç›®å½•ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/1_3.png" alt="è®¾ç½® cmaketools"></p></li></ul></li><li><p>è¿™æ—¶ä½ çš„ CmakeTools åº”è¯¥å°±å¯ä»¥æ­£ç¡®çš„å·¥ä½œäº†ã€‚ä»¥ä¸‹å°±æ˜¯æˆ‘å½“å‰ç¯å¢ƒä¸­çš„ CmakeTools åœ¨é…ç½® CMakeLists.txt æ—¶çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆæ˜¯é…ç½®æˆåŠŸçš„ã€‚</p><pre class="line-numbers language-sh"><code class="language-sh">[variant] å·²åŠ è½½ä¸€ç»„æ–°å˜é‡[kit] å·²æˆåŠŸä» C:\Users\Administrator\AppData\Local\CMakeTools\cmake-tools-kits.json åŠ è½½ 14 å·¥å…·åŒ…[main] æ­£åœ¨é…ç½®æ–‡ä»¶å¤¹: llvm-project-10.0.0[cmake] clang project is enabled[cmake] clang-tools-extra project is enabled[cmake] compiler-rt project is disabled[cmake] debuginfo-tests project is disabled[cmake] libc project is disabled[cmake] libclc project is disabled[cmake] libcxx project is disabled[cmake] libcxxabi project is disabled[cmake] libunwind project is disabled[cmake] lld project is disabled[cmake] lldb project is disabled[cmake] llgo project is disabled[cmake] mlir project is disabled[cmake] openmp project is disabled[cmake] parallel-libs project is disabled[cmake] polly project is disabled[cmake] pstl project is disabled[cmake] Could NOT find Z3: Found unsuitable version "0.0.0", but required is at least "4.7.1" (found Z3_LIBRARIES-NOTFOUND)[cmake] Could NOT find Backtrace (missing: Backtrace_LIBRARY Backtrace_INCLUDE_DIR)[cmake] Native target architecture is X86[cmake] Threads enabled.[cmake] Doxygen disabled.[cmake] Go bindings disabled.[cmake] Ninja version: 1.8.2[cmake] Could NOT find OCaml (missing: OCAMLFIND OCAML_VERSION OCAML_STDLIB_PATH)[cmake] OCaml bindings disabled.[cmake] LLVM host triple: x86_64-pc-windows-msvc[cmake] LLVM default target triple: x86_64-pc-windows-msvc[cmake] Using Release VC++ CRT: MD[cmake] Constructing LLVMBuild project information[cmake] LLVMHello ignored -- Loadable modules not supported on this platform.[cmake] Targeting AArch64[cmake] Targeting AMDGPU[cmake] Targeting ARM[cmake] Targeting BPF[cmake] Targeting Hexagon[cmake] Targeting Lanai[cmake] Targeting Mips[cmake] Targeting MSP430[cmake] Targeting NVPTX[cmake] Targeting PowerPC[cmake] Targeting RISCV[cmake] Targeting Sparc[cmake] Targeting SystemZ[cmake] Targeting WebAssembly[cmake] Targeting X86[cmake] Targeting XCore[cmake] Clang version: 10.0.0[cmake] PrintFunctionNames ignored -- Loadable modules not supported on this platform.[cmake] AnnotateFunctions ignored -- Loadable modules not supported on this platform.[cmake] BugpointPasses ignored -- Loadable modules not supported on this platform.[cmake] Bye ignored -- Loadable modules not supported on this platform.[cmake] TestPlugin ignored -- Loadable modules not supported on this platform.[cmake] -- Version: 0.0.0[cmake] -- Performing Test HAVE_GNU_POSIX_REGEX -- failed to compile[cmake] -- Performing Test HAVE_POSIX_REGEX -- failed to compile[cmake] CMake Warning at utils/benchmark/CMakeLists.txt:244 (message):[cmake]   Using std::regex with exceptions disabled is not fully supported[cmake][cmake][cmake] -- Performing Test HAVE_STEADY_CLOCK -- success[cmake] Configuring done[cmake] Generating done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¿™é‡Œå¦‚æœæƒ³è¦ç¼–è¯‘å…¶ä»–æ¨¡å—ä¾‹å¦‚ <code>[cmake] clang project is enabled</code>ï¼Œè¿˜éœ€è¦åœ¨ CmakeTools é…ç½®çš„æ—¶å€™ä¼ å…¥ä¸€äº›å‚æ•°ï¼Œå¦‚å›¾ã€‚å‚æ•°çš„å«ä¹‰å¯ä»¥çœ‹æ ¹ç›®å½•ä¸­ README.md ä¸­æœ‰è¯¦ç»†çš„è§£é‡Šã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯åƒæˆ‘é…ç½®çš„ç¬¬ä¸€é¡¹ <code>compiler-rt</code> å…¶å®ä¾æ—§æ˜¯ <code>disabled</code> çš„ï¼Œæ€€ç–‘æ˜¯ LLVM çš„ CMakeLists.txt è§£ææœ‰ BUG æˆ–è€…æˆ‘å“ªé‡Œé…ç½®çš„è¿˜æ˜¯ä¸å¯¹ï¼Œè¯·äº†è§£çš„å¤§ä½¬å‘ŠçŸ¥ã€‚</p><ul><li><p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒCMakeTools é»˜è®¤ä¹Ÿæ˜¯ç¼–è¯‘ Debug æ¨¡å¼ï¼Œä½†æ˜¯è¿™å¯¹ç”µè„‘å†…å­˜è¦æ±‚è¾ƒé«˜ï¼Œè€—æ—¶åŒæ ·å¾ˆé•¿ï¼Œå› æ­¤æˆ‘è¿™é‡Œé…ç½®å‚æ•°ç¼–è¯‘çš„æ˜¯ Release ç‰ˆæœ¬ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/1_4.png" alt="è®¾ç½® cmaketools"></p></li></ul></li><li><p>æœ€ç»ˆå½“è¿™ä¸€åˆ‡é…ç½®å®Œæˆï¼Œç‚¹å‡» CmakeTools ä¸­çš„ <code>ç”Ÿæˆ</code> æŒ‰é’®ï¼Œå°±å¯ä»¥å¼€å§‹ç¼–è¯‘äº†ã€‚</p><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/LLVM/1_5.png" alt="cmaketools ç¼–è¯‘"></p></li></ol><h3 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h3><p>æœ€ç»ˆç¼–è¯‘å®Œæˆåï¼Œä¼šåœ¨æ ¹ç›®å½•çš„ build æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆè®¸å¤šæ–‡ä»¶ï¼Œå…¶ä¸­ <code>lib</code> å°±åŒ…æ‹¬æ‰€æœ‰ç”Ÿæˆçš„åº“æ–‡ä»¶ã€‚<br>æ³¨æ„ LLVM ä¸­æœ‰ä¸€äº›å¤´æ–‡ä»¶æ—¶åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­é’ˆå¯¹å¹³å°ç”Ÿæˆï¼Œä¹Ÿåœ¨ build ç›®å½•ä¸­ï¼Œå½“ä½¿ç”¨åº“æ—¶å‘ç°å¤´æ–‡ä»¶æ‰¾ä¸åˆ°çš„æƒ…å†µï¼Œå¯ä»¥å» build ä¸­æœç´¢ä¸‹æŸ¥æ‰¾ã€‚</p><p>è‡³æ­¤ï¼ŒLLVM å°±æˆåŠŸç¼–è¯‘å®Œæˆï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å¿ƒçš„æäº‹æƒ…äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> LLVM ç¼–è¯‘å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LLVM ç¼–è¯‘å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ï¼ˆå…­ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--å¢é‡è®¾è®¡</title>
      <link href="/2022/06/02/liu-ce-shi-qu-dong-kai-fa-ji-qiao-zeng-liang-she-ji/"/>
      <url>/2022/06/02/liu-ce-shi-qu-dong-kai-fa-ji-qiao-zeng-liang-she-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="å¢é‡è®¾è®¡"><a href="#å¢é‡è®¾è®¡" class="headerlink" title="å¢é‡è®¾è®¡"></a>å¢é‡è®¾è®¡</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä½¿ç”¨ TDD çš„ä¸»è¦åŸå› æ˜¯ï¼Œèƒ½å¤Ÿä»¥å¯æ‰¿å—çš„ã€ç¨³å®šçš„ç»´æŠ¤æˆæœ¬æ¥æ·»åŠ æˆ–ä¿®æ”¹åŠŸèƒ½ç‰¹æ€§ã€‚åœ¨æœ¬ç« ä¸­ï¼Œä½ å°†å­¦åˆ°é‡æ„è¿‡ç¨‹ä¸­éœ€è¦åšçš„äº‹æƒ…ã€‚æˆ‘ä»¬å°†ä¸»è¦è®¨è®º Kent Beck æå‡ºçš„ç®€å•è®¾è®¡ç†å¿µï¼ˆå‚è§ã€Šè§£ææé™ç¼–ç¨‹ï¼šæ‹¥æŠ±å˜åŒ–ã€‹ï¼‰ï¼Œä»¥åŠå¯ä»¥ä¿æŒä»£ç æ•´æ´çš„ä¸€ç³»åˆ—é‡è¦è§„åˆ™ã€‚</p><h2 id="ç®€å•è®¾è®¡"><a href="#ç®€å•è®¾è®¡" class="headerlink" title="ç®€å•è®¾è®¡"></a>ç®€å•è®¾è®¡</h2><ul><li>åœ¨ä½¿ç”¨ TDD æ—¶éœ€è¦è€ƒè™‘ä¸‰æ¡è§„åˆ™ï¼š<ol><li>ç¡®ä¿ä»£ç å…·å¤‡å¾ˆå¼ºçš„å¯è¯»æ€§å’Œè¡¨è¾¾åŠ›ã€‚</li><li>åœ¨å’Œç¬¬ä¸€æ¡è§„åˆ™ä¸å†²çªçš„æƒ…å†µä¸‹ï¼Œæ¶ˆé™¤æ‰€æœ‰çš„é‡å¤ã€‚</li><li>ä¸è¦å‘ç³»ç»Ÿå¼•å…¥ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚é¿å…çŒœæµ‹è¡Œçš„ç»“æ„å…³ç³»å’Œä¸èƒ½å¢åŠ ç³»ç»Ÿè¡¨è¾¾åŠ›çš„æŠ½è±¡ã€‚</li></ol></li></ul><h3 id="é‡å¤ä»£ç çš„ä»£ä»·"><a href="#é‡å¤ä»£ç çš„ä»£ä»·" class="headerlink" title="é‡å¤ä»£ç çš„ä»£ä»·"></a>é‡å¤ä»£ç çš„ä»£ä»·</h3><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œé‡å¤ä»£ç æˆ–è®¸æ˜¯ç»´æŠ¤ä»£ç åº“çš„æœ€å¤§å¼€é”€ã€‚å¤§å¤šæ•°å¼€å‘è€…æ‡’äºåˆ›å»ºæ–°çš„æˆå‘˜å‡½æ•°ï¼Œå› ä¸ºæ€€ç–‘è¿™ä¼šé™ä½æ€§èƒ½ï¼Œæ‰€ä»¥ä»–ä»¬æœ‰æ—¶ç”šè‡³ä¼šæ‹’ç»è¿™æ ·åšã€‚æœ€ç»ˆï¼Œä»–ä»¬åªæ˜¯ä¸ºè‡ªå·±åˆ›é€ äº†æ›´å¤šçš„æœªæ¥å·¥ä½œé‡ã€‚</p><p>ç”±äºå¯¹é‡å¤çš„è‡ªç„¶å€¾å‘ï¼Œå¤§éƒ¨åˆ†å¤§å‹ç³»ç»Ÿçš„ä»£ç è¿œè¿œå¤šäºå®é™…éœ€è¦çš„ä»£ç ã€‚è¿™äº›é¢å¤–çš„ä»£ç å¤§å¤§åœ°å¢åŠ äº†ç»´æŠ¤æˆæœ¬å’Œé£é™©ã€‚</p><p><strong>å°†å¢é‡é‡æ„ä½œä¸º TDD ç¯èŠ‚çš„ä¸€éƒ¨åˆ†å¯ä»¥é¿å…ç³»ç»Ÿçº§çš„é€€åŒ–ã€‚</strong></p><h3 id="æŠ•èµ„ç®¡ç†å™¨"><a href="#æŠ•èµ„ç®¡ç†å™¨" class="headerlink" title="æŠ•èµ„ç®¡ç†å™¨"></a>æŠ•èµ„ç®¡ç†å™¨</h3><p>ä»¥å¼€å‘ä¸€ä¸ªå°å‹å­ç³»ç»Ÿä¸¾ä¾‹:</p><ul><li>åœºæ™¯ï¼šæŠ•èµ„ç®¡ç†å™¨<ul><li>æŠ•èµ„äººæƒ³è¦è·Ÿè¸ªè‚¡ç¥¨ä¹°å–è®°å½•ï¼Œå¹¶å°†æ­¤ä½œä¸ºé‡‘èåˆ†æçš„åŸºç¡€ã€‚</li></ul></li></ul><p>æœ¬ç¯‡ç¤ºä¾‹ä»£ç å¤§éƒ¨åˆ†ç¼–å†™è¿‡ç¨‹ä¸åœ¨è¯¦ç»†èµ˜è¿°ï¼Œå¦‚æœéœ€è¦å¯ä»¥åœ¨<a href="https://github.com/HATTER-LONG/TDD_Learning">æºç å·¥ç¨‹</a>ä¸­æŸ¥æ‰¾åˆ°ã€‚</p><p>ç»è¿‡åˆæ­¥ç¼–å†™ï¼Œè·å¾—äº†å¦‚ä¸‹çš„æµ‹è¯•ä»£ç ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">// test/Catch2/PortfolioTest/PortfolioTest.cpp</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Portfolio/Portfolio.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"catch2/catch.hpp"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> Catch<span class="token punctuation">;</span><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"Create portfolio example"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    Portfolio portfolio<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">APortfolio</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    Portfolio m_portfolio<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Is empty whe created"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>m_portfolio<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Is not empty after purchase"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    m_portfolio<span class="token punctuation">.</span><span class="token function">purchase</span><span class="token punctuation">(</span><span class="token string">"IBM"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE_FALSE</span><span class="token punctuation">(</span>m_portfolio<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers zero for share count of no purchased symbol"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>m_portfolio<span class="token punctuation">.</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token string">"AAPL"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0u</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers share count for purchased symbol"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    m_portfolio<span class="token punctuation">.</span><span class="token function">purchase</span><span class="token punctuation">(</span><span class="token string">"IBM"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>m_portfolio<span class="token punctuation">.</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token string">"IBM"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2u</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//Src/Portfolio/Portfolio.h</span><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token keyword">class</span> <span class="token class-name">Portfolio</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">Portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">bool</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">bool</span> m_isEmpty<span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> m_shareCount<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Src/Portfolio/Portfolio.cpp</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Portfolio.h"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>Portfolio<span class="token operator">::</span><span class="token function">Portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token operator">:</span> m_isEmpty <span class="token punctuation">{</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>        <span class="token punctuation">,</span> m_shareCount <span class="token punctuation">{</span> <span class="token number">0u</span> <span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">bool</span> Portfolio<span class="token operator">::</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> m_isEmpty<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">)</span><span class="token punctuation">{</span>    m_isEmpty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    m_shareCount <span class="token operator">=</span> ShareCount<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Portfolio<span class="token operator">::</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> m_shareCount<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ä»£ç å°±æ˜¯é˜…è¯»ä»£ç é¦–è¦çš„ç†è§£é€”å¾„ã€‚</p><h3 id="æŠ•èµ„ç®¡ç†å™¨ä¸­çš„ç®€å•é‡å¤"><a href="#æŠ•èµ„ç®¡ç†å™¨ä¸­çš„ç®€å•é‡å¤" class="headerlink" title="æŠ•èµ„ç®¡ç†å™¨ä¸­çš„ç®€å•é‡å¤"></a>æŠ•èµ„ç®¡ç†å™¨ä¸­çš„ç®€å•é‡å¤</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (18fdb0404fcec58c117f776cadb40d4909c50243)ï¼›</strong></p><p>é¦–å…ˆè¦çŸ¥é“ä¸€ç‚¹ï¼Œ<strong>ä¸ä»…ä»…æ˜¯ç”Ÿäº§ä»£ç ï¼Œæµ‹è¯•ä»£ç ä¸­é¿å…é‡å¤ä¹Ÿæ˜¯å¾ˆé‡è¦çš„</strong>ã€‚ä¾‹å¦‚å­—ç¬¦ä¸² â€œIBMâ€ åœ¨ä¸¤ä¸ªæµ‹è¯•ä¸­å°±é‡å¤äº† 3 æ¬¡ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APortfolio</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string IBM<span class="token punctuation">;</span>    Portfolio m_portfolio<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> string APortfolio<span class="token operator">::</span><span class="token function">IBM</span><span class="token punctuation">(</span><span class="token string">"IBM"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨ IBM æˆå‘˜æ›¿æ¢æ‰ â€œIBMâ€ å­—ç¬¦ä¸²ã€‚</p><p>å¦‚ä¸‹ä»£ç ä¸­ä¹Ÿå­˜åœ¨é‡å¤ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Portfolio.h"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>Portfolio<span class="token operator">::</span><span class="token function">Portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token operator">:</span> m_isEmpty <span class="token punctuation">{</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>        <span class="token punctuation">,</span> m_shareCount <span class="token punctuation">{</span> <span class="token number">0u</span> <span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">bool</span> Portfolio<span class="token operator">::</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> m_isEmpty<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">)</span><span class="token punctuation">{</span>    m_isEmpty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    m_shareCount <span class="token operator">=</span> ShareCount<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Portfolio<span class="token operator">::</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> m_shareCount<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»è§†è§‰è§’åº¦æ¥çœ‹ï¼Œä»£ç å¹¶æ²¡æœ‰æ˜æ˜¾çš„è¡Œä¸è¡Œï¼ˆæˆ–è¡¨è¾¾å¼ä¸è¡¨è¾¾å¼ï¼‰çš„é‡å¤ã€‚ä½†å…¶ä¸­å­˜åœ¨ç®—æ³•çº§çš„é‡å¤ã€‚æˆå‘˜å‡½æ•° IsEmpty() è¿”å›ä¸€ä¸ªå¸ƒå°”é‡ï¼Œè¿™ä¸ªå¸ƒå°”é‡ä¼šåœ¨ Purchase() è¢«è°ƒç”¨æ—¶æ›´æ”¹ã€‚ä½†æ˜¯ï¼Œç©ºçš„æ¦‚å¿µå´ç›´æ¥ç»‘å®šäº†è‚¡ç¥¨æ•°ç›®ï¼Œè‚¡ç¥¨æ•°ç›®ä¼šåœ¨è°ƒç”¨ Purchase() æ—¶è¢«èµ‹å€¼ã€‚é€šè¿‡å»é™¤ m_isEmpty å˜é‡ï¼Œè®© IsEmpty() æŸ¥è¯¢è‚¡ç¥¨çš„æ•°é‡ï¼Œæˆ‘ä»¬å¯ä»¥æ¶ˆé™¤è¿™ä¸€æ¦‚å¿µé‡å¤ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Portfolio.h"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>Portfolio<span class="token operator">::</span><span class="token function">Portfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token operator">:</span> m_shareCount <span class="token punctuation">{</span> <span class="token number">0u</span> <span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">bool</span> Portfolio<span class="token operator">::</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token number">0</span> <span class="token operator">==</span> m_shareCount<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">)</span><span class="token punctuation">{</span>    m_shareCount <span class="token operator">=</span> ShareCount<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Portfolio<span class="token operator">::</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> m_shareCount<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡æŸ¥è¯¢è‚¡ç¥¨æ•°é‡æ¥å†³å®šæ˜¯ä¸æ˜¯ç©ºæœ‰äº›å•°å—¦ï¼Œä½†æ˜¯ç›®å‰æ˜¯æ­£ç¡®çš„ã€‚è€Œä¸”éšè¯å¢é‡ç¼–å†™ä»£ç ï¼Œå¾€å¾€ä¼šæœ‰ä¸€äº›æ›´æœ‰è¶£çš„æƒ³å‘è¿›è€Œä¿ƒè¿›æ–°æµ‹è¯•çš„äº§ç”Ÿã€‚ä¾‹å¦‚ï¼Œæœ‰äººè´­ä¹°äº† 0 è‚¡æŸè‚¡ç¥¨ï¼ŒPortfolio::isEmpty() ä¼šè¿”å›ç©ºã€‚ä½†æ˜¯æˆ‘ä»¬å¯¹äºç©ºçš„å®šä¹‰æ˜¯æ˜¯å¦åŒ…å«ä»»ä½•è‚¡ç¥¨ï¼Œæ‰€ä»¥è¿™æ˜¯å¦ä¸ºç©ºï¼Ÿæˆ–è€…ä¸åº”è¯¥å…è®¸è¿™ç¬”ä¹°å…¥ï¼Ÿç¡®å®šå¥½å‰è¿›çš„æ–¹å‘ï¼Œå¹¶å¢åŠ ä¸€ä¸ªæµ‹è¯•å§ã€‚</p><p><strong>ç®—æ³•çš„é‡å¤ï¼ˆè§£å†³åŒä¸€é—®é¢˜çš„ä¸åŒæ–¹æ³•æˆ–é—®é¢˜çš„ä¸åŒéƒ¨åˆ†ï¼‰ä¼šéšç³»ç»Ÿå¢é•¿æ¼”å˜ä¸ºé‡å¤§é—®é¢˜ã€‚é€šå¸¸æ¥è¯´ï¼Œéšç€å¯¹ä¸€ä¸ªå®ç°çš„æ”¹åŠ¨æœªèƒ½ç¼–å†™è¿›å…¶ä»–å®ç°ï¼Œé‡å¤ä»£ç ä¼šæ¼”åŒ–ä¸ºä¸ç»æ„çš„å˜ä½“ã€‚</strong></p><h3 id="å¦‚ä½•åšæŒå¢é‡çš„æ–¹æ³•"><a href="#å¦‚ä½•åšæŒå¢é‡çš„æ–¹æ³•" class="headerlink" title="å¦‚ä½•åšæŒå¢é‡çš„æ–¹æ³•"></a>å¦‚ä½•åšæŒå¢é‡çš„æ–¹æ³•</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (76f547915f27e85a2078d92c70eac8144da2e336)ï¼›</strong></p><p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„ç¼–ç åï¼Œæˆ‘ä»¬å¾—åˆ°äº†å¦‚ä¸‹çš„ä¸€äº›æµ‹è¯•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Is empty whe created"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Is not empty after purchase"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers zero for share count of no purchased symbol"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers share count for purchased symbol"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Throw on purchase of zero shares"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers share count for appropriate symbol"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"share count reflects accumulated for purchases same symbol"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Reduces share count of symbol on sell"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Throw when selling more shares than purchased"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–°å¢çš„éœ€æ±‚æ¥äº†ï¼š</p><ul><li><strong>åœºæ™¯ï¼šæ˜¾ç¤ºä¹°å…¥å†å²è®°å½•</strong><ul><li>æŠ•èµ„è€…æƒ³çœ‹ä¸€ä¸‹ç‰¹å®šè‚¡ç¥¨çš„è´­ä¹°è®°å½•ï¼Œæ¯ä¸ªè®°å½•è¦æ˜¾ç¤ºè´­ä¹°çš„æ—¥æœŸåŠæ•°é‡ã€‚</li></ul></li></ul><p>å°±å½“å‰å®ç°æ¥è¯´ï¼Œè¿™ä¸ªåœºæ™¯å¼€å‘å¾ˆå›°éš¾ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰è·Ÿè¸ªæ¯ä¸€ç¬”çš„äº¤æ˜“ï¼Œæ›´æ²¡æœ‰è®°å½•è´­ä¹°æ—¥æœŸã€‚è¿™ä¹Ÿæ˜¯è®¸å¤šå¼€å‘è€…å¯¹ TDD è´¨ç–‘çš„åœ°æ–¹ã€‚ä½†æ˜¯å¦‚æœå¤šèŠ±ä¸€äº›æ—¶é—´è¿›è¡Œå‰æœŸçš„éœ€æ±‚åˆ†æï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šçŸ¥é“éœ€è¦è·Ÿè¸ªä¹°æ—¥æ—¥æœŸï¼Œè¿™æ ·åœ¨æœ€åˆçš„è®¾è®¡å°±å¯èƒ½çº³å…¥è¿™ä¸ªéœ€æ±‚ã€‚</p><p>ä½†ç°åœ¨å·²ç»å¼€å‘ä¸€èˆ¬ï¼Œé©¬åç‚®æ˜¯æ²¡æœ‰ç”¨çš„ã€‚è¿™ä¸ªéœ€æ±‚åœºæ™¯éœ€è¦é‡æ„ï¼Œè®¾å®šå¥½ 10 åˆ†é’Ÿçš„é—¹é’Ÿï¼Œå¼€å§‹ã€‚</p><blockquote><p>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (d4516419538f4adfd5d8f252c10a9e8f37b528ec)</p></blockquote><ul><li>å…ˆç†é¡ºä»¥ä¸‹éœ€è¦åšçš„å·¥ä½œï¼š<ul><li>é¦–å…ˆå¿…é¡»å®šä¹‰å¥½è¡¨ç¤ºä¹°å…¥çš„æ•°æ®ç»“æ„ã€æ”¹å˜æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ã€ä»å®¢æˆ·ç«¯ä»£ç æä¾›æ—¥æœŸã€æ­£ç¡®åœ°å¡«å†™æ•°æ®ç»“æ„å¹¶å‚¨å­˜æ•°æ®ã€‚</li><li>ä¸è¿‡å…ˆä¸è¦å¼€å§‹ï¼Œè‡³å°‘ä¸è¦ä¸€å£æ°”åšå®Œã€‚æ—¶åˆ»è°¨è®°æ˜¯å¦å¯ä»¥å¢é‡çš„è¿›è¡Œï¼Œæ¯å‡ åˆ†é’Ÿå°±å¯»æ±‚ä¸€ä¸‹æ­£é¢çš„åé¦ˆã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåšå‡ºä¸€ç¬”ä¹°å…¥çš„æµ‹è¯•ï¼Œç„¶åéªŒè¯ç›¸åº”çš„ä¹°å…¥æ˜¯å¦åœ¨è´­ä¹°è®°å½•ä¸­ã€‚å‡è®¾ä¹°å…¥æ€»æ˜¯åœ¨ä¸€ä¸ªæŒ‡å®šçš„æ—¥æœŸåšå‡ºï¼Œå› ä¸ºå¯ä»¥ä¸ç»™ Purchase() ä¼ é€’æ—¥æœŸï¼Œè¿™ä½¿å¾—ç›®å‰çš„ä»»åŠ¡æ›´ç®€å•ã€‚</li></ul></li></ul><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers the purchase record for a single purchase"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">using</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token punctuation">;</span>    m_portfolio<span class="token punctuation">.</span><span class="token function">purchase</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> purchases <span class="token operator">=</span> m_portfolio<span class="token punctuation">.</span><span class="token function">purchases</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> purchase <span class="token operator">=</span> purchases<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>purchase<span class="token punctuation">.</span>m_shareCount <span class="token operator">==</span> <span class="token number">5u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>purchase<span class="token punctuation">.</span>m_date <span class="token operator">==</span> Portfolio<span class="token operator">::</span>FIXED_PURCHASE_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ºäº†ä½¿æµ‹è¯•é€šè¿‡ï¼Œå¯ä»¥å…ˆä¸éœ€è¦å°†ä¹°å…¥è®°å½•äº holding æ•°æ®ç»“æ„å…³è”ã€‚å› ä¸ºç›®å‰çš„å‡è®¾åªè€ƒè™‘å•æ¬¡ä¹°å…¥ï¼Œæ‰€ä»¥å¯ä»¥å®šä¹‰ä¸€ä¸ªâ€œå…¨å±€çš„â€ä¹°å…¥è®°å½•é›†åˆï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> PurchaseRecord<span class="token punctuation">{</span>    <span class="token function">PurchaseRecord</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token operator">&amp;</span> Date<span class="token punctuation">)</span>            <span class="token operator">:</span> <span class="token function">m_shareCount</span><span class="token punctuation">(</span>ShareCount<span class="token punctuation">)</span>            <span class="token punctuation">,</span> <span class="token function">m_date</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> m_shareCount<span class="token punctuation">;</span>    boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date m_date<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Portfolio</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date FIXED_PURCHASE_DATE<span class="token punctuation">;</span>    <span class="token keyword">bool</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">sell</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> <span class="token function">purchases</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token keyword">private</span><span class="token operator">:</span>    std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">></span> m_holdings<span class="token punctuation">;</span>    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> m_purchases<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (34253c6cd9326d82aa508e8e82bd52061b26508f)</p></blockquote><p>åœ¨ç»§ç»­ä¹‹å‰ï¼Œè·å¾—å¯¹æ•²å…¥ä»£ç çš„æ­£é¢åé¦ˆæ˜¯ä¸€ä»¶å¾ˆå¥½çš„äº‹æƒ…ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¸¸é‡ FIXED_PURCHASE_DATEï¼Œä»¥ä¾¿å–å¾—å¿«é€Ÿçš„ã€å¯ä»¥å±•ç¤ºçš„è¿›æ­¥ã€‚æˆ‘ä»¬çŸ¥é“è¿™æ˜¯å‡è®¾çš„ï¼Œç°åœ¨å»æ‰è¿™ä¸ªå‡è®¾ï¼Œç„¶åå¢åŠ ä¸€ä¸ªæ–°çš„æµ‹è¯•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers the purchase record for a single purchase"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">using</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token punctuation">;</span>    date <span class="token function">dateOfPurchase</span><span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> boost<span class="token operator">::</span>date_time<span class="token operator">::</span>Mar<span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m_portfolio<span class="token punctuation">.</span><span class="token function">purchase</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> dateOfPurchase<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> purchases <span class="token operator">=</span> m_portfolio<span class="token punctuation">.</span><span class="token function">purchases</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> purchase <span class="token operator">=</span> purchases<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>purchase<span class="token punctuation">.</span>m_shareCount <span class="token operator">==</span> <span class="token number">5u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>purchase<span class="token punctuation">.</span>m_date <span class="token operator">==</span> dateOfPurchase<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ purchase æ¥å£æ”¯æŒä¼ å…¥æ—¥æœŸå‚æ•°ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//Src/Portfolio/Portfolio.h</span>    <span class="token keyword">void</span> <span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span>        <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token operator">&amp;</span> TransactionDate <span class="token operator">=</span> Portfolio<span class="token operator">::</span>FIXED_PURCHASE_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Src/Portfolio/Portfolio.cpp</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> ShareCount<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">InvalidPurchaseException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m_holdings<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> ShareCount <span class="token operator">+</span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>    m_purchases<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">PurchaseRecord</span><span class="token punctuation">(</span>ShareCount<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°æ¥å£ä½¿ç”¨äº†é»˜è®¤å‚æ•°ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°å¹¶æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œè¿˜å®¹æ˜“å¼•èµ·é”™è¯¯ï¼Œç°åœ¨æƒ³è¦å»é™¤ purchase çš„é»˜è®¤æ—¶é—´ä½†æ˜¯è¿˜æœ‰è®¸å¤šæµ‹è¯•æ²¡æœ‰ä¼ å…¥æ—¥æœŸï¼Œå¯ä»¥æä¾›ä¸€ä¸ª fixture è¾…åŠ©æ–¹æ³•ï¼Œç”±å®ƒæ¥å¤„ç†å¯¹ Purchase() çš„è°ƒç”¨å¹¶æä¾›ä¸€ä¸ªé»˜è®¤æ—¥æœŸã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APortfolio</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date ARBITRARY_DATE<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string IBM<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string SAMSUNG<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span>        <span class="token keyword">const</span> date<span class="token operator">&amp;</span> TransactionDate <span class="token operator">=</span> APortfolio<span class="token operator">::</span>ARBITRARY_DATE<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        m_portfolio<span class="token punctuation">.</span><span class="token function">purchase</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">,</span> ShareCount<span class="token punctuation">,</span> ARBITRARY_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    Portfolio m_portfolio<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Reduces share count of symbol on sell"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">purchase</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m_portfolio<span class="token punctuation">.</span><span class="token function">sell</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>m_portfolio<span class="token punctuation">.</span><span class="token function">shareCount</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">30u</span> <span class="token operator">-</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€ä¸ªå¯èƒ½å¼•èµ·äº‰è®®çš„ç‚¹æ˜¯ï¼Œè¾…åŠ©å‡½æ•° Purchase() ä»æµ‹è¯•ä¸­ç§»é™¤äº†ä¸€äº›ä¿¡æ¯ï¼Œç¬¬ä¸€æ¬¡é˜…è¯»æµ‹è¯•çš„äººå¿…é¡»æŸ¥çœ‹è¾…åŠ©å‡½æ•°ä»¥ä¾¿äº†è§£å…¶ä½œç”¨ã€‚ä½†è¿™æ˜¯ä¸€ä¸ªç®€å•å‡½æ•°ï¼Œæ²¡æœ‰éšè—å¯¹é˜…è¯»è€…æ¥è¯´éš¾ä»¥è®°å¿†çš„å…³é”®ä¿¡æ¯ã€‚<strong>å› æ­¤åœ¨ä¸“é—¨æµ‹è¯• Purchase() è¡Œä¸ºæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç›´æ¥è°ƒç”¨å®ƒã€‚</strong></p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers share count for purchased symbol"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    m_portfolio<span class="token punctuation">.</span><span class="token function">purchase</span><span class="token punctuation">(</span>IBM<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> ARBITRARY_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//å¯ä»¥æ¥å—ä¸€ä¸ªé»˜è®¤çš„æµ‹è¯•æ—¶é—´ä¼ å…¥</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>m_portfolio<span class="token punctuation">.</span><span class="token function">shareCount</span><span class="token punctuation">(</span>IBM<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2u</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ›´å¤šçš„é‡å¤"><a href="#æ›´å¤šçš„é‡å¤" class="headerlink" title="æ›´å¤šçš„é‡å¤"></a>æ›´å¤šçš„é‡å¤</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (336879ab8d12cd3aeed071004ff61aa642c3d953)ï¼›</strong></p><p>ä¸ºäº†æ”¯æŒè´Ÿæ•°çš„ä¹°å…¥è®°å½•ï¼Œå°† ShareCount æ”¹ä¸ºæœ‰ç¬¦å·æ•´æ•°ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">struct</span> PurchaseRecord<span class="token punctuation">{</span>    <span class="token function">PurchaseRecord</span><span class="token punctuation">(</span><span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token operator">&amp;</span> Date<span class="token punctuation">)</span>            <span class="token operator">:</span> <span class="token function">m_shareCount</span><span class="token punctuation">(</span>ShareCount<span class="token punctuation">)</span>            <span class="token punctuation">,</span> <span class="token function">m_date</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> m_shareCount<span class="token punctuation">;</span>    boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date m_date<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®é™…çš„äº¤æ˜“ä»£ç ï¼Œå…¶ä¸­ä¸‰è¡Œçœ‹èµ·æ¥æœ‰äº›é‡å¤ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> ShareCount<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">InvalidPurchaseException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m_holdings<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> ShareCount <span class="token operator">+</span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>    m_purchases<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">PurchaseRecord</span><span class="token punctuation">(</span>ShareCount<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ShareCount <span class="token operator">></span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">InvalidSellException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m_holdings<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span> <span class="token operator">-</span> ShareCount<span class="token punctuation">;</span>    m_purchases<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">PurchaseRecord</span><span class="token punctuation">(</span><span class="token operator">-</span>ShareCount<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»–ä»¬æœ¬è´¨ä¸Šå¾ˆç›¸ä¼¼ï¼š</p><ol><li><p>ç¬¬ä¸€è¡Œçš„ä¿æŠ¤è¯­å¥éƒ½æ˜¯ç”¨æ¥çº¦æŸæ“ä½œï¼Œå³ä¸èƒ½ä¹°å…¥ 0ï¼Œå’Œä¸èƒ½å–å‡ºçš„å¤§äºæŒæœ‰çš„æ•°é‡ï¼Œä½†æ˜¯å–å‡ºç»Ÿä¸€ä¹Ÿä¸åº”å–å‡º 0ï¼ŒåŒæ—¶ sell() æ¥å£ä¸­çš„ InvalidSellException å¼‚å¸¸ç±»å‹çš„åç§°å¯ä»¥å…·ä½“åŒ–å…¬ç”¨ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Throws on sell of zero shares"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THROWS_AS</span><span class="token punctuation">(</span><span class="token function">sell</span><span class="token punctuation">(</span>IBM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ShareCountCannotBeZeroException<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//Src/Portfolio/Portfolio.cpp</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ShareCount <span class="token operator">></span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">InvalidSellException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//è¿™æ · sell ä¸ purchase å°±æœ‰ç›¸åŒçš„åˆ¤æ–­æ¡ä»¶äº†</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> ShareCount<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">ShareCountCannotBeZeroException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m_holdings<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span> <span class="token operator">-</span> ShareCount<span class="token punctuation">;</span>    m_purchases<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">PurchaseRecord</span><span class="token punctuation">(</span><span class="token operator">-</span>ShareCount<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>é€šè¿‡åŠ æˆ–å‡å·²æŒæœ‰çš„è‚¡ç¥¨æ•°ï¼Œå¯ä»¥æ›´æ–°ç›¸åº”è‚¡ç¥¨åç§°çš„æŒæœ‰é‡ã€‚è¿™æ · sell ä¸ purchase å…¬ç”¨çš„è¯­å¥å¯ä»¥æŠ½å‡ºï¼š</p></li></ol><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">purchase</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">transact</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">,</span> ShareCount<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">sell</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ShareCount <span class="token operator">></span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">InvalidSellException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">transact</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">,</span> <span class="token operator">-</span>ShareCount<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">transact</span><span class="token punctuation">(</span>    <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">int</span> ShareChange<span class="token punctuation">,</span> <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> ShareChange<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">ShareCountCannotBeZeroException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m_holdings<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span> <span class="token operator">+</span> ShareChange<span class="token punctuation">;</span>    m_purchases<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">PurchaseRecord</span><span class="token punctuation">(</span>ShareChange<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦ä¸€ä¸ªå’Œè¡¨è¾¾åŠ›ç›¸å…³çš„äº‹æƒ…ï¼Œå¼‚å¸¸ç±»å‹ InvalidSellException çš„åç§°ä¸æ˜¯å¾ˆå¥½ã€‚æˆ‘ä»¬å°†å…¶æ”¹æˆ InsufficientSharesExceptionã€‚</p><h3 id="å°æ–¹æ³•çš„å¥½å¤„"><a href="#å°æ–¹æ³•çš„å¥½å¤„" class="headerlink" title="å°æ–¹æ³•çš„å¥½å¤„"></a>å°æ–¹æ³•çš„å¥½å¤„</h3><p>Transact() å‡½æ•°åªåŒ…å«ä¸‰è¡Œç®€å•çš„ä»£ç ï¼Œä½†æ˜¯æƒ³è¦äº†è§£æ•´ä¸ªç³»ç»Ÿç¡®æœ‰äº›å›°éš¾ï¼Œä¸å…·å¤‡è¡¨è¾¾åŠ›å¯¹æ­¤è¿›è¡Œä¿®æ”¹ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">transact</span><span class="token punctuation">(</span>    <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">int</span> ShareChange<span class="token punctuation">,</span> <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">throwIfShareCountIsZero</span><span class="token punctuation">(</span>ShareChange<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">updateShareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">,</span> ShareChange<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">addPurchaseRecord</span><span class="token punctuation">(</span>ShareChange<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">throwIfShareCountIsZero</span><span class="token punctuation">(</span><span class="token keyword">int</span> ShareChange<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> ShareChange<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">ShareCountCannotBeZeroException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">updateShareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">int</span> ShareChange<span class="token punctuation">)</span><span class="token punctuation">{</span>    m_holdings<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">shareCount</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span> <span class="token operator">+</span> ShareChange<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">addPurchaseRecord</span><span class="token punctuation">(</span><span class="token keyword">int</span> ShareChange<span class="token punctuation">,</span> <span class="token keyword">const</span> date<span class="token operator">&amp;</span> Date<span class="token punctuation">)</span><span class="token punctuation">{</span>    m_purchases<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">PurchaseRecord</span><span class="token punctuation">(</span>ShareChange<span class="token punctuation">,</span> Date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>ä¸‹é¢å¯èƒ½æ˜¯ä½ ä¼šæå‡ºä¸è¿™ä¹ˆåšçš„ä¸€äº›ç†ç”±ï¼š</p><ul><li>è¿™æ˜¯é¢å¤–åŠŸã€‚åˆ›å»ºæ–°å‡½æ•°å¾ˆè´¹åŠ›ã€‚</li><li>ä¸ºåªåœ¨ä¸€ä¸ªåœ°æ–¹ç”¨åˆ°çš„å•è¡Œä»£ç åˆ›å»ºä¸€ä¸ªå‡½æ•°ä¼¼ä¹å¾ˆè’å”ã€‚</li><li>é¢å¤–çš„å‡½æ•°è°ƒç”¨ä¼šåŠ é‡æ€§èƒ½å¼€é”€ã€‚</li><li>å¾ˆéš¾åœ¨æ‰€æœ‰ä»£ç ä¸­éµå¾ªå®Œæ•´çš„æ§åˆ¶æµã€‚</li><li>ä½ ä¼šå¾—åˆ°æˆåƒä¸Šä¸‡ä¸ªå°æ–¹æ³•ï¼Œä¸”æ¯ä¸ªæ–¹æ³•éƒ½æœ‰ç€å·¨é•¿çš„åç§°ã€‚</li></ul></li><li><p>æœŸæœ›è¿™ä¹ˆåšçš„åŸå› ï¼š</p><ul><li>è¿™éµå®ˆäº†å†…èšå’Œå•ä¸€è´£ä»»çš„è®¾è®¡åŸåˆ™ã€‚åŒä¸€å‡½æ•°ä¸­çš„æ‰€æœ‰ä»£ç å¤„äºåŒä¸€å±‚æ¬¡çš„æŠ½è±¡ã€‚ä¿®æ”¹æ¯ä¸ªå‡½æ•°çš„åŸå› åªæœ‰ä¸€ä¸ªã€‚</li><li>è¿™ä¸ºä»¥åçš„è®¾è®¡æ”¹åŠ¨é“ºå¹³äº†é“è·¯ã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦å°†ä¹°å…¥è®°å½•å’Œå¯¹åº”çš„è‚¡ç¥¨åç§°è”ç³»èµ·æ¥ï¼Œä½†ç°åœ¨å¯ä»¥åœ¨ä¸€å¤„å®Œæˆæ”¹åŠ¨ï¼Œè€Œéä¸¤å¤„ã€‚</li><li>å¿½ç•¥å…·ä½“çš„å®ç°ç»†èŠ‚ä¼šæ›´å®¹æ˜“ç†è§£ä»£ç æ§åˆ¶æµã€‚å›å¿†ä¸€ä¸‹æ¥å£å’Œå®ç°æˆ–æŠ½è±¡å’Œå…·ä½“çš„åˆ†ç¦»ç†å¿µã€‚</li><li>å°æ–¹æ³•æ˜¯çœŸæ­£é‡ç”¨çš„å¼€å§‹ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„ç›¸ä¼¼å‡½æ•°è¢«æå–å‡ºæ¥ï¼Œè¯†åˆ«å‡ºé‡å¤çš„æ¦‚å¿µå’Œç»“æ„ä¼šå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</li></ul></li></ul><h3 id="å®ŒæˆåŠŸèƒ½"><a href="#å®ŒæˆåŠŸèƒ½" class="headerlink" title="å®ŒæˆåŠŸèƒ½"></a>å®ŒæˆåŠŸèƒ½</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (8e75460501b0ef4c3dd3689f549eff60f1e575e4)ï¼›</strong></p><p>ç›®å‰çš„æŠ•èµ„ç®¡ç†å™¨èƒ½å¤Ÿè¿”å›ä¸€ä¸ªä¹°å…¥åˆ—è¡¨ï¼Œä½†åªèƒ½è¿”å›ä¸€æ”¯è‚¡ç¥¨çš„åˆ—è¡¨ã€‚ä¸‹ä¸€ä¸ªæµ‹è¯•è¦æ±‚æŠ•èµ„ç®¡ç†å™¨èƒ½è¿”å›å¤šæ”¯å·²è´­è‚¡ç¥¨çš„ä¹°å…¥è®°å½•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> PurchaseRecord<span class="token operator">&amp;</span> Lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> PurchaseRecord<span class="token operator">&amp;</span> Rhs<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> Lhs<span class="token punctuation">.</span>m_shareCount <span class="token operator">==</span> Rhs<span class="token punctuation">.</span>m_shareCount <span class="token operator">&amp;&amp;</span> Lhs<span class="token punctuation">.</span>m_date <span class="token operator">==</span> Rhs<span class="token punctuation">.</span>m_date<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// TODO: ä½¿ç”¨æ–°å¼æ–¹æ³•å®ç°ä¸€ä¸ª Matcher åŒ¹é…å™¨</span><span class="token comment" spellcheck="true">// https://github.com/catchorg/Catch2/blob/devel/docs/matchers.md</span><span class="token keyword">class</span> <span class="token class-name">ElementsAre</span> <span class="token operator">:</span> <span class="token keyword">public</span> Catch<span class="token operator">::</span>MatcherBase<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">>></span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">ElementsAre</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span><span class="token operator">&amp;</span> Param<span class="token punctuation">)</span>            <span class="token operator">:</span> <span class="token function">m_purchaseRecord</span><span class="token punctuation">(</span>Param<span class="token punctuation">)</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">bool</span> <span class="token function">match</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> <span class="token keyword">const</span><span class="token operator">&amp;</span> Arg<span class="token punctuation">)</span> <span class="token keyword">const</span> override    <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> varL <span class="token operator">:</span> Arg<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">bool</span> retFlag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> varR <span class="token operator">:</span> m_purchaseRecord<span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>varL <span class="token operator">==</span> varR<span class="token punctuation">)</span> <span class="token punctuation">{</span> retFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>retFlag<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">describe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"None Match"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> m_purchaseRecord<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Separates purchase records by symbol"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">purchase</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> ARBITRARY_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">purchase</span><span class="token punctuation">(</span>IBM<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ARBITRARY_DATE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> sales <span class="token operator">=</span> m_portfolio<span class="token punctuation">.</span><span class="token function">purchases</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">)</span><span class="token punctuation">;</span>    vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> checkArray <span class="token punctuation">{</span> <span class="token function">PurchaseRecord</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> ARBITRARY_DATE<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>sales<span class="token punctuation">,</span> <span class="token function">ElementsAre</span><span class="token punctuation">(</span>checkArray<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Catch2 æ²¡æœ‰æä¾›ç±»ä¼¼ gmock çš„ ElementAre åŒ¹é…å™¨ï¼Œè¿™é‡Œå…ˆè‡ªå·±å®ç°ä¸€ä¸ªï¼Œç”¨æ¥éªŒè¯æŒ‡å®šçš„å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚æµ‹è¯•ä¸€å¼€å§‹å¤±è´¥äº†ï¼Œå› ä¸ºåä¸º m_portfolio çš„å‘é‡å®¹å™¨åªåŒ…å«ä¸¤ä¸ªä¹°å…¥è®°å½•â€”â€”ä¸€ä¸ªæ˜¯ Samsungï¼Œå¦ä¸€ä¸ªæ˜¯ IBMã€‚<br>ç°åœ¨ä¿®æ”¹ä»£ç ï¼Œä¸ºæ¯åªè‚¡ç¥¨ä¿å­˜åŒ…å«äº†æ­¤è‚¡ç¥¨ä¹°å–çš„è®°å½•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Portfolio</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//......</span>    <span class="token keyword">void</span> <span class="token function">addPurchaseRecord</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">int</span> ShareCount<span class="token punctuation">,</span> <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token operator">&amp;</span> Date<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">throwIfShareCountIsZero</span><span class="token punctuation">(</span><span class="token keyword">int</span> ShareChange<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>    std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">></span> m_holdings<span class="token punctuation">;</span>    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> m_purchases<span class="token punctuation">;</span>    std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">>></span> m_purchaseRecords<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¢åŠ ä¸€ä¸ª map ç”¨äºå­˜å‚¨äº¤æ˜“ä¿¡æ¯ï¼ŒåŒæ—¶ addPurchaseRecord æ¥å£å¢åŠ  Symbol å‚æ•°ã€‚ä¿®æ”¹å…·ä½“å®ç°ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">addPurchaseRecord</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">int</span> ShareChange<span class="token punctuation">,</span> <span class="token keyword">const</span> date<span class="token operator">&amp;</span> Date<span class="token punctuation">)</span><span class="token punctuation">{</span>    m_purchases<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">PurchaseRecord</span><span class="token punctuation">(</span>ShareChange<span class="token punctuation">,</span> Date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> it <span class="token operator">=</span> m_purchaseRecords<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">==</span> m_purchaseRecords<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> m_purchaseRecords<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    m_purchaseRecords<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">PurchaseRecord</span><span class="token punctuation">(</span>ShareChange<span class="token punctuation">,</span> Date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//......</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> Portfolio<span class="token operator">::</span><span class="token function">purchases</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> m_purchaseRecords<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥åœ¨æµ‹è¯•åˆ—è¡¨ä¸­åŠ å…¥ä¸€ä¸ªæ¡ç›®ï¼ˆâ€œå¤„ç†åœ¨ä¹°å…¥è®°å½•ä¸­æ‰¾ä¸åˆ°ç‰¹å®šè‚¡ç¥¨çš„æƒ…å†µâ€ï¼‰ã€‚åŒæ—¶åœ¨æµ‹è¯•é€šè¿‡åå¯ä»¥ç§»é™¤æ‰ m_purchases ç›¸å…³çš„ä»£ç ã€‚ä»é‡å¤ä»£ç è§’åº¦æ¥çœ‹ï¼ŒShareCount() å’Œ Purchases() ä¸­éƒ½åŒ…å«äº†åœ¨æ˜ å°„å®¹å™¨ä¸­æŸ¥æ‰¾å…ƒç´ çš„ä»£ç ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//test.cpp</span><span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> PurchaseRecord<span class="token operator">&amp;</span> Lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> PurchaseRecord<span class="token operator">&amp;</span> Rhs<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span>Lhs <span class="token operator">==</span> Rhs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> <span class="token string">"Answers empty purchase record vector when symbol not found"</span><span class="token punctuation">,</span> <span class="token string">"[Portfolio]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>m_portfolio<span class="token punctuation">.</span><span class="token function">purchases</span><span class="token punctuation">(</span>SAMSUNG<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//.h</span><span class="token keyword">class</span> <span class="token class-name">Portfolio</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//.....</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">></span>    T <span class="token function">mapFind</span><span class="token punctuation">(</span>std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> T<span class="token operator">></span> Map<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Key<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">auto</span> it <span class="token operator">=</span> Map<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> it <span class="token operator">==</span> Map<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> T <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">:</span> it<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">></span> m_holdings<span class="token punctuation">;</span>    std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">>></span> m_purchaseRecords<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//cpp</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Portfolio<span class="token operator">::</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> mapFind<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">(</span>m_holdings<span class="token punctuation">,</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> Portfolio<span class="token operator">::</span><span class="token function">purchases</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> mapFind<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">>></span><span class="token punctuation">(</span>m_purchaseRecords<span class="token punctuation">,</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŒæ—¶è¿›è¡Œä¸€ç‚¹ç‚¹å°å°ä¼˜åŒ–ï¼Œä¸»è¦é’ˆå¯¹ addPurchaseRecord ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token keyword">bool</span> <span class="token function">containsSymbol</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">initializePurchaseRecords</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> PurchaseRecord<span class="token operator">&amp;&amp;</span> Record<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å†ä¸€æ¬¡åšäº†å¤§é‡çš„å°å‡½æ•°é‡æ„ã€‚ç°åœ¨ AddPurchaseRecord() å£°æ˜äº†é«˜å±‚æ¬¡çš„ç­–ç•¥ï¼Œå…¶ä¸­çš„ä¸‰ä¸ªå‡½æ•°ä»£è¡¨äº†ç­–ç•¥ä¸­å°è£…äº†å®ç°ç»†èŠ‚çš„æ¯ä¸ªæ­¥éª¤ã€‚</p><p>è¦è¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æå‰æ€è€ƒè®¾è®¡ã€‚ç›¸åï¼Œæˆ‘ä»¬å…ˆå¾—åˆ°äº†ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„ä»£ç ï¼Œç„¶åå†ä¼˜åŒ–ç°æœ‰æ–¹æ¡ˆçš„è®¾è®¡ã€‚è¿™æ ·åšçš„å‰¯ä½œç”¨æ˜¯ï¼Œä»¥åçš„æ”¹åŠ¨ä¼šæ›´åŠ å®¹æ˜“ã€‚</p><h3 id="å¢é‡è®¾è®¡è®©äº‹æƒ…å˜å¾—æ›´ç®€å•"><a href="#å¢é‡è®¾è®¡è®©äº‹æƒ…å˜å¾—æ›´ç®€å•" class="headerlink" title="å¢é‡è®¾è®¡è®©äº‹æƒ…å˜å¾—æ›´ç®€å•"></a>å¢é‡è®¾è®¡è®©äº‹æƒ…å˜å¾—æ›´ç®€å•</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (687b674d83cd1eb25182666c53e130e12a15881e)ï¼›</strong></p><p>åœ¨ Portfolio ä¸­ä¸¤ä¸ªç›¸ä¼¼çš„é›†åˆï¼šm_holdings å’Œ m_purchaseRecordsï¼Œå‰è€…å°†è‚¡ç¥¨å’Œæ€»è‚¡æ•°ç›¸<br>è”ç³»ï¼Œåè€…å°†è‚¡ç¥¨å’Œè´­ä¹°è®°å½•ç›¸è”ç³»ã€‚å¯ä»¥å»é™¤ m_holdingsï¼Œè½¬è€ŒæŒ‰ç…§éœ€è¦æ¥è®¡ç®—ä¸€ä¸ªç‰¹å®šè‚¡ç¥¨<br>çš„è‚¡æ•°ã€‚</p><p>å…¶å®å¦‚æœä¸å»é™¤ m_holdings å…¶å®å¯¹æ€§èƒ½æ˜¯æœ‰ç›Šå¤„çš„ï¼Œä½†æ˜¯è¿™ä¹Ÿä¼šå¯¼è‡´ä»£ç ç¨æ˜¾å¤æ‚ï¼Œè¿™ä¸€åˆ‡å–å†³äºå¼€å‘äººå‘˜çš„å–èˆã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">bool</span> Portfolio<span class="token operator">::</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token number">0</span> <span class="token operator">==</span> m_purchaseRecords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">transact</span><span class="token punctuation">(</span>    <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> <span class="token keyword">int</span> ShareChange<span class="token punctuation">,</span> <span class="token keyword">const</span> boost<span class="token operator">::</span>gregorian<span class="token operator">::</span>date<span class="token operator">&amp;</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">throwIfShareCountIsZero</span><span class="token punctuation">(</span>ShareChange<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">addPurchaseRecord</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">,</span> ShareChange<span class="token punctuation">,</span> TransactionDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Portfolio<span class="token operator">::</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">auto</span> records <span class="token operator">=</span> mapFind<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">>></span><span class="token punctuation">(</span>m_purchaseRecords<span class="token punctuation">,</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">accumulate</span><span class="token punctuation">(</span>records<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> records<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> Total<span class="token punctuation">,</span> PurchaseRecord Record<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Total <span class="token operator">+</span> Record<span class="token punctuation">.</span>m_shareCount<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥éœ€è¦å°†æ‰€æœ‰å’Œä¹°å…¥è®°å½•ç›¸å…³çš„ä»£ç æŠ½åˆ°å•ç‹¬çš„ç±»ä¸­ï¼Œå› ä¸º Portfolio è¿åäº†å•ä¸€è´£ä»»åŸåˆ™ï¼Œä¿®æ”¹ Portfolio ç±»çš„ä¸»è¦åŸå› åº”è¯¥å’Œæ“ä½œè‚¡ç¥¨çš„æ–¹å¼æœ‰å…³ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªéœ€è¦ä¿®æ”¹çš„åŸå› â€”â€”é’ˆå¯¹ä¹°å…¥è®°å½•çš„ç‰¹å®šå®ç°ç»†èŠ‚ã€‚</p><p>é€šè¿‡å¢é‡çš„æ–¹å¼è¿›è¡Œä¿®æ”¹ï¼Œé¦–å…ˆå¼•å…¥ä¸€ä¸ªæ–°çš„æˆå‘˜å˜é‡ï¼Œå°†è‚¡ç¥¨å’ŒæŒæœ‰é‡è”ç³»èµ·æ¥ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Portfolio</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//.....</span>    std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">>></span> m_purchaseRecords<span class="token punctuation">;</span>    std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token punctuation">,</span> Holding<span class="token operator">></span> m_holdings<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Holding å°±æ˜¯åç»­éœ€è¦å°†ä¹°å…¥å®ç°ç»†èŠ‚è¿å‡ºçš„åœ°æ–¹ï¼Œæ¥ä¸‹æ¥é€æ­¥å°† m_holdings æ›¿æ¢æ‰ m_purchaseRecordsã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">initializePurchaseRecords</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">{</span>    m_purchaseRecords<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    m_holdings<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Holding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> Portfolio<span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">,</span> PurchaseRecord<span class="token operator">&amp;&amp;</span> Record<span class="token punctuation">)</span><span class="token punctuation">{</span>    m_purchaseRecords<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>Record<span class="token punctuation">)</span><span class="token punctuation">;</span>    m_holdings<span class="token punctuation">[</span>Symbol<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥å°† Portfolio ä¸­ä¹°å…¥è®°å½•ç»†èŠ‚çš„ä»£ç è¿å‡ºåˆ° Holding.h ä¸­ï¼Œå¹¶å°†ä½¿ç”¨çš„ m_purchaseRecords å®ç°çš„åŠŸèƒ½æ›¿æ¢æˆ Holding ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">bool</span> Portfolio<span class="token operator">::</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// return 0 == m_purchaseRecords.size();</span>    <span class="token keyword">return</span> <span class="token number">0</span> <span class="token operator">==</span> m_holdings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// .....</span><span class="token keyword">bool</span> Portfolio<span class="token operator">::</span><span class="token function">containsSymbol</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// return m_purchaseRecords.find(Symbol) != m_purchaseRecords.end();</span>    <span class="token keyword">return</span> m_holdings<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">)</span> <span class="token operator">!=</span> m_holdings<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Portfolio<span class="token operator">::</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// auto records = mapFind&lt;vector&lt;PurchaseRecord>>(m_purchaseRecords, Symbol);</span>    <span class="token comment" spellcheck="true">// return accumulate(records.begin(), records.end(), 0,</span>    <span class="token comment" spellcheck="true">// [](int Total, PurchaseRecord Record) { return Total + Record.m_shareCount; });</span>    <span class="token keyword">return</span> mapFind<span class="token operator">&lt;</span>Holding<span class="token operator">></span><span class="token punctuation">(</span>m_holdings<span class="token punctuation">,</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shareCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>vector<span class="token operator">&lt;</span>PurchaseRecord<span class="token operator">></span> Portfolio<span class="token operator">::</span><span class="token function">purchases</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Symbol<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// return mapFind&lt;vector&lt;PurchaseRecord>>(m_purchaseRecords, Symbol);</span>    <span class="token keyword">return</span> mapFind<span class="token operator">&lt;</span>Holding<span class="token operator">></span><span class="token punctuation">(</span>m_holdings<span class="token punctuation">,</span> Symbol<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">purchases</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆåˆ é™¤ m_purchaseRecords ç›¸å…³å®ä¾‹å³å¯ã€‚</p><h2 id="é¢„å…ˆè®¾è®¡åœ¨å“ª"><a href="#é¢„å…ˆè®¾è®¡åœ¨å“ª" class="headerlink" title="é¢„å…ˆè®¾è®¡åœ¨å“ª"></a>é¢„å…ˆè®¾è®¡åœ¨å“ª</h2><p>é¢„å…ˆè®¾è®¡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·å§‹è·¯çº¿å›¾ã€‚å›´ç»•æ­¤è®¾è®¡çš„è®¨è®ºæœ‰åŠ©äºå‘ç°è½¯ä»¶ä¸­å¿…é¡»è¦åšçš„ä¸œè¥¿ï¼Œä»¥åŠæœ€åˆè¯¥æ€æ ·è®¾è®¡è½¯ä»¶ã€‚ä½†æ˜¯ï¼Œæ‰“é€ ç³»ç»Ÿæ‰€éœ€è¦çš„å¤§é‡ç»†èŠ‚ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä¾‹å¦‚ï¼Œç±»å›¾æ˜¯ä¸€ä¸ªéœ€è¦åˆ›å»ºçš„å¥½ä¸œè¥¿ï¼Œä½†ä¸è¦è¿‡åº¦æ‰§ç€äºåº•å±‚ç»†èŠ‚ï¼šç§æœ‰è¿˜æ˜¯å…¬å¼€ï¼Œå±æ€§ç»†èŠ‚ï¼Œèšåˆè¿˜æ˜¯ç»„åˆï¼Œç­‰ç­‰ã€‚è¿™äº›ä¸œè¥¿æ¥æºäºæµ‹è¯•é©±åŠ¨çš„è¿‡ç¨‹ã€‚ç›¸åï¼Œåº”è‡´åŠ›äºç±»åã€ä¾èµ–å…³ç³»ï¼Œæˆ–ä¸€äº›å…³é”®çš„å…¬å…±è¡Œä¸ºã€‚<br>TDD å…è®¸ä½ åŸºäºå½“å‰çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¿æŒä¸€ä¸ªå¯èƒ½çš„æœ€ç®€è®¾è®¡ã€‚å¦‚æœä¸€ç›´ä¿æŒè®¾è®¡å°½é‡ç®€æ´ï¼Œé‚£ä¹ˆå°±å¯ä»¥æœ€å¤§å¯èƒ½åœ°å¼•å…¥æ–°çš„ã€ä»æœªè¢«è€ƒè™‘è¿‡çš„åŠŸèƒ½ã€‚ç›¸åï¼Œå¦‚æœä»»ç”±ç³»ç»Ÿé€€åŒ–ï¼ˆå¹¶æœ‰å¤§é‡çš„é‡å¤ä»£ç å’Œæ™¦æ¶©éš¾æ‡‚çš„ä»£ç ï¼‰ï¼Œæœªæ¥æœ‰ä»»ä½•æ–°çš„éœ€æ±‚æ—¶ï¼Œä½ å°†ç—›è‹¦ä¸‡åˆ†ã€‚</p><h3 id="å“ªé‡Œæ‰ä¼šè®¨è®ºçœŸæ­£çš„è®¾è®¡å‘¢"><a href="#å“ªé‡Œæ‰ä¼šè®¨è®ºçœŸæ­£çš„è®¾è®¡å‘¢" class="headerlink" title="å“ªé‡Œæ‰ä¼šè®¨è®ºçœŸæ­£çš„è®¾è®¡å‘¢"></a>å“ªé‡Œæ‰ä¼šè®¨è®ºçœŸæ­£çš„è®¾è®¡å‘¢</h3><p>å½“å¤„äº TDD çš„é‡æ„é˜¶æ®µï¼Œä½ è¦å°½å¯èƒ½åœ°äº†è§£ä¸ä¼˜ç§€è®¾è®¡æ„æˆç›¸å…³çš„æ‰€æœ‰çŸ¥è¯†ã€‚åŒæ—¶ï¼Œä¹Ÿè¦å°½å¯èƒ½åœ°äº†è§£å›¢é˜Ÿçš„æƒ³æ³•ã€‚ä½ æ˜¯åœ¨ä¸€ä¸ªå…±äº«çš„ä»£ç åº“ä¸­å·¥ä½œï¼Œéœ€è¦ä¸å›¢é˜Ÿå°±å“ªäº›å¯æ¥å—ã€å“ªäº›ä¸è®¾è®¡æ— å…³ç­‰æ–¹é¢è¾¾æˆå…±è¯†ã€‚<br>å¤§å¤šæ•°æ—¶å€™ï¼Œç»å…¸è®¾è®¡ç†å¿µå’Œç®€å•è®¾è®¡åŸåˆ™ç›¸ä¸€è‡´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œè®¾è®¡æ¨¡å¼ä¸»è¦ä¸è§£å†³æ–¹æ¡ˆçš„è¡¨è¾¾åŠ›ç›¸å…³ã€‚åƒæ¨¡æ¿æ–¹æ³•è¿™æ ·çš„æ¨¡å¼ä¸»è¦ç”¨äºæ¶ˆé™¤é‡å¤ã€‚</p><h3 id="ç®€å•è®¾è®¡åŸåˆ™å’Œç»å…¸è®¾è®¡ç†å¿µå†²çª"><a href="#ç®€å•è®¾è®¡åŸåˆ™å’Œç»å…¸è®¾è®¡ç†å¿µå†²çª" class="headerlink" title="ç®€å•è®¾è®¡åŸåˆ™å’Œç»å…¸è®¾è®¡ç†å¿µå†²çª"></a>ç®€å•è®¾è®¡åŸåˆ™å’Œç»å…¸è®¾è®¡ç†å¿µå†²çª</h3><ol><li><p>è®¿é—®æ€§ï¼šä»ç„¶åº”å½“å°½é‡ä¿æŒæˆå‘˜ç§æœ‰åŒ–ã€‚è¿™ä¼šä½¿å¾—æœ‰äº›æ”¹åŠ¨å˜å¾—æ›´å®¹æ˜“äº›ã€‚è™½ç„¶ä¸å¤ªå¯èƒ½ï¼Œä½†æš´éœ²ä¸å¿…è¦çš„æˆå‘˜ä¼šä½¿å¾—ç³»ç»Ÿå—åˆ°æ¶æ„æˆ–ç³Šæ¶‚å®¢æˆ·çš„ç ´åã€‚</p><ul><li>ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦æ”¾æ¾è®¿é—®æ§åˆ¶æ¥è®©æµ‹è¯•éªŒè¯ä¸€äº›åŠŸèƒ½æ˜¯å¦å¯ä»¥å¦‚æœŸå·¥ä½œï¼Œé‚£å¤§å¤šæ•°æ—¶é—´å°±ä¸è¦ä¸ºæ­¤æ‹…å¿ƒäº†ã€‚å¦‚æœæ¯æ ·ä¸œè¥¿éƒ½è¢«æµ‹è¯•ï¼Œé‚£ä¹ˆæµ‹è¯•å°±ä¼šä¿æŠ¤ç³»ç»Ÿå…å—ç³Šæ¶‚å®¢æˆ·çš„ç ´åã€‚<strong>çŸ¥é“ç³»ç»Ÿå¯ä»¥å¦‚æœŸå·¥ä½œè¿œæ¯”å¯¹æœªæ¥æ»¥ç”¨çš„æäººå¿§å¤©æ›´è®©äººå‘å¾€ã€‚</strong></li><li>åœ¨æµ‹è¯•ä¸­ï¼Œç»å¯¹è¦é¿å…ä¸å¿…è¦çš„è®¾è®¡ï¼Œä¾‹å¦‚ï¼Œç”¨ç§æœ‰è¿˜æ˜¯å…¬æœ‰æ§åˆ¶ã€‚æ²¡æœ‰äººä¼šè°ƒç”¨ä½ çš„æµ‹è¯•ï¼Œæµ‹è¯•ä¸­çš„è®¿é—®æŒ‡ç¤ºç¬¦åªä¼šå½±å“å¯è¯»æ€§ã€‚</li></ul></li><li><p>åŠæ—¶æ€§ï¼šè€æ´¾çš„è®¾è®¡å¸Œæœ›ä½ èƒ½å°è¯•è·å¾—å°½å¯èƒ½å®Œç¾çš„è®¾è®¡ã€‚åœ¨ç®€å•è®¾è®¡ä¸­ï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚å®é™…ä¸Šï¼Œè¶Šæ˜¯ç»å°½è„‘æ±æƒ³å‡ºåº”å¯¹æœªæ¥æ¯ç§å¯èƒ½åŠŸèƒ½çš„è®¾è®¡ï¼Œå°±è¶Šä¼šä»˜å‡ºæ›´å¤šæ—¶é—´ï¼ŒåŒæ—¶ï¼Œå½“åŠŸèƒ½éœ€æ±‚çœŸçš„å‡ºç°æ—¶ï¼Œä½ ä¾ç„¶éœ€è¦åšå¤§é‡çš„ä¿®æ”¹ã€‚æœ€å¥½çš„æ–¹å¼æ˜¯ï¼Œå­¦ä¹ æ€æ ·é€šè¿‡ç®€å•ã€å¢é‡çš„è®¾è®¡æ¥æŒç»­åœ°åº”å¯¹å˜åŒ–ã€‚</p></li></ol><h2 id="é˜»ç¢é‡æ„çš„å› ç´ "><a href="#é˜»ç¢é‡æ„çš„å› ç´ " class="headerlink" title="é˜»ç¢é‡æ„çš„å› ç´ "></a>é˜»ç¢é‡æ„çš„å› ç´ </h2><ol><li>æµ‹è¯•ä¸è¶³ï¼šä½¿ç”¨ TDD çš„è¯ï¼Œæ„å»ºè¿›ç³»ç»Ÿçš„æ¯ä¸€å°å—é€»è¾‘éƒ½æœ‰å¯¹åº”çš„å¿«é€Ÿæµ‹è¯•ã€‚è¿™äº›æµ‹è¯•å¯ä»¥ç»™äºˆä½ å……è¶³çš„ä¿¡å¿ƒæ¥æ„å»ºæ›´å¥½çš„ä»£ç ã€‚ç›¸åï¼Œå¦‚æœä½ åªæœ‰å°‘é‡çš„å¿«é€Ÿå•å…ƒæµ‹è¯•ï¼Œéšä¹‹è€Œæ¥çš„æ˜¯æ›´ä½çš„æµ‹è¯•è¦†ç›–ç‡ï¼Œé‡æ„çš„çƒ­æƒ…å’Œé‡æ„çš„èƒ½åŠ›ä¼šå¤§å¤§ç¼©å‡ã€‚</li><li>ç”Ÿå­˜å‘¨æœŸé•¿çš„åˆ†æ”¯ï¼šï¼šå¦‚æœæ›¾ç»åˆå¹¶è¿‡åŒ…å«å¤§é‡æ”¹åŠ¨çš„å…¶ä»–åˆ†æ”¯ä¸­çš„ä»£ç ï¼Œé‚£ä¹ˆä½ åº”è¯¥çŸ¥é“å¤§é‡çš„é‡æ„ä¼šä½¿åˆå¹¶ä»£ç å¼‚å¸¸å›°éš¾ã€‚åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸Šå·¥ä½œçš„å¼€å‘è€…æˆ–è®¸ä¼šè¢«è¦æ±‚æœ€å°åŒ–æ”¹åŠ¨èŒƒå›´ã€‚è¿™æ ·åšå¯èƒ½ä¼šä½¿ä»£ç åˆå¹¶æ›´ç®€å•äº›ï¼Œä½†ä¹Ÿä¼šä½¿ä»£ç åº“ä»æ­¤æ·±å—ç…ç†¬ã€‚</li><li>ä¸å®ç°ç›¸å…³çš„æµ‹è¯•ï¼šåœ¨æµ‹è¯•é©±åŠ¨å¼€å‘ä¸­ï¼Œç±»çš„è¡Œä¸ºæ˜¯é€šè¿‡å…¶å…¬æœ‰æ¥å£æ¥å±•ç°çš„ã€‚æŒ‰å®šä¹‰æ¥è¯´ï¼Œé‡æ„æ˜¯åœ¨ä¸æ”¹å˜å…¶å¤–åœ¨å…¬æœ‰è¡Œä¸ºçš„å‰æä¸‹æ”¹å˜è®¾è®¡çš„ã€‚å¦‚æœæµ‹è¯•çŸ¥é“å†…éƒ¨ç§æœ‰å®ç°ç»†èŠ‚çš„è¯ï¼Œé‚£ä¹ˆåœ¨è¿™äº›ç§æœ‰ç»†èŠ‚æ”¹å˜æ—¶ï¼Œæµ‹è¯•å°±æœ‰å¤±è´¥çš„å¯èƒ½ã€‚å¤§é‡çš„æ¨¡æ‹Ÿæˆ–åä½œè€…å­˜æ ¹ä¼šå‘æµ‹è¯•æš´éœ²ä¸€äº›æœ¬è¯¥ç§æœ‰çš„ç»†èŠ‚ã€‚ä½¿ç”¨å¾—å½“çš„è¯ï¼Œä½¿ç”¨æµ‹è¯•æ›¿èº«ä¸ä¼šå¯¼è‡´é—®é¢˜ã€‚ä½†å¦‚æœéšæ„ä½¿ç”¨ï¼Œä½ å¯èƒ½ä¼šåœ¨é‡æ„æ—¶å‘ç°è®¸å¤šæµ‹è¯•å¤±è´¥ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šå¼€å‘è€…ä¸æ„¿æ„é‡æ„çš„å¥½å€Ÿå£ã€‚</li><li>å¤§é‡çš„æŠ€æœ¯å€ºåŠ¡ï¼šå¤§é‡æ™¦æ¶©éš¾æ‡‚çš„ä»£ç è¶³ä»¥è®©è®¸å¤šå¼€å‘è€…æ”¾å¼ƒé‡æ„ã€‚â€œæˆ‘è¯¥ä»å“ªä¸‹æ‰‹å‘¢ï¼Ÿâ€è¶Šæ˜¯ä»»ç”±ä»£ç é€€åŒ–ï¼Œè¶Šæ˜¯éš¾ä»¥å¯¹å®ƒåšå‡ºæ”¹å˜ã€‚</li><li>ç¼ºä¹çŸ¥è¯†ï¼šä»»ä½•ä½ ä¸çŸ¥é“çš„äº‹æƒ…éƒ½èƒ½å¤Ÿä¸”ç»ˆå°†ç»Šå€’ä½ ã€‚</li><li>ç€è¿·äºæå‰çš„æ€§èƒ½ä¼˜åŒ–ï¼šæœ¬ä¹¦ä¸­æ‰€æå€¡çš„è®¸å¤šè§‚ç‚¹éƒ½æ˜¯åŸºäºå°çš„ç±»å’Œå‡½æ•°ï¼Œå®ƒä»¬ä¼šå¸¦æ¥åˆ›å»ºé¢å¤–å¯¹è±¡ã€è°ƒç”¨é¢å¤–å‡½æ•°çš„å¼€é”€ã€‚ç¡®ä¿å…ˆåˆ›å»ºä¸€ä¸ªæ•´æ´ã€å¯ç»´æŠ¤çš„è®¾è®¡ã€‚å¾—åˆ°ä¸€ä¸ªé€‚åˆè®¾è®¡çš„æ€§èƒ½æ•°æ®æ¥åˆ¤æ–­å®ƒæ˜¯å¦æœ‰æ€§èƒ½ç¼ºé™·ã€‚ä»…å¯¹å¿…é¡»ä¼˜åŒ–çš„ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å¤§å¤šæ•°ä¼˜åŒ–ä¼šå¢åŠ ç†è§£å’Œç»´æŠ¤ä»£ç çš„éš¾åº¦ã€‚</li><li>ç»©æ•ˆè€ƒæ ¸ï¼šHAHAHAã€‚</li><li>ä¸€å‘³çš„è¿½æ±‚é€Ÿåº¦ï¼šï¼šâ€œå‘å¸ƒå§ï¼ä¸è¦èŠ±æ—¶é—´é‡æ„äº†ï¼â€ä½ å¯ä»¥è´£æ€ªå·¥ç¨‹ç»ç†ä¸ç†è§£ä¿æŒç³»ç»Ÿè®¾è®¡æ•´æ´çš„é‡è¦æ€§å—ï¼Ÿå½“ç„¶ï¼Œå¯èƒ½çœ‹ä¸Šå»ä½ çš„è¿›åº¦åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯å¿«äº†äº›ï¼Œä½†ä»»ç”±ç³»ç»Ÿè´¨é‡å˜å·®ç»ˆä¼šå°†ä½ æ¨å…¥æ·±æ¸Šã€‚</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><p>åœ¨ä½¿ç”¨ TDD æ—¶éœ€è¦è€ƒè™‘ä¸‰æ¡è§„åˆ™ï¼š</p><ol><li>ç¡®ä¿ä»£ç å…·å¤‡å¾ˆå¼ºçš„å¯è¯»æ€§å’Œè¡¨è¾¾åŠ›ã€‚</li><li>åœ¨å’Œç¬¬ä¸€æ¡è§„åˆ™ä¸å†²çªçš„æƒ…å†µä¸‹ï¼Œæ¶ˆé™¤æ‰€æœ‰çš„é‡å¤ã€‚</li><li>ä¸è¦å‘ç³»ç»Ÿå¼•å…¥ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚é¿å…çŒœæµ‹è¡Œçš„ç»“æ„å…³ç³»å’Œä¸èƒ½å¢åŠ ç³»ç»Ÿè¡¨è¾¾åŠ›çš„æŠ½è±¡ã€‚</li></ol></li><li><p>é‡å¤ä»£ç æˆ–è®¸ä½¿ç»´æŠ¤ä»£ç åº“æœ€å¤§çš„å¼€é”€ï¼Œå› æ­¤æ—¶åˆ»è°¨è®°å°†å¢é‡é‡æ„ä½œä¸º TDD ç¯èŠ‚çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥é¿å…ç³»ç»Ÿçº§çš„é€€åŒ–ï¼Œæ–‡ä¸­ä»¥è®¾è®¡ä¸€ä¸ªè‚¡ç¥¨äº¤æ˜“ç³»ç»Ÿä¸ºä¾‹ã€‚</p><ol><li>ä¸ä»…ä»…æ˜¯ç”Ÿäº§ä»£ç ï¼Œæµ‹è¯•ä»£ç ä¸­é¿å…é‡å¤åŒæ ·é‡è¦ã€‚</li><li>è·å–åœ¨ä»£ç å±‚é¢æ²¡æœ‰æ˜æ˜¾é‡å¤ï¼Œä½†æ˜¯åœ¨é€»è¾‘ä¸Šæ˜¯æœ‰å¤šä½™çš„ç‚¹ï¼Œä¾‹å¦‚ä¾‹å­ä¸­åˆ¤æ–­æ˜¯å¦æŒä»“ä¸ºç©ºä¸æŸ¥è¯¢è‚¡ç¥¨æ•°é‡çš„å…³ç³»ï¼Œé€šè¿‡å»é™¤ m_isEmpty å˜é‡ï¼Œè®© IsEmpty() æŸ¥è¯¢è‚¡ç¥¨çš„æ•°é‡ï¼Œæˆ‘ä»¬å¯ä»¥æ¶ˆé™¤è¿™ä¸€æ¦‚å¿µé‡å¤ã€‚<ul><li>ç®—æ³•çš„é‡å¤ï¼ˆè§£å†³åŒä¸€é—®é¢˜çš„ä¸åŒæ–¹æ³•æˆ–é—®é¢˜çš„ä¸åŒéƒ¨åˆ†ï¼‰ä¼šéšç³»ç»Ÿå¢é•¿æ¼”å˜ä¸ºé‡å¤§é—®é¢˜ã€‚é€šå¸¸æ¥è¯´ï¼Œéšç€å¯¹ä¸€ä¸ªå®ç°çš„æ”¹åŠ¨æœªèƒ½ç¼–å†™è¿›å…¶ä»–å®ç°ï¼Œé‡å¤ä»£ç ä¼šæ¼”åŒ–ä¸ºä¸ç»æ„çš„å˜ä½“ã€‚</li></ul></li><li>æŠ½ç¦»å‡ºå…¬ç”¨çš„ä»£ç ï¼Œé¿å…é‡å¤ã€‚</li><li>æå–çŸ­å°çš„æ–¹æ³•æœ‰è®¸å¤šå¥½å¤„ï¼ŒèŒè´£å•ä¸€ï¼ŒåŠŸèƒ½é€»è¾‘æ¸…æ™°ï¼Œè¡¨è¾¾åŠ›å¼ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯é¿å…é‡å¤çš„å¼ºåŠ›å·¥å…·ï¼Œåªæœ‰å°†è¿™äº›å­åŠŸèƒ½æå–å‡ºæ‰æœ‰å¤ç”¨çš„å¯èƒ½ã€‚</li></ol></li><li><p>ä½•æ—¶æ¢è®¨è®¾è®¡ï¼š</p><ul><li>é¢„å…ˆè®¾è®¡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·å§‹è·¯çº¿å›¾ã€‚å›´ç»•æ­¤è®¾è®¡çš„è®¨è®ºæœ‰åŠ©äºå‘ç°è½¯ä»¶ä¸­å¿…é¡»è¦åšçš„ä¸œè¥¿ï¼Œä»¥åŠæœ€åˆè¯¥æ€æ ·è®¾è®¡è½¯ä»¶ã€‚ä½†æ˜¯ï¼Œæ‰“é€ ç³»ç»Ÿæ‰€éœ€è¦çš„å¤§é‡ç»†èŠ‚ä¼šå‘ç”Ÿå˜åŒ–ã€‚</li><li>TDD å…è®¸ä½ åŸºäºå½“å‰çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¿æŒä¸€ä¸ªå¯èƒ½çš„æœ€ç®€è®¾è®¡ã€‚å¦‚æœä¸€ç›´ä¿æŒè®¾è®¡å°½é‡ç®€æ´ï¼Œé‚£ä¹ˆå°±å¯ä»¥æœ€å¤§å¯èƒ½åœ°å¼•å…¥æ–°çš„ã€ä»æœªè¢«è€ƒè™‘è¿‡çš„åŠŸèƒ½ã€‚ç›¸åï¼Œå¦‚æœä»»ç”±ç³»ç»Ÿé€€åŒ–ï¼ˆå¹¶æœ‰å¤§é‡çš„é‡å¤ä»£ç å’Œæ™¦æ¶©éš¾æ‡‚çš„ä»£ç ï¼‰ï¼Œæœªæ¥æœ‰ä»»ä½•æ–°çš„éœ€æ±‚æ—¶ï¼Œä½ å°†ç—›è‹¦ä¸‡åˆ†ã€‚</li></ul></li><li><p>ç®€å•è®¾è®¡åŸåˆ™ä¸ç»å…¸è®¾è®¡åŸåˆ™çš„å†²çªï¼š</p><ol><li>è®¿é—®æ€§ï¼šå¦‚ä½•æŠ‰æ‹©åº”ä¸åº”è¯¥ä¸ºæµ‹è¯•æ–¹ä¾¿ï¼Œæ”¾æ¾å¯¹äºæˆå‘˜ç§æœ‰åŒ–çš„æ ‡å‡†ã€‚</li><li>åŠæ—¶æ€§ï¼šè€æ´¾çš„è®¾è®¡å¸Œæœ›ä½ èƒ½å°è¯•è·å¾—å°½å¯èƒ½å®Œç¾çš„è®¾è®¡ã€‚åœ¨ç®€å•è®¾è®¡ä¸­ï¼Œæ›´åº”è¯¥è€ƒè™‘å¦‚ä½•é€šè¿‡ç®€å•ã€å¢é‡çš„è®¾è®¡åº”å¯¹æŒç»­çš„å˜åŒ–ã€‚</li></ol></li></ul>]]></content>
      
      
      <categories>
          
          <category> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ï¼ˆäº”ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--æµ‹è¯•æ›¿èº«</title>
      <link href="/2022/06/02/wu-ce-shi-qu-dong-kai-fa-ji-qiao-ce-shi-ti-shen/"/>
      <url>/2022/06/02/wu-ce-shi-qu-dong-kai-fa-ji-qiao-ce-shi-ti-shen/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ‹è¯•æ›¿èº«"><a href="#æµ‹è¯•æ›¿èº«" class="headerlink" title="æµ‹è¯•æ›¿èº«"></a>æµ‹è¯•æ›¿èº«</h1><p>åœ¨å‰é¢çš„ç« èŠ‚ä¸­äº†è§£äº† TDD çš„åŸºç¡€å†…å®¹ï¼Œä½†æ˜¯åœ¨çœŸå®çš„ç”Ÿäº§ç¯å¢ƒä¸­å¯¹è±¡å¿…é¡»ååŒå·¥ä½œï¼Œæœ‰æ—¶ä¾èµ–åˆä½œå¯¹è±¡ä½¿å¾— TDD å˜å¾—ä¸¾æ­¥ç»´è‰°ï¼Œæœ¬ç« å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨æµ‹è¯•æ›¿èº«æ¥è§£å†³ã€‚</p><ul><li>æµ‹è¯•æ›¿èº«è§£ç­”äº†ä¸€ä¸ªå›°æƒ‘æˆ‘å¥½ä¹…çš„é—®é¢˜ï¼Œå°±æ˜¯ä»£ç è€¦åˆçš„æƒ…å†µä¸‹æˆ‘è¯¥å¦‚ä½•æµ‹è¯•è¿™ä¸ªå‡½æ•°ä¼šæŒ‰ç…§è¦æ±‚è°ƒç”¨å…¶ä»–å…³è”ç»„ä»¶ã€‚æµ‹è¯•æ›¿èº«å³å¯ä»¥è®©ä½ ç¼–å†™ä»£ç æ¥æ„ŸçŸ¥åˆ°è°ƒç”¨ä»¥åŠè°ƒç”¨æ¬¡æ•°ï¼Œè¿˜ä¼šå€’é€¼ä½ å»å°è¯•æ³¨å…¥ä¾èµ–ç»„ä»¶ä»è€Œè¿›è¡Œè§£è—•ï¼Œç›¸ä¿¡çœ‹å®Œè¿™ä¸€ç« ä¼šæœ‰æ‰€æ„Ÿå—ã€‚</li><li>æœ¬ç« ä¼šæœ‰ä¸€äº›ä»£ç æ ‡æ³¨äº† git hash å€¼ï¼Œæ ‡è¯†æˆ‘æ˜¯é‚£æ¬¡ä¿®æ”¹å¯¹åº”çš„ä»£ç ï¼Œæ–¹ä¾¿å¯¹æ¯”ã€‚è¿™ä¸å¾—å¤¸ä¸‹å½“æ—¶æˆ‘å¯å¤ªæœ‰è€å¿ƒäº† ğŸ˜„ã€‚</li></ul><h2 id="ä¾èµ–é—®é¢˜"><a href="#ä¾èµ–é—®é¢˜" class="headerlink" title="ä¾èµ–é—®é¢˜"></a>ä¾èµ–é—®é¢˜</h2><ul><li>Storyï¼šä½ç½®æè¿°æœåŠ¡<ul><li>ä½œä¸ºä¸€ä¸ªåœ°å›¾åº”ç”¨å¼€å‘äººå‘˜ï¼Œæˆ‘éœ€è¦è¿™æ ·çš„æœåŠ¡ï¼Œå³å®ƒèƒ½åŸºäºç»™å®šçš„ä½ç½®ï¼ˆç»çº¬åº¦ï¼‰è¿”å›ä¸€è¡Œä¿¡æ¯æ¥æè¿°ç¦»å®ƒæœ€è¿‘çš„åœ°æ–¹ã€‚</li></ul></li></ul><p>æ„å»ºä½ç½®æè¿°æœåŠ¡ä¸­ä¸€ä¸ªé‡è¦çš„å·¥ä½œå°±æ˜¯å»è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨ APIï¼Œè¿™ä¸ª API èƒ½æ¥å—ä¸€ä¸ªä½ç½®ä¿¡æ¯ï¼Œå¹¶è¿”å›ä½ç½®æ•°æ®ã€‚ä¹¦ä¸­ä¸¾ä¾‹ REST æœåŠ¡ï¼Œç»™å®šä¸€ä¸ª GET URLï¼Œå®ƒä¼šä»¥ JSON æ ¼å¼è¿”å›ä½ç½®æ•°æ®ã€‚æµ‹è¯•é©±åŠ¨å¼€å‘ä½ç½®æè¿°æœåŠ¡ä¼šé‡åˆ°ä¸€ä¸ªéš¾é¢˜ã€‚è‡³å°‘å‡ºäºä»¥ä¸‹å‡ ç‚¹åŸå› ï¼Œå¯¹ REST è°ƒç”¨çš„ä¾èµ–ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚</p><ol><li>é€šè¿‡ä¸€ä¸ª HTTP æ¥è°ƒç”¨ REST æœåŠ¡éå¸¸ç¼“æ…¢ï¼Œè¿™ä¹Ÿå¯¼è‡´æµ‹è¯•çš„è¿è¡Œé€Ÿåº¦å˜æ…¢ã€‚</li><li>REST æœåŠ¡å¯èƒ½ä¸æ˜¯ä¸€ç›´å¤„äºå¯ç”¨çŠ¶æ€ã€‚</li><li>REST æœåŠ¡è¿”å›çš„ç»“æœå¾—ä¸åˆ°ä¿è¯ã€‚</li></ol><p>ä¸ºä»€ä¹ˆè¿™äº›ä¾èµ–ä¼šä½¿å¾—æµ‹è¯•å˜å¾—å›°éš¾å‘¢ï¼Ÿ</p><ol><li>ä¾èµ–ä¸€ä¸ªæ…¢é€Ÿçš„åä½œå¯¹è±¡ä¼šè®©æµ‹è¯•æ…¢å¾—éš¾ä»¥å¿å—ã€‚</li><li>ä¾èµ–ä¸€ä¸ªä¸ç¨³å®šçš„æœåŠ¡ï¼ˆè¦ä¹ˆä¸å¯ç”¨ï¼Œè¦ä¹ˆæ¯æ¬¡è¿”å›ä¸åŒçš„ç»“æœï¼‰ä¼šå¯¼è‡´æµ‹è¯•é—´æ–­æ€§åœ°å¤±è´¥ã€‚</li></ol><p>è€Œä¸”å¦‚æœå½“å‰æ²¡æœ‰å‘èµ· HTTP è°ƒç”¨çš„ä»£ç ï¼Œå¯èƒ½æ˜¯è¢«äººè¿˜æ²¡æœ‰è®¾è®¡å®ç°å®Œæˆï¼ŒåŒæ—¶ä½ ä¹Ÿæ²¡æœ‰æ—¶é—´è‡ªå·±å»å®ç°ä¸€ä¸ª HTTP ç±»æ€ä¹ˆåŠï¼Ÿå¦‚æœè‡ªå·±å°±æ˜¯è´Ÿè´£ HTTP ç±»å®ç°çš„äººæ€ä¹ˆåŠï¼Ÿæˆ–è®¸å¯ä»¥å…ˆäº†è§£ä¸‹ä½ç½®æè¿°æœåŠ¡æ•´ä½“è®¾è®¡ä¸ä½¿ç”¨æ–¹æ³•ååœ¨è€ƒè™‘ HTTP å·¥å…·ç±»çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p><h2 id="æµ‹è¯•æ›¿èº«åŸç†"><a href="#æµ‹è¯•æ›¿èº«åŸç†" class="headerlink" title="æµ‹è¯•æ›¿èº«åŸç†"></a>æµ‹è¯•æ›¿èº«åŸç†</h2><p>åœ¨ä¸Šè¿°æåˆ°çš„é—®é¢˜ï¼Œå¯ä»¥åˆ©ç”¨<code>æµ‹è¯•æ›¿èº«</code>æ¥é¿å…è¢«è¿™ç±»é—®é¢˜é˜»å¡ã€‚æµ‹è¯•æ›¿èº«èµ·åˆ°ä»£æ›¿çš„ä½œç”¨ï¼šå®ƒä»£æ›¿äº†å®é™…äº§å“ä»£ç ä¸­çš„ç±»ã€‚</p><p>å¦‚ä¸Šæ–‡ HTTP ç±»å¸¦æ¥äº†å›°éš¾ï¼Œå¯ä»¥ä¸ºå…¶åˆ›å»ºæµ‹è¯•æ›¿èº«ï¼å½“å®¢æˆ·æäº¤ä¸€ä¸ª GET è¯·æ±‚è‡³ HTTP å¯¹è±¡æ—¶ï¼Œæµ‹è¯•æ›¿èº«èƒ½å¤Ÿè¿”å›é¢„å…ˆå‡†å¤‡çš„å“åº”ã€‚æµ‹è¯•æ›¿èº«åº”è¯¥è¿”å›ä»€ä¹ˆæ˜¯ç”±æµ‹è¯•è‡ªå·±å†³å®šçš„ã€‚</p><ul><li>å‡è®¾éœ€è¦æ„å»ºä¸€ä¸ªæœåŠ¡ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç±»å¯ä»¥å¤ç”¨ï¼ˆå½“å‰è¿˜æœªå®ç°ï¼‰ï¼š<ul><li>CurlHttpï¼Œå®ƒä½¿ç”¨ cURL å‘èµ· HTTP è¯·æ±‚ã€‚è¿™ä¸ªç±»æ´¾ç”Ÿè‡ªçº¯è™šåŸºç±» Httpï¼Œè¿™ä¸ªåŸºç±»å®šä¹‰ä¸¤ä¸ªå‡½æ•°ï¼šget() å’Œ initialize()ã€‚å®¢æˆ·ç«¯ä»£ç åœ¨è°ƒç”¨ get() å‰å¿…é¡»å…ˆè°ƒç”¨ initialize()ã€‚</li><li>Addressï¼Œä¸€ä¸ªåŒ…å«å‡ ä¸ªå­—æ®µçš„ç»“æ„ã€‚</li><li>AddressExtractorï¼Œå®ƒå€ŸåŠ© JsonCpp åº“ä»ä¸€ä¸ª JSON å­—ç¬¦ä¸²ä¸­æå–åœ°å€ (æœ¬æ–‡å°† Catch2 å®ç°ç‰ˆæœ¬ä»ä¹¦ä¸­çš„ JsonCpp åˆ‡æ¢æˆ nlohmann/json.hpp)ï¼Œå¹¶å¡«å†™ Address ç»“æ„ã€‚</li></ul></li></ul><p>å¯èƒ½çš„ä»£ç æµç¨‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">CurlHttp http<span class="token punctuation">;</span>http<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> jsonResponse <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">createGetRequestUrl</span><span class="token punctuation">(</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>AddressExtractor extractor<span class="token punctuation">;</span><span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>jsonResponse<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">summaryDescription</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‰‹åŠ¨æ‰“é€ çš„æµ‹è¯•æ›¿èº«"><a href="#æ‰‹åŠ¨æ‰“é€ çš„æµ‹è¯•æ›¿èº«" class="headerlink" title="æ‰‹åŠ¨æ‰“é€ çš„æµ‹è¯•æ›¿èº«"></a>æ‰‹åŠ¨æ‰“é€ çš„æµ‹è¯•æ›¿èº«</h2><p><a href="https://github.com/HATTER-LONG/TDD_Learning">é…å¥—å·¥ç¨‹</a>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (92c0b746c3b862199597c6a9eb2da93abca8a5aa)ï¼›</p><p>å¦‚æœæƒ³è¦ä½¿ç”¨æ›¿èº«ï¼Œé¦–å…ˆå¿…é¡»ä½¿å…¶å–ä»£ CurlHttp ç±»çš„è¡Œä¸ºã€‚C++æä¾›äº†è®¸å¤šä¸åŒçš„æ–¹æ³•ï¼Œå…¶ä¸­å¤šæ€çš„ä½¿ç”¨é¢‘ç‡æœ€é«˜ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ CurlHttp ç±»æ‰€å®ç°çš„åŸºç±» <a href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/Include/Http.h">Http æ¥å£</a>ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Http</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨å¤šæ€åªéœ€è¦åœ¨æ´¾ç”Ÿç±»ä¸­è¦†å†™è™šå‡½æ•°ï¼Œå¹¶åœ¨è¿™ä¸ªè¦†å†™ä¸­æä¾›ç‰¹åˆ«çš„è¡Œä¸ºæ¥æ”¯æŒæµ‹è¯•ï¼Œç„¶åå°†åŸºç±»æŒ‡é’ˆä¼ é€’ç»™åœ°åæè¿°æœåŠ¡ã€‚ç°åœ¨æ¥è¿›è¡Œä¸€äº›<a href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/test/Gmock/PlaceDescriptionServiceTest/PlaceDescriptionServiceTest.cpp">æµ‹è¯•</a>ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionService</span> <span class="token operator">:</span> <span class="token keyword">public</span> Test<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLatitude<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLongitude<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    HttpStub httpStub<span class="token punctuation">;</span>    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> description <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>description<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Drury Ln, Fountain, CO, US"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæˆ‘ä»¬æ‰€éœ€çš„æ›¿èº« HttpStub è¿˜æ²¡æœ‰å®ç°ï¼Œåœ¨æµ‹è¯•ä»£ç æ–‡ä»¶ä¸­å…ˆå®šä¹‰ä¸€ä¸ªã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http<span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"???"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    HttpStub httpStub<span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿”å›é—®å·å­—ç¬¦ä¸²æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œå¯ä»¥å°è¯•ä¼šè¿”å›ä¸€ä¸ªæœç´¢æœåŠ¡çœŸå®çš„ Json å“åº”ï¼Œ<a href="https://nominatim.org/release-docs/develop/api/Search/#parameters">å†…å®¹å¯ä»¥å°è¯•å‘ Nominatim æäº¤ Get è¯·æ±‚è·å–</a>ï¼Œè¿™é‡Œä¿æŒä¹¦ä¸­çš„ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http<span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override    <span class="token punctuation">{</span>        <span class="token keyword">return</span> R<span class="token string">"({ "</span>address"<span class="token operator">:</span> <span class="token punctuation">{</span>         <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"Drury Ln"</span><span class="token punctuation">,</span>         <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Fountain"</span><span class="token punctuation">,</span>         <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">,</span>         <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"US"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥å°† HttpStub å®ä¾‹ä¼ é€’ç»™äº† PlaceDescriptionService çš„æ„é€ å‡½æ•°ã€‚å’ŒåŸå…ˆçš„é¢„æƒ³ç›¸æ¯”ï¼Œæˆ‘ä»¬æ­£åœ¨æ”¹å˜è®¾è®¡ã€‚<strong>æœåŠ¡å¯¹è±¡æœ¬èº«ä¸åˆ›å»ºç§æœ‰çš„ Http å®ä¾‹ï¼Œç›¸åï¼Œä½¿ç”¨è¯¥æœåŠ¡å¯¹è±¡çš„å®¢æˆ·ç«¯éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ª Http å®ä¾‹ï¼Œå¹¶æŠŠå®ƒä¼ ç»™æœåŠ¡å¯¹è±¡</strong>ã€‚<a href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/Src/PlaceDescriptionService/PlaceDescriptionService.cpp">æœåŠ¡å¯¹è±¡</a>é€šè¿‡ä¸€ä¸ªåŸºç±»æŒ‡é’ˆæŒæœ‰è¿™ä¸ª Http å®ä¾‹ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp">PlaceDescriptionService<span class="token operator">::</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span>Http<span class="token operator">*</span> IHttp<span class="token punctuation">)</span>        <span class="token operator">:</span> <span class="token function">MHttp</span><span class="token punctuation">(</span>IHttp<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åˆ©ç”¨å¤šæ€å®ç°äº†çµæ´»çš„æµ‹è¯•æ›¿èº«ï¼ŒåŠŸèƒ½ç±» <code>PlaceDescriptionService</code> ä¸æ¸…æ¥šå®ƒæŒæœ‰çš„ Http å®ä¾‹æ—¶ä¸€ä¸ªçœŸå®çš„è¿˜æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„å®ä¾‹ã€‚</p><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (05f37b1b63764fdd54fe4d9555b3b9d276136d6d)ï¼›</strong></p><p>ç»§ç»­å‘ä¸‹ summaryDescription æ¥å£è°ƒç”¨çš„å‚æ•°æ˜¯éœ€è¦ä¼ å…¥ä¸¤ä¸ªåæ ‡ï¼Œè¿™é‡Œä¸º ValidLatitudeã€ValidLongitude è¿›è¡Œåˆå§‹åŒ–ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionService</span> <span class="token operator">:</span> <span class="token keyword">public</span> Test<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLatitude<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLongitude<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">const</span> string APlaceDescriptionService<span class="token operator">::</span><span class="token function">ValidLatitude</span><span class="token punctuation">(</span><span class="token string">"38.005"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> string APlaceDescriptionService<span class="token operator">::</span><span class="token function">ValidLongitude</span><span class="token punctuation">(</span><span class="token string">"-104.44"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶ç¼–è¯‘æˆåŠŸå¯ä»¥è¿è¡Œä¸€ä¸‹å“ï¼Œä¸å‡ºæ„å¤–å¤±è´¥äº†è¿™æ—¶ç”±äºè¿˜æ²¡æœ‰å…·ä½“å®ç° summaryDescription æ¥å£çš„åŠŸèƒ½ã€‚</p><p>è‡³æ­¤ï¼Œå¯ä»¥ç¼–å†™ summaryDescription() äº†ã€‚ä½†æ˜¯é¦–å…ˆè¿˜éœ€è¦ä¸€ä¸ª AddressExtractorã€‚å®ƒèƒ½è§£æ JSON å“åº”ï¼Œå¹¶å¡«å†™ Address ç»“æ„ä½“ã€‚è¯¦ç»†çš„è¿‡ç¨‹ç•¥è¿‡ï¼Œå¯ä»¥æŸ¥é˜…<a href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/Src/PlaceDescriptionService/AddressExtractor.cpp">æºç </a>ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>AnAddressExtractor<span class="token punctuation">,</span> ReturnsPopulatedAddressForValidJsonResult<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">*</span> json <span class="token operator">=</span> R"<span class="token punctuation">(</span><span class="token punctuation">{</span>         <span class="token string">"place_id"</span><span class="token operator">:</span><span class="token string">"15331615"</span><span class="token punctuation">,</span>         <span class="token string">"address"</span><span class="token operator">:</span><span class="token punctuation">{</span>            <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"War Eagle Court"</span><span class="token punctuation">,</span>            <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Colorado Springs"</span><span class="token punctuation">,</span>            <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"Colorado"</span><span class="token punctuation">,</span>            <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"United States of America"</span><span class="token punctuation">,</span>         <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">;</span>    <span class="token keyword">auto</span> address <span class="token operator">=</span> Extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>Road<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"War Eagle Court"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>City<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Colorado Springs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>State<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Colorado"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>Country<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"United States of America"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€åæˆ‘ä»¬å®ç° summaryDescription()ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">*</span> getRequestUrl <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> jsonResponse <span class="token operator">=</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>getRequestUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>    AddressExtractor extractor<span class="token punctuation">;</span>    <span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>jsonResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> address<span class="token punctuation">.</span>Road <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>City <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>State <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>Country<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä¸‹è¾¹å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (432dedc2c1589fe7a8bfb3487879fec56997e6fa)ï¼›</strong></p><p>å½“æµ‹è¯•è°ƒç”¨ summaryDescription() æ—¶ï¼Œå¯¹ get() çš„è°ƒç”¨ä½œç”¨åˆ° HttpStub å®ä¾‹ä¸Šï¼Œè¿”å›æˆ‘ä»¬é¢„å…ˆç¡¬ç¼–ç çš„ Json å­—ç¬¦ä¸²ã€‚ä½†æ˜¯è¯·æ±‚çš„ URL åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œå½“æ­£åœ¨æ¥å—æµ‹è¯•çš„ä»£ç å’Œä¸€ä¸ªååŒå¯¹è±¡äº¤äº’æ—¶ï¼Œéœ€è¦ä¿è¯ç»™å®ƒä¼ é€’ä¸€ä¸ªæ­£ç¡®çš„å€¼ã€‚è¿”å›ç¡¬ç¼–ç å€¼çš„æµ‹è¯•æ›¿èº«å«ä½œå­˜æ ¹ï¼ˆstubï¼‰ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç§° get() ä¸ºå­˜æ ¹æ–¹æ³•ã€‚</p><p>å®é™…ä¸Šï¼Œå½“ä¼ ç»™ get() ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²æ—¶å°±å¯ä»¥è¿›è¡Œå¢é‡çš„å¼€å‘äº†ï¼Œæ¥ä¸‹æ¥ç¼–å†™èƒ½å¤Ÿæ­£ç¡®ç»™ getRequestUrl èµ‹å€¼çš„ä»£ç ã€‚<strong>åˆ©ç”¨ä¸‰è§’æ³•ï¼Œå¹¶ä¸ºç¬¬äºŒä¸ªä½ç½®æ·»åŠ ä¸€ä¸ªæ–­è¨€</strong>ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http<span class="token punctuation">{</span>    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override    <span class="token punctuation">{</span>        <span class="token function">verify</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> R<span class="token string">"({ "</span>address"<span class="token operator">:</span> <span class="token punctuation">{</span>         <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"Drury Ln"</span><span class="token punctuation">,</span>         <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Fountain"</span><span class="token punctuation">,</span>         <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">,</span>         <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"US"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">auto</span> <span class="token function">expectedArgs</span><span class="token punctuation">(</span><span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                          <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>Url<span class="token punctuation">,</span> <span class="token function">EndsWith</span><span class="token punctuation">(</span>expectedArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è°ƒç”¨ get() æ—¶ï¼Œå­˜æ ¹å®ç°å¯ä»¥ç¡®ä¿å‚æ•°ç¬¦åˆé¢„æœŸï¼Œæ¥ä¸‹æ¥ä¿®æ”¹ä»£ç é€šè¿‡æµ‹è¯•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> string<span class="token operator">&amp;</span> getRequestUrl <span class="token operator">=</span> <span class="token string">"lat="</span> <span class="token operator">+</span> Latitude <span class="token operator">+</span> <span class="token string">"&amp;lon="</span> <span class="token operator">+</span> Longitude<span class="token punctuation">;</span>    <span class="token keyword">auto</span> jsonResponse <span class="token operator">=</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>getRequestUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>    AddressExtractor extractor<span class="token punctuation">;</span>    <span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>jsonResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> address<span class="token punctuation">.</span>Road <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>City <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>State <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>Country<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºå½“å‰ URL æ²¡æœ‰æŒ‡å®šæœåŠ¡å™¨è·¯å¾„ï¼Œä¿®æ”¹ verify() å‡½æ•°ï¼Œè®©å®ƒä¼ ç»™ get() ä¸€ä¸ªå®Œæ•´çš„ URL:</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    string <span class="token function">urlStart</span><span class="token punctuation">(</span><span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> <span class="token function">expectedArgs</span><span class="token punctuation">(</span>urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                        <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>Url<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span>expectedArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ€ç»ˆå®ç° summaryDescription() æ–¹æ³•åï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">auto</span> request <span class="token operator">=</span> <span class="token function">createGetRequestUrl</span><span class="token punctuation">(</span>Latitude<span class="token punctuation">,</span> Longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> response <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">summaryDescription</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Response<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    AddressExtractor extractor<span class="token punctuation">;</span>    <span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>Response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> address<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>string PlaceDescriptionService<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> RequestUrl<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>RequestUrl<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>string PlaceDescriptionService<span class="token operator">::</span><span class="token function">createGetRequestUrl</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    string server <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    string document <span class="token punctuation">{</span> <span class="token string">"nominatim/v1/reverse"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> server <span class="token operator">+</span> document <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"format"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span> <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> Latitude<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>           <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"lon"</span><span class="token punctuation">,</span> Longitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>string PlaceDescriptionService<span class="token operator">::</span><span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Key<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Value<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> Key <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> Value<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç°åœ¨ä»£ç ä¸­è¿˜æ¬ ç¼ºçš„åœ°æ–¹ï¼š<ol><li>é‡å¤ä»£ç ï¼šæµ‹è¯•ä¸­çš„æ–‡æœ¬å’Œäº§å“ä»£ç ä¸­çš„æ–‡æœ¬å®Œå…¨ä¸€æ ·ã€‚ç¬¬ä¸ƒç« ä¼šè®²è§£å¦‚ä½•å»é™¤è¿™ç§é‡å¤ã€‚</li><li>PlaceDescriptionService ä¸­çš„ä¸€äº›ç»“æ„æ˜¯å¯ä»¥å¤ç”¨çš„ã€‚å¯ä»¥è€ƒè™‘å¦‚ä½•è®¾è®¡æ›´åŠ æ–¹ä¾¿æ”¯æŒç¬¬äºŒä¸ªæœåŠ¡ã€‚</li></ol></li></ul><h2 id="åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶æå‡æµ‹è¯•çš„æŠ½è±¡ç¨‹åº¦"><a href="#åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶æå‡æµ‹è¯•çš„æŠ½è±¡ç¨‹åº¦" class="headerlink" title="åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶æå‡æµ‹è¯•çš„æŠ½è±¡ç¨‹åº¦"></a>åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶æå‡æµ‹è¯•çš„æŠ½è±¡ç¨‹åº¦</h2><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (71f934b009b744e4fd3d66d1a8d21792ad88471a)ï¼›</strong></p><p>åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶ï¼Œç”±äºæµ‹è¯•ä¸­æ¨¡ç³Šçš„ä¿¡æ¯å¢åŠ äº†è®¸å¤šç†è§£çš„éš¾åº¦ï¼Œä¾‹å¦‚ ReturnsDescriptionForValidLocation æµ‹è¯•ä¸­éšè—äº†è®¸å¤šç›¸å…³ä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆæœ€ç»ˆæ–­è¨€çš„æ¯”å¯¹ç›®æ ‡æ˜¯ Drury Ln, Fountain, CO, US è¿™äº›éƒ½ä¼šç»™é˜…è¯»æµ‹è¯•çš„äººæŸ¥çœ‹ HttpStub ä¸­ä¸ä¹‹ç›¸å…³çš„å®ç°ç»†èŠ‚æ‰èƒ½ç†è§£ã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦é‡æ„æµ‹è¯•ï¼Œä½¿å®ƒå¯ä»¥è‡ªåŒ…å«ã€‚å¯ä»¥ä¿®æ”¹ HttpStub çš„å®ç°ï¼Œè®©æµ‹è¯•è´Ÿè´£è®¾å®š get() æ–¹æ³•çš„è¿”å›å€¼ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    string ReturnResponse<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override    <span class="token punctuation">{</span>        <span class="token function">verify</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ReturnResponse<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    HttpStub httpStub<span class="token punctuation">;</span>    httpStub<span class="token punctuation">.</span>ReturnResponse <span class="token operator">=</span> R<span class="token string">"({"</span>address"<span class="token operator">:</span> <span class="token punctuation">{</span>                                    <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"Drury Ln"</span><span class="token punctuation">,</span>                                    <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Fountain"</span><span class="token punctuation">,</span>                                    <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">,</span>                                    <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"US"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">;</span>    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> description <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>description<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Drury Ln, Fountain, CO, US"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·é˜…è¯»çš„äººå¯ä»¥å°†æ‘˜è¦æè¿°å’Œ HttpStub è¿”å›çš„ JSON å¯¹è±¡å¯¹åº”èµ·æ¥ï¼Œç±»ä¼¼çš„ï¼Œä¹Ÿå¯ä»¥å°† URL éªŒè¯ä»¥åˆ°æµ‹è¯•ä¸­ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    string ReturnResponse<span class="token punctuation">;</span>    string ExpectedURL<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override    <span class="token punctuation">{</span>        <span class="token function">verify</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ReturnResponse<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>Url<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span>ExpectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    HttpStub httpStub<span class="token punctuation">;</span>    httpStub<span class="token punctuation">.</span>ReturnResponse <span class="token operator">=</span> <span class="token comment" spellcheck="true">//....</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    httpStub<span class="token punctuation">.</span>ExpectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                           <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//.....</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨ï¼Œåœ¨æµ‹è¯•ä»£ç ä¸­å¯ä»¥æ¸…æ™°çš„è¡¨è¾¾å‡ºæ„å›¾ï¼ŒåŒæ—¶ HttpStub æ¶ˆå‡è‡³ä¸€ä¸ªå°ç±»ï¼Œè¿”å›éœ€è¦çš„å­˜æ ¹åŒæ—¶éªŒè¯æœŸæœ›çš„ä¿¡æ¯ã€‚ï¼Œä¸€ä¸ª HttpStub å¯¹è±¡éªŒè¯äº†è¿™æ ·çš„äº‹å®ï¼šä¼šæœ‰ä¸€ä¸ªæœŸæœ›çš„ URL ä¼ ç»™ HttpStubã€‚</p><h2 id="ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·"><a href="#ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·" class="headerlink" title="ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·"></a>ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·</h2><p>æœ¬ç»“å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Google Mock æ¥å®ç°å¯¹å¤šä¸ªç›¸ä¼¼çš„æ¨¡æ‹Ÿå¯¹è±¡è¾…åŠ©ç”Ÿæˆ Mock å¯¹è±¡çš„æ–¹æ³•ã€‚</p><h3 id="å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»"><a href="#å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»"></a>å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (74290eccd1b383da76082716ac070f7b06609a28)ï¼›</strong></p><p>ç°åœ¨å·²é‡æ–°å¼€å‘ summaryDescription() ä¸¾ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿ HTTP çš„æ–¹æ³•ï¼šget() å’Œ initialize()ã€‚</p><p>ä¸ºäº†ä½¿ç”¨ Google Mock è‡ªèº«çš„æ¨¡æ‹Ÿå¯¹è±¡ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ´¾ç”Ÿç±»ç”¨æ¥å£°æ˜æ‰€æ¨¡æ‹Ÿçš„æ–¹æ³•ã€‚Google Mock å…è®¸æˆ‘ä»¬ç®€æ´åœ°å®šä¹‰åä¸º HttpStub çš„æ´¾ç”Ÿç±»ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MOCK_METHOD0</span><span class="token punctuation">(</span>initialize<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä½¿ç”¨å®æ¥å£°æ˜æ¨¡æ‹Ÿçš„æ–¹æ³•</span>    <span class="token function">MOCK_CONST_METHOD1</span><span class="token punctuation">(</span>get<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 1 æ ‡è¯†ä¸€ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æˆå‘˜å‡½æ•°åç§°ï¼Œç¬¬äºŒä¸ªå®å‚æ•°ç»™å‡ºæ–¹æ³•å…¶ä»–ä¿¡æ¯(è¿”å›å€¼å’Œå‚æ•°å£°æ˜)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GoogleTest 1.10.x Release ç‰ˆæœ¬æ”¯æŒäº†ä¸€ä¸ªæ–°å®å®šä¹‰ï¼Œèˆå»äº†ç¹ççš„æ–¹æ³•ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MOCK_METHOD</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">,</span> initialize<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>override<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MOCK_METHOD</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> get<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> override<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>CmakeLists<span class="token punctuation">.</span>txt<span class="token comment" spellcheck="true">//å½“å‰ä½¿ç”¨çš„ googletest ç‰ˆæœ¬ä¸º 1.10.x MOCK_METHOD å®åœ¨ç¼–è¯‘å™¨ä¸‹ä¼šæœ‰é”™è¯¯ä¿¡æ¯ï¼Œä¾æ® gmock issues æ— ç”¨æŠ¥é”™ å…³é—­ç›¸å…³è­¦å‘Š</span><span class="token function">add_definitions</span><span class="token punctuation">(</span><span class="token operator">-</span>Wno<span class="token operator">-</span>gnu<span class="token operator">-</span>zero<span class="token operator">-</span>variadic<span class="token operator">-</span>macro<span class="token operator">-</span>arguments<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Google Mock æŠŠä¸€ä¸ª mock å£°æ˜è½¬ä¸ºæ´¾ç”Ÿç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ã€‚Google Mock è¿˜åœ¨å¹•åå®ç°äº†è¿™ä¸ªå‡½æ•°ã€‚</p><h3 id="è®¾ç«‹æœŸæœ›"><a href="#è®¾ç«‹æœŸæœ›" class="headerlink" title="è®¾ç«‹æœŸæœ›"></a>è®¾ç«‹æœŸæœ›</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (8e49b0b7091856f6308584b40d1d8bdc2114c621)ï¼›</strong></p><p>é¦–å…ˆå±è”½æ‰ summaryDescription() çš„å…·ä½“å®ç°é‡æ–°å¼€å‘ä¸€æ¬¡ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    HttpStub httpStub<span class="token punctuation">;</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ EXPECT_CALL å®è®¾ç«‹æœŸæœ›ï¼Œè¿™ä¸ªå®é…ç½® Google Mock å»éªŒè¯ç»™å®šçš„ expectedURL å‚æ•°å»è°ƒç”¨ httpStub å¯¹è±¡çš„ get() é€»è¾‘æ˜¯å¦å»åˆã€‚å…¶æ–­è¨€ç”Ÿæ•ˆåœ¨æ¨¡æ‹Ÿå¯¹è±¡è·³å‡ºä½œç”¨åŸŸåå¼€å§‹éªŒè¯ï¼Œæ–­è¨€æ­¥éª¤è¢«éšå¼çš„æ‰§è¡Œäº†ã€‚</p><p>å¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥å¼ºåˆ¶ Google Mock åœ¨æ¨¡æ‹Ÿå¯¹è±¡è·³å‡ºä½œç”¨åŸŸå‰åšéªŒè¯: <code>Mock::VerifyAndClearExpectations(&amp;httpStub);</code></p><p>é¦–å…ˆç©ºå®ç° summaryDescription()ï¼Œè®©æµ‹è¯•å¯ä»¥ç¼–è¯‘è¿è¡Œï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œåï¼Œæµ‹è¯•å‡ºç°å¤±è´¥ä¿¡æ¯ï¼Œç›´åˆ°æµ‹è¯•ç»“æŸä¸ºæ­¢ï¼ŒhttpStub å¯¹è±¡çš„ get() ä¹Ÿæ²¡æœ‰è¢«è°ƒç”¨ã€‚ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">[----------] 1 test from APlaceDescriptionService[ RUN      ] APlaceDescriptionService.ReturnsDescriptionForValidLocation/home/caolei/WorkSpace/TDD_Learning/test/Gmock/PlaceDescriptionServiceTestByGMock/PlaceDescriptionServiceTest.cpp:36: FailureActual function call count doesn't match EXPECT_CALL(httpStub, get(expectedURL))...         Expected: to be called once           Actual: never called - unsatisfied and active[  FAILED  ] APlaceDescriptionService.ReturnsDescriptionForValidLocation (0 ms)[----------] 1 test from APlaceDescriptionService (0 ms total)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ä»£ç ä½¿ä¹‹é€šè¿‡æµ‹è¯•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    string server <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    string document <span class="token punctuation">{</span> <span class="token string">"nominatim/v1/reverse"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// clang-format off</span>    string url <span class="token operator">=</span> server <span class="token operator">+</span> document <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span>                    <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"format"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                    <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> Latitude<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                    <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"lon"</span><span class="token punctuation">,</span> Longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// clang-format on</span>    <span class="token keyword">auto</span> response <span class="token operator">=</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    AddressExtractor extractor<span class="token punctuation">;</span>    <span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> address<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¾æ¨¡æ‹Ÿå’Œä¸¥æ¨¡æ‹Ÿ"><a href="#æ¾æ¨¡æ‹Ÿå’Œä¸¥æ¨¡æ‹Ÿ" class="headerlink" title="æ¾æ¨¡æ‹Ÿå’Œä¸¥æ¨¡æ‹Ÿ"></a>æ¾æ¨¡æ‹Ÿå’Œä¸¥æ¨¡æ‹Ÿ</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (46639a97cb73d0cd34071e70e1cc0bd05560fc94)ï¼›</strong></p><p>summaryDescription() çš„è§†çº¿ä¸­å¹¶æ²¡æœ‰éµé¡¼ CurlHttp æ¥å£è§„åˆ™ï¼Œå³åœ¨ä½¿ç”¨ get() å‰æ²¡æœ‰è¿›è¡Œ initialize åˆå§‹åŒ–ã€‚å¯ä»¥åœ¨æµ‹è¯•ä¸­æ–°å¢ä¸€ä¸ªæœŸæœ›æ¥ç¡®ä¿åˆå§‹åŒ–è¢«è°ƒç”¨ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    HttpStub httpStub<span class="token punctuation">;</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥ä¿æŒ summaryDescription() ä¸­ç­–ç•¥ä¸å˜ï¼Œå•ç‹¬æŠ½ç¦» get() æ¥å£æˆä¸ºå•ç‹¬çš„æ–¹æ³•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¨¡æ‹Ÿå¯¹è±¡ä¸­çš„é¡ºåº"><a href="#æ¨¡æ‹Ÿå¯¹è±¡ä¸­çš„é¡ºåº" class="headerlink" title="æ¨¡æ‹Ÿå¯¹è±¡ä¸­çš„é¡ºåº"></a>æ¨¡æ‹Ÿå¯¹è±¡ä¸­çš„é¡ºåº</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (e1a51df6b0e5af65d328017b1e9c9ebb1b46b0ea)ï¼›</strong></p><p>initialize() å’Œ get() çš„è°ƒç”¨æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ GMOCK ä¸ä¼šéªŒè¯æ»¡è¶³è°ƒç”¨æœŸæœ›çš„é¡ºåºï¼Œå¦‚æœæƒ³è¦éªŒè¯ï¼Œå¯ä»¥å®šä¹‰ InSequence å®ä¾‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    InSequence forceExpectationOrder<span class="token punctuation">;</span>    HttpStub httpStub<span class="token punctuation">;</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜å¯ä»¥æ›´åŠ ç²¾ç»†æ§åˆ¶ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥å‚è§ <a href="https://github.com/google/googletest/blob/master/docs/gmock_cheat_sheet.md">GoogleMock DOC</a>ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    HttpStub httpStub<span class="token punctuation">;</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    Expectation Expectations <span class="token operator">=</span> <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>Expectations<span class="token punctuation">)</span><span class="token punctuation">;</span>    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å·§å¦™çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§"><a href="#å·§å¦™çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§" class="headerlink" title="å·§å¦™çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§"></a>å·§å¦™çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (8478946c5e86720daeec8eba54ef1dd5438899a1)ï¼›</strong></p><p>EXPECT_CALL å®æ”¯æŒè®¸å¤šä¿®é¥°ç¬¦ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼ˆ?å’Œ<em>ä»£è¡¨æ¯ä¸ªä¿®é¥°ç¬¦çš„åŸºæ•°ï¼š?è¡¨ç¤ºå¯ä»¥é€‰ç”¨ä¿®é¥°ç¬¦ä¸€æ¬¡ï¼›</em>è¡¨ç¤ºå¯ä»¥å¤šæ¬¡ä½¿ç”¨ä¿®é¥°ç¬¦ã€‚ï¼‰ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>mock<span class="token operator">-</span>object<span class="token punctuation">,</span> <span class="token function">method</span> <span class="token punctuation">(</span>matchers<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>     <span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span>multi<span class="token operator">-</span>argument<span class="token operator">-</span>matcher<span class="token punctuation">)</span>  <span class="token operator">?</span>     <span class="token punctuation">.</span><span class="token function">Times</span><span class="token punctuation">(</span>cardinality<span class="token punctuation">)</span>            <span class="token operator">?</span>     <span class="token punctuation">.</span><span class="token function">InSequence</span><span class="token punctuation">(</span>sequences<span class="token punctuation">)</span>         <span class="token operator">*</span>     <span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>expectations<span class="token punctuation">)</span>           <span class="token operator">*</span>     <span class="token punctuation">.</span><span class="token function">WillOnce</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>              <span class="token operator">*</span>     <span class="token punctuation">.</span><span class="token function">WillRepeatedly</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>        <span class="token operator">?</span>     <span class="token punctuation">.</span><span class="token function">RetiresOnSaturation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">?</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GMOCK å·¥å…·å¯ä»¥æ”¯æŒå‡ ä¹æ‰€æœ‰çš„æ¨¡æ‹Ÿæ–¹å¼ï¼Œå¦‚ä¸‹ä¾‹æ¨¡æ‹Ÿè¾“å…¥å‚æ•°çš„å‡½æ•°å¹¶æŒ‡å®šä¸€ä¸ªè¿”å›å€¼ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">DifficultCollaborator</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> Result<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">TEST</span><span class="token punctuation">(</span>ATarget<span class="token punctuation">,</span> ReturnsAnAmountWhenCalculatePasses<span class="token punctuation">)</span><span class="token punctuation">{</span>    DifficultCollaboratorMock difficult<span class="token punctuation">;</span>    Target calc<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//SetArgPointee&lt;0>(3) è¡¨ç¤º ç¬¬ 0 ä¸ªå‚æ•°å€¼ä¸º 3ã€‚</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>difficult<span class="token punctuation">,</span> <span class="token function">calculate</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WillOnce</span><span class="token punctuation">(</span><span class="token function">DoAll</span><span class="token punctuation">(</span>SetArgPointee<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> result <span class="token operator">=</span> calc<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>difficult<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>GMOCK è¿˜æä¾›äº†è®¸å¤šåŠŸèƒ½æ”¯æŒï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µåªéœ€è¦åŸºæœ¬çš„æœºåˆ¶å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœåœ¨ TDD è¿‡ç¨‹ä¸­ç»å¸¸é‡åˆ°è¦ç”¨æ€ªå¼‚çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§ï¼Œè¯·æ£€æŸ¥ä¸‹è®¾è®¡æ˜¯å¦åšäº†è¿‡å¤šçš„äº‹æƒ…ã€‚</p><p>å½“ä½ å°è¯•ç€ä¸ºéæµ‹è¯•é©±åŠ¨çš„ã€ç»“æ„ä¸è‰¯çš„ç³»ç»Ÿç¼–å†™æµ‹è¯•å¹¶é‡åˆ°é—®é¢˜æ—¶ï¼Œæˆ–è®¸éœ€è¦ä½¿ç”¨æ¨¡æ‹Ÿå·¥å…·æä¾›çš„æ›´åŠ å¼ºå¤§çš„ç‰¹æ€§ã€‚æˆ‘ä»¬ä¼šåœ¨ç¬¬ 8 ç« ä¸­è®¨è®ºè¿™ç±»é—®é¢˜ã€‚</p><h3 id="æ’é™¤æ¨¡æ‹Ÿå¤±è´¥"><a href="#æ’é™¤æ¨¡æ‹Ÿå¤±è´¥" class="headerlink" title="æ’é™¤æ¨¡æ‹Ÿå¤±è´¥"></a>æ’é™¤æ¨¡æ‹Ÿå¤±è´¥</h3><ol><li>äº§å“ä»£ç ä¸­æ˜¯å¦æœ‰åˆç†è°ƒç”¨ï¼Ÿ</li><li>æ˜¯å¦æ­£ç¡®å®šä¹‰äº†æ¨¡æ‹Ÿæ–¹æ³•ï¼Ÿ</li><li>æœ‰æ²¡æœ‰å°†è¦æ¨¡æ‹Ÿçš„æˆå‘˜å‡½æ•°å£°æ˜ä¸ºè™šå‡½æ•°ï¼Ÿ</li><li>MOCK_METHOD() å£°æ˜æ­£ä¸æ­£ç¡®ï¼Ÿ</li><li>æ’é™¤å‚æ•°åŒ¹é…çš„æ‹…å¿§ï¼Œä¸ºæ‰€æœ‰å‚æ•°å’Œè¿”å›å€¼ä½¿ç”¨é€šé…ç¬¦ testing::_ ï¼Œå¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæœ‰ä¸€ä¸ªå‚æ•°ä¸èƒ½è¢«æ­£ç¡®åŒ¹é…ã€‚</li></ol><h3 id="ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªæµ‹è¯•"><a href="#ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªæµ‹è¯•" class="headerlink" title="ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªæµ‹è¯•"></a>ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªæµ‹è¯•</h3><p>å½“ä½¿ç”¨æ‰‹å·¥åˆ›å»ºçš„æ¨¡æ‹Ÿå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬æœ€ç»ˆåªç”¨äº†ä¸€ä¸ªæµ‹è¯•æ¥éªŒè¯æœ€ç»ˆçš„ç›®æ ‡ï¼Œå³ä¸ºä¸€ä¸ªä½ç½®ç”Ÿæˆæ¦‚è¦ä¿¡æ¯æè¿°ã€‚ä½†æ˜¯ï¼Œåœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å´ç”¨äº†ä¸¤ä¸ªæµ‹è¯•ã€‚</p><p>æ‹¥æœ‰ä¸¤ä¸ªæµ‹è¯•è¿˜ä¼šæä¾›é¢å¤–çš„å¥½å¤„ã€‚ç¬¬ä¸€ï¼Œä¸€ä¸ªæ¨¡æ‹ŸéªŒè¯æ˜¯ä¸€ä¸ªæ–­è¨€ã€‚æˆ‘ä»¬å·²ç»ç”¨ä¸€ä¸ªæ–­è¨€æ¥éªŒè¯æ¦‚è¦ä¿¡æ¯å­—ç¬¦ä¸²äº†ã€‚å°†æµ‹è¯•åˆ†ä¸ºä¸¤ä¸ªï¼Œä¸ä¸€ä¸ªæ–­è¨€ä¸€ä¸ªæµ‹è¯•ä¿æŒä¸€è‡´ï¼ˆå‚è€ƒ 7.3 èŠ‚ï¼‰ã€‚ç¬¬äºŒï¼Œç‹¬ç«‹çš„æµ‹è¯•æ›´å…·å¯è¯»æ€§ã€‚ç”±äºåœ¨ Google Mock ä¸­è®¾ç«‹æœŸæœ›ä¼šå¯¼è‡´å¾ˆéš¾ç•Œå®šè®¾ç½®æ–­è¨€çš„ä½ç½®ï¼ˆè¿™ä¹Ÿå’Œ 4.2.4 èŠ‚ä¸€è‡´ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬ä¸ºç®€åŒ–åŸºäºæ¨¡æ‹Ÿçš„æµ‹è¯•çš„åŠªåŠ›æ˜¯å€¼å¾—çš„ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    HttpStub httpStub<span class="token punctuation">;</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    Expectation Expectations <span class="token operator">=</span> <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//  get(expectedURL) è¿™ä¸€æ­¥åŒæ—¶éªŒè¯äº†åº”è¯¥ä¼ ç»™ get çš„å‚æ•°ä¸ expectedURL ä¸€è‡´</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>Expectations<span class="token punctuation">)</span><span class="token punctuation">;</span>    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> FormatsRetrievedAddressIntoSummaryDescription<span class="token punctuation">)</span><span class="token punctuation">{</span>    NiceMock<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> httpStub<span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">WillOnce</span><span class="token punctuation">(</span><span class="token function">Return</span><span class="token punctuation">(</span>            R<span class="token string">"({ "</span>address"<span class="token operator">:</span> <span class="token punctuation">{</span>              <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"Drury Ln"</span><span class="token punctuation">,</span>              <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Fountain"</span><span class="token punctuation">,</span>              <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">,</span>              <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"US"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    PlaceDescriptionService <span class="token function">service</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>httpStub<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> description <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>description<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Drury Ln, Fountain, CO, US"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è®©æµ‹è¯•æ›¿èº«å„å°±å„ä½"><a href="#è®©æµ‹è¯•æ›¿èº«å„å°±å„ä½" class="headerlink" title="è®©æµ‹è¯•æ›¿èº«å„å°±å„ä½"></a>è®©æµ‹è¯•æ›¿èº«å„å°±å„ä½</h2><p>åœ¨å¼•å…¥ä¸€ä¸ªæµ‹è¯•æ›¿èº«æ—¶éœ€è¦åšä¸¤ä»¶äº‹ã€‚ç¬¬ä¸€ï¼Œç¼–å†™æµ‹è¯•æ›¿èº«ã€‚ç¬¬äºŒï¼Œåœ¨ç›®æ ‡æµ‹è¯•ä¸­ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ ·çš„åšæ³•åˆç§°ä½œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰ã€‚</p><p>ä»¥å‰æ–‡çš„ PlaceDescriptionService ä¸ºä¾‹ï¼Œå®ƒæ˜¯é€šè¿‡æ„é€ å‡½æ•°å°†æµ‹è¯•æ›¿èº«æ³¨å…¥å…¶ä¸­ï¼Œæœ‰äº›æƒ…å†µå¯èƒ½ä½¿ç”¨ setter æˆå‘˜å‡½æ•°æ¥æ³¨å…¥æµ‹è¯•æ›¿èº«æ›´åˆé€‚ï¼Œè¿™ç§æ–¹æ³•åˆç§°ä½œæ„é€ æ³¨å…¥æˆ– setter æ³¨å…¥ã€‚</p><h3 id="è¦†å†™å·¥å‚æ–¹æ³•å’Œè¦†å†™-Getter"><a href="#è¦†å†™å·¥å‚æ–¹æ³•å’Œè¦†å†™-Getter" class="headerlink" title="è¦†å†™å·¥å‚æ–¹æ³•å’Œè¦†å†™ Getter"></a>è¦†å†™å·¥å‚æ–¹æ³•å’Œè¦†å†™ Getter</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (fe19774356b4cb14d14e4041029c535b3619ebf3)ï¼›</strong></p><p>æƒ³è¦ä½¿ç”¨è¦†å†™å·¥å‚æ–¹æ³•ï¼Œé¦–å…ˆè¦ä¿®æ”¹äº§å“ä»£ç ä½¿ç”¨å·¥å‚æ¨¡å¼è·å–å†™ä½œç±»çš„å®ä¾‹ï¼š</p><p>é¦–å…ˆä¿®æ”¹ PlaceDescriptionService ä¸­çš„æˆå‘˜ Http* MHttpï¼Œä¸åœ¨ä»¥æˆå‘˜æ–¹å¼ä¿å­˜è€Œæ˜¯ httpService() è·å–ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//PlaceDescriptionService.h</span><span class="token keyword">class</span> <span class="token class-name">PlaceDescriptionService</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    std<span class="token operator">::</span>string <span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">protected</span><span class="token operator">:</span>    <span class="token keyword">virtual</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> <span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//PlaceDescriptionService.cpp</span>string PlaceDescriptionService<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">auto</span> http <span class="token operator">=</span> <span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    http<span class="token operator">-</span><span class="token operator">></span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> http<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> PlaceDescriptionService<span class="token operator">::</span><span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> make_shared<span class="token operator">&lt;</span>CurlHttp<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ httpService è·å–å¯ä»¥çœ‹ä½œä½¿é€šè¿‡å·¥å‚æ¨¡å¼è·å–åˆ°åŠŸèƒ½ç±»ï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿ PlaceDescriptionService æ¥è¦†å†™ httpService ä¼ å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ Http åŠŸèƒ½ç±»ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">PlaceDescriptionServiceStubHttpService</span> <span class="token operator">:</span> <span class="token keyword">public</span> PlaceDescriptionService<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">// è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ„é€ ç”¨äºä¼ å…¥è‡ªå®šä¹‰çš„ Http åŠŸèƒ½ç±»</span>    <span class="token function">PlaceDescriptionServiceStubHttpService</span><span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> ParmHttpStub<span class="token punctuation">)</span>            <span class="token operator">:</span> HttpStub <span class="token punctuation">{</span> ParmHttpStub <span class="token punctuation">}</span>    <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> <span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{</span> <span class="token keyword">return</span> HttpStub<span class="token punctuation">;</span> <span class="token punctuation">}</span>    shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> HttpStub<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…·ä½“æµ‹è¯•ä»£ç äºä¹‹é—´å·®ä¸å¤šï¼Œå”¯ä¸€çš„å·®å¼‚å°±æ˜¯ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆè¿›è¡Œäº†å°è£…ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>    shared_ptr<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> httpStub <span class="token punctuation">{</span> <span class="token keyword">new</span> HttpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    Expectation Expectations <span class="token operator">=</span> <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span><span class="token operator">*</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//  get(expectedURL) è¿™ä¸€æ­¥åŒæ—¶éªŒè¯äº†åº”è¯¥ä¼ ç»™ get çš„å‚æ•°ä¸ expectedURL ä¸€è‡´</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span><span class="token operator">*</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>Expectations<span class="token punctuation">)</span><span class="token punctuation">;</span>    PlaceDescriptionServiceStubHttpService service <span class="token punctuation">{</span> httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¦†å†™å·¥å‚æ–¹æ³•å±•ç¤ºäº†ä½¿ç”¨æµ‹è¯•æ›¿èº«æ‰€å¸¦æ¥çš„æµ‹è¯•è¦†ç›–ç‡æ¼æ´ã€‚ç”±äºæˆ‘ä»¬çš„æµ‹è¯•è¦†å†™äº†äº§å“ä»£ç ä¸­ httpService() çš„å®ç°ï¼Œå› æ­¤æµ‹è¯•å¹¶æ²¡æœ‰ä½¿ç”¨å®é™…äº§å“ä»£ç ä¸­çš„è¿™ä¸ªå‡½æ•°ã€‚æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œè¦ç¡®ä¿åœ¨é›†æˆæµ‹è¯•ä¸­ä½¿ç”¨å®é™…çš„æœåŠ¡ï¼åŒæ—¶ï¼Œä¸è¦åœ¨å·¥å‚æ–¹æ³•ä¸­åŠ å…¥å®é™…é€»è¾‘çš„ä»£ç ï¼Œå¦åˆ™ï¼Œæœªç»æµ‹è¯•çš„ä»£ç å°±ä¼šè¶Šæ¥è¶Šå¤šã€‚å·¥å‚æ–¹æ³•åº”å½“åªè¿”å›åä½œç±»å‹çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><p>å…³äº Getter å…¶å®ä¸è¦†ç›–å·¥å‚å·®ä¸å¤šï¼ŒåŒºåˆ«å¦‚ä¸‹:</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">PlaceDescriptionService</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    std<span class="token operator">::</span>string <span class="token function">summaryDescription</span><span class="token punctuation">(</span>    <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">// ...</span>    std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> http_<span class="token punctuation">;</span><span class="token keyword">protected</span><span class="token operator">:</span>    <span class="token keyword">virtual</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> <span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>PlaceDescriptionService<span class="token operator">::</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token operator">:</span> http_<span class="token punctuation">{</span>make_shared<span class="token operator">&lt;</span>CurlHttp<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ...</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> PlaceDescriptionService<span class="token operator">::</span><span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> http_<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨å·¥å‚"><a href="#ä½¿ç”¨å·¥å‚" class="headerlink" title="ä½¿ç”¨å·¥å‚"></a>ä½¿ç”¨å·¥å‚</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (398ef02bf56e9484335f5f1aed0f07caf01424b1)ï¼›</strong></p><p>å·¥å‚ç±»æ˜¯ç”¨æ¥è´Ÿè´£åˆ›å»ºå’Œè¿”å›å®ä¾‹çš„ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ª HttpFactoryï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æµ‹è¯•ä¸­å‘Šè¯‰å®ƒè¿”å›ä¸€ä¸ª HttpStub å®ä¾‹è€Œé Http å®ä¾‹ã€‚æ³¨æ„ä¸è¦ä»…ä»…ä¸ºäº†æ”¯æŒæµ‹è¯•è€Œå¼•å…¥å·¥å‚æ¨¡å¼ã€‚</p><p>ä¸‹ä¾‹ä½¿å·¥å‚å®ç°ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"CurlHttp.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"HttpFactory.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;memory></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>HttpFactory<span class="token operator">::</span><span class="token function">HttpFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> HttpFactory<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> Instance<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> HttpFactory<span class="token operator">::</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    Instance <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>CurlHttp<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> HttpFactory<span class="token operator">::</span><span class="token function">setInstance</span><span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> NewInstance<span class="token punctuation">)</span><span class="token punctuation">{</span>    Instance <span class="token operator">=</span> NewInstance<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹æµ‹è¯•ä»£ç ï¼Œåœ¨æµ‹è¯•æ‰§è¡Œå‰ï¼Œè°ƒç”¨ setInstance å°†å·¥å‚ä¸­äº§å“æ›¿æ¢æ‰ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionService</span> <span class="token operator">:</span> <span class="token keyword">public</span> Test<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLatitude<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLongitude<span class="token punctuation">;</span>    shared_ptr<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> httpStub<span class="token punctuation">;</span>    shared_ptr<span class="token operator">&lt;</span>HttpFactory<span class="token operator">></span> factory<span class="token punctuation">;</span>    shared_ptr<span class="token operator">&lt;</span>PlaceDescriptionService<span class="token operator">></span> service<span class="token punctuation">;</span>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override    <span class="token punctuation">{</span>        factory <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>HttpFactory<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        service <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>PlaceDescriptionService<span class="token operator">></span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">TearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override    <span class="token punctuation">{</span>        factory<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        httpStub<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionServiceWithHttpMock</span> <span class="token operator">:</span> <span class="token keyword">public</span> APlaceDescriptionService<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override    <span class="token punctuation">{</span>        APlaceDescriptionService<span class="token operator">::</span><span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        httpStub <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token operator">-</span><span class="token operator">></span><span class="token function">setInstance</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionServiceWithHttpMock<span class="token punctuation">,</span> MakesHttpRequestToObtainAddress<span class="token punctuation">)</span><span class="token punctuation">{</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span><span class="token operator">*</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span><span class="token operator">*</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    service<span class="token operator">-</span><span class="token operator">></span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ summaryDescription() ä»£ç ï¼Œé€šè¿‡å·¥å‚è·å– Http å®ä¾‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//æ„é€ ä¼ å…¥å·¥å‚å®ä¾‹</span>PlaceDescriptionService<span class="token operator">::</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>HttpFactory<span class="token operator">></span> HttpFactory<span class="token punctuation">)</span>        <span class="token operator">:</span> httpFactory_ <span class="token punctuation">{</span> HttpFactory <span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//å†²è·å–æ¥å£æ”¹ä¸ºä»å·¥å‚è·å¾—å®ä¾‹</span>string PlaceDescriptionService<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// auto http = httpService();</span>    <span class="token keyword">auto</span> http <span class="token operator">=</span> httpFactory_<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    http<span class="token operator">-</span><span class="token operator">></span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> http<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€šè¿‡æ¨¡æ¿å‚æ•°"><a href="#é€šè¿‡æ¨¡æ¿å‚æ•°" class="headerlink" title="é€šè¿‡æ¨¡æ¿å‚æ•°"></a>é€šè¿‡æ¨¡æ¿å‚æ•°</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (35932b820ad5de4a9bb584f1eeed6d4f6bfa86f4)ï¼›</strong></p><p>å¯ä»¥é€šè¿‡æ¨¡æ¿å‚æ•°è¿›è¡Œæ³¨å…¥ï¼Œå®ƒä¸éœ€è¦å®¢æˆ·ç¨‹åºä¼ é€’ä¸€ä¸ªåä½œç±»çš„å®ä¾‹ã€‚æŠŠ PlaceDescriptionService å£°æ˜ä¸ºä¸€ä¸ªæ¨¡æ¿ï¼Œå®ƒæœ‰ä¸€ä¸ªç±»å‹åç§°ï¼Œå³ HTTPã€‚åœ¨è¿™ä¸ªæ¨¡æ¿ä¸­åŠ å…¥ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œhttp_ï¼Œå…¶ç±»å‹ä¸º HTTPã€‚å› ä¸ºæˆ‘ä»¬æƒ³è®©å®¢æˆ·ä½¿ç”¨ç±»å PlaceDescriptionServiceï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ¨¡æ¿ç±»æ”¹åä¸º PlaceDescriptionServiceTemplateã€‚åœ¨å®šä¹‰æ¨¡æ¿ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ typedef æ¥å®šä¹‰ PlaceDescriptionServiceï¼Œå®ƒå°†äº§å“ç±» Http ä½œä¸º PlaceDescriptionServiceTemplate çš„æ¨¡æ¿å‚æ•°ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> HTTP<span class="token operator">></span><span class="token keyword">class</span> <span class="token class-name">PlaceDescriptionServiceTemplate</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">// ...</span>    <span class="token comment" spellcheck="true">// æµ‹è¯•ä¸­çš„mockéœ€è¦å¼•ç”¨</span>    HTTP<span class="token operator">&amp;</span> <span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> http_<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">// ...</span>    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>        http_<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> http_<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// ...</span>    HTTP http_<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Http</span><span class="token punctuation">;</span><span class="token keyword">typedef</span> PlaceDescriptionServiceTemplate<span class="token operator">&lt;</span>Http<span class="token operator">></span> PlaceDescriptionService<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æµ‹è¯•æ—¶ä¹Ÿæ˜¯é€šè¿‡å£°æ˜ä¸€ä¸ªæœåŠ¡æ¨¡æ‹Ÿç±»ï¼Œå³ HttpStubï¼Œä¸ºæ¨¡æ¿ PlaceDescriptionServiceTemplate çš„å‚æ•°ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionService</span> <span class="token operator">:</span> <span class="token keyword">public</span> Test<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLatitude<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLongitude<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionServiceWithHttpMock</span> <span class="token operator">:</span> <span class="token keyword">public</span> APlaceDescriptionService<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    PlaceDescriptionServiceTemplate<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> service<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionServiceWithHttpMock<span class="token punctuation">,</span> MakesHttpRequestToObtainAddress<span class="token punctuation">)</span><span class="token punctuation">{</span>    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨å…¥å·¥å…·"><a href="#æ³¨å…¥å·¥å…·" class="headerlink" title="æ³¨å…¥å·¥å…·"></a>æ³¨å…¥å·¥å…·</h3><p>ç”¨äºæ³¨å…¥åä½œå¯¹è±¡ä½œä¸ºä¾èµ–å¯¹è±¡çš„å·¥å…·åˆç§°ä¸ºä¾èµ–æ³¨å…¥å·¥å…·ã€‚é¦–å…ˆï¼Œä½ éœ€è¦æŒæ¡è¿™é‡Œæè¿°çš„æ‰‹å·¥æ³¨å…¥æŠ€å·§ã€‚å…¶æ¬¡ï¼Œå†å»è°ƒç ”ä¸€ä¸‹æ³¨å…¥å·¥å…·ï¼Œæ¥æ£€æŸ¥å®ƒä»¬èƒ½å¦å¸¦æ¥ä¸€äº›æ”¹å–„ã€‚ä¾èµ–æ³¨å…¥å·¥å…·é€šå¸¸åœ¨å®Œå…¨æ”¯æŒåå°„æœºåˆ¶çš„è¯­è¨€ä¸­æ›´åŠ æœ‰æ•ˆã€‚</p><h2 id="è®¾è®¡ä¼šå˜åŒ–"><a href="#è®¾è®¡ä¼šå˜åŒ–" class="headerlink" title="è®¾è®¡ä¼šå˜åŒ–"></a>è®¾è®¡ä¼šå˜åŒ–</h2><p>åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶ä¼šå‘ç°ï¼Œæ­£åœ¨æ”¹å˜ä½ çš„è®¾è®¡æ–¹æ³•ã€‚è¿™æ ·å¯èƒ½ä¼šä»¤ä½ ä¸å®‰ã€‚ä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œè¿™æ˜¯æ­£å¸¸çš„ååº”ã€‚</p><h3 id="å†…èšä¸è€¦åˆ"><a href="#å†…èšä¸è€¦åˆ" class="headerlink" title="å†…èšä¸è€¦åˆ"></a>å†…èšä¸è€¦åˆ</h3><p>åœ¨é¢å¯¹ä¸€äº›æ…¢é€Ÿæˆ–è€…ä¸ç¨³å®šçš„ååŒå¯¹è±¡ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯å°†å®ƒä»¬éš”ç¦»æˆå•ç‹¬çš„ç±»ã€‚ä¾‹å¦‚å‘é€ HTTP çš„è¯·æ±‚ï¼Œè™½ç„¶å®ƒå¹¶ä¸æ˜¯éå¸¸å¤æ‚ï¼Œæ”¾åˆ°ä¸€ä¸ªå°è€Œç‹¬ç«‹çš„ç±»ä¸­æœ‰äº›ä¸å€¼å¾—ï¼Œä½†æ˜¯é€‰æ‹©è¿™æ ·çš„æ–¹å¼å°†å¸¦æ¥å® ç”¨çš„æœºä¼šå’Œæ›´çµæ´»çš„è®¾è®¡å¼¹æ€§ï¼ˆå¯ä»¥åˆ©ç”¨å¤šæ€çš„æ–¹å¼æ¥æ›¿æ¢ï¼‰ã€‚</p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºæ›´åŠ è¿‡ç¨‹åŒ–ã€å¼±å†…èšçš„ä»£ç ï¼Œåœ¨æµ‹è¯•åè¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ª PlaceDescriptionService çš„å…¸å‹è§£å†³æ–¹æ¡ˆï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>      <span class="token keyword">const</span> string<span class="token operator">&amp;</span> latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> longitude<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">// retrieve JSON response via API</span>   response_ <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> url <span class="token operator">=</span> <span class="token function">createGetRequestUrl</span><span class="token punctuation">(</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">curl_easy_setopt</span><span class="token punctuation">(</span>curl<span class="token punctuation">,</span> CURLOPT_URL<span class="token punctuation">,</span> url<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">curl_easy_perform</span><span class="token punctuation">(</span>curl<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">curl_easy_cleanup</span><span class="token punctuation">(</span>curl<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// parse json response</span>   Value location<span class="token punctuation">;</span>   Reader reader<span class="token punctuation">;</span>   reader<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>response_<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">auto</span> jsonAddress <span class="token operator">=</span> location<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span> Value<span class="token operator">::</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// populate address from json</span>   Address address<span class="token punctuation">;</span>   address<span class="token punctuation">.</span>road <span class="token operator">=</span> jsonAddress<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"road"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   address<span class="token punctuation">.</span>city <span class="token operator">=</span> jsonAddress<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"hamlet"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   address<span class="token punctuation">.</span>state <span class="token operator">=</span> jsonAddress<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   address<span class="token punctuation">.</span>country <span class="token operator">=</span> jsonAddress<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"country"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">return</span> address<span class="token punctuation">.</span>road <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>city <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span>          address<span class="token punctuation">.</span>state <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>country<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ˜¯å…¸å‹çš„åæµ‹è¯•ä»£ç ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥å°†å…¶æ‹†æˆå¤šä¸ªæ›´å°çš„å‡½æ•°ï¼Œå°±åƒç¨æ—©å‰çš„åšæ³•ä¸€æ ·ï¼Œä½†æ˜¯å¼€å‘äººå‘˜ä¸ä¼šè¿™ä¹ˆåšã€‚æµ‹è¯•åè¡Œçš„å¼€å‘è€…ä¸ä¹ æƒ¯å®šæœŸåšé‡æ„ï¼Œé€šå¸¸ï¼Œä»–ä»¬ä¸éœ€è¦ä½¿ç”¨å¿«é€Ÿçš„æµ‹è¯•æ¥è®©é‡æ„å˜å¾—æ›´å¿«ã€æ›´å®‰å…¨ã€‚</p><ul><li>ä»è®¾è®¡çš„è§’åº¦ï¼Œè¿™äºŒåå¤šè¡Œä»£ç è¿èƒŒäº†å•ä¸€è´£ä»»åŸåˆ™â€”â€”éœ€è¦ä¿®æ”¹ summaryDescription() çš„åŸå› æœ‰å¤šä¸ªï¼š<ol><li>é¦–å…ˆï¼Œè¿™ä¸ªå‡½æ•°ä¸ cURL ç´§å¯†è€¦åˆï¼›</li><li>å…¶æ¬¡ï¼Œè¿™äºŒåå¤šè¡Œä»£ç çš„å‡½æ•°ç®—ä½œå†—é•¿å‡½æ•°ï¼Œæƒ³è¦å®Œå…¨ç†è§£å®ƒä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚</li><li>å†è€…ï¼Œè¿™ç§å†—é•¿çš„å‡½æ•°ä¼šå¯¼è‡´ä¸å¿…è¦çš„ä»£ç é‡å¤ã€‚è®¸å¤šå¯é‡ç”¨çš„ä»£ç æ·±åŸ‹äºå†—é•¿çš„å‡½æ•°ä¸­ï¼Œé‚£ä¹ˆé‡ç”¨å°†ä¸ä¼šå‘ç”Ÿã€‚</li></ol></li></ul><p>å³ä½¿è¿™æ ·ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚ä½¿ç”¨ link substitution å†™ä¸€ä¸ªå¿«é€Ÿçš„å•å…ƒæµ‹è¯•ï¼ˆå‚è§ 8.9 èŠ‚ï¼‰ï¼Œæˆ–è€…å†™ä¸€ä¸ªèƒ½å‘èµ·ä¸€ä¸ªå³æ—¶çš„ REST æœåŠ¡è°ƒç”¨çš„é›†æˆæµ‹è¯•ã€‚</p><p>è€Œå½“è·µè¡Œ TDD æ—¶ï¼Œè‡ªç„¶è€Œç„¶çš„ä¼šå¯»æ±‚é«˜å†…èšã€ä½è€¦åˆçš„è®¾è®¡ã€‚ä½ ä¼šå¼€å§‹æ„è¯†åˆ°çµæ´»è®¾è®¡çš„å¥½å¤„ï¼Œä¹Ÿä¼šå¾ˆå¿«å‘ç°å¥½çš„è®¾è®¡æ˜¯æ€æ ·ä¸æµ‹è¯•å’Œè°å…±å­˜çš„ï¼Œè€Œä¸”è¿™äº›æµ‹è¯•å…·æœ‰ä½“é‡å°ï¼Œæ˜“äºç¼–å†™ã€é˜…è¯»å’Œç»´æŠ¤çš„ç‰¹ç‚¹ã€‚</p><h3 id="è½¬å«ç§æœ‰ä¾èµ–"><a href="#è½¬å«ç§æœ‰ä¾èµ–" class="headerlink" title="è½¬å«ç§æœ‰ä¾èµ–"></a>è½¬å«ç§æœ‰ä¾èµ–</h3><p>å¦‚æœä¸éœ€è¦æ–¹ä¾¿äºæµ‹è¯•ï¼ŒPlaceDescriptionService ä¸­çš„ HTTP è°ƒç”¨å¯ä»¥é€šè¿‡æˆå‘˜ä¿å­˜ä¸€ä¸ªç§æœ‰çš„å®ä¾‹ï¼Œä½¿å¾—å®¢æˆ·ç«¯è°ƒç”¨ä¸éœ€è¦å† setter æˆ–è€…æ„é€ æ³¨å…¥ã€‚åä¹‹ï¼Œéœ€è¦å®¢æˆ·ç«¯åˆ›å»º HTTP å¯¹è±¡ï¼Œå¹¶å°†å…¶ä¼ ç»™ PlaceDescriptionService å®ä¾‹ï¼Œå°±å°†å…¶å¯¹ HTTP çš„ä¾èµ–è½¬å«ç»™äº†å®¢æˆ·ç«¯ã€‚</p><p>Q: setter æˆ–æ„é€ å‡½æ•°æ³¨å…¥æ˜¯ä¸æ˜¯è¿åäº†ä¿¡æ¯éšè—ï¼Ÿ<br>A: ä»å®¢æˆ·ç«¯ç¨‹åºçš„è§’åº¦æ¥è¯´ï¼Œç¡®å®æ˜¯è¿åäº†ã€‚ä½†æ˜¯æœ‰å‡ ç§æ–¹æ³•æœ‰æ•ˆé¿å…ï¼š</p><ol><li>ä½¿ç”¨å…¶ä»–ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼Œä½¿å¾—æŸäººå³ä½¿åˆ©ç”¨äº†è¿™äº›æš´éœ²å‡ºçš„ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•é€ æˆä¸å¥½çš„å½±å“ã€‚</li><li>æä¾›æŸäººçš„å®ä¾‹ï¼Œå…ˆé…ç½®ä¸€ä¸ªé»˜è®¤çš„å®ä¾‹ï¼Œå¦‚æœæµ‹è¯•æä¾›äº† HttpStub å®ä¾‹ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æ›¿æ¢ã€‚è€ŒçœŸæ­£çš„å®¢æˆ·ç«¯æ—¶ä¸éœ€è¦åšä»€ä¹ˆæ”¹åŠ¨çš„ã€‚</li></ol><p>Q: å¦‚æœå¿ƒæ€€æ¶æ„çš„å¼€å‘è€…æä¾›ä¸€ä¸ªå…·æœ‰ç ´åæ€§çš„ Http å®ä¾‹å‘¢ï¼Ÿ<br>A: å¦‚æœäº§å“çš„å®¢æˆ·æ˜¯å›¢é˜Ÿä¹‹å¤–çš„äººï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©å…¶ä»–æ³¨å…¥å½¢å¼ã€‚å¦‚æœæ‹…å¿ƒå›¢é˜Ÿå†…éƒ¨çš„å¼€å‘è€…æœ‰æ„åˆ©ç”¨æ³¨å…¥ç‚¹åšäº›ä¸å¥½çš„äº‹ï¼Œé‚£ä½ å°†é¢ä¸´æ›´å¤§çš„é—®é¢˜ã€‚</p><p>Q: æˆ‘é€æ¸èƒ½å¤Ÿæµ‹è¯•é©±åŠ¨å¼€å‘äº†ï¼Œä½†æˆ‘æ‹…å¿ƒä»…ä»…ä¸ºäº†æµ‹è¯•çš„ç›®çš„è€Œæ”¹å˜æˆ‘çš„è®¾è®¡æ–¹æ³•ã€‚æˆ‘çš„å›¢é˜Ÿä¸­çš„å…¶ä»–äººå¯èƒ½ä¹Ÿä¼šè¿™ä¹ˆè§‰å¾—ã€‚<br>A: ç¡®åˆ‡åœ°äº†è§£è½¯ä»¶èƒ½å¦‚æœŸå·¥ä½œæ˜¯æ”¹å˜è®¾è®¡æ–¹å¼çš„é‡è¦åŸå› ã€‚ä½ å¯ä»¥è¿™æ ·å’ŒåŒäº‹è®²ï¼šâ€œæˆ‘æ›´å…³å¿ƒä»£ç æ˜¯å¦å¦‚æœŸå·¥ä½œã€‚åšå‡ºè¿™ä¹ˆä¸€ä¸ªå°çš„è®©æ­¥æ„å‘³ç€æˆ‘ä»¬èƒ½å¤Ÿæ›´å®¹æ˜“åœ°æµ‹è¯•ä»£ç ï¼Œä¹Ÿä¼šæœ‰æ›´å¤šçš„æµ‹è¯•èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“åœ°æ‰“ç£¨è®¾è®¡ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¯¹ä»£ç æ›´æœ‰ä¿¡å¿ƒã€‚æ‰€ä»¥ä½ ä»¬èƒ½é‡æ–°æ€è€ƒä¸‹æˆ‘ä»¬çš„æ ‡å‡†å—ï¼Ÿâ€</p><h2 id="ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ç­–ç•¥"><a href="#ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ç­–ç•¥" class="headerlink" title="ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ç­–ç•¥"></a>ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ç­–ç•¥</h2><p>ä½¿ç”¨æµ‹è¯•æ›¿èº«å’Œå…¶ä»–å·¥å…·ä¸€æ ·ï¼Œæœ€å¤§çš„æŒ‘æˆ˜ä¸æ˜¯å­¦ä¼šæ€ä¹ˆç”¨å®ƒä»¬ï¼Œè€Œæ˜¯çŸ¥é“ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ã€‚</p><h3 id="æ¢ç´¢è®¾è®¡"><a href="#æ¢ç´¢è®¾è®¡" class="headerlink" title="æ¢ç´¢è®¾è®¡"></a>æ¢ç´¢è®¾è®¡</h3><p>ç°åœ¨å‡è®¾ AddressExtractor ä¸å­˜åœ¨ï¼Œåœ¨æµ‹è¯•é©±åŠ¨å¼€å‘ summaryDescription() æ—¶ï¼Œè‚¯å®šä¼šæ„è¯†åˆ°éœ€è¦ä¸€äº›é€»è¾‘å»å¤„ç† JSON æ ¼å¼çš„å“åº”ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œé€šå¸¸å¼€å‘è€…å¯ä»¥åœ¨ PlaceDescriptionService ä¸­å…¨éƒ¨è‡ªå·±å®ç°ã€‚</p><p>ä½†æ˜¯è¿˜å¯ä»¥å¯»æ±‚æ½œåœ¨çš„é‡ç”¨æ€§ã€æ›´å¤§çš„çµæ´»æ€§å’Œæ˜“äºç†è§£çš„ä»£ç è®¾è®¡ï¼Œä¸ºäº†éµå®ˆå•ä¸€åŸåˆ™ï¼Œæˆ–è®¸å¯ä»¥å°†éœ€è¦çš„é€»è¾‘æ‹†åˆ†æˆä¸¤å—ï¼šè§£æ JSON æ ¼å¼çš„å“åº”å’Œæ ¼å¼åŒ–è¾“å‡ºã€‚</p><p>TDD ä¼šä¿ƒä½¿ä½ åœ¨ä»»ä½•æ—¶å€™éƒ½è¦åšå‡ºæ¸…é†’çš„è®¾è®¡é€‰æ‹©ã€‚ä¾‹å¦‚ä½ å¯ä»¥å…ˆå†™ä¸€ä¸ªæè¿° summaryDescription() æ€æ ·äºå¤–éƒ¨åä½œè€…äº¤äº’çš„æµ‹è¯•ã€‚è¿™ä¸ªåä½œè€…çš„å·¥ä½œæ˜¯å¾—åˆ°ä¸€ä¸ª JSON æ ¼å¼çš„å“åº”ï¼Œå¹¶è¿”å›ç›¸åº”çš„åœ°å€æ•°æ®ç»“æ„ã€‚ç›®å‰è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥å®ç°è¿™ä¸ªåä½œè€…çš„ç»†èŠ‚ï¼Œå…ˆé›†ä¸­ä½¿ç”¨ mock æ¥æµ‹è¯•é©±åŠ¨å¼€å‘ summaryDescription() ï¼Œå°±åƒå‰æ–‡ä¸­ HTTP å¯¹è±¡äº¤äº’ä¸€æ ·ã€‚</p><p>å½“ä»¥è¿™ç§æ–¹å¼å¼€å‘å®Œæˆæ—¶ï¼Œå¯ä»¥é€šè¿‡å¼•å…¥ mock æ¥æ›¿ä»£ç¼ºå¤±çš„åä½œè€…åŠŸèƒ½ã€‚<strong>åœ¨æŸä¸€æ—¶åˆ»ï¼Œä½ æˆ–å…¶ä»–äººå°†ä¼šå®ç°è¿™ä¸ªåä½œè€…ã€‚è¿™æ—¶ä½ å¯ä»¥ä½œå‡ºä»¥ä¸‹é€‰æ‹©ï¼šç§»é™¤ mockï¼Œä»¥ä¾¿å¾…æµ‹è¯•çš„ä»£ç ä½¿ç”¨äº§å“çº§çš„åä½œè€…ï¼›ä¿ç•™ mockã€‚</strong></p><p>ä¹Ÿè®¸ä½ å·²ç»ä½œå¥½äº†é€‰æ‹©ã€‚<strong>å¦‚æœåä½œè€…å¼•å…¥éº»çƒ¦çš„ä¾èµ–ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿ç•™ mockã€‚å¦åˆ™ï¼Œç§»é™¤ mock ä¼šé™ä½æµ‹è¯•çš„å¤æ‚åº¦ã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿè®¸é€‰æ‹©ä¿ç•™å®ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”¨å®ƒæ¥æè¿°ä¸åä½œè€…çš„äº¤äº’å¼è®¾è®¡ä¸­çš„é‡è¦æ–¹é¢ã€‚</strong><br>æˆ–è®¸æœ€å¥½çš„æŒ‡å¯¼æ–¹é’ˆéœ€è¦è€ƒè™‘ç»´æŠ¤å’Œç†è§£æµ‹è¯•æ‰€éœ€çš„ç²¾åŠ›ã€‚å¦‚æœæ²¡æœ‰ mockï¼Œäº‹æƒ…å¯èƒ½ä¼šç®€å•äº›ï¼Œä½†ä¸æ€»æ˜¯è¿™æ ·çš„ã€‚mock å¯èƒ½éœ€è¦å¤§é‡çš„ä»£ç æ¥åˆå§‹åŒ–ä¸€äº›åä½œè€…ï¼Œè¿™ä¹Ÿä¼šå¢åŠ ç»´æŠ¤æµ‹è¯•çš„æˆæœ¬ã€‚</p><h3 id="æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«"><a href="#æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«" class="headerlink" title="æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«"></a>æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«</h3><p>å¦‚æœä½ è¦å½»å¤´å½»å°¾åœ°æµ‹è¯•é©±åŠ¨å¼€å‘ä¸€ä¸ªå¸¦æœ‰å¿«é€Ÿæµ‹è¯•çš„ç³»ç»Ÿï¼Œè¿™å…¶ä¸­çš„å¤§éƒ¨åˆ†ç³»ç»Ÿéƒ½éœ€è¦ä½¿ç”¨æµ‹è¯•æ›¿èº«ã€‚åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„å»ºè®®ï¼š</p><ul><li>é‡æ–°æ€è€ƒè®¾è®¡ï¼šä½ æ˜¯ä¸ºäº†ç®€åŒ–ä¾èµ–å¯¹è±¡çš„åˆ›å»ºè€Œä½¿ç”¨ mock çš„å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆé‡æ–°ä¿®æ”¹ä¾èµ–ç»“æ„ã€‚ä½ æ˜¯ä¸æ˜¯åœ¨å¤šä¸ªåœ°æ–¹ä¸ºåŒä¸€ä¸ªä¸œè¥¿ä½¿ç”¨äº† mockï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆé‡æ–°è®¾è®¡æ¥æ¶ˆé™¤è¿™æ ·çš„é‡å¤ã€‚</li><li>æ„è¯†åˆ°å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä¸Šçš„è®©æ­¥ã€‚ä¸€ä¸ªæµ‹è¯•æ›¿èº«ä»£è¡¨äº†ç³»ç»Ÿæµ‹è¯•è¦†ç›–ç‡çš„æ¼æ´ã€‚å› ä¸ºæµ‹è¯•æ›¿èº«æä¾›çš„é€»è¾‘æ­£æ˜¯å•å…ƒæµ‹è¯•æ‰€ä¸èƒ½è¦†ç›–çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦ç¡®ä¿å…¶ä»–æµ‹è¯•è¦†ç›–åˆ°è¿™éƒ¨åˆ†é€»è¾‘ã€‚</li><li>é‡æ„æµ‹è¯•ã€‚ä¸èƒ½è®©å¯¹ç¬¬ä¸‰æ–¹å·¥å…·çš„ä¾èµ–æˆä¸ºé—®é¢˜ã€‚ä½¿ç”¨éšæ„çš„æ–¹æ³•ä¼šå¯¼è‡´ mock çš„å¤§é‡å¢åŠ ï¼Œä¹Ÿä¼šå¯¼è‡´å¤§é‡çš„é‡å¤å’Œå¤æ‚éš¾æ‡‚çš„æµ‹è¯•ã€‚è¦åƒé‡æ„äº§å“ä»£ç é‚£æ ·å»é‡æ„æµ‹è¯•ï¼æŠŠæœŸæœ›å£°æ˜å°è£…è¿›ä¸€ä¸ªå…¬å…±çš„è¾…åŠ©å‡½æ•°èƒ½å¤Ÿæé«˜æŠ½è±¡ã€é™ä½ä¾èµ–åº¦ã€å‡å°‘é‡å¤ä»£ç ã€‚</li><li>è´¨ç–‘ä»¥è¿‡åº¦å¤æ‚çš„æ–¹å¼ä½¿ç”¨æµ‹è¯•æ›¿èº«ã€‚å¦‚æœä½ èº«é™· mockï¼Œé‚£å¯èƒ½æ˜¯å› ä¸ºä½ å°è¯•äº†è¿‡åº¦æµ‹è¯•æˆ–ä½ çš„è®¾è®¡æœ‰ç¼ºé™·ã€‚è¿™æ—¶ä½¿ç”¨å¤šçº§çš„ mock é€šå¸¸èƒ½è§£å†³é—®é¢˜ã€‚å¦‚æœé‡åˆ°äº†é—®é¢˜ï¼Œé‚£ä¹ˆå°±è¦å°†æµ‹è¯•åˆ†è§£ä¸ºå¤šä¸ªå°çš„æµ‹è¯•æ¥ç®€åŒ–é—®é¢˜ã€‚åŒæ ·ä¹Ÿè¦æ£€æµ‹ä¸€ä¸‹æ‰€æµ‹ä»£ç æ˜¯å¦å¯ä»¥æ‹†è§£ã€‚</li><li>è¡¨è¾¾åŠ›èƒœäºåŠŸèƒ½ã€‚é€‰æ‹© mock å·¥å…·æ˜¯å› ä¸ºå®ƒèƒ½å¸®åŠ©ä½ åˆ›å»ºé«˜åº¦æŠ½è±¡çš„æµ‹è¯•ï¼Œè¿™äº›æµ‹è¯•å¯ä»¥æ–‡æ¡£åŒ–ç³»ç»Ÿè¡Œä¸ºå’Œè®¾è®¡ï¼Œè€Œä¸ä»…ä»…æ˜¯å› ä¸ºå®ƒæœ‰å¾ˆé…·çš„åŠŸèƒ½ï¼Œå¯ä»¥åšç²¾å·§å’Œæ·±å¥¥çš„äº‹æƒ…ã€‚é™¤éå¿…è¦ï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨è¿™äº›ç²¾å·§æ·±å¥¥çš„åŠŸèƒ½ã€‚</li></ul><h2 id="å…¶ä»–å…³äºæµ‹è¯•æ›¿èº«çš„ä¸»é¢˜"><a href="#å…¶ä»–å…³äºæµ‹è¯•æ›¿èº«çš„ä¸»é¢˜" class="headerlink" title="å…¶ä»–å…³äºæµ‹è¯•æ›¿èº«çš„ä¸»é¢˜"></a>å…¶ä»–å…³äºæµ‹è¯•æ›¿èº«çš„ä¸»é¢˜</h2><h3 id="ç§°å‘¼"><a href="#ç§°å‘¼" class="headerlink" title="ç§°å‘¼"></a>ç§°å‘¼</h3><p>æœ¬ç« ä¸­ä½¿ç”¨çš„æœ¯è¯­æœ‰æµ‹è¯•æ›¿èº«ã€mock å’Œ Stubã€‚è¿˜æœ‰ä»¥ä¸‹çš„å®šä¹‰ç§°å‘¼ï¼š</p><ul><li>æµ‹è¯•æ›¿èº«ï¼šä¸ºæµ‹è¯•è€Œæ¨¡æ‹Ÿäº§å“ä»£ç çš„ä»£ç ã€‚</li><li>Stubï¼šä¸€ä¸ªè¿”å›ç¡¬ç¼–ç å€¼çš„æµ‹è¯•æ›¿èº«ã€‚</li><li>Spyï¼šä¸€ä¸ªä¿å­˜æ¥å—ä¿¡æ¯ä»¥ä¾¿æ—¥åéªŒè¯çš„æµ‹è¯•æ›¿èº«ã€‚</li><li>mockï¼šä¸€ä¸ªåŸºäºæœŸæœ›è‡ªæˆ‘éªŒè¯çš„æµ‹è¯•æ›¿èº«ã€‚</li><li>Fakeï¼šæä¾›äº§å“ç±»è½»é‡çº§å®ç°çš„æµ‹è¯•æ›¿èº«ã€‚</li></ul><h3 id="æµ‹è¯•æ›¿èº«è¯¥æ”¾åœ¨å“ª"><a href="#æµ‹è¯•æ›¿èº«è¯¥æ”¾åœ¨å“ª" class="headerlink" title="æµ‹è¯•æ›¿èº«è¯¥æ”¾åœ¨å“ª"></a>æµ‹è¯•æ›¿èº«è¯¥æ”¾åœ¨å“ª</h3><p>ä¸€å¼€å§‹åœ¨ç›¸åŒçš„æµ‹è¯•æ–‡ä»¶ä¸­å®šä¹‰æµ‹è¯•æ›¿èº«ï¼Œä»¥ä¾¿å¼€å‘è€…çœ‹åˆ°ã€‚å½“å¤šä¸ª fixture ä½¿ç”¨åŒä¸€ä¸ªæµ‹è¯•æ›¿èº«æ—¶ï¼Œå†å°†å£°æ˜ç§»æ¤åˆ°å•ç‹¬çš„å¤´æ–‡ä»¶ä¸­ã€‚å½“ä¸å†éœ€è¦æŸ¥çœ‹æµ‹è¯•æ›¿èº«æ—¶ï¼Œåº”è¯¥æŠŠå®ƒä»¬ä»è§†é‡ä¸­ç§»é™¤ã€‚</p><h3 id="è™šå‡½æ•°è¡¨å’Œæ€§èƒ½"><a href="#è™šå‡½æ•°è¡¨å’Œæ€§èƒ½" class="headerlink" title="è™šå‡½æ•°è¡¨å’Œæ€§èƒ½"></a>è™šå‡½æ•°è¡¨å’Œæ€§èƒ½</h3><p>å¼•å…¥æµ‹è¯•æ›¿èº«æ˜¯ä¸ºäº†æµ‹è¯•é©±åŠ¨å¼€å‘ä¸€ä¸ªæœ‰å¤æ‚ä¾èµ–å…³ç³»çš„ç±»ã€‚è®¸å¤šåˆ›å»ºæµ‹è¯•æ›¿èº«çš„æŠ€æœ¯éƒ½éœ€è¦åˆ›å»ºæ´¾ç”Ÿç±»æ¥è¦†å†™è™šæˆå‘˜å‡½æ•°ã€‚å¦‚æœä¹‹å‰çš„äº§å“ç±»æ²¡æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆç°åœ¨ä¼šæœ‰ï¼Œå¹¶ä¸”ä¼šæœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨ã€‚è™šå‡½æ•°è¡¨å¸¦æ¥é¢å¤–çš„é—´æ¥æ€§æ˜¯æœ‰å¼€é”€çš„ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœä½ å¿…é¡»å¤§è§„æ¨¡åœ°è°ƒç”¨æ¨¡æ‹Ÿçš„äº§å“å‡½æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆå¾—åˆ°ä¸€äº›æ€§èƒ½æ•°æ®ã€‚å¦‚æœæ€§èƒ½é™åˆ°ä¸å¯æ¥å—çš„ç¨‹åº¦ï¼Œå°±è¦è€ƒè™‘ä¸åŒçš„æ¨¡æ‹Ÿæ–¹å¼ï¼ˆæˆ–è®¸åŸºäºæ¨¡æ¿çš„æ–¹æ¡ˆï¼‰ï¼Œé‡æ–°è®¾è®¡ï¼ˆå¯èƒ½çš„è¯ï¼Œé€šè¿‡ä¼˜åŒ–å…¶ä»–åœ°æ–¹æ¥è¡¥å¿æ€§èƒ½æŸå¤±ï¼‰ï¼Œæˆ–è€…å¼•å…¥é›†æˆæµ‹è¯•æ¥å¼¥è¡¥å•å…ƒæµ‹è¯•çš„ä¸è¶³ï¼ˆå‚è§ 10.2 èŠ‚ï¼‰ã€‚</p><h3 id="æ¨¡æ‹Ÿå…·ä½“çš„ç±»"><a href="#æ¨¡æ‹Ÿå…·ä½“çš„ç±»" class="headerlink" title="æ¨¡æ‹Ÿå…·ä½“çš„ç±»"></a>æ¨¡æ‹Ÿå…·ä½“çš„ç±»</h3><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å®ç°ä¸€ä¸ªçº¯è™šçš„ Http æ¥å£æ¥åˆ›å»ºä¸€ä¸ª mockã€‚å¾ˆå¤šç³»ç»Ÿä¸»è¦ç”±å…·ä½“çš„ç±»æ„æˆï¼Œå› æ­¤æ²¡æœ‰å¤šå°‘æ­¤ç±»æ¥å£ã€‚ä»è®¾è®¡çš„è§’åº¦è®²ï¼Œä½¿ç”¨æ¥å£æ˜¯å°†ç³»ç»Ÿä¸­çš„ä¸€éƒ¨åˆ†å’Œå¦ä¸€éƒ¨åˆ†éš”ç¦»çš„æ–¹å¼ã€‚</p><p>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼ŒDIPï¼‰æå€¡è®©å®¢æˆ·ç«¯ä¾èµ–æŠ½è±¡çš„æ¥å£è€Œéå…·ä½“çš„å®ç°ï¼Œä»è€Œè¾¾åˆ°æ¶ˆé™¤ä¾èµ–çš„ç›®çš„ã€‚ä»¥çº¯è™šç±»çš„æ–¹å¼å¼•å…¥è¿™ç§æŠ½è±¡ï¼Œèƒ½å¤ŸåŠ å¿«ç¼–è¯‘å¹¶éš”ç¦»å¤æ‚æ€§ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒä»¬èƒ½è®©æµ‹è¯•å˜å¾—ç®€å•ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ´¾ç”Ÿè‡ªä¸€ä¸ªå…·ä½“ç±»çš„ mockã€‚é—®é¢˜æ˜¯äº§ç”Ÿçš„ç±»æ··åˆäº†äº§å“ä»£ç å’Œæ¨¡æ‹Ÿçš„è¡Œä¸ºï¼Œè¿™åˆè¢«ç§°ä¸ºéƒ¨åˆ†æ¨¡æ‹Ÿã€‚å®ƒå¯ä»¥ä½“ç°å‡ºä¸¤æ–¹é¢é—®é¢˜ï¼š</p><ol><li>é¦–å…ˆï¼Œéƒ¨åˆ†æ¨¡æ‹Ÿé€šå¸¸èƒ½å‘Šè¯‰ä½ æ‰€æ¨¡æ‹Ÿçš„ç±»è¿‡å¤§ï¼Œå¦‚æœä½ åªéœ€è¦å…¶ä¸­çš„ä¸€éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‰ç…§è¿™äº›è¾¹ç•Œå°†ç±»æ‹†åˆ†æˆä¸¤ä¸ªã€‚</li><li>å…¶æ¬¡ï¼Œä½¿ç”¨éƒ¨åˆ†æ¨¡æ‹Ÿå¾ˆå¯èƒ½ä½¿ä½ é™·å…¥éº»çƒ¦ï¼Œä»¥è‡³äºå¾ˆå¿«é™·å…¥æ¨¡æ‹Ÿåœ°ç‹±ã€‚åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿå¯èƒ½é‡åˆ°è¯¡ç§˜çš„é—®é¢˜ï¼šâ€œå•Šï¼æˆ‘åŸä»¥ä¸ºä»£ç æ­¤æ—¶ä¼šä¸æ¨¡æ‹Ÿçš„æ–¹æ³•äº¤äº’ï¼Œä½†æ˜¯çœ‹èµ·æ¥å®ƒä¸çœŸæ­£çš„æ–¹æ³•äº¤äº’äº†ã€‚â€</li></ol><p>ç»“è®ºä¾¿æ˜¯ï¼šå¦‚æœä½ ä½¿ç”¨è¯¸å¦‚éƒ¨åˆ†æ¨¡æ‹Ÿæ­¤ç±»éš¾ä»¥é©¾é©­çš„å·¥å…·ï¼Œé‚£ä¹ˆä½ çš„è®¾è®¡æ­£æ•£å‘ç€åå‘³ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸€ä¸ªå¹²å‡€çš„è®¾è®¡ä¼šé‡‡ç”¨å…·ä½“ç±»ç»§æ‰¿ä¸€ä¸ªæ¥å£çš„æ–¹å¼ã€‚è¿™æ ·ï¼Œæµ‹è¯•ä¹Ÿä¸å†éœ€è¦éƒ¨åˆ†æ¨¡æ‹Ÿäº†ï¼Œä¸ºè¿™ä¸ªæ¥å£åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ›¿èº«å³å¯ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><p>çœŸå®çš„ç”Ÿäº§ç¯å¢ƒä¸­å¯¹è±¡å¿…é¡»ååŒå·¥ä½œï¼Œæœ‰æ—¶ä¾èµ–åˆä½œå¯¹è±¡ä½¿å¾— TDD å˜å¾—ä¸¾æ­¥ç»´è‰°ï¼Œå¯ä»¥ä½¿ç”¨ MOCK æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚ç”±äº Catch2 æ²¡æœ‰æä¾› MOCK åŠŸèƒ½æ”¯æŒï¼Œæœ¬ç« èŠ‚ä¸»è¦çš„ä»£ç æ¼”ç¤ºå‡ä½¿ç”¨ GMOCKã€‚ä½†æ˜¯ Catch2 ä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨ GMOCK ç›¸å…³å®æ¥å®Œå–„æµ‹è¯•éœ€è¦ï¼Œ<a href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/test/Catch2/PlaceDescriptionServiceTestByGMock">å…·ä½“ä½¿ç”¨</a>ã€‚</p></li><li><p>ä¾èµ–é—®é¢˜ï¼šå½“æ„å»ºäº§å“ä»£ç æ˜¯æ— æ³•é¿å…ä¸ç¬¬ä¸‰æ–¹è¿›è¡Œäº¤äº’ï¼Œè¿™æ—¶å°±ä¼šæœ‰è®¸å¤šä¸ç¡®å®šæ€§ï¼ˆæ¥å£ä¸ç¨³å®šã€é€Ÿåº¦æ…¢ã€ç”šè‡³æ²¡æœ‰å¼€å‘å®Œæˆç­‰ç­‰ï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥åˆ©ç”¨ MOCK æ›¿èº«æŠ€æœ¯æ¥é¿å…é˜»å¡ã€‚</p></li><li><p>ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">MOCK_METHOD</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">,</span> initialize<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>override<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">MOCK_METHOD</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> get<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> override<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//CmakeLists.txt</span><span class="token comment" spellcheck="true">//å½“å‰ä½¿ç”¨çš„ googletest ç‰ˆæœ¬ä¸º 1.10.x MOCK_METHOD å®åœ¨ç¼–è¯‘å™¨ä¸‹ä¼šæœ‰é”™è¯¯ä¿¡æ¯ï¼Œä¾æ® gmock issues æ— ç”¨æŠ¥é”™ å…³é—­ç›¸å…³è­¦å‘Š</span><span class="token function">add_definitions</span><span class="token punctuation">(</span><span class="token operator">-</span>Wno<span class="token operator">-</span>gnu<span class="token operator">-</span>zero<span class="token operator">-</span>variadic<span class="token operator">-</span>macro<span class="token operator">-</span>arguments<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è®¾ç«‹æœŸæœ›ï¼š</p><ul><li><p>é€šè¿‡ EXPECT_CALL å®è®¾ç«‹æœŸæœ›ï¼Œè¿™ä¸ªå®é…ç½® Google Mock å»éªŒè¯ä»¥ç»™å®šçš„å‚æ•°å»è°ƒç”¨ç›®æ ‡å¯¹è±¡é€»è¾‘æ˜¯å¦å»åˆã€‚</p></li><li><p>EXPECT_CALL å®æ”¯æŒè®¸å¤šä¿®é¥°ç¬¦ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼ˆ?å’Œ<em>ä»£è¡¨æ¯ä¸ªä¿®é¥°ç¬¦çš„åŸºæ•°ï¼š?è¡¨ç¤ºå¯ä»¥é€‰ç”¨ä¿®é¥°ç¬¦ä¸€æ¬¡ï¼›</em>è¡¨ç¤ºå¯ä»¥å¤šæ¬¡ä½¿ç”¨ä¿®é¥°ç¬¦ã€‚ï¼‰ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>mock<span class="token operator">-</span>object<span class="token punctuation">,</span> <span class="token function">method</span> <span class="token punctuation">(</span>matchers<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span>multi<span class="token operator">-</span>argument<span class="token operator">-</span>matcher<span class="token punctuation">)</span>  <span class="token operator">?</span>    <span class="token punctuation">.</span><span class="token function">Times</span><span class="token punctuation">(</span>cardinality<span class="token punctuation">)</span>            <span class="token operator">?</span>    <span class="token punctuation">.</span><span class="token function">InSequence</span><span class="token punctuation">(</span>sequences<span class="token punctuation">)</span>         <span class="token operator">*</span>    <span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>expectations<span class="token punctuation">)</span>           <span class="token operator">*</span>    <span class="token punctuation">.</span><span class="token function">WillOnce</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>              <span class="token operator">*</span>    <span class="token punctuation">.</span><span class="token function">WillRepeatedly</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>        <span class="token operator">?</span>    <span class="token punctuation">.</span><span class="token function">RetiresOnSaturation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">?</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>æ’é™¤æ¨¡æ‹Ÿå¤±è´¥çš„æ–¹æ³•ï¼š</p><ol><li>äº§å“ä»£ç ä¸­æ˜¯å¦æœ‰åˆç†è°ƒç”¨ï¼Ÿ</li><li>æ˜¯å¦æ­£ç¡®å®šä¹‰äº†æ¨¡æ‹Ÿæ–¹æ³•ï¼Ÿ</li><li>æœ‰æ²¡æœ‰å°†è¦æ¨¡æ‹Ÿçš„æˆå‘˜å‡½æ•°å£°æ˜ä¸ºè™šå‡½æ•°ï¼Ÿ</li><li><code>MOCK_METHOD()</code> å£°æ˜æ­£ä¸æ­£ç¡®ï¼Ÿ</li><li>æ’é™¤å‚æ•°åŒ¹é…çš„æ‹…å¿§ï¼Œä¸ºæ‰€æœ‰å‚æ•°å’Œè¿”å›å€¼ä½¿ç”¨é€šé…ç¬¦ testing::_ ï¼Œå¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæœ‰ä¸€ä¸ªå‚æ•°ä¸èƒ½è¢«æ­£ç¡®åŒ¹é…ã€‚</li></ol></li><li><p>ä½¿ç”¨æµ‹è¯•æ›¿èº«ï¼šåœ¨å¼•å…¥ä¸€ä¸ªæµ‹è¯•æ›¿èº«æ—¶éœ€è¦åšä¸¤ä»¶äº‹ã€‚ç¬¬ä¸€ï¼Œç¼–å†™æµ‹è¯•æ›¿èº«ã€‚ç¬¬äºŒï¼Œåœ¨ç›®æ ‡æµ‹è¯•ä¸­ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ ·çš„åšæ³•åˆç§°ä½œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰ã€‚</p></li><li><p>å†…èšä¸è€¦åˆï¼šåœ¨å…¸å‹çš„åæµ‹è¯•ä»£ç æƒ…å†µï¼Œå¼€å‘è€…å¯èƒ½ä¸ä¼šç»å¸¸è¿›è¡Œé‡æ„ï¼Œé€šå¸¸ä»–ä»¬ä¹Ÿæ— æ³•ä½¿ç”¨å¿«é€Ÿçš„æµ‹è¯•è®©é‡æ„å˜å¾—æ›´å¿«æ›´å®‰å…¨ã€‚è¿™æ ·å¾€å¾€äº§ç”Ÿä¸€äº›å†—ä½™ä¸”è€¦åˆçš„ä»£ç ã€‚å³ä½¿è¿™æ ·ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œèƒ½å¤Ÿåˆ©ç”¨åˆ°çš„æŠ€æœ¯ï¼š</p></li><li><p>è½¬å«ç§æœ‰ä¾èµ–ï¼šæ³¨å…¥æ¨¡å¼å¾€å¾€éœ€è¦å¯¹å®¢æˆ·ç«¯è°ƒç”¨äº§ç”Ÿä¾èµ–å…³ç³»ï¼Œå³ setter æˆ–è€…æ„é€ æ³¨å…¥ã€‚</p></li><li><p>ä½¿ç”¨ mock çš„ç­–ç•¥ï¼šåœ¨å¼€å‘å‰æœŸï¼Œå¯ä»¥é€šè¿‡å¼•å…¥ mock æ¥æ›¿ä»£ç¼ºå¤±çš„åä½œè€…åŠŸèƒ½ã€‚<strong>åœ¨æŸä¸€æ—¶åˆ»ï¼Œä½ æˆ–å…¶ä»–äººå°†ä¼šå®ç°è¿™ä¸ªåä½œè€…ã€‚è¿™æ—¶ä½ å¯ä»¥ä½œå‡ºä»¥ä¸‹é€‰æ‹©ï¼šç§»é™¤ mockï¼Œä»¥ä¾¿å¾…æµ‹è¯•çš„ä»£ç ä½¿ç”¨äº§å“çº§çš„åä½œè€…ï¼›ä¿ç•™ mockã€‚</strong></p><ul><li><strong>å¦‚æœåä½œè€…å¼•å…¥éº»çƒ¦çš„ä¾èµ–ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿ç•™ mockã€‚å¦åˆ™ï¼Œç§»é™¤ mock ä¼šé™ä½æµ‹è¯•çš„å¤æ‚åº¦ã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿè®¸é€‰æ‹©ä¿ç•™å®ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”¨å®ƒæ¥æè¿°ä¸åä½œè€…çš„äº¤äº’å¼è®¾è®¡ä¸­çš„é‡è¦æ–¹é¢ã€‚</strong></li></ul></li><li><p>æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«ï¼šå½“éœ€è¦ä»å¤´ TDD å¼€å‘ä¸€ä¸ªå¸¦æœ‰å¿«é€Ÿæµ‹è¯•çš„ç³»ç»Ÿï¼Œå¤§éƒ¨åˆ†ç³»ç»ŸåŠŸèƒ½éƒ½éœ€è¦ä½¿ç”¨æµ‹è¯•æ›¿èº«ï¼Œåœ¨ä½¿ç”¨æ—¶å¯ä»¥å‚è€ƒæ˜ç« èŠ‚#æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«ã€‚</p></li></ul><h3 id="Q-x2F-A"><a href="#Q-x2F-A" class="headerlink" title="Q/A"></a>Q/A</h3><p>Q: setter æˆ–æ„é€ å‡½æ•°æ³¨å…¥æ˜¯ä¸æ˜¯è¿åäº†ä¿¡æ¯éšè—ï¼Ÿ<br>A: ä»å®¢æˆ·ç«¯ç¨‹åºçš„è§’åº¦æ¥è¯´ï¼Œç¡®å®æ˜¯è¿åäº†ã€‚ä½†æ˜¯æœ‰å‡ ç§æ–¹æ³•æœ‰æ•ˆé¿å…ï¼š</p><ol><li>ä½¿ç”¨å…¶ä»–ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼Œä½¿å¾—æŸäººå³ä½¿åˆ©ç”¨äº†è¿™äº›æš´éœ²å‡ºçš„ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•é€ æˆä¸å¥½çš„å½±å“ã€‚</li><li>æä¾›æŸäººçš„å®ä¾‹ï¼Œå…ˆé…ç½®ä¸€ä¸ªé»˜è®¤çš„å®ä¾‹ï¼Œå¦‚æœæµ‹è¯•æä¾›äº† HttpStub å®ä¾‹ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æ›¿æ¢ã€‚è€ŒçœŸæ­£çš„å®¢æˆ·ç«¯æ—¶ä¸éœ€è¦åšä»€ä¹ˆæ”¹åŠ¨çš„ã€‚</li></ol><p>Q: å¦‚æœå¿ƒæ€€æ¶æ„çš„å¼€å‘è€…æä¾›ä¸€ä¸ªå…·æœ‰ç ´åæ€§çš„ Http å®ä¾‹å‘¢ï¼Ÿ<br>A: å¦‚æœäº§å“çš„å®¢æˆ·æ˜¯å›¢é˜Ÿä¹‹å¤–çš„äººï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©å…¶ä»–æ³¨å…¥å½¢å¼ã€‚å¦‚æœæ‹…å¿ƒå›¢é˜Ÿå†…éƒ¨çš„å¼€å‘è€…æœ‰æ„åˆ©ç”¨æ³¨å…¥ç‚¹åšäº›ä¸å¥½çš„äº‹ï¼Œé‚£ä½ å°†é¢ä¸´æ›´å¤§çš„é—®é¢˜ã€‚</p><p>Q: æˆ‘é€æ¸èƒ½å¤Ÿæµ‹è¯•é©±åŠ¨å¼€å‘äº†ï¼Œä½†æˆ‘æ‹…å¿ƒä»…ä»…ä¸ºäº†æµ‹è¯•çš„ç›®çš„è€Œæ”¹å˜æˆ‘çš„è®¾è®¡æ–¹æ³•ã€‚æˆ‘çš„å›¢é˜Ÿä¸­çš„å…¶ä»–äººå¯èƒ½ä¹Ÿä¼šè¿™ä¹ˆè§‰å¾—ã€‚<br>A: ç¡®åˆ‡åœ°äº†è§£è½¯ä»¶èƒ½å¦‚æœŸå·¥ä½œæ˜¯æ”¹å˜è®¾è®¡æ–¹å¼çš„é‡è¦åŸå› ã€‚ä½ å¯ä»¥è¿™æ ·å’ŒåŒäº‹è®²ï¼šâ€œæˆ‘æ›´å…³å¿ƒä»£ç æ˜¯å¦å¦‚æœŸå·¥ä½œã€‚åšå‡ºè¿™ä¹ˆä¸€ä¸ªå°çš„è®©æ­¥æ„å‘³ç€æˆ‘ä»¬èƒ½å¤Ÿæ›´å®¹æ˜“åœ°æµ‹è¯•ä»£ç ï¼Œä¹Ÿä¼šæœ‰æ›´å¤šçš„æµ‹è¯•èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“åœ°æ‰“ç£¨è®¾è®¡ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¯¹ä»£ç æ›´æœ‰ä¿¡å¿ƒã€‚æ‰€ä»¥ä½ ä»¬èƒ½é‡æ–°æ€è€ƒä¸‹æˆ‘ä»¬çš„æ ‡å‡†å—ï¼Ÿâ€</p>]]></content>
      
      
      <categories>
          
          <category> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ï¼ˆå››ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--æµ‹è¯•ç»“æ„</title>
      <link href="/2022/06/02/si-ce-shi-qu-dong-kai-fa-ji-qiao-ce-shi-jie-gou/"/>
      <url>/2022/06/02/si-ce-shi-qu-dong-kai-fa-ji-qiao-ce-shi-jie-gou/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ‹è¯•ç»“æ„"><a href="#æµ‹è¯•ç»“æ„" class="headerlink" title="æµ‹è¯•ç»“æ„"></a>æµ‹è¯•ç»“æ„</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬ç« å°†æ·±å…¥è®¨è®ºå®ç°æµ‹è¯•çš„å…·ä½“ç»†èŠ‚ï¼ŒåŒ…æ‹¬ï¼šæ–‡ä»¶ç»„ç»‡ã€fixtureã€setupã€teardownã€è¿‡æ»¤å™¨ã€æ–­è¨€å’ŒåŸºäºå¼‚å¸¸çš„æ–­è¨€ã€‚</p><h2 id="ç»„ç»‡æ–¹å¼"><a href="#ç»„ç»‡æ–¹å¼" class="headerlink" title="ç»„ç»‡æ–¹å¼"></a>ç»„ç»‡æ–¹å¼</h2><p>ä»æ–‡ä»¶å’Œé€»è¾‘æ–¹é¢ç€çœ¼ï¼Œç»„ç»‡æµ‹è¯•çš„æ–¹å¼æœ‰å‡ ç§ï¼š</p><ol><li>fixture æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨ setup å’Œ teardown é’©å­å‡½æ•°ã€‚</li><li>å¦‚ä½•ä½¿ç”¨ Given-When-Then çš„æ¦‚å¿µæ¥ç»„ç»‡ã€‚</li></ol><h3 id="æ–‡ä»¶ç»„ç»‡"><a href="#æ–‡ä»¶ç»„ç»‡" class="headerlink" title="æ–‡ä»¶ç»„ç»‡"></a>æ–‡ä»¶ç»„ç»‡</h3><p>åœ¨æµ‹è¯•é©±åŠ¨å¼€å‘ç›¸å…³è¡Œä¸ºæ—¶ï¼Œæˆ‘ä»¬ä¼šå°†ç›¸å…³çš„æµ‹è¯•å®šä¹‰åœ¨åŒä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ä¸­ã€‚æœ€ç»ˆå¯èƒ½éœ€è¦å¤šä¸ªæµ‹è¯•æ–‡ä»¶æ¥éªŒè¯ç›¸å…³è¡Œä¸ºï¼Œä¹Ÿå¯èƒ½éœ€è¦ç”¨ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶è¦†ç›–å¤šä¸ªåœ°æ–¹è¡Œä¸ºï¼Œæ‰€ä»¥<strong>ä¸ç”¨æ‹˜æ³¥äºä¸€ä¸ªç±»ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶çš„å½¢å¼</strong>ã€‚</p><p>åŸºäºæ‰€åŒ…å«çš„æµ‹è¯•æ¥ç»™æ–‡ä»¶å‘½åã€‚æ¦‚æ‹¬ç›¸å…³çš„è¡Œä¸ºï¼Œå¹¶æ®æ­¤ç»™æµ‹è¯•å‘½åã€‚é€‰å®šä¸€ä¸ªå‘½åä½“ç³»è¯¸å¦‚ <code>BehaviorDescriptionTest.cpp</code>ã€<code>BehaviorDescriptionTests.cpp</code> æˆ–è€… <code>TestBehaviorDescription.cpp</code>ã€‚</p><h3 id="fixture"><a href="#fixture" class="headerlink" title="fixture"></a>fixture</h3><p>å¤§å¤šæ•°å•å…ƒæµ‹è¯•å·¥å…·éƒ½æ”¯æŒå°†é€»è¾‘ä¸Šç›¸å…³çš„æµ‹è¯•åˆ†ç»„ã€‚å† Google Mock ä»¥åŠ Catch2 ä¸­éƒ½æ”¯æŒæ‰€è°“çš„æµ‹è¯•ç”¨ä¾‹åç§°æ¥å°†ç›¸å…³æµ‹è¯•åˆ†ç»„ã€‚ä¸‹é¢çš„æµ‹è¯•æ‰€å±çš„æµ‹è¯•ç”¨ä¾‹åä¸º ARetweetCollectionã€‚IncrementsSizeWhenTweetAdded æ˜¯æ­¤æµ‹è¯•ç”¨ä¾‹ä¸­çš„ä¸€ä¸ªæµ‹è¯•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//google mock</span><span class="token function">TEST</span><span class="token punctuation">(</span>ARetweetCollection<span class="token punctuation">,</span> IncrementsSizeWhenTweetAdded<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//catch2</span><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"IncrementsSizeWhenTweetAdded"</span><span class="token punctuation">,</span><span class="token string">"[ARetweetCollection]"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›¸å…³çš„æµ‹è¯•è¿è¡Œæ—¶éœ€è¦ç›¸åŒçš„ç¯å¢ƒï¼Œä¾‹å¦‚è®¸å¤šæµ‹è¯•éƒ½éœ€è¦å…¬å…±çš„åˆå§‹åŒ–æˆ–è€…ç¬¦ä¸»å‡½æ•°ï¼Œè®¸å¤šæµ‹è¯•å·¥å…·èƒ½å¤Ÿä½¿ä½ å®šä¹‰ä¸€ä¸ª fixture â€“ ä¸€ä¸ªè·¨æµ‹è¯•å¯é‡ç”¨çš„ç±»ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//google mock</span><span class="token keyword">class</span> <span class="token class-name">ARetweetCollection</span><span class="token operator">:</span> <span class="token keyword">public</span> Test<span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    RetweetCollection collection<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>ARetweetCollection<span class="token punctuation">,</span> IsEmptyWhenCreated<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>ARetweetCollection<span class="token punctuation">,</span> IsNoLongerEmptyAfterTweetAdded<span class="token punctuation">)</span><span class="token punctuation">{</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Tweet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//catch2</span><span class="token keyword">class</span> <span class="token class-name">FixtureSoundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    Soundex MSoundex<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Setup-ä¸-Teardown"><a href="#Setup-ä¸-Teardown" class="headerlink" title="Setup ä¸ Teardown"></a>Setup ä¸ Teardown</h3><p>å¦‚æœæµ‹è¯•ç”¨ä¾‹ä¸­çš„æ‰€æœ‰æµ‹è¯•éœ€è¦ä¸€æ¡æˆ–æ›´å¤šçš„ç›¸åŒåˆå§‹åŒ–è¯­å¥ï¼Œé‚£ä¹ˆå¯ä»¥å°†å®ƒä»¬å†™åœ¨ fixture ç±»çš„åˆå§‹åŒ–å‡½æ•°ä¸­ã€‚åœ¨ Google Mock ä¸­ï¼Œå¿…é¡»å°†æ­¤å‡½æ•°å‘½åä¸º SetUpï¼ˆå®ƒè¦†å†™äº†åŸºç±» ::testing::Test ä¸­çš„è™šå‡½æ•°ï¼‰ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//google mock</span><span class="token keyword">class</span> <span class="token class-name">ARetweetCollectionWithOneTweet</span><span class="token operator">:</span> <span class="token keyword">public</span> Test <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    RetweetCollection collection<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span>        collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Tweet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>ARetweetCollectionWithOneTweet<span class="token punctuation">,</span> IsNoLongerEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">ASSERT_FALSE</span><span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>ARetweetCollectionWithOneTweet<span class="token punctuation">,</span> HasSizeOfOne<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å† Catch2 ä¸­ä½¿ç”¨äº†ä¸åŒçš„æ–¹å¼ï¼Œæ¥è¿›è¡Œå…±æœ‰ä»£ç åˆå§‹åŒ–ä¸é‡Šæ”¾ï¼Œå³ SECTION æœºåˆ¶ï¼Œæ¯ä¸ª SECTION éƒ½æ˜¯å†æµ‹è¯•å¼€å§‹é˜¶æ®µè¿è¡Œï¼Œä¸å—å…¶ä»– SECTION æ®µå½±å“ï¼Œæ›´å¼ºçš„æ˜¯å®ƒæ”¯æŒ SECTION ä¸­ç»§ç»­åµŒå¥— SECTION æ¥æ›´åŠ ç²¾ç»†çš„é€‚é…ä¸åŒæµ‹è¯•æ‰€éœ€çš„å‰ç½®æ¡ä»¶ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//catch2</span><span class="token function">TEST_CASE</span><span class="token punctuation">(</span> <span class="token string">"vectors can be sized and resized"</span><span class="token punctuation">,</span> <span class="token string">"[vector]"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">v</span><span class="token punctuation">(</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">SECTION</span><span class="token punctuation">(</span> <span class="token string">"resizing bigger changes size and capacity"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>        v<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">SECTION</span><span class="token punctuation">(</span> <span class="token string">"resizing smaller changes size but not capacity"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>        v<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">SECTION</span><span class="token punctuation">(</span> <span class="token string">"reserving bigger changes capacity but not size"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>        v<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">SECTION</span><span class="token punctuation">(</span> <span class="token string">"reserving smaller again does not change capacity"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            v<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span> <span class="token number">7</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åˆå§‹åŒ–çš„ä»£ç é€‚ç”¨äºæ‰€æœ‰ç›¸å…³çš„æµ‹è¯•ã€‚å¦‚æœåªç”¨å°‘æ•°å‡ ä¸ªæµ‹è¯•æ¥è®¾ç½®ä¸Šä¸‹æ–‡åè€Œå®¹æ˜“é€ æˆä¸å¿…è¦çš„å›°æƒ‘ã€‚å½“ä¸€äº›æµ‹è¯•éœ€è¦ä¸€ä¸ªåˆå§‹åŒ–ä»£ç å—ï¼Œè€Œå…¶ä»–æµ‹è¯•ä¸éœ€è¦æ—¶ï¼Œæœ€å¥½å†åˆ›å»ºä¸€ä¸ªåˆå§‹åŒ–å—ï¼Œå¹¶ä¸”æŠŠæµ‹è¯•åˆç†åœ°åˆ†å¼€ã€‚</p><p>åœ¨åˆ›å»ºé¢å¤–çš„ fixture æ—¶ï¼Œä¸è¦çŠ¹è±«ã€‚ä½†æ˜¯æ¯åˆ›å»ºä¸€ä¸ª fixtureï¼Œåˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯éœ€è¦æ˜¾ç°å‡ºäº§å“ä»£ç ä¸­çš„è®¾è®¡ç¼ºé™·ã€‚<strong>å¦‚æœéœ€è¦ä¸¤ä¸ªä¸åŒçš„ fixture çš„è¯ï¼Œè¿™æœ‰å¯èƒ½æ„å‘³ç€ä½ æ­£åœ¨æµ‹è¯•çš„ç±»è¿åäº†å•ä¸€è´£ä»»åŸåˆ™ï¼Œä½ å¯èƒ½éœ€è¦å°†å®ƒä»¬æ‹†åˆ†ä¸ºä¸¤ä¸ªç±»ã€‚</strong></p><h3 id="Arrange-Act-Assert-x2F-Given-When-Then"><a href="#Arrange-Act-Assert-x2F-Given-When-Then" class="headerlink" title="Arrange-Act-Assert/Given-When-Then"></a>Arrange-Act-Assert/Given-When-Then</h3><p>æµ‹è¯•éƒ½æœ‰ç›¸åŒçš„æµç¨‹ã€‚é¦–å…ˆéœ€è¦è®¾ç½®å¥½åˆé€‚çš„æ¡ä»¶ï¼Œç„¶åæ‰§è¡Œä»£è¡¨è¦éªŒè¯çš„è¡Œä¸ºçš„ä»£ç ï¼Œæœ€åéªŒè¯ç»“æœæ˜¯å¦å’ŒæœŸæœ›çš„ä¸€æ ·ã€‚</p><p>æµ‹è¯•åº”å½“å°½å¯èƒ½åœ°ç›´æ¥åæ˜ å…¶æµ‹è¯•æ„å›¾ã€‚è¿™å°±æ„å‘³ç€é˜…è¯»æµ‹è¯•çš„äººä¸éœ€è¦ç»†ç»†å“è¯»æµ‹è¯•ä¸­çš„æ¯ä¸€è¡Œï¼Œå°±èƒ½å¾ˆå®¹æ˜“åœ°ç†è§£æµ‹è¯•çš„åŸºæœ¬æ„æˆï¼šæµ‹è¯•çš„åˆå§‹åŒ–ï¼ˆArrangeï¼‰ã€æµ‹è¯•çš„è¡Œä¸ºï¼ˆActï¼‰ï¼Œä»¥åŠæ€æ ·éªŒè¯è¡Œä¸ºç»“æœï¼ˆAssertï¼‰ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼Œä½¿ç”¨ AAA çš„åŒºåˆ«ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>ARetweetCollection<span class="token punctuation">,</span> IgnoresDuplicateTweetAdded<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Tweet <span class="token function">tweet</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"@user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Tweet <span class="token function">duplicate</span><span class="token punctuation">(</span>tweet<span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tweet<span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>duplicate<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//VS</span><span class="token function">TEST_F</span><span class="token punctuation">(</span>ARetweetCollection<span class="token punctuation">,</span> IgnoresDuplicateTweetAdded<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Tweet <span class="token function">tweet</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"@user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Tweet <span class="token function">duplicate</span><span class="token punctuation">(</span>tweet<span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tweet<span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>duplicate<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å† Catch2 ä¸­è¿˜æ”¯æŒå¦ä¸€ç§æ–¹å¼ Given-When-Thenã€‚ç»™å®šï¼ˆGivenï¼‰ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå½“ï¼ˆWhenï¼‰<br>æµ‹è¯•è°ƒç”¨ä¸€äº›è¡Œä¸ºï¼Œç„¶åï¼ˆThenï¼‰éªŒè¯ç»“æœã€‚Given-When-Then è¡¨è¿°æ³•ç¨å¾®ä¾§é‡å¼ºè°ƒéªŒè¯è¡Œä¸ºï¼Œè€Œéæµ‹è¯•æ‰§è¡Œã€‚è¿™é‡Œçš„ SCENARIO ä¸ TEST_CASE æ²¡æœ‰åŒºåˆ«ï¼Œä»å‘½åä¸Šæ›´ç¬¦åˆ GWT è¯­ä¹‰ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">SCENARIO</span><span class="token punctuation">(</span> <span class="token string">"vectors can be sized and resized"</span><span class="token punctuation">,</span> <span class="token string">"[vector]"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">GIVEN</span><span class="token punctuation">(</span> <span class="token string">"A vector with some items"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>        std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">v</span><span class="token punctuation">(</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">WHEN</span><span class="token punctuation">(</span> <span class="token string">"the size is increased"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            v<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">THEN</span><span class="token punctuation">(</span> <span class="token string">"the size and capacity change"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">WHEN</span><span class="token punctuation">(</span> <span class="token string">"the size is reduced"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            v<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">THEN</span><span class="token punctuation">(</span> <span class="token string">"the size changes but not capacity"</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">REQUIRE</span><span class="token punctuation">(</span> v<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¿«é€Ÿæµ‹è¯•ã€æ…¢é€Ÿæµ‹è¯•ã€è¿‡æ»¤å™¨å’Œæµ‹è¯•é›†"><a href="#å¿«é€Ÿæµ‹è¯•ã€æ…¢é€Ÿæµ‹è¯•ã€è¿‡æ»¤å™¨å’Œæµ‹è¯•é›†" class="headerlink" title="å¿«é€Ÿæµ‹è¯•ã€æ…¢é€Ÿæµ‹è¯•ã€è¿‡æ»¤å™¨å’Œæµ‹è¯•é›†"></a>å¿«é€Ÿæµ‹è¯•ã€æ…¢é€Ÿæµ‹è¯•ã€è¿‡æ»¤å™¨å’Œæµ‹è¯•é›†</h3><p>å¦‚æœç¼–å†™çš„æ˜¯å°è€Œç‹¬ç«‹çš„ä»£ç å•å…ƒï¼Œé‚£ä¹ˆæ¯ä¸ªæµ‹è¯•éƒ½ä¼šè¿è¡Œå¾—å¿«å¦‚é—ªç”µã€‚é€šå¸¸ä¸€ä¸ªæµ‹è¯•åœ¨ä¸€å°é…ç½®å®Œå¤‡çš„ç”µè„‘ä¸Šçš„è¿è¡Œæ—¶é—´ä¸åˆ°ä¸€æ¯«ç§’ã€‚ä»¥è¿™ç§é€Ÿåº¦ï¼Œå‡ åˆ†é’Ÿå†…è‡³å°‘å¯ä»¥è¿è¡Œå‡ åƒä¸ªæµ‹è¯•ã€‚å¦‚æœä¸ä¸€äº›å¤–éƒ¨æ…¢é€Ÿèµ„æºï¼ˆå¦‚æ•°æ®åº“æˆ–å…¶ä»–æ…¢é€ŸæœåŠ¡ï¼‰äº¤äº’çš„è¯ï¼Œé‚£ä¹ˆæµ‹è¯•å°±ä¼šå˜æ…¢ã€‚å•å•å»ºç«‹æ•°æ®åº“è¿æ¥å°±å¯èƒ½èŠ±è´¹ 50 æ¯«ç§’ã€‚å¦‚æœå¤§éƒ¨åˆ†æµ‹è¯•å¿…é¡»ä¸æ•°æ®åº“äº¤äº’ï¼Œé‚£ä¹ˆéœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½è¿è¡Œå®Œå‡ åƒä¸ªæµ‹è¯•ã€‚æœ‰äº›å·¥ä½œå®¤éœ€è¦åŠä¸ªå¤šå°æ—¶æ‰èƒ½è¿è¡Œå®Œæ‰€æœ‰æµ‹è¯•ã€‚</p><p>è€Œ TDD çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯å°½å¯èƒ½é¢‘ç¹åœ°è·å¾—è¾ƒå¤šçš„åé¦ˆã€‚å½“ä¿®æ”¹äº†ä¸€ç‚¹ä»£ç æ—¶ï¼Œä¼šé©¬ä¸Šæƒ³çŸ¥é“æ”¹åŠ¨æ˜¯å¦æ­£ç¡®ï¼Œå½±å“åˆ°äº†å…¶ä»–ä»£ç ï¼Ÿè¿™æ—¶å¦‚æœè¿è¡Œæµ‹è¯•æ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆå°±ä¸ä¼šé¢‘ç¹çš„è¿è¡Œä»–ä»¬ï¼Œä¸€æ—¦åé¦ˆå‘¨æœŸå˜é•¿ï¼ŒTDD çš„å¨åŠ›å°±æ€¥å‰§å‡å¼±ã€‚å› ä¸ºè¶Šæ™šå¯Ÿè§‰åˆ°çš„é—®é¢˜ï¼Œä¿®æ”¹æ‰€éœ€çš„è€—è´¹å°±æ›´é•¿ã€‚</p><p>è¿è¡Œæ…¢çš„æµ‹è¯•å¯¹ TDD æ¥è¯´æ˜¯ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ä¸€äº›äººä¸å†æŠŠå®ƒä»¬ç§°ä¸ºå•å…ƒæµ‹è¯•ï¼Œè€Œæ˜¯ç§°å…¶ä¸ºé›†æˆæµ‹è¯•ã€‚</p><h4 id="è¿è¡Œæµ‹è¯•çš„ä¸€ä¸ªå­é›†"><a href="#è¿è¡Œæµ‹è¯•çš„ä¸€ä¸ªå­é›†" class="headerlink" title="è¿è¡Œæµ‹è¯•çš„ä¸€ä¸ªå­é›†"></a>è¿è¡Œæµ‹è¯•çš„ä¸€ä¸ªå­é›†</h4><p>å¯èƒ½å·²æœ‰ä¸€ä¸ªæµ‹è¯•é›†ï¼ˆTest suiteï¼‰æ¥éªŒè¯ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†è¡Œä¸ºã€‚åŒæ—¶ä¹Ÿæœ‰å¯èƒ½è¿™äº›æµ‹è¯•è¿è¡Œçš„å¾ˆæ…¢ï¼Œæœ‰æ—¶éœ€è¦æŒ‡å®šè¿è¡ŒæŸä¸€ä¸ªæµ‹è¯•å­é›†ã€‚</p><p>Google Mock å¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ªæµ‹è¯•è¿‡æ»¤å™¨è½»æ¾åœ°åšåˆ°åªè¿è¡Œä¸€ä¸ªæµ‹è¯•å­é›†ã€‚ä½ å¯ä»¥æŠŠæµ‹è¯•è¿‡æ»¤å™¨ä½œä¸ºæ‰§è¡Œæµ‹è¯•çš„å‘½ä»¤è¡Œå‚æ•°ã€‚è¿‡æ»¤å™¨çš„è¯­æ³•æ˜¯ï¼šæµ‹è¯•ç”¨ä¾‹å.æµ‹è¯•åç§°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¦è¿è¡Œä¸€ä¸ªç‰¹å®šçš„æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">./test --gtest_filter=ATweet.CanBeCopyConstructed # weak./test --gtest_filter=ATweet.* # ä½¿ç”¨é€šé…ç¬¦è¿è¡Œä¸€ç»„./test --gtest_filter=*Retweet*.*:ATweet.*:-ATweet*.*Construct* # è‡ªå®šä¹‰å¤æ‚çš„è¿‡æ»¤å™¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Catch2 ä¹ŸåŒæ ·æœ‰ä¸€äº›è¿‡æ»¤æ–¹æ³•ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">~/WorkSpace/TDD_Learning/build/test/Catch2/TestSoundex masterâ¯ ./catch2_tdd_test "[SoundexEncoding]"Filters: [SoundexEncoding]===============================================================================All tests passed (11 assertions in 11 test cases)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–­è¨€"><a href="#æ–­è¨€" class="headerlink" title="æ–­è¨€"></a>æ–­è¨€</h2><p>æ–­è¨€å¯ä»¥è¯´æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ ¸å¿ƒï¼Œå®ƒæ›¿ä»£äº†äººå·¥æŸ¥çœ‹ç»“æœã€‚ä¸€èˆ¬æµ‹è¯•æ¡†æ¶è¿è¡Œå•ä¸ªæµ‹è¯•æ—¶ï¼Œå®ƒä¼šä»å¤´åˆ°å°¾æ‰§è¡Œæµ‹è¯•ä»£ç æ®µä¸­çš„è¯­å¥ã€‚æ¯é‡åˆ°ä¸€ä¸ªæ–­è¨€ï¼Œéƒ½æ„å‘³ç€è¦å»éªŒè¯ä¸€äº›æœŸå¾…çš„ç»“æœã€‚å¦‚æœæ–­è¨€çš„æ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆæµ‹è¯•æ¡†æ¶å°±ä¸­æ­¢æµ‹è¯•ã€‚</p><p>æœ‰äº›å·¥å…·ï¼ŒåŒ…æ‹¬ Google Mock ä¸ Catch2ï¼Œæä¾›äº†å¦ä¸€ç§æ–­è¨€æœºåˆ¶ï¼Œå®ƒå…è®¸æµ‹è¯•åœ¨é‡åˆ°æ–­è¨€å¤±è´¥çš„æƒ…å†µä¸‹ç»§ç»­è¿è¡Œã€‚è¿™äº›æ–­è¨€åˆç§°ä½œéè‡´å‘½æ€§æ–­è¨€ï¼Œä¸è‡´å‘½æ€§æ–­è¨€ç›¸å¯¹ï¼Œåè€…ä¼šä¸­æ­¢æµ‹è¯•ã€‚</p><p>å…·ä½“æ–­è¨€ä½¿ç”¨æ–¹å¼è¯¦è§ï¼ŒGMock ä¸ Catch2 çš„æ–‡æ¡£ã€‚</p><h3 id="åŸºäºå¼‚å¸¸çš„æµ‹è¯•"><a href="#åŸºäºå¼‚å¸¸çš„æµ‹è¯•" class="headerlink" title="åŸºäºå¼‚å¸¸çš„æµ‹è¯•"></a>åŸºäºå¼‚å¸¸çš„æµ‹è¯•</h3><p>å¼€å‘è€…åº”å½“çŸ¥æ™“åœ¨ä»£ç æ‰§è¡Œæ—¶ä¼šå‡ºç°å“ªäº›é”™è¯¯ï¼Œä¹Ÿåº”å½“çŸ¥é“ä»€ä¹ˆæ—¶å€™æŠ›å‡ºå¼‚å¸¸ï¼Œå“ªé‡Œéœ€è¦å¼•å…¥ try-catch å—æ¥ä¿æŠ¤åº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ TDD ä¸­ï¼Œå…ˆä»ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•å¼€å§‹ï¼Œç„¶åå°†å¯¹å¼‚å¸¸çš„é¡¾è™‘åŒ–ä½œä»£ç ç¼–å†™å…¥ç³»ç»Ÿã€‚æ‰€å¾—ç»“æœå°±æ˜¯å¯ä»¥ç”¨ä½œæ–‡æ¡£ä¹‹ç”¨çš„æµ‹è¯•ï¼Œå¯ä»¥å°†æ­¤æµ‹è¯•æä¾›ç»™ä¸å¤ªæ¸…æ¥šä»£ç æ‰§è¡Œè·¯å¾„çš„å¼€å‘äººå‘˜ã€‚å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯ä»¥åœ¨æµ‹è¯•ä¸­æ‰¾åˆ°å¯èƒ½å‡ºé”™çš„åœ°æ–¹å’Œå°†ä¼šå‘ç”Ÿçš„äº‹æƒ…ã€‚æ‹¥æœ‰è¿™äº›çŸ¥è¯†çš„å®¢æˆ·ç«¯å¼€å‘è€…å¯ä»¥å¾ˆè‡ªä¿¡åœ°ä½¿ç”¨ä½ æä¾›çš„ç±»ã€‚</p><p>æœ‰äº›å•å…ƒæµ‹è¯•æ¡†æ¶å…è®¸ä½ å£°æ˜åº”è¯¥æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¦‚æœå¼‚å¸¸æ²¡æœ‰æŠ›å‡ºï¼Œåˆ™æµ‹è¯•å¤±è´¥ã€‚å¯ä»¥ç¼–å†™å¦‚ä¸‹<a href="https://github.com/catchorg/Catch2/blob/devel/docs/assertions.md#Exceptions">ä»£ç </a>ï¼Œå¦‚æœ ASSERT_ANY_TRHROW å®å†…çš„è¡¨è¾¾å¼ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆæµ‹è¯•å¤±è´¥ã€‚ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//GMock</span><span class="token function">TEST</span><span class="token punctuation">(</span>ATweet<span class="token punctuation">,</span> RequiresUserToStartWithAtSign<span class="token punctuation">)</span> <span class="token punctuation">{</span>    string <span class="token function">invalidUser</span><span class="token punctuation">(</span><span class="token string">"notStartingWith@"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_ANY_THROW</span><span class="token punctuation">(</span>Tweet <span class="token function">tweet</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> invalidUser<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// Catch2</span><span class="token function">REQUIRE_THROWS_WITH</span><span class="token punctuation">(</span> <span class="token function">openThePodBayDoors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Contains</span><span class="token punctuation">(</span> <span class="token string">"afraid"</span> <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">Contains</span><span class="token punctuation">(</span> <span class="token string">"can't do that"</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">REQUIRE_THROWS_WITH</span><span class="token punctuation">(</span> <span class="token function">dismantleHal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"My mind is going"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¢æŸ¥ç§æœ‰æˆå‘˜"><a href="#æ¢æŸ¥ç§æœ‰æˆå‘˜" class="headerlink" title="æ¢æŸ¥ç§æœ‰æˆå‘˜"></a>æ¢æŸ¥ç§æœ‰æˆå‘˜</h2><p>å¯ä»¥é’ˆå¯¹ç§æœ‰æˆå‘˜æ•°æ®ç¼–å†™æµ‹è¯•å—ï¼Ÿç§æœ‰æˆå‘˜å‡½æ•°å‘¢ï¼Ÿè¿™ä¸¤ä¸ªæ—¢ç›¸å…³åˆè¿¥å¼‚çš„è¯é¢˜ä¼šå½±å“ä½ çš„è®¾è®¡æŠ‰æ‹©ã€‚</p><h3 id="ç§æœ‰æ•°æ®"><a href="#ç§æœ‰æ•°æ®" class="headerlink" title="ç§æœ‰æ•°æ®"></a>ç§æœ‰æ•°æ®</h3><p>å¦‚é‡åˆ°äº†ä¸€äº›æƒ…å†µéœ€è¦åˆ¤æ–­ç±»çš„ç§æœ‰æ•°æ®ï¼Œä¸ºé‚£äº›éå…¬ç”¨æ¥å£çš„æˆå‘˜æä¾›è®¿é—®é€šé“æ–¹å¼æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">public</span><span class="token operator">:</span><span class="token comment" spellcheck="true">// ä»…ä»…ä¸ºäº†æµ‹è¯•çš„ç›®çš„è€Œæš´éœ²æ•°æ®ï¼›é¿å…ç›´æ¥ç”¨äºç”Ÿäº§ï¼š</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> currentWeighting<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å°†æ•°æ®æš´éœ²å‡ºæ¥ä»…ä»…æ˜¯ä¸ºäº†æµ‹è¯•ï¼Œè¿™å¯¹è®¸å¤šäººæ¥è¯´æ˜¯ä¸æ˜“æ¥å—çš„ï¼Œä½†æ›´é‡è¦çš„æ˜¯æ¸…æ¥šä½ çš„ä»£ç èƒ½æ­£å¸¸å·¥ä½œã€‚ç„¶è€Œï¼Œè¿‡é‡çš„çŠ¶æ€æµ‹è¯•æ˜¾éœ²äº†è®¾è®¡åå‘³ã€‚æ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œ<strong>å¦‚æœæš´éœ²æ•°æ®ä»…ä»…æ˜¯ä¸ºäº†æ–­è¨€ï¼Œé‚£ä¹ˆå°±éœ€è¦è€ƒè™‘ç”¨éªŒè¯è¡Œä¸ºçš„æ–¹å¼æ¥æ›¿ä»£</strong>ã€‚å‚è€ƒç¬¬ 5 ç« è·å–æ›´å¤šä¿¡æ¯ã€‚</p><h3 id="ç§æœ‰è¡Œä¸º"><a href="#ç§æœ‰è¡Œä¸º" class="headerlink" title="ç§æœ‰è¡Œä¸º"></a>ç§æœ‰è¡Œä¸º</h3><p>å¤§å¤šæ•°æ—¶å€™ï¼Œå½“ä½ è§‰å¾—éœ€è¦æµ‹è¯•ç§æœ‰è¡Œä¸ºæ—¶ï¼Œå¯ä»¥å°è¯•å°†ä»£ç ç§»åˆ°å¦ä¸€ä¸ªç±»æˆ–ä¸ºä¹‹åˆ›å»ºçš„ä¸€ä¸ªæ–°ç±»ã€‚</p><h2 id="æµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨ï¼šå‚æ•°åŒ–çš„æµ‹è¯•åŠå…¶ä»–æ–¹æ³•"><a href="#æµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨ï¼šå‚æ•°åŒ–çš„æµ‹è¯•åŠå…¶ä»–æ–¹æ³•" class="headerlink" title="æµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨ï¼šå‚æ•°åŒ–çš„æµ‹è¯•åŠå…¶ä»–æ–¹æ³•"></a>æµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨ï¼šå‚æ•°åŒ–çš„æµ‹è¯•åŠå…¶ä»–æ–¹æ³•</h2><p>å°½ç®¡æµ‹è¯•é©±åŠ¨å¼€å‘ä¸­æœ‰æµ‹è¯•ä¸¤ä¸ªå­—ï¼Œä½†æ˜¯å®ƒæ›´å¤šåœ°ä¸è®¾è®¡æœ‰å…³ï¼Œè€Œéæµ‹è¯•ã€‚åœ¨ TDD è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šç¼–å†™å•å…ƒæµ‹è¯•ï¼Œä½†å®ƒä»¬åŸºæœ¬å°±æ˜¯ä¸€äº›å‰¯äº§å“ã€‚è²Œä¼¼å·®åˆ«ä¸å¤§ï¼Œä½† TDD çš„çœŸæ­£ç›®çš„æ˜¯è®©ä½ ä¸€ç›´ä¿æŒè®¾è®¡æ•´æ´ï¼Œè¿™æ ·åœ¨å¼•å…¥æ–°çš„è¡Œä¸ºæˆ–æ”¹å˜ç°æœ‰è¡Œä¸ºæ—¶ï¼Œä½ ä¼šæ›´ä»å®¹è‡ªä¿¡ï¼Œå¹¶ä¸”ä¸ä¼šå¤ªè´¹åŠ›ã€‚</p><p>ä»æµ‹è¯•çš„è§’åº¦çœ‹ï¼Œä½ å¯»æ±‚çš„æ˜¯åˆ›å»ºå…·æœ‰é«˜è¦†ç›–ç‡çš„æµ‹è¯•ã€‚æ‰€å†™çš„æµ‹è¯•æœ‰äº”ç±»ï¼šæ— ï¼ˆzeroï¼‰ã€æœ‰ï¼ˆoneï¼‰ã€å¤šï¼ˆmanyï¼‰ã€è¾¹ç•Œï¼ˆboundaryï¼‰å’Œå¼‚å¸¸ï¼ˆexceptionalï¼‰æƒ…å½¢ã€‚è€Œä»æµ‹è¯•é©±åŠ¨è§’åº¦æ¥çœ‹ï¼Œä½ å†™æµ‹è¯•çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯ä»£ç èƒ½å¤Ÿç¬¦åˆé¢„å®šè§„èŒƒã€‚è™½ç„¶æµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨éƒ½èƒ½å¤Ÿä¿è¯ä½ æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒå»å‘å¸ƒä»£ç ï¼Œä½†æ˜¯ä¸€æ—¦å¯¹æ‰€æ„å»ºçš„ä¸œè¥¿æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒï¼Œå°±å¯ä»¥åœæ­¢ TDDã€‚ä¸æ­¤ç›¸åï¼Œä¼˜ç§€çš„æµ‹è¯•äººå‘˜ä¼šç«­å°½æ‰€èƒ½åœ°å»è¦†ç›–ä¸Šé¢æ‰€è¯´çš„äº”ç±»æƒ…å½¢ã€‚</p><p>ä½ å¯ä»¥åœ¨æµ‹è¯•é©±åŠ¨å¼€å‘æ—¶ç¼–å†™é¢å¤–çš„äº‹åæµ‹è¯•ã€‚ä½†é€šå¸¸è€Œè¨€ï¼Œä¸€æ—¦ä½ è®¤ä¸ºä½ æœ‰ä¸€ä¸ªæ­£ç¡®ä¸”å¹²å‡€çš„å®ç°ï¼Œå¹¶ä¸”è¿™ä¸ªå®ç°èƒ½è¦†ç›–ä½ è¦æ”¯æŒçš„æƒ…å½¢ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç«‹åˆ»åœæ­¢ã€‚<strong>æ¢å¥è¯è¯´ï¼Œåœ¨ä½ æƒ³ä¸å‡ºå¯ä»¥å†™å‡ºä¸èƒ½é€šè¿‡çš„æµ‹è¯•æ—¶ï¼Œå°±å¯ä»¥åœæ­¢ã€‚</strong></p><p>ç°åœ¨ä»¥ç½—é©¬æ•°å­—è½¬æ¢å™¨ä¸ºä¾‹ï¼Œå®ƒå¯ä»¥å°†é˜¿æ‹‰ä¼¯æ•°å­—è½¬æ¢ä¸ºå¯¹åº”çš„ç½—é©¬æ•°å­—ã€‚ä¼˜ç§€çš„æµ‹è¯•äººå‘˜å¯èƒ½è‡³å°‘ä¼šæµ‹è¯•å‡ åä¸ªè½¬æ¢ï¼Œä»¥ç¡®ä¿èƒ½è¦†ç›–å„ç§æ•°å­—å’Œç»„åˆã€‚ç›¸åï¼Œåœ¨æµ‹è¯•é©±åŠ¨å¼€å‘è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæœ¬æ–‡åœ¨æµ‹è¯•å®Œåå‡ ä¸ªè½¬æ¢åå°±å¯ä»¥åœä¸‹æ¥ã€‚æ­¤æ—¶ï¼Œæˆ‘æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒä¿è¯ä½ å·²ç»å¼€å‘å‡ºäº†æ­£ç¡®çš„ç®—æ³•ï¼Œå‰©ä¸‹çš„å·¥ä½œä»…ä»…æ˜¯å®Œæˆé˜¿æ‹‰ä¼¯æ•°å­—åˆ°ç½—é©¬æ•°å­—çš„è½¬æ¢è¡¨ã€‚</p><p><strong>åœ¨æµ‹è¯•é©±åŠ¨å¼€å‘æ—¶ï¼Œè¿½æ±‚çš„æ˜¯å¿«é€Ÿä¸”ç‹¬ç«‹çš„æµ‹è¯•ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿™ç§æµ‹è¯•é—´çš„ä¾èµ–å…³ç³»ï¼Œå› ä¸ºå®ƒä¼šè®©äº‹æƒ…å˜å¾—å¤æ‚ã€‚</strong></p><h3 id="å‚æ•°åŒ–æµ‹è¯•"><a href="#å‚æ•°åŒ–æµ‹è¯•" class="headerlink" title="å‚æ•°åŒ–æµ‹è¯•"></a>å‚æ•°åŒ–æµ‹è¯•</h3><p>ä»¥ä¸€ä¸ªç®€å•çš„åä¸º Adder ç±»ä¸¾ä¾‹ï¼Œè¾“å…¥å‚æ•°æµ‹è¯•åŠŸèƒ½ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Adder</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> A<span class="token punctuation">,</span> <span class="token keyword">int</span> B<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> A <span class="token operator">+</span> B<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"GeneratesASumFromTwoNumbers"</span><span class="token punctuation">,</span> <span class="token string">"AnAdder"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>Adder<span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€ä¸ªç®€å•çš„ sum å‡½æ•°å®ç°æµ‹è¯•ï¼Œå‡å¦‚æƒ³è¦åŠ å…¥æ›´å¤šçš„å‚æ•°æ¥è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•°ç”Ÿæˆå™¨:</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"BulkTest"</span><span class="token punctuation">,</span> <span class="token string">"AnAdder"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">using</span> std<span class="token operator">::</span>make_tuple<span class="token punctuation">;</span>    size_t TestInputA<span class="token punctuation">,</span> TestInputB<span class="token punctuation">,</span> ExpectOutPut<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// clang-format off</span>    std<span class="token operator">::</span><span class="token function">tie</span><span class="token punctuation">(</span>TestInputA<span class="token punctuation">,</span> TestInputB<span class="token punctuation">,</span> ExpectOutPut<span class="token punctuation">)</span> <span class="token operator">=</span>        <span class="token function">GENERATE</span><span class="token punctuation">(</span>table<span class="token operator">&lt;</span>size_t<span class="token punctuation">,</span> size_t<span class="token punctuation">,</span> size_t<span class="token operator">></span><span class="token punctuation">(</span>                <span class="token punctuation">{</span>                    <span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">make_tuple</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">}</span>            <span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//clang-format on</span>    <span class="token function">CAPTURE</span><span class="token punctuation">(</span>TestInputA<span class="token punctuation">,</span> TestInputB<span class="token punctuation">,</span> ExpectOutPut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//ç”¨äºè®°å½•æ•°æ®ä¿¡æ¯ log</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>Adder<span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">(</span>TestInputA<span class="token punctuation">,</span> TestInputB<span class="token punctuation">)</span> <span class="token operator">==</span> ExpectOutPut<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³äº gmock çš„å‚æ•°ç”Ÿæˆå™¨ä½¿ç”¨æ–¹æ³•ï¼Œ<a href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/test/Gmock/ParameterizedTest">è¯¦è§é…å¥—çš„å·¥ç¨‹ä»£ç </a>ã€‚</p><h3 id="æµ‹è¯•ä¸­çš„æ³¨é‡Š"><a href="#æµ‹è¯•ä¸­çš„æ³¨é‡Š" class="headerlink" title="æµ‹è¯•ä¸­çš„æ³¨é‡Š"></a>æµ‹è¯•ä¸­çš„æ³¨é‡Š</h3><p>æ³¨é‡Šä¸æ˜¯æµ‹è¯•å·¥å…·çš„ç‰¹æ€§è€Œæ˜¯ä¸€ä¸ªè¯­è¨€ç‰¹æ€§ã€‚åœ¨äº§å“ä»£ç å’Œæµ‹è¯•ä»£ç ä¸­ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯å°½é‡å°†æ³¨é‡ŠåŒ–ä¸ºæ›´å…·è¡¨è¾¾åŠ›çš„ä»£ç ã€‚æ‰€å‰©çš„æ³¨é‡Šåªå›ç­”ç±»ä¼¼ä¸‹é¢çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆæˆ‘ä¼šè¿™æ ·ç¼–å†™ä»£ç ï¼Ÿ</p><p>é™¤äº†å›ç­”æ­¤ç±»â€œä¸ºä»€ä¹ˆâ€ï¼Œå¦‚æœä½ è¦åŠ æ³¨é‡Šæ¥é˜æ˜æµ‹è¯•çš„è¯ï¼Œé‚£å°±ç³Ÿç³•é€é¡¶äº†ã€‚æµ‹è¯•åº”å½“æ¸…æ¥šåœ°é˜æ˜ç±»çš„åŠŸèƒ½ã€‚ä½ æ€»æ˜¯å¯ä»¥ç”¨ä¸€ç§æ— éœ€ä½¿ç”¨é˜è¿°æ€§æ³¨é‡Šçš„æ–¹æ³•æ¥é‡å‘½åå’Œç»„ç»‡æµ‹è¯•ã€‚</p><p>å¯ä»¥ç”¨ä¸€å¥è¯æŠŠè¿™ä¸€ç‚¹è¯´å¾—æ›´æ¸…æ¥šï¼šä¸è¦ç”¨æè¿°æ€§çš„æ³¨é‡Šæ¥æ€»ç»“æµ‹è¯•ï¼Œè€Œæ˜¯ä¿®æ”¹æµ‹è¯•åç§°ä»¥è¾¾åˆ°æè¿°æ•ˆæœã€‚ä¸è¦å¼•å¯¼è¯»è€…é€šè¿‡æ³¨é‡Šæ¥ç†è§£æµ‹è¯•ã€‚è¦æ•´ç†æµ‹è¯•ä¸­çš„æ­¥éª¤ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬ç« è®²è§£äº†å¦‚ä½•ç»„ç»‡å•å…ƒæµ‹è¯•ä»£ç ï¼ŒåŒ…æ‹¬äº†æºç æ–‡ä»¶ä»¥åŠä»£ç ç»“æ„ä¸Šå¦‚ä½•è¿›è¡Œã€‚</p><p>é’ˆå¯¹æµ‹è¯•é›†çš„å¤§å°åˆ†å¸ƒï¼Œä»¥åŠæ–­è¨€ç›¸å…³æ¦‚å¿µè¿›è¡Œäº†ä»‹ç»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ï¼ˆä¸‰ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--åŸºç¡€æ¦‚å¿µ</title>
      <link href="/2022/06/02/san-ce-shi-qu-dong-kai-fa-ji-qiao-ji-chu-gai-nian/"/>
      <url>/2022/06/02/san-ce-shi-qu-dong-kai-fa-ji-qiao-ji-chu-gai-nian/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ‹è¯•é©±åŠ¨å¼€å‘åŸºç¡€"><a href="#æµ‹è¯•é©±åŠ¨å¼€å‘åŸºç¡€" class="headerlink" title="æµ‹è¯•é©±åŠ¨å¼€å‘åŸºç¡€"></a>æµ‹è¯•é©±åŠ¨å¼€å‘åŸºç¡€</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li>ç»è¿‡å‰ä¸€ç« çš„ä»‹ç»æƒ³å¿…å¯¹äº TDD çš„å®è·µæœ‰äº†ä¸ªäº†è§£ï¼Œæœ¬ç« å¼€å§‹å°†ä¼šæ·±å…¥å…¶ä¸­ï¼Œå¯¹äºå…¶æ¦‚å¿µå¼€å§‹è¯¦ç»†çš„åˆ†æã€‚</li></ul><h2 id="å•å…ƒæµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨å¼€å‘åŸºç¡€"><a href="#å•å…ƒæµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨å¼€å‘åŸºç¡€" class="headerlink" title="å•å…ƒæµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨å¼€å‘åŸºç¡€"></a>å•å…ƒæµ‹è¯•å’Œæµ‹è¯•é©±åŠ¨å¼€å‘åŸºç¡€</h2><p>TDD ä¼šäº§å‡ºå•å…ƒæµ‹è¯•ã€‚å•å…ƒæµ‹è¯•éªŒè¯äº†ä¸€ä¸ªä»£ç å•å…ƒçš„è¡Œä¸ºï¼Œè¿™é‡Œçš„ä»£ç å•å…ƒæ˜¯ä¸€ä¸ªåº”ç”¨ä¸­æœ€å°çš„ã€å¯æµ‹çš„ä¸€æ®µä»£ç ã€‚é€šå¸¸è€Œè¨€ï¼Œå¼€å‘å•å…ƒæµ‹è¯•å’Œä»£ç å•å…ƒè¦ä½¿ç”¨ä¸€è‡´çš„ç¼–ç¨‹è¯­è¨€ã€‚</p><h3 id="å•å…ƒæµ‹è¯•çš„ç»„ç»‡å’Œæ‰§è¡Œ"><a href="#å•å…ƒæµ‹è¯•çš„ç»„ç»‡å’Œæ‰§è¡Œ" class="headerlink" title="å•å…ƒæµ‹è¯•çš„ç»„ç»‡å’Œæ‰§è¡Œ"></a>å•å…ƒæµ‹è¯•çš„ç»„ç»‡å’Œæ‰§è¡Œ</h3><ul><li>å•å…ƒæµ‹è¯•åŒ…æ‹¬ä¸€ä¸ªæè¿°æ€§çš„åç§°å’Œä¸€ç³»åˆ—ä»£ç å£°æ˜ï¼Œä»æ¦‚å¿µä¸Šå¯ä»¥ç»†åˆ†æˆå››ä¸ªï¼ˆæœ‰åºçš„ï¼‰éƒ¨åˆ†ï¼š<ol><li>è®¾ç½®èƒ½å¤Ÿè¿è¡Œä¸Šä¸‹æ–‡çš„è¯­å¥ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼›</li><li>ä¸€æ¡æˆ–å¤šæ¡èƒ½æ„æˆä½ æƒ³è¦éªŒè¯çš„è¡Œä¸ºçš„è¯­å¥ï¼›</li><li>ä¸€æ¡æˆ–å¤šæ¡éªŒè¯æœŸæœ›è¾“å‡ºçš„è¯­å¥ï¼›</li><li>æ¸…ç†å·¥ä½œçš„è¯­å¥ï¼ˆä¾‹å¦‚ï¼Œé‡Šæ”¾æ‰€åˆ†é…çš„å†…å­˜ï¼‰ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯å¯é€‰çš„ã€‚</li></ol></li></ul><p>æ‰§è¡Œä¸€éæ‰€æœ‰çš„æµ‹è¯•ç§°ä¸ºè¿è¡Œæµ‹è¯•ï¼ˆtest run æˆ– suite runï¼‰ã€‚åœ¨è¿è¡Œæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>å·¥å…·ä¼šæšä¸¾æ‰€æœ‰çš„æµ‹è¯•ï¼Œç‹¬ç«‹åœ°æ‰§è¡Œæ¯ä¸ªæµ‹è¯•</strong>ã€‚å¯¹äºæ¯ä¸ªæµ‹è¯•æ¥è¯´ï¼Œæµ‹è¯•å·¥å…·éƒ½æ˜¯ä»å¤´åˆ°å°¾æ‰§è¡Œå…¶ä¸­çš„è¯­å¥çš„ã€‚å½“æ‰§è¡Œä¸€æ¡æ–­è¨€è¯­å¥æ—¶ï¼Œå¦‚æœæ–­è¨€æ‰€æœŸå¾…çš„æ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆæµ‹è¯•å°±ä¼šå¤±è´¥ã€‚åä¹‹ï¼Œæµ‹è¯•é€šè¿‡ã€‚</p><h3 id="æµ‹è¯•é©±åŠ¨å•å…ƒ"><a href="#æµ‹è¯•é©±åŠ¨å•å…ƒ" class="headerlink" title="æµ‹è¯•é©±åŠ¨å•å…ƒ"></a>æµ‹è¯•é©±åŠ¨å•å…ƒ</h3><ul><li><p><strong>TDD çš„å¥½å¤„?</strong></p><ul><li>ä¸ POUT å³å¼€å‘å®Œæˆåå†ç¼–å†™æµ‹è¯•ä¸åŒï¼ŒTDD äº‹ä¸€ä¸ªæ›´åŠ ç®€æ˜çš„æµç¨‹ï¼Œå¹¶ä¸”ä¹Ÿä½¿ç”¨äº†å•å…ƒæµ‹è¯•ã€‚åœ¨ TDD ä¸­å…ˆç¼–å†™æµ‹è¯•ï¼Œå¹¶ä¸”ä¿æŒæµ‹è¯•çš„ç²’åº¦å°½é‡å°ä¸”ä¸€è‡´ï¼Œè¿™æ ·ä¼šå¸¦æ¥è®¸å¤šå¥½å¤„ï¼Œæœ€é‡è¦çš„æ˜¯å¯ä»¥å®‰å…¨åœ°ä¿®æ”¹ç°æœ‰ä»£ç ã€‚</li></ul></li><li><p><strong>æ€ä¹ˆè¿›è¡Œ TDD?</strong></p><ul><li>åœ¨ TDD ä¸­ï¼Œæ˜¯ä»¥éå¸¸å°çš„æ­¥ä¼ï¼Œå¢é‡åœ°å¾€ç³»ç»Ÿä¸­æ·»åŠ æ–°è¡Œä¸ºã€‚æ¢å¥è¯è¯´ï¼Œä¸ºäº†å¾€ç³»ç»Ÿä¸­åŠ å…¥æ–°çš„è¡Œä¸ºï¼Œé¦–å…ˆä¼šå»å†™ä¸€ä¸ªæµ‹è¯•æ¥å®šä¹‰è¿™ä¸ªè¡Œä¸ºã€‚è¿™ä¸ªèµ·åˆè¿è¡Œå¤±è´¥çš„æµ‹è¯•å°†é©±ä½¿ä½ å»å®ç°ç›¸åº”çš„è¡Œä¸ºã€‚</li></ul></li><li><p><strong>TDD ä¸åŠŸèƒ½æµ‹è¯•çš„åŒºåˆ«ï¼Ÿ</strong></p><ul><li>TDD ä¸åº”è¯¥å’Œå¤§é‡åŠŸèƒ½çš„æµ‹è¯•æ··æ·†ã€‚ä¸»è¦åŒºåˆ«åœ¨äºï¼Œè¦†ç›–äº†å¤§é‡åŠŸèƒ½çš„æµ‹è¯•æ˜¯ä¸å…¶ä»–ä»£ç æˆ–è€…å¤–éƒ¨å®ä½“é›†æˆåçš„æ•´ä½“åŠŸèƒ½ï¼Œä¸€èˆ¬è¢«ç§°ä¸ºé›†æˆæµ‹è¯•ã€‚æ­¤ç±»æµ‹è¯•åº”åœ¨éªŒæ”¶æˆ–è€…ç³»ç»Ÿæµ‹è¯•æ—¶è¿›è¡Œã€‚</li><li>TDD ä¸»å¯¼çš„æ˜¯äº§ç”Ÿå•å…ƒæµ‹è¯•ï¼Œæ˜¯å»è¦†ç›–æœ€å°çš„é€»è¾‘ä»£ç å•å…ƒçš„æµ‹è¯•ç”¨ä¾‹ã€‚è™½è¯´ TDD åœ¨å¤±è´¥æµ‹è¯•é€šè¿‡æ—¶æ‰ç¼–å†™äº§å“ä»£ç çš„è§„åˆ™ï¼Œå¾€å¾€ä¼šæŒ‡å¼•è€…å¼€å‘è€…ä¸å¤–éƒ¨å®ä½“ä»£ç è¿›è¡Œäº¤äº’ï¼Œè¿›è€Œå˜æˆé›†æˆæµ‹è¯•ï¼Œä½†æ˜¯è€…æ²¡æœ‰å…³ç³»ã€‚<strong>é‡è¦çš„æ˜¯ç°æŒ‡å®šè¡Œä¸ºï¼Œç³»ç»Ÿåœ°æµ‹è¯•é©±åŠ¨å¼€å‘ç³»ç»Ÿä¸­çš„æ¯ä¸€å—ä»£ç </strong>ã€‚</li></ul></li></ul><h2 id="æµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸï¼šçº¢-ç»¿-é‡æ„"><a href="#æµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸï¼šçº¢-ç»¿-é‡æ„" class="headerlink" title="æµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸï¼šçº¢ - ç»¿ - é‡æ„"></a>æµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸï¼šçº¢ - ç»¿ - é‡æ„</h2><p>å°±åƒç¬¬äºŒç« ä¸­æè¿°çš„æ­¥éª¤ä¸€æ ·ï¼š</p><ol><li>å…ˆå†™ä¸€ä¸ªæµ‹è¯•ï¼ˆâ€œçº¢â€ï¼‰ï¼›</li><li>è®©æµ‹è¯•é€šè¿‡ï¼ˆâ€œç»¿â€ï¼‰ï¼›</li><li>ä¼˜åŒ–è®¾è®¡ï¼ˆâ€œé‡æ„â€ï¼‰ã€‚</li></ol><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/TDD/1_TDD_Process.png" alt="TDDProcess"></p><h3 id="æ€è€ƒæµ‹è¯•é©±åŠ¨å¼€å‘"><a href="#æ€è€ƒæµ‹è¯•é©±åŠ¨å¼€å‘" class="headerlink" title="æ€è€ƒæµ‹è¯•é©±åŠ¨å¼€å‘"></a>æ€è€ƒæµ‹è¯•é©±åŠ¨å¼€å‘</h3><ul><li><p>æ€»çš„æ¥è¯´ TDD è¿‡ç¨‹éœ€è¦æ€è€ƒä¸¤ä»¶äº‹æƒ…ï¼š</p><ol><li>éœ€è¦ç¼–å†™ä¸€ä¸ªæµ‹è¯•è¯´æ˜è¡Œä¸ºï¼›</li><li>æ¯ä¸ªå‘¨æœŸéƒ½è¦æ¸…ç†ä»£ç ã€‚</li></ol></li><li><p>åœ¨ TDD å‘¨æœŸä¸­çš„æ¯ä¸€æ­¥ï¼Œä½ å¿…é¡»èƒ½å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>å†™ä¸€ä¸ªå°æµ‹è¯•ï¼š<ul><li>æ€æ ·æ‰ç®—å¯ä»¥å¢é‡å¼€å‘çš„æœ€å°è¡Œä¸ºï¼Ÿ</li><li>ç³»ç»Ÿä¸­å·²ç»å­˜åœ¨è¿™æ ·çš„è¡Œä¸ºäº†ä¹ˆï¼Ÿ</li><li>æ€æ ·è®©æµ‹è¯•åç§°å‡†ç¡®è¡¨è¾¾è¡Œä¸ºï¼Ÿ</li><li>æµ‹è¯•ä¸­ä½¿ç”¨çš„æ¥å£æ˜¯å®¢æˆ·ç«¯ä»£ç ä½¿ç”¨è¿™ä¸€è¡Œä¸ºæœ€å¥½çš„æ–¹å¼å—ï¼Ÿ</li></ul></li><li>ç¡®ä¿æ–°çš„æµ‹è¯•æ˜¯å¤±è´¥çš„ï¼š<ul><li>å¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li><li>è¿™ä¸ªè¡Œä¸ºå·²ç»åœ¨ç³»ç»Ÿä¸­å­˜åœ¨äº†ä¹ˆï¼Ÿ</li><li>æ˜¯å¦æ˜¯å¿˜è®°äº†ç¼–è¯‘å·®å¼‚ä»£ç ï¼Ÿ</li><li>æ˜¯ä¸æ˜¯åœ¨ä¸Šä¸€ä¸ªæµ‹è¯•ä¸­æ­¥ä¼å¤ªå¤§äº†ï¼ŒåŒ…å«äº†å¤šä¸ªè¡Œä¸ºï¼Ÿ</li><li>æ–­è¨€æ˜¯å¦æœ‰æ•ˆï¼Ÿ</li></ul></li><li>å†™å‡ºä½ è®¤ä¸ºå¯ä»¥è®©æµ‹è¯•é€šè¿‡çš„ä»£ç ï¼š<ul><li>ä»£ç æ˜¯ä¸æ˜¯åˆšå¥½æ»¡è¶³æµ‹è¯•è¯´æ˜çš„è¡Œä¸ºè¦æ±‚ï¼Ÿ</li><li>ä½ æ¸…æ¥šåˆšæ‰å†™çš„ä»£ç ä¸­å“ªäº›åœ°æ–¹éœ€è¦æ•´ç†ä¹ˆï¼Ÿ</li><li>æ˜¯å¦éµå¾ªäº†å›¢é˜Ÿæ ‡å‡†ï¼Ÿ</li></ul></li><li>ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½èƒ½é€šè¿‡ï¼š<ul><li>å¦‚æœæ²¡æœ‰ï¼Œä½ çš„ç¼–ç æ˜¯å¦æ­£ç¡®ï¼Ÿ</li><li>ä½ çš„è§„èŒƒæ­£ç¡®ä¹ˆï¼Ÿ</li></ul></li><li>æ•´ç†åˆšæ‰çš„ä»£ç æ”¹åŠ¨ï¼š<ul><li>æ€ä¹ˆåšæ‰èƒ½ä½¿ä½ çš„ä»£ç ç¬¦åˆå›¢é˜Ÿæ ‡å‡†ï¼Ÿ</li><li>æ–°çš„ä»£ç å’Œç³»ç»Ÿä¸­å…¶ä»–è¦æ¸…é™¤çš„ä»£ç æœ‰é‡å¤ä¹ˆï¼Ÿ</li><li>ä»£ç æœ‰æ²¡æœ‰åå‘³ï¼Ÿ</li><li>éµå¾ªå¥½çš„è®¾è®¡åŸåˆ™äº†å—ï¼Ÿ</li><li>é™¤äº†å½“ä¸‹è¦åšçš„è®¾è®¡å’Œä»£ç æ•´ç†å·¥ä½œï¼Œä½ è¿˜çŸ¥é“å…¶ä»–ä»€ä¹ˆï¼Ÿ</li><li>è®¾è®¡æ˜¯æœå¥½çš„æ–¹å‘å‘å±•å—ï¼Ÿ</li><li>ä½ çš„ä»£ç æ”¹åŠ¨ä¼šå¯¼è‡´éœ€è¦ä¿®æ”¹å…¶ä»–åœ°æ–¹çš„ä»£ç å—ï¼Ÿ</li></ul></li><li>ç¡®ä¿æ‰€æœ‰æµ‹è¯•å†æ¬¡é€šè¿‡ï¼š<ul><li>ç¡®ä¿¡ä½ çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡å¤Ÿé«˜å—ï¼Ÿ</li><li>æ˜¯ä¸æ˜¯åº”è¯¥è¿è¡Œä¸€äº›é€Ÿåº¦è¾ƒæ…¢çš„æµ‹è¯•é›†åˆï¼Œä»¥ä¾¿æœ‰ä¿¡æ¯ç»§ç»­å‰è¡Œï¼Ÿ</li><li>ä¸‹ä¸€ä¸ªæµ‹è¯•æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul></li></ol></li></ul><h2 id="TDD-çš„ä¸‰æ¡å‡†åˆ™"><a href="#TDD-çš„ä¸‰æ¡å‡†åˆ™" class="headerlink" title="TDD çš„ä¸‰æ¡å‡†åˆ™"></a>TDD çš„ä¸‰æ¡å‡†åˆ™</h2><ul><li>Robert C. Martinï¼ˆBob å¤§å”ï¼‰æå‡ºäº†è·µè¡Œ TDD çš„<a href="http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd">ç®€æ˜è§„åˆ™</a>ã€‚<ol><li>åªåœ¨è®©å¤±è´¥æµ‹è¯•é€šè¿‡æ—¶æ‰ç¼–å†™äº§å“ä»£ç ã€‚</li><li>å½“æµ‹è¯•åˆšå¥½å¤±è´¥æ—¶ï¼Œåœæ­¢ç»§ç»­ç¼–å†™ã€‚ç¼–è¯‘å¤±è´¥ä¹Ÿæ˜¯å¤±è´¥ã€‚</li><li>åªç¼–å†™èƒ½åˆšå¥½è®©ä¸€ä¸ªå¤±è´¥æµ‹è¯•é€šè¿‡çš„äº§å“ä»£ç ã€‚</li></ol></li></ul><h2 id="è¡¨é‡Œä¸ä¸€"><a href="#è¡¨é‡Œä¸ä¸€" class="headerlink" title="è¡¨é‡Œä¸ä¸€"></a>è¡¨é‡Œä¸ä¸€</h2><p>TDD çš„ç¬¬ä¸€æ¡å‡†åˆ™ä¾¿æ˜¯åœ¨ç¼–å†™ä»£ç å‰å…ˆå†™å‡ºä¸€ä¸ªè¿è¡Œå¤±è´¥çš„æµ‹è¯•ï¼Œä½†æ˜¯ç»å¸¸åœ¨å¼€å‘ä¸­ç¢°åˆ°åˆšåˆšå†™å®Œä¸€ä¸ªæµ‹è¯•ç«‹åˆ»å°±é€šè¿‡äº†ï¼Œè¿™ç§éæœŸæœ›å®è·µäº§ç”Ÿçš„å¯èƒ½åŸå› ï¼š</p><ol><li><p>è¿è¡Œäº†é”™è¯¯çš„æµ‹è¯•ï¼›</p><ul><li>è¿è¡Œäº†é”™è¯¯çš„æµ‹è¯•é›†ã€‚</li><li>å¯èƒ½æ–°å¢çš„æµ‹è¯•æ²¡æœ‰è¢«ç¼–è¯‘è¿›å…¥æ‰§è¡Œç¨‹åºï¼Œæµ‹è¯•æ¡†æ¶çš„æµ‹è¯•ç”¨ä¾‹æ•°é‡éœ€è¦æ—¶åˆ»å…³æ³¨ã€‚</li><li>æµ‹è¯•æ¡†æ¶çš„ç§ç§è¿‡æ»¤å™¨ç”¨æ³•ï¼Œæ˜¯å¦æ˜¯æ–°å¢çš„æµ‹è¯•è¢«è¿‡æ»¤äº†ã€‚</li><li>æµ‹è¯•è¢«å…³é—­ã€ç¦æ­¢äº†ã€‚</li></ul></li><li><p>æµ‹è¯•äº†é”™è¯¯çš„ä»£ç ï¼›</p><ul><li>æ²¡æœ‰åŒ…å«æœ€æ–°çš„æµ‹è¯•ä»£ç ã€‚</li><li>æ²¡æœ‰æ³¨æ„åˆ°æ„å»ºå¤±è´¥äº†ã€‚</li><li>æ„å»ºè„šæœ¬æœ‰ç¼ºé™·ï¼Œæ²¡æœ‰æ–°å¢æµ‹è¯•ä»£ç ã€‚</li><li>ä½ åœ¨æµ‹è¯•é”™è¯¯çš„ç±»ã€‚åŒåæ›¿èº«ç±»è¿™äº›ã€‚</li></ul></li><li><p>ä¸å½“çš„æµ‹è¯•è§„èŒƒï¼›</p><ul><li>ç±»ä¼¼ä¸‹ä¾‹è¿™ç§ï¼Œæ–­è¨€çš„ç›®æ ‡ä¸æµ‹è¯•æè¿°çš„è¡Œä¸ºä¸ç¬¦ã€‚</li></ul><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APortfolio<span class="token punctuation">,</span> IsEmptyWhenCreated<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>portfolio<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>å¯¹ç³»ç»Ÿçš„æ— æ•ˆå‡è®¾ï¼›</p><ul><li>å†™äº†ä¸€ä¸ªæµ‹è¯•ï¼Œå®ƒä¸€è¿è¡Œå°±é€šè¿‡äº†ã€‚ä¹‹æ‰€ä»¥å†™æµ‹è¯•ç”¨ä¾‹æ˜¯å› ä¸ºæœ€å¼€å§‹å‡è®¾è¿™ä¸ªè¡Œä¸ºå¹¶æ²¡æœ‰å®ç°ã€‚è¿™ä¸ªé€šè¿‡çš„æµ‹è¯•æé†’äº†ä½ ä¹‹å‰çš„å‡è®¾æ˜¯é”™è¯¯çš„ã€‚è¿™æ—¶éœ€è¦åœä¸‹æ¥ï¼Œå°±å‰é¢å·²æ·»åŠ çš„è¡Œä¸ºæ¥åˆ†æç³»ç»Ÿè¿™ä¸ªè¡Œä¸ºçš„å®ç°æ˜¯å¦åˆç†ã€‚</li></ul></li><li><p>ä¸ä½³çš„æµ‹è¯•é¡ºåºï¼›</p><ul><li>æµ‹è¯•ç”¨ä¾‹ä¹‹é—´ä¸è¦å­˜åœ¨è€¦åˆå…³ç³»ï¼Œæ¯ä¸ªå•å…ƒæµ‹è¯•éƒ½åº”è¯¥æ˜¯ç‹¬ç«‹ä¸å—é¡ºåºå½±å“çš„ã€‚</li></ul></li><li><p>ç›¸å…³è”çš„äº§å“ä»£ç ï¼›</p></li><li><p>è¿‡åº¦ç¼–ç ï¼›</p><ul><li>åœ¨å¼€å‘åŠŸèƒ½çš„è¿‡ç¨‹ä¸­å¾€å¾€ä¼šæœ‰ä¸‹æ„è¯†æ›´å¥½çš„è§£å†³æ–¹æ³•ï¼Œä¾‹å¦‚å¼•å…¥æ–°çš„æ•°æ®ç»“æ„ç­‰ç­‰ï¼Œä½†æ˜¯å…¶å¯èƒ½å¯¼è‡´åç»­è®¸å¤šçš„æµ‹è¯•ç”¨ä¾‹æå‰é€šè¿‡ï¼Œå¦‚æœä½ æƒ³æˆåŠŸè¿ç”¨ TDDï¼Œå°±å¿…é¡»ç¡®ä¿å¢é‡åœ°å¼•å…¥è¿™äº›æƒ³æ³•ï¼Œå¹¶é…ä»¥ç›¸åº”çš„æµ‹è¯•ã€‚æœ‰æ—¶å€™ä½ ä¼šè§‰å¾—è‡ªå·±ç”šè‡³ä¸éœ€è¦ä¸€ä¸ª mapã€‚ä¸æ­¤åŒæ—¶ï¼Œä¸åšå¤šä½™éœ€æ±‚çš„å®ç°å¯ä»¥ä¿æŒä»£ç ç®€å•ã€‚è¿™æ ·åšä¹Ÿå¯ä»¥é¿å…åœ¨å­˜åœ¨æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œå¼•å…¥é•¿æ—¶é—´çš„è¿‡åº¦å¤æ‚çš„ä»£ç ã€‚</li></ul></li><li><p>ç¡®å®šæ€§æµ‹è¯•ã€‚</p><ul><li>æœ‰æ—¶å€™ä½ å¹¶ä¸çŸ¥é“ä»£ç åœ¨ä¸€äº›ç‰¹å®šæƒ…å½¢ä¸‹æ˜¯æ€æ ·å·¥ä½œçš„ã€‚ä½ è®¤ä¸º TDD çš„ä»£ç åº”è¯¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œä½†å¹¶ä¸ç¡®å®šã€‚â€œæˆ‘ä»¬çš„ç®—æ³•å¤„ç†è¿™ä¸€æƒ…å½¢äº†å—ï¼Ÿâ€ä½ å¯ä»¥æœ‰é’ˆå¯¹æ€§åœ°å†™ä¸€ä¸ªæµ‹è¯•æ¥æ¢æµ‹ç³»ç»Ÿè¡Œä¸ºã€‚</li></ul></li><li><p>æ€è€ƒï¼š</p><ul><li>æµ‹è¯•æå‰é€šè¿‡çš„æƒ…å†µåº”è¯¥å¾ˆå°‘è§ã€‚ä½†æ˜¯è¿™ç§æƒ…å½¢å´å¾ˆé‡è¦ï¼Œå¯ä»¥é—®è‡ªå·±å‡ ä¸ªé—®é¢˜ï¼šæˆ‘æ¼æ‰äº†ä»€ä¹ˆï¼Ÿæˆ‘çš„æ­¥ä¼æ˜¯ä¸æ˜¯å¤§äº†ç‚¹å„¿ï¼Ÿæˆ‘æœ‰æ²¡æœ‰çŠ¯æ„šè ¢çš„é”™è¯¯ï¼Ÿå¦‚æœä¸è¿™æ ·åšä¼šæ˜¯ä»€ä¹ˆç»“æœå‘¢ï¼Ÿå’Œç¼–è¯‘è­¦å‘Šä¸€æ ·ï¼Œä½ å§‹ç»ˆè¦å»æ£æ‘©æµ‹è¯•æå‰é€šè¿‡èƒŒåçš„çœŸç›¸ã€‚</li></ul></li></ol><h2 id="æˆåŠŸè¿ç”¨æµ‹è¯•é©±åŠ¨å¼€å‘çš„æ€ç»´"><a href="#æˆåŠŸè¿ç”¨æµ‹è¯•é©±åŠ¨å¼€å‘çš„æ€ç»´" class="headerlink" title="æˆåŠŸè¿ç”¨æµ‹è¯•é©±åŠ¨å¼€å‘çš„æ€ç»´"></a>æˆåŠŸè¿ç”¨æµ‹è¯•é©±åŠ¨å¼€å‘çš„æ€ç»´</h2><h3 id="å¢é‡æ€§"><a href="#å¢é‡æ€§" class="headerlink" title="å¢é‡æ€§"></a>å¢é‡æ€§</h3><p>TDD ä»¥æ¸è¿›çš„æ–¹å¼ä»æ— åˆ°æœ‰åœ°å¼€å‘ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ç³»ç»Ÿï¼Œæ¯å½“å¾€ç³»ç»Ÿä¸­åŠ å…¥æ–°è¡Œä¸ºå•å…ƒå‰ï¼Œéƒ½åº”è¯¥ä¸ºå…¶ç¼–å†™ä¸€ä¸ªæµ‹è¯•ï¼Œå¹¶ä¿è¯ä»¥å¾€åŠ å…¥çš„è¡Œä¸ºä¹Ÿæœ‰å¯¹åº”çš„æµ‹è¯•ï¼Œä½ åªæœ‰åœ¨æ–°åŠŸèƒ½ä¸å…¶ä»–æ‰€æœ‰åŠŸèƒ½ååŒå·¥ä½œæ—¶æ‰èƒ½ç»§ç»­å‰è¿›ã€‚</p><p>TDD ä¸æ•æ·å¼€å‘çš„æµç¨‹ä¹Ÿç›¸äº’å¥‘åˆï¼Œåœ¨æ¯ä¸ªçŸ­çš„æ•æ·å¼€å‘è¿­ä»£å‘¨æœŸï¼Œéƒ½å¯ä»¥å®šä¹‰ã€æ„å»ºå¹¶å‘å¸ƒå°‘é‡çš„åŠŸèƒ½ï¼Œè€Œ TDD åˆ™ä¼šä¿è¯ä½ çš„ä¿®æ”¹æ˜¯å¦å½±å“å…¶ä»–åŠŸèƒ½ä»¥åŠæ–°å¼€å‘çš„åŠŸèƒ½æŒ‡å®šè¡Œä¸ºæ˜¯å¦æ­£ç¡®ã€‚</p><h3 id="æµ‹è¯•è¡Œä¸ºè€Œéæ–¹æ³•"><a href="#æµ‹è¯•è¡Œä¸ºè€Œéæ–¹æ³•" class="headerlink" title="æµ‹è¯•è¡Œä¸ºè€Œéæ–¹æ³•"></a>æµ‹è¯•è¡Œä¸ºè€Œéæ–¹æ³•</h3><p>TDD ä¸åº”è¯¥é›†ä¸­ç²¾åŠ›å»æµ‹è¯•æˆå‘˜å‡½æ•°ã€‚â€œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ª add() æˆå‘˜å‡½æ•°ã€‚å†å†™ä¸€ä¸ª TEST(ARetweetCollection, Add) çš„æµ‹è¯•ã€‚â€æƒ³è¦å®Œå…¨è¦†ç›–ä¸€ä¸ª add è¡Œä¸ºçš„æµ‹è¯•éœ€è¦è€ƒè™‘å¤šç§ä¸åŒæƒ…å†µï¼Œéå¸¸æµªè´¹ç²¾åŠ›ã€‚</p><ul><li>ç›¸åå°†æ³¨æ„åŠ›æ”¾åœ¨æè¿°è¡Œä¸ºä¸Šï¼š<ul><li>å¦‚æœåŠ å…¥ä¸€ä¸ªå·²ç»åŠ å…¥çš„ add å‚æ•°ï¼Ÿ</li><li>å¦‚æœå®¢æˆ·ä¼ å…¥ä¸€ä¸ªç©ºçš„å‚æ•°ï¼Ÿ</li><li>å¦‚æœåŠ å…¥çš„å‚æ•°ä¸åœ¨ç”Ÿæ•ˆï¼Ÿ</li><li>â€¦â€¦ç­‰ç­‰ã€‚</li></ul></li></ul><h3 id="ä½¿ç”¨æµ‹è¯•æ¥æè¿°è¡Œä¸º"><a href="#ä½¿ç”¨æµ‹è¯•æ¥æè¿°è¡Œä¸º" class="headerlink" title="ä½¿ç”¨æµ‹è¯•æ¥æè¿°è¡Œä¸º"></a>ä½¿ç”¨æµ‹è¯•æ¥æè¿°è¡Œä¸º</h3><p>æµ‹è¯•å¯ä»¥è¢«çœ‹ä½œä¸€ä¸ªç¤ºä¾‹ï¼Œç”¨å®ƒæè¿°æˆ–æ–‡æ¡£åŒ–ç³»ç»Ÿä¸­çš„è¡Œä¸ºã€‚</p><ul><li>å¯ä»¥é€šè¿‡ä¸‹åˆ—ä¸¤ä¸ªæ–¹é¢æ¥ç¼–å†™ä¸€ä¸ªè‰¯å¥½çš„æµ‹è¯•ï¼š<ol><li>æµ‹è¯•åç§°ï¼Œå®ƒæ¦‚æ‹¬äº†åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­ç³»ç»Ÿè¡¨ç°å‡ºçš„è¡Œä¸ºï¼›</li><li>æµ‹è¯•è¯­å¥æœ¬èº«ï¼Œå®ƒç²¾ç‚¼åœ°å±•ç°äº†ä¸€ä¸ªæµ‹è¯•çš„è¡Œä¸ºã€‚</li></ol></li></ul><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>ARetweetCollection<span class="token punctuation">,</span> IgnoresDuplicateTweetAdded<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Tweet <span class="token function">tweet</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"@user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Tweet <span class="token function">duplicate</span><span class="token punctuation">(</span>tweet<span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tweet<span class="token punctuation">)</span><span class="token punctuation">;</span>    collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>duplicate<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//> æµ‹è¯•åç§°æä¾›äº†é«˜å±‚æ¬¡çš„æ¦‚æ‹¬ï¼šåº”è¯¥å¿½ç•¥é‡å¤æ·»åŠ çš„ tweetã€‚ä½†ä»€ä¹ˆæ‰ç®—é‡å¤çš„ tweetï¼Ÿå¿½ç•¥é‡å¤çš„ tweet æ„å‘³ç€ä»€ä¹ˆï¼Ÿè¿™ä¸ªæµ‹è¯•æç¤ºäº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¸…æ¥šåœ°å›ç­”äº†è¿™ä¸¤ä¸ªé—®é¢˜ã€‚å½“ä¸€ä¸ª tweet å’Œå¦ä¸€ä¸ª tweet å®Œå…¨ç›¸åŒæ—¶ï¼Œç®—ä½œé‡å¤ï¼›å½“åŠ å…¥ä¸€ä¸ªé‡å¤çš„ tweet åï¼Œtweet é›†åˆçš„å¤§å°ä¸å˜ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¶Šæ˜¯é‡è§† TDD çš„æ–‡æ¡£åŠŸèƒ½ï¼Œè¶Šæ‡‚å¾—é«˜è´¨é‡æµ‹è¯•çš„é‡è¦æ€§ã€‚æµ‹è¯•çš„æ–‡æ¡£åŠŸèƒ½æ˜¯ TDD çš„é™„å±äº§ç‰©ã€‚ä¸ºäº†ç¡®ä¿åœ¨å•å…ƒæµ‹è¯•ä¸­çš„æŠ•å…¥å¾—åˆ°è‰¯å¥½çš„å›æŠ¥ï¼Œå¿…é¡»ä¿è¯å…¶ä»–äººèƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°ç†è§£æµ‹è¯•ï¼Œå¦åˆ™ä½ çš„æµ‹è¯•å°±æ˜¯åœ¨æµªè´¹ä»–ä»¬çš„æ—¶é—´ã€‚è‰¯å¥½çš„æµ‹è¯•å¯ä»¥é€šè¿‡å…¨é¢åœ°è®°å½•ç³»ç»Ÿè¡Œä¸ºæ¥èŠ‚çœæ—¶é—´ã€‚åªè¦æ‰€æœ‰çš„æµ‹è¯•éƒ½é€šè¿‡ï¼Œå®ƒä»¬å°±å‡†ç¡®åœ°ä¼ è¾¾äº†ç³»ç»Ÿçš„å†…éƒ¨è¡Œä¸ºã€‚æ–‡æ¡£ä¹Ÿä¸ä¼šè¿‡æ—¶ã€‚</p><h3 id="ä¿æŒç®€å•"><a href="#ä¿æŒç®€å•" class="headerlink" title="ä¿æŒç®€å•"></a>ä¿æŒç®€å•</h3><p>æœ‰å¾ˆå¤šæ„¿æ„å¯¼è‡´å¼€å‘äººå‘˜åˆ¶é€ éå¿…è¦çš„å¤æ‚æ€§ï¼š</p><ol><li>æ—¶é—´å‹åŠ›ï¼›</li><li>ç¼ºä¹å­¦ä¹ ï¼›</li><li>å·²æœ‰çš„å¤æ‚ï¼›</li><li>å®³æ€•æ”¹ä»£ç ï¼›</li><li>è‡†æµ‹ï¼›</li></ol><p>ä½†æ˜¯ä¿æŒç®€å•æ‰æ˜¯åœ¨æŒç»­å˜åŒ–çš„ç¯å¢ƒä¸­çš„ç”Ÿå­˜ä¹‹é“ã€‚æœ€å¥½çš„é˜²èŒƒåŠæ³•å°±æ˜¯ä¿æŒç®€å•çš„è®¾è®¡ï¼šä»£ç æ˜“è¯»ã€æ²¡æœ‰å†—ä½™ã€æ²¡æœ‰æ— è°“çš„å¤æ‚æ€§ã€‚å…·æœ‰è¿™äº›ç‰¹å¾çš„ç³»ç»Ÿä¼šæœ€å¤§ç¨‹åº¦åœ°é™ä½ç»´æŠ¤æˆæœ¬ã€‚</p><h3 id="æªå®ˆæµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸ"><a href="#æªå®ˆæµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸ" class="headerlink" title="æªå®ˆæµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸ"></a>æªå®ˆæµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸ</h3><p>è¯·éµå¾ªâ€œçº¢-ç»¿-é‡æ„â€å‘¨æœŸï¼Œéå¸¸é‡è¦ã€‚</p><h2 id="æˆåŠŸè¿ç”¨-TDD-çš„æ–¹æ³•"><a href="#æˆåŠŸè¿ç”¨-TDD-çš„æ–¹æ³•" class="headerlink" title="æˆåŠŸè¿ç”¨ TDD çš„æ–¹æ³•"></a>æˆåŠŸè¿ç”¨ TDD çš„æ–¹æ³•</h2><h3 id="ä¸‹ä¸€ä¸ªæµ‹è¯•æ˜¯ä»€ä¹ˆ"><a href="#ä¸‹ä¸€ä¸ªæµ‹è¯•æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸‹ä¸€ä¸ªæµ‹è¯•æ˜¯ä»€ä¹ˆ"></a>ä¸‹ä¸€ä¸ªæµ‹è¯•æ˜¯ä»€ä¹ˆ</h3><p>ä¸€ä¸ªç­”æ¡ˆä¾¿æ˜¯ï¼šå¦‚æœä¸€ä¸ªæµ‹è¯•éœ€è¦çš„äº§å“ä»£ç æœ€å°‘ï¼Œé‚£ä¹ˆå°±å†™è¿™ä¸ªæµ‹è¯•ã€‚</p><p>è¿˜å¯ä»¥ä½¿ç”¨<code>å˜æ¢ä¼˜å…ˆçº§å‡è®¾ï¼ˆTransformation Priority Premiseï¼ŒTPPï¼‰</code>æ¨¡å¼ï¼Œç¬¬åç« æœ‰è®²è§£ã€‚å¤§è‡´æè¿°ï¼šå°†æ¯æ­¥å˜æ¢åˆ†ç±»ã€‚æ‰€æœ‰çš„å˜æ¢æŒ‰ä»æœ€ç®€å•ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰åˆ°æœ€å¤æ‚ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰å®‰æ’ä¼˜å…ˆçº§é¡ºåºã€‚ä½ è¦åšçš„å°±æ˜¯é€‰æ‹©ä¸€ä¸ªæœ€é«˜ä¼˜å…ˆçº§çš„å˜æ¢ï¼Œç„¶åä¸ºæ­¤å˜æ¢å†™ä¸€ä¸ªæµ‹è¯•ã€‚æŒ‰ç…§å˜æ¢ä¼˜å…ˆçº§å¢é‡åœ°è¿›è¡Œï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªç†æƒ³çš„æµ‹è¯•é¡ºåºã€‚</p><ul><li>é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥å›ç­”ä¸‹åˆ—é—®é¢˜åšå‡ºå†³å®šï¼š<ol><li>ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œé‚£ä¸ªè¡Œä¸ºæœ€å…·æœ‰æ„ä¹‰ï¼Ÿ</li><li>ä½ å¯ä»¥éªŒè¯è¿™ä¸ªæœ‰æ„ä¹‰çš„è¡Œä¸ºä¸­å“ªä¸ªæœ€å°é›†åˆï¼Ÿ</li><li>ä½ èƒ½å†™ä¸€ä¸ªæµ‹è¯•æ¥è¯´æ˜å½“å‰çš„è¡Œä¸ºä¸å®Œå¤‡å—ï¼Ÿ</li></ol></li></ul><h3 id="ååˆ†é’Ÿé™åˆ¶"><a href="#ååˆ†é’Ÿé™åˆ¶" class="headerlink" title="ååˆ†é’Ÿé™åˆ¶"></a>ååˆ†é’Ÿé™åˆ¶</h3><p>TDD ä¾èµ–è¾ƒçŸ­çš„åé¦ˆå‘¨æœŸã€‚ä½†æœ‰æ—¶é‡åˆ°å›°éš¾ï¼Œä¾‹å¦‚é‡æ„ä»£ç æ—¶ç ´åäº†ä¸€äº›æµ‹è¯•ï¼Œåˆæˆ–è€…éœ€è¦ GDB å·¥å…·æŸ¥æ‰¾é—®é¢˜ã€‚</p><p>å½“é‡åˆ°è¿™äº›ç—›è‹¦æ—¶é—´åï¼Œä»ä¸Šä¸€ä¸ªæµ‹è¯•é€šè¿‡ç®—èµ·ï¼Œä¸è¦è¶…è¿‡ 10 åˆ†é’Ÿã€‚å¦‚æœé™å®šæ—¶é—´åˆ°äº†ï¼Œé‚£ä¹ˆä¸¢æ‰ä¹‹å‰çš„ä¿®æ”¹é‡æ–°æ¥è¿‡ã€‚ä¸è¦è¿‡åˆ†çº ç»“ä»£ç ï¼Œç‰¹åˆ«æ—¶å’Œç°åœ¨åšçš„ä¸ç›¸å¹²çš„ä»£ç ï¼Œå¤§å¯å¿½ç•¥ä»–ä»¬ï¼Œä¸è¦å†™è¶…è¿‡ 10 åˆ†é’Ÿçš„ä»£ç ï¼Œä½ çš„æ–¹æ¡ˆå¯èƒ½è´¨é‡ä¸é«˜ã€‚é‡æ–°æ•´ç†æ€ç»ªï¼Œç”¨å…¨æ–°çš„è§†è§’ä¸æ–¹æ³•å†è¿›è¡Œå°è¯•ã€‚</p><h3 id="ä»£ç ç¼ºé™·"><a href="#ä»£ç ç¼ºé™·" class="headerlink" title="ä»£ç ç¼ºé™·"></a>ä»£ç ç¼ºé™·</h3><p>ä½¿ç”¨ TDD å‡ ä¹ä¸ä¼šå‡ºç°ä¸€äº›æ„šè ¢çš„é€»è¾‘é”™è¯¯ã€‚é‚£è¿˜ä¼šæœ‰å“ªäº›å‘¢ï¼Ÿå…¶ä»–çš„äº‹æƒ…ä¹Ÿä¼šå‡ºç°é—®é¢˜ï¼šæ²¡äººé¢„æ–™åˆ°çš„æ¡ä»¶ã€ä¸åŒæ­¥çš„å¤–éƒ¨äº‹æƒ…ï¼ˆä¾‹å¦‚ï¼Œé…ç½®æ–‡ä»¶ï¼‰ï¼Œä»¥åŠå¤šä¸ªæ–¹æ³•æˆ–ç±»åˆåœ¨ä¸€èµ·æ—¶è¡¨ç°å‡ºçš„å¥‡æ€ªè¡Œä¸ºã€‚å¦‚æœè§„èŒƒæœ‰é—®é¢˜ä¹Ÿä¼šå‡ºé”™ï¼ŒåŒ…æ‹¬å› ç²—å¿ƒè€Œå¿½ç•¥æ‰ä¸€äº›ä¸œè¥¿ï¼Œä½ å’Œå®¢æˆ·é—´çš„è¯¯è§£ã€‚TDD ä¸æ˜¯é“¶å¼¹ï¼Œå´æœ‰åŠ©äºæ¶ˆé™¤ä¸€äº›äººäººéƒ½ä¼šçŠ¯çš„é€»è¾‘é”™è¯¯ã€‚ï¼ˆæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæ˜¯ç²¾ç»†æ‰“ç£¨ç³»ç»Ÿè®¾è®¡çš„ç»å¦™æ–¹æ³•ã€‚ï¼‰</p><p>å½“ QA æˆ–å®¢æˆ·æ”¯æŒå›¢é˜Ÿå½“é¢ç»™ä½ æŒ‡å‡ºä¸€ä¸ªä»£ç ç¼ºé™·æ—¶ï¼Œä½ è¯¥æ€ä¹ˆåšï¼Ÿå—¯ï¼Œæµ‹è¯•é©±åŠ¨ï¼ä½ æˆ–è®¸å¯ä»¥å…ˆå†™ä¸€äº›ç®€å•çš„æµ‹è¯•æ¥æ¢æµ‹ç³»ç»Ÿè¡Œä¸ºã€‚ä¸“æ³¨äºç›¸å…³ä»£ç çš„æµ‹è¯•èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ä»£ç æ˜¯æ€æ ·å·¥ä½œçš„ï¼Œä¹Ÿæœ‰åŠ©äºè§£è¯»ä»£ç ç¼ºé™·ã€‚æœ‰äº›æ—¶å€™ï¼Œä½ å¯ä»¥ä¿ç•™è¿™äº›æµ‹è¯•ï¼Œå¹¶æŠŠå®ƒä»¬ç”¨ä½œç‰¹å¾æµ‹è¯•ã€‚æœ‰æ—¶å€™åˆ™å¯ä»¥ä¸¢å¼ƒè¿™äº›ç±»ä¼¼ä¸€æ¬¡æ€§å·¥å…·çš„æµ‹è¯•ã€‚ä¸€æ—¦æŸ¥æ˜é—®é¢˜æ ¹æºï¼Œä¹Ÿä¸è¦ç®€å•ä¿®å¤ï¼Œç»§ç»­åšå…¶ä»–äº‹æƒ…å§ã€‚æˆ‘ä»¬æ˜¯åœ¨æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ç›¸åï¼Œå†™ä¸€ä¸ªä½ è®¤ä¸ºèƒ½æ¨¡æ‹Ÿæš´éœ²ç¼ºé™·çš„è¡Œä¸ºçš„æµ‹è¯•ã€‚ç¡®ä¿æµ‹è¯•å¤±è´¥ï¼ˆçº¢ï¼‰ï¼Œä¿®å¤å®ƒï¼ˆç»¿ï¼‰ï¼Œé‡æ„ã€‚</p><h3 id="ç¦ç”¨æµ‹è¯•"><a href="#ç¦ç”¨æµ‹è¯•" class="headerlink" title="ç¦ç”¨æµ‹è¯•"></a>ç¦ç”¨æµ‹è¯•</h3><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨æµ‹è¯•é©±åŠ¨å¼€å‘æ—¶ä¸€æ¬¡åªå…³æ³¨ä¸€ä»¶äº‹æƒ…ã€‚ä¸ªåˆ«æƒ…å†µä¸‹ï¼Œå½“ä½ å¿™äºè®©ç¬¬ä¸€ä¸ªæµ‹è¯•é€šè¿‡æ—¶ï¼Œç¬¬äºŒä¸ªæµ‹è¯•å¤±è´¥äº†ã€‚å¦‚æœå¦ä¸€ä¸ªæµ‹è¯•å¤±è´¥ï¼Œè¿™æ„å‘³ç€ä½ çš„ç¬¬ä¸€ä¸ªæµ‹è¯•æ²¡èƒ½éµå®ˆâ€œçº¢-ç»¿-é‡æ„â€å‘¨æœŸï¼ˆé™¤éè¿™ä¸¤ä¸ªæµ‹è¯•æ˜¯å› ä¸ºåŒä¸€ä¸ªåŸå› è€Œå¤±è´¥ï¼‰ã€‚</p><p>ä¸ºäº†ä¸è®©ç¬¬äºŒä¸ªå¤±è´¥çš„æµ‹è¯•åˆ†æ•£ä½ çš„æ³¨æ„åŠ›ï¼Œå¯ä»¥è®©å®ƒæš‚æ—¶å¤±æ•ˆã€‚</p><p>ä¸è¦æäº¤è¢«ç¦ç”¨ï¼ˆæˆ–æ³¨é‡Šæ‰ï¼‰çš„æµ‹è¯•çš„ä»£ç ï¼Œé™¤éä½ æœ‰å……è¶³çš„ç†ç”±ã€‚é›†æˆåçš„ä»£ç åº”è¯¥åæ˜ ç³»ç»Ÿçš„å½“å‰åŠŸèƒ½ã€‚æ³¨é‡Šæ‰çš„æµ‹è¯•ï¼ˆæˆ–äº§å“ä»£ç ï¼‰ä¼šæµªè´¹å…¶ä»–å¼€å‘è€…çš„æ—¶é—´ã€‚â€œæµ‹è¯•è¢«æ³¨é‡Šæ‰æ˜¯å› ä¸ºæ²¡æœ‰è¿™ä¸ªè¡Œä¸ºäº†å—ï¼Ÿè¿™ä¸ªæµ‹è¯•æœ‰é—®é¢˜ï¼Ÿå¤„äºå˜åŠ¨ä¸­ï¼Ÿè¿™ä¸ªæµ‹è¯•è¿è¡Œå¤ªæ…¢ä»¥è‡³äºéœ€è¦çš„æ—¶å€™æ‰å¯ç”¨å®ƒï¼Ÿæˆ‘æ˜¯ä¸æ˜¯åº”è¯¥æ‰¾ä¸ªäººè®¨è®ºä¸€ä¸‹è¿™ä¸ªæµ‹è¯•ï¼Ÿâ€</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬ç« è®²è§£äº†ä¸€äº›æµ‹è¯•é©±åŠ¨å¼€å‘çš„åŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><p>é¦–å…ˆå°±æ˜¯æµ‹è¯•é©±åŠ¨å¼€å‘å‘¨æœŸï¼š</p><ol><li>å…ˆå†™ä¸€ä¸ªæµ‹è¯•ï¼ˆâ€œçº¢â€ï¼‰ï¼›</li><li>è®©æµ‹è¯•é€šè¿‡ï¼ˆâ€œç»¿â€ï¼‰ï¼›</li><li>ä¼˜åŒ–è®¾è®¡ï¼ˆâ€œé‡æ„â€ï¼‰ã€‚<blockquote><p>å°±åƒç¬¬äºŒç« ä¸­æè¿°çš„æ­¥éª¤ä¸€æ ·ï¼Œè¿™é‡Œå°†å…¶ç²¾ç®€ã€‚</p></blockquote></li></ol></li><li><p>TDD çš„å‰è¿›è§„åˆ™ï¼Œåœ¨ TDD å‘¨æœŸä¸­çš„æ¯ä¸€æ­¥ï¼Œä½ å¿…é¡»èƒ½å›ç­”ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š</p><ol><li>ç¡®å®šæµ‹è¯•ç›®æ ‡ã€‚</li><li>ç¡®ä¿æ–°çš„æµ‹è¯•æ˜¯å¤±è´¥çš„ã€‚</li><li>å†™å‡ºä½ è®¤ä¸ºå¯ä»¥è®©æµ‹è¯•é€šè¿‡çš„ä»£ç ã€‚</li><li>ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½èƒ½é€šè¿‡ã€‚</li><li>æ•´ç†åˆšæ‰çš„ä»£ç æ”¹åŠ¨ã€‚</li><li>ç¡®ä¿æ‰€æœ‰æµ‹è¯•å†æ¬¡é€šè¿‡ã€‚</li></ol></li><li><p>TDD ä¸‰æ¡å‡†åˆ™</p><ol><li>åªåœ¨è®©å¤±è´¥æµ‹è¯•é€šè¿‡æ—¶æ‰ç¼–å†™äº§å“ä»£ç ã€‚</li><li>å½“æµ‹è¯•åˆšå¥½å¤±è´¥æ—¶ï¼Œåœæ­¢ç»§ç»­ç¼–å†™ã€‚ç¼–è¯‘å¤±è´¥ä¹Ÿæ˜¯å¤±è´¥ã€‚</li><li>åªç¼–å†™èƒ½åˆšå¥½è®©ä¸€ä¸ªå¤±è´¥æµ‹è¯•é€šè¿‡çš„äº§å“ä»£ç ã€‚</li></ol></li></ul><h3 id="æˆåŠŸè¿ç”¨-TDD-çš„æ–¹æ³•-1"><a href="#æˆåŠŸè¿ç”¨-TDD-çš„æ–¹æ³•-1" class="headerlink" title="æˆåŠŸè¿ç”¨ TDD çš„æ–¹æ³•"></a>æˆåŠŸè¿ç”¨ TDD çš„æ–¹æ³•</h3><ol><li><strong>ä¸‹ä¸€ä¸ªæµ‹è¯•æ˜¯ä»€ä¹ˆ</strong>ï¼Œè¿™æ˜¯ TDD æ­£ç¡®å‰è¿›çš„é‡è¦é—®é¢˜ï¼Œæ–‡ä¸­ç»™å‡ºä¸‰ç§æ–¹æ¡ˆï¼š<ol><li>å¦‚æœä¸€ä¸ªæµ‹è¯•éœ€è¦çš„äº§å“ä»£ç æœ€å°‘ï¼Œé‚£ä¹ˆå°±å†™è¿™ä¸ªæµ‹è¯•ã€‚</li><li>ä½¿ç”¨<code>å˜æ¢ä¼˜å…ˆçº§å‡è®¾ï¼ˆTransformation Priority Premiseï¼ŒTPPï¼‰</code>æ¨¡å¼ã€‚</li><li>å¯ä»¥å›ç­”ä¸‹åˆ—é—®é¢˜åšå‡ºå†³å®šï¼š<ol><li>ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œé‚£ä¸ªè¡Œä¸ºæœ€å…·æœ‰æ„ä¹‰ï¼Ÿ</li><li>ä½ å¯ä»¥éªŒè¯è¿™ä¸ªæœ‰æ„ä¹‰çš„è¡Œä¸ºä¸­å“ªä¸ªæœ€å°é›†åˆï¼Ÿ</li><li>ä½ èƒ½å†™ä¸€ä¸ªæµ‹è¯•æ¥è¯´æ˜å½“å‰çš„è¡Œä¸ºä¸å®Œå¤‡å—ï¼Ÿ</li></ol></li></ol></li><li><strong>ååˆ†é’Ÿé™åˆ¶</strong>ï¼šå‡ºç°é—®é¢˜å¼€å§‹ååˆ†é’Ÿå¦‚æœè§£å†³ä¸äº†ï¼Œåº”è¯¥å›æ»šå¹¶æ¢ä¸€ç§æ€è·¯äº†ã€‚</li><li><strong>ä»£ç ç¼ºé™·</strong>ï¼šTDD ä¸æ˜¯é“¶å¼¹æ— æ³•å®Œå…¨æ¶ˆé™¤é”™è¯¯ï¼Œä½†æ˜¯å´æœ‰åŠ©äºæ¶ˆé™¤ä¸€äº›äººäººéƒ½ä¼šçŠ¯çš„é€»è¾‘é”™è¯¯ï¼ˆæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæ˜¯ç²¾ç»†æ‰“ç£¨ç³»ç»Ÿè®¾è®¡çš„ç»å¦™æ–¹æ³•ã€‚ï¼‰ã€‚å½“å‘ç°äº†ä¸€ä¸ªæ–°çš„é—®é¢˜æœ€å¥½çš„æ–¹å¼ä¾¿æ˜¯å°†é”™è¯¯é€šè¿‡æµ‹è¯•ä»£ç è¿›è¡Œæè¿°ï¼Œè¿›å…¥â€œçº¢-ç»¿-é‡æ„â€å‘¨æœŸã€‚</li><li><strong>ç¦ç”¨æµ‹è¯•</strong>ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨æµ‹è¯•é©±åŠ¨å¼€å‘æ—¶ä¸€æ¬¡åªå…³æ³¨ä¸€ä»¶äº‹æƒ…ã€‚ä¸ªåˆ«æƒ…å†µä¸‹ï¼Œå½“ä½ å¿™äºè®©ç¬¬ä¸€ä¸ªæµ‹è¯•é€šè¿‡æ—¶ï¼Œç¬¬äºŒä¸ªæµ‹è¯•å¤±è´¥äº†ã€‚ä¸ºäº†ä¸è®©ç¬¬äºŒä¸ªå¤±è´¥çš„æµ‹è¯•åˆ†æ•£ä½ çš„æ³¨æ„åŠ›ï¼Œå¯ä»¥è®©å®ƒæš‚æ—¶å¤±æ•ˆã€‚ä½†æ˜¯ä¸è¦æäº¤è¿™ç§è¢«ç¦ç”¨çš„æµ‹è¯•ç”¨ä¾‹ï¼Œé™¤éä½ æœ‰è¶³å¤Ÿçš„ç†ç”±ï¼Œå¹¶ä¸”åšå¥½å®Œå–„çš„å¤‡æ³¨ï¼Œé¿å…ç»™åˆ«äººè¯¯å¯¼ã€‚</li></ol><h3 id="TDD-QA"><a href="#TDD-QA" class="headerlink" title="TDD QA"></a>TDD QA</h3><ol><li>TDD çš„å¥½å¤„ï¼Ÿ<ul><li>ä¸ POUT å³å¼€å‘å®Œæˆåå†ç¼–å†™æµ‹è¯•ä¸åŒï¼ŒTDD äº‹ä¸€ä¸ªæ›´åŠ ç®€æ˜çš„æµç¨‹ï¼Œå¹¶ä¸”ä¹Ÿä½¿ç”¨äº†å•å…ƒæµ‹è¯•ã€‚åœ¨ TDD ä¸­å…ˆç¼–å†™æµ‹è¯•ï¼Œå¹¶ä¸”ä¿æŒæµ‹è¯•çš„ç²’åº¦å°½é‡å°ä¸”ä¸€è‡´ï¼Œè¿™æ ·ä¼šå¸¦æ¥è®¸å¤šå¥½å¤„ï¼Œæœ€é‡è¦çš„æ˜¯å¯ä»¥å®‰å…¨åœ°ä¿®æ”¹ç°æœ‰ä»£ç ã€‚</li></ul></li><li>å¦‚ä½•è¿›è¡Œ TDDï¼Ÿ<ul><li>åœ¨ TDD ä¸­ï¼Œæ˜¯ä»¥éå¸¸å°çš„æ­¥ä¼ï¼Œå¢é‡åœ°å¾€ç³»ç»Ÿä¸­æ·»åŠ æ–°è¡Œä¸ºã€‚æ¢å¥è¯è¯´ï¼Œä¸ºäº†å¾€ç³»ç»Ÿä¸­åŠ å…¥æ–°çš„è¡Œä¸ºï¼Œé¦–å…ˆä¼šå»å†™ä¸€ä¸ªæµ‹è¯•æ¥å®šä¹‰è¿™ä¸ªè¡Œä¸ºã€‚è¿™ä¸ªèµ·åˆè¿è¡Œå¤±è´¥çš„æµ‹è¯•å°†é©±ä½¿ä½ å»å®ç°ç›¸åº”çš„è¡Œä¸ºã€‚</li></ul></li><li>TDD ä¸åŠŸèƒ½æµ‹è¯•çš„åŒºåˆ«ï¼Ÿ<ul><li>TDD ä¸åº”è¯¥å’Œå¤§é‡åŠŸèƒ½çš„æµ‹è¯•æ··æ·†ã€‚ä¸»è¦åŒºåˆ«åœ¨äºï¼Œè¦†ç›–äº†å¤§é‡åŠŸèƒ½çš„æµ‹è¯•æ˜¯ä¸å…¶ä»–ä»£ç æˆ–è€…å¤–éƒ¨å®ä½“é›†æˆåçš„æ•´ä½“åŠŸèƒ½ï¼Œä¸€èˆ¬è¢«ç§°ä¸ºé›†æˆæµ‹è¯•ã€‚æ­¤ç±»æµ‹è¯•åº”åœ¨éªŒæ”¶æˆ–è€…ç³»ç»Ÿæµ‹è¯•æ—¶è¿›è¡Œã€‚</li><li>TDD ä¸»å¯¼çš„æ˜¯äº§ç”Ÿå•å…ƒæµ‹è¯•ï¼Œæ˜¯å»è¦†ç›–æœ€å°çš„é€»è¾‘ä»£ç å•å…ƒçš„æµ‹è¯•ç”¨ä¾‹ã€‚è™½è¯´ TDD åœ¨å¤±è´¥æµ‹è¯•é€šè¿‡æ—¶æ‰ç¼–å†™äº§å“ä»£ç çš„è§„åˆ™ï¼Œå¾€å¾€ä¼šæŒ‡å¼•è€…å¼€å‘è€…ä¸å¤–éƒ¨å®ä½“ä»£ç è¿›è¡Œäº¤äº’ï¼Œè¿›è€Œç¼–ç¨‹é›†æˆæµ‹è¯•ï¼Œä½†æ˜¯è€…æ²¡æœ‰å…³ç³»ã€‚<strong>é‡è¦çš„æ˜¯ç°æŒ‡å®šè¡Œä¸ºï¼Œç³»ç»Ÿåœ°æµ‹è¯•é©±åŠ¨å¼€å‘ç³»ç»Ÿä¸­çš„æ¯ä¸€å—ä»£ç </strong>ã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ï¼ˆäºŒï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--ç¬¬ä¸€ä¸ªç¤ºä¾‹</title>
      <link href="/2022/06/02/er-ce-shi-qu-dong-kai-fa-ji-qiao-di-yi-ge-shi-li/"/>
      <url>/2022/06/02/er-ce-shi-qu-dong-kai-fa-ji-qiao-di-yi-ge-shi-li/</url>
      
        <content type="html"><![CDATA[<h1 id="æµ‹è¯•é©±åŠ¨å¼€å‘ï¼šç¬¬ä¸€ä¸ªç¤ºä¾‹"><a href="#æµ‹è¯•é©±åŠ¨å¼€å‘ï¼šç¬¬ä¸€ä¸ªç¤ºä¾‹" class="headerlink" title="æµ‹è¯•é©±åŠ¨å¼€å‘ï¼šç¬¬ä¸€ä¸ªç¤ºä¾‹"></a>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼šç¬¬ä¸€ä¸ªç¤ºä¾‹</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å†™ä¸ªæµ‹è¯•ï¼Œä¿è¯å®ƒé€šè¿‡ï¼Œæ¥ç€é‡æ„è®¾è®¡ï¼Œè¿™å°±æ˜¯ TDD çš„å…¨éƒ¨å†…å®¹äº†ã€‚</p><ul><li>å•Šå“ˆï¼Œæˆ‘å¤ªå‹¤å¿«äº†ï¼Œè¿™ä¹ˆå¿«å°±æ›´æ–°ç¬¬äºŒç¯‡æ–‡ç« äº†ï¼Œåæ§½ä¸‹èº«ä»½è¯è¿‡æœŸäº†å¯¼è‡´æ—…æ¸¸è®¡åˆ’è¢«æç½® ğŸ˜“ï¼Œç–«æƒ…ä¸‹å¤ªä¹…æ²¡ç”¨è¿‡èº«ä»½è¯äº†ï¼Œæ²¡æƒ³åˆ°è¿˜è¿‡æœŸäº†ã€‚</li><li>åºŸè¯å°‘è¯´ï¼Œè¿™ç¯‡æ–‡ç« ç¯‡å¹…æœ‰äº›å¤šå•Šï¼Œä¸è¿‡éƒ½æ˜¯ä»£ç ç‰‡æ®µå®é™…çœ‹èµ·æ¥ä¹Ÿè¿˜å¥½ï¼Œå®Œæ•´ä»£ç åœ¨<a href="https://github.com/HATTER-LONG/TDD_Learning">è¿™é‡Œ</a>ï¼ŒSrc ç›®å½•ä¸‹çš„å¯¹åº”æ–‡ä»¶å¤¹ï¼Œå¯ä»¥å…ˆç¼–è¯‘è¯•è¯•ï¼Œä½“ä¼šä¸‹ã€‚</li><li><a href="https://github.com/HATTER-LONG/NoteBook_ModernCppProgrammingWithTDD">ç¬”è®°ç›®å½•</a>ï¼Œå†æ¬¡åšé¢œæ— è€»çš„æ±‚ä¸‹ star æˆ–è€… follow ğŸš©ã€‚</li></ul><h2 id="Soundex-ç±»"><a href="#Soundex-ç±»" class="headerlink" title="Soundex ç±»"></a>Soundex ç±»</h2><p>ä»¥ TDD çš„æ–¹å¼å¼€å‘ Soundex ç±»ï¼Œè¿™ç§ç±»å¯ä»¥æå‡åº”ç”¨ç¨‹åºçš„æœç´¢èƒ½åŠ›ã€‚è¿™ä¸ªç®—æ³•æ˜¯å°†å•è¯ç¼–ç ä¸ºä¸€ä¸ªå­—æ¯å’Œä¸‰ä¸ªæ•°å­—ï¼Œå®ƒå°†å‘éŸ³ç›¸ä¼¼çš„å•è¯æ˜ å°„åˆ°ç›¸åŒçš„ç¼–ç ã€‚<a href="http://en.wikipedia.org/wiki/Soundex">Wiki è§£é‡Š</a>ï¼š</p><ol><li><p>ä¿ç•™ç¬¬ä¸€ä¸ªå­—æ¯ã€‚ä¸¢æ‰æ‰€æœ‰å‡ºç°çš„ aã€eã€iã€oã€ uã€yã€hã€wã€‚</p></li><li><p>ä»¥æ•°å­—æ¥ä»£æ›¿è¾…éŸ³ï¼ˆç¬¬ä¸€ä¸ªå­—æ¯é™¤å¤–ï¼‰ï¼š</p><ul><li>bã€fã€pã€v : 1</li><li>cã€gã€jã€kã€qã€sã€xã€z : 2</li><li>dã€t : 3</li><li>l : 4</li><li>mã€n : 5</li><li>r : 6</li></ul></li><li><p>å¦‚æœç›¸é‚»å­—æ¯ç¼–ç ç›¸åŒï¼Œç”¨ä¸€ä¸ªæ•°å­—è¡¨ç¤ºå®ƒä»¬å³å¯ã€‚åŒæ ·ï¼Œå¦‚æœå‡ºç°ä¸¤ä¸ªç¼–ç ç›¸åŒçš„å­—æ¯ï¼Œä¸”å®ƒä»¬è¢« h æˆ– w éš”å¼€ï¼Œä¹Ÿè¿™æ ·å¤„ç†ï¼›ä½†å¦‚æœè¢«å…ƒéŸ³éš”å¼€ï¼Œå°±è¦ç¼–ç ä¸¤æ¬¡ã€‚è¿™æ¡è§„åˆ™åŒæ ·é€‚ç”¨äºç¬¬ä¸€ä¸ªå­—æ¯ã€‚</p></li><li><p>å½“å¾—åˆ°ä¸€ä¸ªå­—æ¯å’Œä¸‰ä¸ªæ•°å­—æ—¶ï¼Œåœæ­¢å¤„ç†ã€‚å¦‚æœéœ€è¦ï¼Œè¡¥é›¶ä»¥å¯¹é½ã€‚</p></li></ol><h2 id="Letâ€™s-start"><a href="#Letâ€™s-start" class="headerlink" title="Letâ€™s start"></a>Letâ€™s start</h2><p>TDD å¹¶éä¸€æ¬¡å°†æ‰€æœ‰æµ‹è¯•å…¨éƒ¨å®ç°ï¼Œè€Œæ˜¯æ¯æ¬¡åªå…³æ³¨ä¸€ä¸ªåŠŸèƒ½ç‚¹å¯¹åº”çš„å•å…ƒæµ‹è¯•ï¼Œå½“å®Œæˆåå†è€ƒè™‘ä¸‹ä¸€ä¸ªéœ€è¦åŠ å…¥ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p><p><strong>ä»å®è§‚çš„è§’åº¦æ¥çœ‹ï¼ŒTDD çš„è·µè¡Œæ­¥éª¤æ˜¯ï¼šç¼–å†™ä¸€ä¸ªæœ€åŸºæœ¬å•å…ƒåŠŸèƒ½çš„æµ‹è¯•ä»£ç  â€“&gt; æµ‹è¯•å¤±è´¥ â€“&gt; å®ç°åŠŸèƒ½ä»£ç æœ€ä½é™åº¦çš„ä½¿å¾—æµ‹è¯•ä»£ç é€šè¿‡æµ‹è¯• â€“&gt; æµ‹è¯•æˆåŠŸ â€“&gt; è€ƒè™‘ä¸‹ä¸€ä¸ªåŸºæœ¬å•å…ƒåŠŸèƒ½å¹¶ç¼–å†™å¯¹åº”æµ‹è¯• â€“&gt; â€¦ã€‚</strong></p><p>åŸºäºè¿™ä¸€æ€è·¯ï¼Œä»¥ Soundex ä¸¾ä¾‹ï¼šæœ€å…ˆéœ€è¦å®ç°çš„ä¾¿æ˜¯æ­¥éª¤ä¸€ï¼Œä¿ç•™ç¬¬ä¸€ä¸ªå­—æ¯ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"catch2/catch.hpp"</span></span><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">GIVEN</span><span class="token punctuation">(</span><span class="token string">"A soundex var"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Soundex soundex<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Soundex ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶ååˆ°æ­¤ä¸ºæ­¢ï¼Œå› ä¸ºç°åœ¨å·²ç»ç¼–è¯‘ä¸é€šè¿‡äº†ï¼Œéœ€è¦å…ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼š<ul><li>åªåœ¨ä¸ºäº†ä½¿å¤±è´¥æµ‹è¯•é€šè¿‡æ—¶æ‰ç¼–å†™äº§å“ä»£ç ã€‚</li><li>å½“æµ‹è¯•åˆšå¥½å¤±è´¥æ—¶ï¼Œåœæ­¢ç»§ç»­ç¼–å†™ã€‚ç¼–è¯‘å¤±è´¥ä¹Ÿæ˜¯å¤±è´¥ã€‚</li><li>åªç¼–å†™åˆšå¥½èƒ½è®©ä¸€ä¸ªå¤±è´¥æµ‹è¯•é€šè¿‡çš„äº§å“ä»£ç ã€‚</li></ul></li></ul><p>ç°åœ¨ç¼–è¯‘åœ¨å·²ç»é€šçŸ¥æœªå®šä¹‰ Soundex çš„é”™è¯¯ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"catch2/catch.hpp"</span></span><span class="token comment" spellcheck="true">// !TODO : å½“å‰æš‚æ—¶ä¸æµ‹è¯•ä»£ç åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå½“æ„Ÿè§‰ä»£ç æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶æœ‰äº›éº»çƒ¦æ—¶ï¼Œå†ç”¨åˆé€‚çš„æ–¹å¼è¿å‡º</span><span class="token comment" spellcheck="true">/** * @brief å®ç° Soundex ç±» * */</span><span class="token keyword">class</span> <span class="token class-name">Soundex</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">GIVEN</span><span class="token punctuation">(</span><span class="token string">"A soundex var"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Soundex soundex<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨ç»§ç»­å‘å‰æ·»åŠ åŠŸèƒ½ï¼Œè®¾è®¡ä½¿ Soundex å¯¹å¤–æä¾›ä¸€ä¸ª encode(string) å…¬å…±æˆå‘˜å‡½æ•°ï¼Œç°åœ¨ä»£ç ä½¿æ— æ³•ç¼–è¯‘é€šè¿‡ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">GIVEN</span><span class="token punctuation">(</span><span class="token string">"A soundex var"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Soundex soundex<span class="token punctuation">;</span>        <span class="token function">WHEN</span><span class="token punctuation">(</span><span class="token string">"Input one char"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">auto</span> encoded <span class="token operator">=</span> soundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®å¤é”™è¯¯ï¼Œä½¿ Soundex æ”¯æŒ encode æ–¹æ³•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief Soundex ç®—æ³•ç±» * */</span><span class="token keyword">class</span> <span class="token class-name">Soundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹     *     * @param word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æ£€éªŒè¿”å›å€¼æ˜¯å¦ç¬¦åˆ Soundex ç®—æ³•è½¬æ¢åçš„ç»“æœï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>       <span class="token function">WHEN</span><span class="token punctuation">(</span><span class="token string">"Input one char"</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">auto</span> encoded <span class="token operator">=</span> soundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">THEN</span><span class="token punctuation">(</span><span class="token string">"Check that the return value is correct"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> Catch<span class="token operator">::</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨å¾—åˆ°äº†ä¸å‰è¾¹ç¼–è¯‘å¤±è´¥ä¸åŒçš„ç»“æœï¼Œæ–­è¨€å¤±è´¥ã€‚å½“ç„¶è¿™æ˜¯å¿…ç„¶çš„ï¼Œå› ä¸º encode æ–¹æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆå®ç°ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief Soundex ç®—æ³•ç±» * */</span><span class="token keyword">class</span> <span class="token class-name">Soundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹     *     * @param word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"A"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æ–­è¨€èƒ½é€šè¿‡äº†ï¼Œä¸è¿‡åŠŸèƒ½å¹¶æ²¡æœ‰å®Œå–„ï¼Œä¸è¿‡è¿™é‡Œå±•ç¤ºäº†ä¸€ä¸ªæ¸è¿›å¼ TDD å¼€å‘çš„è¿‡ç¨‹ã€‚</p><h2 id="å»æ‰ä¸å¹²å‡€çš„ä»£ç "><a href="#å»æ‰ä¸å¹²å‡€çš„ä»£ç " class="headerlink" title="å»æ‰ä¸å¹²å‡€çš„ä»£ç "></a>å»æ‰ä¸å¹²å‡€çš„ä»£ç </h2><p>å³ä½¿ä»£ç å¾ˆçŸ­ä¹Ÿå¯èƒ½å­˜åœ¨é—®é¢˜ï¼ŒTDD ä¸ºå¼€å‘æä¾›äº†æ›´å¥½çš„æ—¶æœºå»ä¿®å¤ï¼Œå³æ¯æ¬¡å®Œæˆå•å…ƒæµ‹è¯•ä»£ç ä»¥åŠåŠŸèƒ½ä»£ç ç¼–å†™åéƒ½å¯ä»¥è¿›è¡Œå¿«é€Ÿçš„å¢é‡å®¡é˜…ï¼Œé¿å…å°é—®é¢˜è¶Šç§¯è¶Šå¤šã€‚</p><h3 id="å‘½åç©ºé—´çš„ä¿®å¤"><a href="#å‘½åç©ºé—´çš„ä¿®å¤" class="headerlink" title="å‘½åç©ºé—´çš„ä¿®å¤"></a>å‘½åç©ºé—´çš„ä¿®å¤</h3><p>å•å…ƒæµ‹è¯•ä»£ç ä¸­ï¼ŒEquals ä½¿ç”¨ Catch å‘½åç©ºé—´æ¯”è¾ƒå½±å“é˜…è¯»è¿è´¯æ€§ï¼Œä½¿ç”¨å‘½åç©ºé—´å°†æ–­è¨€è¯»èµ·æ¥åƒä¸€ä¸ªå¥å­ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"catch2/catch.hpp"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> Catch<span class="token punctuation">;</span><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">GIVEN</span><span class="token punctuation">(</span><span class="token string">"A soundex var"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Soundex soundex<span class="token punctuation">;</span>        <span class="token function">WHEN</span><span class="token punctuation">(</span><span class="token string">"Input one char"</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">auto</span> encoded <span class="token operator">=</span> soundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">THEN</span><span class="token punctuation">(</span><span class="token string">"Check that the return value is correct"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ¶ˆé™¤é‡å¤ä»£ç "><a href="#æ¶ˆé™¤é‡å¤ä»£ç " class="headerlink" title="æ¶ˆé™¤é‡å¤ä»£ç "></a>æ¶ˆé™¤é‡å¤ä»£ç </h3><p>é‡å¤ä»£ç å¯¹äºç»´æŠ¤æˆæœ¬å’Œé£é™©éƒ½ä¼šæå‡ã€‚å®¡é˜…ä»£ç æ˜¯éœ€è¦ç€é‡ä¼˜åŒ–ã€‚</p><p>åœ¨æ­¤ä¾‹ä¸­æ²¡æœ‰å¤ªæ˜æ˜¾çš„é‡å¤ï¼Œä½†æ˜¯ <code>"A"</code> è¿™ä¸ªç¡¬ç¼–ç çš„å­—ç¬¦ä¸²å‡ºç°äº†å¾ˆå¤šå›ï¼Œå¯ä»¥å°† encode æ–¹æ³•ä¸­è¿”å›çš„ç¡¬ç¼–ç  â€œAâ€ ä¼˜åŒ–æ‰ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief Soundex ç®—æ³•ç±» * */</span><span class="token keyword">class</span> <span class="token class-name">Soundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹     *     * @param word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Word<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»»ä½•æ—¶å€™ï¼Œä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•é›†åˆå£°æ˜äº†ç³»ç»Ÿä¸­æœŸæœ›çš„è¡Œä¸ºã€‚è¿™é‡Œè•´å«ç€ä¸€ä¸ªæ½œå°è¯ï¼šå¦‚æœä¸€ä¸ªè¡Œä¸ºæ²¡æœ‰å¯¹åº”çš„æµ‹è¯•æ¥æè¿°ï¼Œé‚£è¿™ä¸ªè¡Œä¸ºè¦ä¹ˆä¸å­˜åœ¨ï¼Œè¦ä¹ˆä¸æ˜¯æœŸæœ›çš„ï¼ˆæˆ–è€…æµ‹è¯•æœ¬èº«æ²¡æœ‰å°½åˆ°æè¿°è¡Œä¸ºçš„èŒè´£ï¼‰ã€‚</p><p>å½“å†ç» TDD çš„å„ä¸ªå‘¨æœŸæ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨é‡æ„æ¥å®¡é˜…è®¾è®¡ï¼ŒåŒæ—¶ä¿®å¤å‡ºç°çš„æ‰€æœ‰é—®é¢˜ã€‚é‡æ„çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯æå‡è¡¨è¾¾èƒ½åŠ›ï¼Œå»é™¤é‡å¤ä»£ç ã€‚å°±ä»£ç çš„å¯ç»´æŠ¤æ€§æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªç‚¹æœ€æœ‰è£¨ç›Šã€‚</p><h2 id="å¢é‡æ€§"><a href="#å¢é‡æ€§" class="headerlink" title="å¢é‡æ€§"></a>å¢é‡æ€§</h2><p>å¯¹äºå‰æ–‡çš„ç¡¬ç¼–ç å¯èƒ½å¿ƒå­˜ç–‘è™‘ï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½å¾ˆæ¸…æ¥šç¡¬ç¼–ç æœ€å¤šå­˜åœ¨ä¸€å°ä¼šï¼Œéšç€å¯¹ç›®æ ‡æè¿°è€Œç¼–å†™æ›´å¤šçš„æµ‹è¯•ç”¨ä¾‹ï¼Œé€æ¸å°±ä¼šæ›¿æ¢æ‰ç¡¬ç¼–ç ã€‚</p><p>ç»§ç»­å®Œå–„ Soundex åŠŸèƒ½ï¼Œå¯¹äºç°åœ¨çš„ä»£ç å¹¶ä¸ç¬¦ Soundex è§„èŒƒï¼Œä»¥åªä¼ é€’å•ä¸ªå­—ç¬¦ä¸ºå‰æï¼Œå¹¶ä¸ç¬¦åˆç¬¬å››æ¡å³å¦‚æœæ²¡æœ‰ä¸‰ä¸ªæ•°å­—ï¼Œéœ€è¦è¡¥é›¶ã€‚æ¥ä¸‹æ¥ä¸ºè¿™ä¸ªåŠŸèƒ½ç¼–å†™æ–°çš„æµ‹è¯•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"Pads with zeros to ensure three digits"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">GIVEN</span><span class="token punctuation">(</span><span class="token string">"A soundex var"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Soundex soundex<span class="token punctuation">;</span>        <span class="token function">WHEN</span><span class="token punctuation">(</span><span class="token string">"Input one char"</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">auto</span> encoded <span class="token operator">=</span> soundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">THEN</span><span class="token punctuation">(</span><span class="token string">"Check that the return value pads with zeros"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"I000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¤±è´¥äº†ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">/home/caolei/WorkSpace/TDD_Learning/test/Catch2/TestSoundex.cpp:45: FAILED:  REQUIRE_THAT( encoded, Equals("I000") )with expansion:  "I" equals: "I000"===============================================================================test cases: 2 | 1 passed | 1 failedassertions: 2 | 1 passed | 1 failed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®©æµ‹è¯•é€šè¿‡ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹ * * @param word * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Word <span class="token operator">+</span> <span class="token string">"000"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ—¶ä¼šå‘ç°ç¬¬ä¸€æ¡ç”¨ä¾‹å¤±è´¥äº†ï¼Œè¿™æ—¶å› ä¸ºç¬¬ä¸€æ¡ç”¨ä¾‹ä¸ Soundex çš„è§„åˆ™ä¸ç¬¦åˆï¼Œä¿®æ”¹å…¶æ–­è¨€è¯­å¥å·²é€‚é…è§„åˆ™ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">GIVEN</span><span class="token punctuation">(</span><span class="token string">"A soundex var"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Soundex soundex<span class="token punctuation">;</span>        <span class="token function">WHEN</span><span class="token punctuation">(</span><span class="token string">"Input one char"</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">auto</span> encoded <span class="token operator">=</span> soundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">THEN</span><span class="token punctuation">(</span><span class="token string">"Check that the return value is correct"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨æœ‰ä¸¤æ¡ç›¸ä¼¼çš„æµ‹è¯•ä»…ä»…æ•°æ®æœ‰äº›å·®å¼‚ï¼Œä½†æ˜¯æ²¡æœ‰å…³ç³»ï¼Œæ¯ä¸ªæµ‹è¯•æè¿°ä¸€ç§è¡Œä¸ºã€‚<strong>æˆ‘ä»¬ä¸ä»…è¦ç¡®ä¿ç³»ç»ŸæŒ‰é¢„æœŸå·¥ä½œï¼Œè¿˜è¦è®©æ¯ä¸ªäººçŸ¥é“æ‰€æœ‰æ—¢å®šçš„ç³»ç»Ÿè¡Œä¸ºã€‚</strong></p><p>å®Œæ•´è¿™ä¸ªåŠŸèƒ½å‘¨æœŸåï¼Œè€ƒè™‘é‡æ„ä»£ç ã€‚å¯ä»¥å‘ç° encode çš„å®ç°æœ‰äº›è®©äººè¿·æƒ‘ï¼Œå°¤å…¶æ˜¯ä¸æ¸…æ¥šæ¡æ¬¾çš„äººçœ‹åˆ°è¿™ç§é­”æ•°ç»„åˆå«äººå¿ƒç”ŸåŒæ¶ ğŸ˜¢ï¼Œå› æ­¤éœ€è¦å¯¹å…¶å°è£…ä¸‹ï¼Œæå–ç‹¬ç«‹çš„æ–¹æ³•é…ä»¥æ„å›¾æ˜ç¡®çš„åå­—ã€‚åŒæ—¶è·‘ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ç¡®ä¿é‡æ„çš„ä¿®æ”¹å¯¹äºå·²æœ‰åŠŸèƒ½æ— å½±å“ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief Soundex ç®—æ³•ç±» * */</span><span class="token keyword">class</span> <span class="token class-name">Soundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹     *     * @param word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">zeroPad</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex çš„è§„åˆ™è¦æ±‚è¿›è¡Œè¡¥é›¶     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Word <span class="token operator">+</span> <span class="token string">"000"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="fixture-ä¸è®¾ç½®"><a href="#fixture-ä¸è®¾ç½®" class="headerlink" title="fixture ä¸è®¾ç½®"></a>fixture ä¸è®¾ç½®</h2><p>åœ¨é‡æ„çš„æ—¶å€™ï¼Œä¸ä»…è¦å®¡é˜…äº§å“ä»£ç ï¼Œè¿˜è¦å®¡é˜…æµ‹è¯•ã€‚ç°åœ¨æµ‹è¯•ä»£ç ä¸­å­˜åœ¨ä¸€äº›é‡å¤çš„åœ°æ–¹ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„ GIVEN éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ª Soundex å¯¹è±¡ã€‚æœ‰ä¸¤ç§æ–¹å¼ä¿®æ”¹ï¼š</p><ul><li>å°†ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹åˆå¹¶å…¥ä¸€ä¸ªï¼Œå…¬ç”¨ä¸€ä¸ª GIVENã€‚ä¼˜ç‚¹æ˜¯æ¯”è¾ƒæ–¹ä¾¿ä¿®æ”¹ï¼Œç¼ºç‚¹å¦‚æœç”¨ä¾‹æ¯”è¾ƒå¤šï¼Œæµ‹è¯•ä»£ç ä¼šå¾ˆé•¿ã€‚</li></ul><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE</span><span class="token punctuation">(</span><span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">GIVEN</span><span class="token punctuation">(</span><span class="token string">"A soundex var"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        Soundex soundex<span class="token punctuation">;</span>        <span class="token function">WHEN</span><span class="token punctuation">(</span><span class="token string">"Input one char"</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">auto</span> encoded <span class="token operator">=</span> soundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">THEN</span><span class="token punctuation">(</span><span class="token string">"Check that the return value is correct"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// ç¬¬äºŒä¸ª WHEN æ‰§è¡Œæ—¶ä¼šé‡æ–°ä» GIVEN è¿è¡Œï¼Œä¸å—å‰ä¸€ä¸ª WHEN å½±å“</span>        <span class="token function">WHEN</span><span class="token punctuation">(</span><span class="token string">"Input one another char"</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">auto</span> encoded <span class="token operator">=</span> soundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">THEN</span><span class="token punctuation">(</span><span class="token string">"Check that the return value pads with zeros"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"I000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¬¬äºŒç§ä¾¿æ˜¯ä½¿ç”¨ class fixture æ–¹æ³•ï¼ŒGIVEN ä¸ WHEN å­˜åœ¨é‡å¤ï¼Œè™½ç„¶æœ¬æ–‡é‡‡ç”¨çš„å•å…ƒæµ‹è¯•ç¼–å†™é£æ ¼æ˜¯ BDD-ScenarioGivenWhenThen ä½†æ˜¯å¯¹äºçŸ­å°çš„æµ‹è¯•çŸ­å¦‚æœæµ‹è¯•åç§°å¯ä»¥æè¿°æ¸…æ¥šå…¶ç›®çš„ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦å¤ªå•°å—¦ï¼š</li></ul><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">FixtureSoundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    Soundex MSoundex<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Pads with zeros to ensure three digits"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"I000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Catch2 ä¼šåœ¨è¿è¡Œæ¯ä¸ªæµ‹è¯•æ—¶åˆ›å»º fixture å®ä¾‹ã€‚ç°åœ¨å°±å¯ä»¥åˆ é™¤æµ‹è¯•å†…çš„å±€éƒ¨å˜é‡ soundexã€‚ç°åœ¨ Soundex ä»£ç æœ‰äº›é•¿äº†ï¼Œæ˜¯æ—¶å€™è¦æŠŠ TODO äº‹é¡¹è§£å†³ä¸€ä¸‹ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//Include/Soundex.h</span><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token comment" spellcheck="true">// !TODO: æš‚æ—¶å°†å®ç°ä¹Ÿéƒ½æ”¾å…¥åŒä¸€ä¸ªæ–‡ä»¶ä¸­æ¯”è¾ƒæ–¹ä¾¿ä¿®æ”¹ï¼Œåç»­åˆé€‚çš„æ—¶æœºæŠ½å‡º</span><span class="token comment" spellcheck="true">/** * @brief Soundex ç®—æ³•ç±» * */</span><span class="token keyword">class</span> <span class="token class-name">Soundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹     *     * @param word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">zeroPad</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex æ¡æ¬¾4 è¦æ±‚è¿›è¡Œè¡¥é›¶     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Word <span class="token operator">+</span> <span class="token string">"000"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ä»£ç ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//test/Catch2/TestSoundex.cpp</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"Soundex.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"catch2/catch.hpp"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"spdlog/spdlog.h"</span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> Catch<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">FixtureSoundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    Soundex MSoundex<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Retain sole letter of one letter world"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Pads with zeros to ensure three digits"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"I000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€ç´¢ä¸æµ‹è¯•é©±åŠ¨å¼€å‘"><a href="#æ€ç´¢ä¸æµ‹è¯•é©±åŠ¨å¼€å‘" class="headerlink" title="æ€ç´¢ä¸æµ‹è¯•é©±åŠ¨å¼€å‘"></a>æ€ç´¢ä¸æµ‹è¯•é©±åŠ¨å¼€å‘</h2><p>ç®€å•åœ°è¯´ï¼ŒTDD çš„å‘¨æœŸå°±æ˜¯å†™ä¸€ä¸ªæµ‹è¯•ï¼Œå…ˆç¡®ä¿æµ‹è¯•å¤±è´¥ï¼Œç„¶åç¼–ç è®©æµ‹è¯•é€šè¿‡ï¼Œæ¥ç€å®¡é˜…ä»£ç å’Œæ‰“ç£¨è®¾è®¡ï¼ˆåŒ…æ‹¬æµ‹è¯•çš„è®¾è®¡ï¼‰ï¼Œæœ€åç¡®ä¿æ‰€æœ‰æµ‹è¯•ä¾ç„¶é€šè¿‡ã€‚</p><p>æ¥ä¸‹æ¥å°†è¦å¤„ç†è§„åˆ™ 2ï¼šå³åœ¨ç¬¬ä¸€ä¸ªå­—æ¯åï¼Œç”¨æ•°å­—æ›¿æ¢è¾…éŸ³ã€‚æ›¿æ¢è§„åˆ™è¡¨ä¸­å­—æ¯ b å¯¹åº”æ•°å­— 1ï¼Œä»¥æ­¤ç¼–å†™ç”¨ä¾‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Replace consonants with appropriate numbers"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Ab"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A100"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸å‡ºæ‰€æ–™çš„å¤±è´¥ï¼Œæ¥ä¸‹æ¥ä¾¿æ˜¯è®©æµ‹è¯•é€šè¿‡ï¼Œç„¶åé‡æ„åŠŸèƒ½ä»£ç ã€‚åœ¨å¯»æ±‚è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ‰¾åˆ°ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•ï¼Œ<strong>ä½†æ˜¯ä¹Ÿä¸è¦ä½¿ç”¨å·²æœ‰çš„å¤„ç†é€»è¾‘</strong>ï¼Œä¾‹å¦‚ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>word <span class="token operator">==</span> <span class="token string">"Ab"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">"A100"</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">zeroPad</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼–å†™äº†è¿™ä¸ªç‰¹ä¾‹ï¼Œä½†æ˜¯çœ‹èµ·æ¥å®ƒå°±åƒå¯¹ Ab è¿›è¡Œç‰¹æ®Šå¤„ç†æˆ A1 åçš„è¡¥é›¶è¾“å‡ºï¼Œä½†æ˜¯æˆ‘ä»¬å·²æœ‰ zeroPad äº†ï¼Œè™½è¯´ç‰¹ä¾‹å¹¶éé”™è¯¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„æµ‹è¯•ç”¨ä¾‹æ¥ä¿®æ”¹è¿™ä¸ªç‰¹ä¾‹ï¼Œè¿™é‡Œä»…ä»…æ˜¯åˆ—ä¸¾å‡ºå½“æˆ‘æƒ³è¦åŠŸèƒ½å‘å‰å¼€å‘æ—¶çš„æ ‡å‡†ï¼Œå› ä¸ºä¸€ç›´æ·»åŠ ç‰¹ä¾‹ä¹Ÿæ˜¯å¯è¡Œçš„ä¸æ˜¯ä¹ˆ ğŸ˜€ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹ * * @param word * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">auto</span> encoded <span class="token operator">=</span> Word<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> encoded <span class="token operator">+</span><span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">zeroPad</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Opsï¼Œè¡¥é›¶å‡ºç°äº†é”™è¯¯ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">/home/caolei/WorkSpace/TDD_Learning/test/Catch2/TestSoundex.cpp:43: FAILED:  REQUIRE_THAT( encoded, Equals("A100") )with expansion:  "A1000" equals: "A100"===============================================================================test cases: 3 | 2 passed | 1 failedassertions: 3 | 2 passed | 1 failed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ zeroPad æ–¹æ³•ä»¥é€šè¿‡æµ‹è¯•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief å®‰è£… Soundex æ¡æ¬¾4 è¦æ±‚è¿›è¡Œè¡¥é›¶ * * @param Word * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">auto</span> zerosNeeded <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">-</span> Word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> Word <span class="token operator">+</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span>zerosNeeded<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨çœ‹èµ·æ¥ä¸é”™ï¼Œç”¨ä¾‹ä¹Ÿå·²ç»é€šè¿‡äº†ã€‚ä½†æ˜¯å¯¹äº encode æ–¹æ³•çš„å®ç°è¿˜æ˜¯æœ‰äº›ä¸æ»¡æ„ï¼Œå…¶ä¸­å……æ–¥äº†ä¸€äº›ç¼–ç ç»†èŠ‚å’Œé­”æ•°ï¼Œå¯¹äºä¸ç†Ÿæ‚‰åŠŸèƒ½çš„å…¶ä»–äººé˜…è¯»èµ·æ¥æ˜¯ç¾éš¾çš„ï¼Œä¸å¤šåºŸè¯é‡æ„å®ƒ ğŸš€ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> once</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token comment" spellcheck="true">// !TODO: æš‚æ—¶å°†å®ç°ä¹Ÿéƒ½æ”¾å…¥åŒä¸€ä¸ªæ–‡ä»¶ä¸­æ¯”è¾ƒæ–¹ä¾¿ä¿®æ”¹ï¼Œåç»­åˆé€‚çš„å®é™…æŠ½å‡º</span><span class="token comment" spellcheck="true">/** * @brief Soundex ç®—æ³•ç±» * */</span><span class="token keyword">class</span> <span class="token class-name">Soundex</span><span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹     *     * @param word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token function">head</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">encodedDigits</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token comment" spellcheck="true">/**     * @brief è·å–å•è¯çš„ç¬¬ä¸€ä¸ªå­—æ¯     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">head</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Word<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @brief è·å–é¦–å­—æ¯åå…¶ä»–å­—ç¬¦è½¬åŒ–çš„å¯¹åº”æ•°å­—     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex çš„è§„åˆ™è¦æ±‚è¿›è¡Œè¡¥é›¶     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">auto</span> zerosNeeded <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">-</span> Word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> Word <span class="token operator">+</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span>zerosNeeded<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥å£°æ˜æ€§çš„æ–¹å¼ç»„ç»‡ä»£ç ï¼Œä½¿å…¶éå¸¸æ˜“äºç†è§£ã€‚è®¾è®¡ä¸­éå¸¸é‡è¦çš„ä¸€æ–¹é¢æ˜¯ä»å®ç°ï¼ˆæ€ä¹ˆåšï¼‰ä¸­åˆ†ç¦»æ¥å£ï¼ˆåšä»€ä¹ˆï¼‰ï¼Œè¿™æä¾›äº†è¿ˆå‘æ›´é«˜å±‚æ¬¡è®¾è®¡æ–¹æ¡ˆçš„è·³æ¿ã€‚</p><blockquote><p>æœ‰æ—¶ä¹Ÿä¼šæ‹…å¿ƒä¸€äº›å®ç°çš„ç»†èŠ‚å¹¶ä¸æ˜¯é‚£ä¹ˆå¥½ï¼šç¬¬ä¸€ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥ç”¨ stringstreamï¼Œè€Œä¸æ˜¯ç›´æ¥å°†å­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Ÿç¬¬äºŒï¼Œä¸ºä»€ä¹ˆä¸å°½å¯èƒ½åœ°ç”¨å•ç‹¬çš„ charï¼Ÿä¾‹å¦‚ï¼Œä¸ºä»€ä¹ˆç”¨ return words.substr(0, 1); è€Œé return word.front();ï¼Ÿç¬¬ä¸‰ï¼Œç”¨ return std::string(); ä¸æ˜¯æ¯” return â€œâ€; æ›´å¥½å—ï¼Ÿ</p><p>è¿™äº›æ›¿ä»£çš„ä»£ç æ–¹æ¡ˆå¯èƒ½æ›´å¥½ã€‚ä½†è¿™äº›éƒ½æ˜¯è¿‡æ—©ä¼˜åŒ–ï¼ˆpremature optimizationï¼‰ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä¸€ä¸ªå¥½çš„è®¾è®¡ï¼ˆæ¥å£ä¸€è‡´ä¸”ä»£ç å¯è¯»æ€§é«˜ï¼‰æ›´é‡è¦ã€‚ä¸€æ—¦ä»¥ç‰¢é çš„è®¾è®¡å®ç°äº†æ­£ç¡®çš„è¡Œä¸ºåï¼Œå†è€ƒè™‘æ˜¯å¦ä¼˜åŒ–æ€§èƒ½ã€‚</p></blockquote><p>å…ˆä¸è¦è€ƒè™‘å¯¹äºæ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œè¿˜æ˜¯è¦ä¼˜å…ˆè€ƒè™‘å¥½çš„ä»£ç è®¾è®¡ï¼Œä¾‹å¦‚æ¶ˆé™¤ä»£ç ä¸­çš„<code>é­”æ•°</code>ï¼Œå–è€Œä»£ä¹‹ä¸€ä¸ªåˆç†åå­—çš„å¸¸é‡ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">const</span> size_t MaxCodeLength<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment" spellcheck="true">/** * @brief å®‰è£… Soundex çš„è§„åˆ™è¦æ±‚è¿›è¡Œè¡¥é›¶ * * @param Word * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">auto</span> zerosNeeded <span class="token operator">=</span> MaxCodeLength <span class="token operator">-</span> Word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> Word <span class="token operator">+</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span>zerosNeeded<span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äº encodedDigits() ä¸­çš„ç¡¬ç¼–ç  <code>1</code>ï¼Œéœ€è¦ä»£ç å°†å­—æ¯ b æ›¿æ¢æˆ 1ï¼Œè€Œå†™åç»­è¿˜è¦æ”¯æŒå¯¹å…¶ä»–å­—ç¬¦çš„æ•°å­—è½¬æ¢ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªåˆç†çš„å‡½æ•°åå­—æ›¿ä»£ï¼Œæœ€ç»ˆçš„ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief è·å–é¦–å­—æ¯åå…¶ä»–å­—ç¬¦è½¬åŒ–çš„å¯¹åº”æ•°å­— * * @param Word * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * @brief è·å–ä¸€ä¸ªå­—ç¬¦å¯¹åº”çš„æ•°å­— * * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"1"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•é©±åŠ¨"><a href="#æµ‹è¯•é©±åŠ¨" class="headerlink" title="æµ‹è¯•é©±åŠ¨"></a>æµ‹è¯•é©±åŠ¨</h2><p>ç°åœ¨è¦ç»§ç»­ä½¿ç”¨ TDD æ¥ä¿ƒä½¿å¼€å‘è¿›åº¦ç»§ç»­å‘å‰ï¼Œé¦–è¦è€ƒè™‘ä¸€ç‚¹ä»¥æ­¤æ—¶é©±åŠ¨å¼€å‘æ›´å¤šçš„è¾…éŸ³å˜æ¢é€»è¾‘ï¼Œä½¿è§£å†³æ–¹æ¡ˆæ›´åŠ å…·æœ‰é€šç”¨æ€§ï¼Œæ˜¯åº”è¯¥ç»§ç»­åœ¨ <code>Replace consonants with appropriate numbers</code> å¢åŠ æ›´å¤šä¾‹å­çš„æ–­è¨€åˆ¤æ–­ï¼Œè¿˜æ˜¯æ–°å¢ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å‘¢ï¼Ÿ</p><p>TDD çš„ç»éªŒæ³•åˆ™æ˜¯ä¸€ä¸ªæµ‹è¯•ä¸€ä¸ªæ–­è¨€ï¼ˆå‚è€ƒ 7.3 èŠ‚ï¼Œè·å–æ›´å¤šä¿¡æ¯ï¼‰ã€‚æˆ‘ä»¬æå€¡ä¸“æ³¨æµ‹è¯•è¡Œä¸ºï¼Œè€Œéæµ‹è¯•åŠŸèƒ½å‡½æ•°ã€‚å¤§éƒ¨åˆ†æ—¶å€™è¦éµä»è¿™ä¸€ä¸ªè§„åˆ™ã€‚</p><p>å› æ­¤å¯¹äºç¬¬äºŒä¸ªè¾…éŸ³ç¼–ç æµ‹è¯•å¹¶ä¸æ˜¯å¦ä¸€ä¸ªè¡Œä¸ºï¼Œæˆ‘ä»¬å°†å®ƒåŠ åˆ°åŒä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹é‡Œï¼ŒåŒæ—¶å¸Œæœ›å½“ä¸€ä¸ªæ–­è¨€å¤±è´¥åå…¶ä»–ç”¨ä¾‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œè¿™é‡Œä½¿ç”¨ CHECK æ¥è¿›è¡Œæ£€æŸ¥ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨ SECTION æ–¹å¼ç¼–å†™æµ‹è¯•ä»£ç ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Replace consonants with appropriate numbers"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">SECTION</span><span class="token punctuation">(</span><span class="token string">"Test to replace the consonants in the entered words with appropriate numbers"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">CHECK_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Ab"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A100"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">CHECK_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Ac"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A200"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ä»£ç ä¿è¯æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief è·å–é¦–å­—æ¯åå…¶ä»–å­—ç¬¦è½¬åŒ–çš„å¯¹åº”æ•°å­— * * @param Word * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>Word<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * @brief è·å–ä¸€ä¸ªå­—ç¬¦å¯¹åº”çš„æ•°å­— * * @param Letter * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token keyword">char</span> Letter<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Letter <span class="token operator">==</span> <span class="token string">'c'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">"2"</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"1"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç°åœ¨å†æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä½“ç°æ›´å¤šçš„æ•°æ®è¾“å…¥æƒ…å†µï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">CHECK_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Ab"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A100"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">CHECK_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Ac"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A200"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">CHECK_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Ad"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A300"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŒ‰ç…§ä¹‹å‰ä¸€æ ·çš„æ­¥éª¤æ·»åŠ è¿™æ¬¡çš„åŠŸèƒ½å—ï¼Ÿä¸ ğŸ’£ï¼Œè¿™æ—¶å°±ä¼šå‘ç°åŠŸèƒ½å®ç°ä»£ç å¼€å§‹æœ‰é‡å¤çš„é€»è¾‘äº§ç”Ÿï¼Œæ˜¯æ—¶å€™å°†å…¶é‡æ„ä»¥æ›´åŠ é€šç”¨çš„å®ç°ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ª hash é›†åˆä»£æ›¿ç®€å•é‡å¤çš„ if åˆ†æ”¯åˆ¤æ–­ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief è·å–ä¸€ä¸ªå­—ç¬¦å¯¹åº”çš„æ•°å­— * * @param Letter * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token keyword">char</span> Letter<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">const</span> std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">></span> encodings <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">"3"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> encodings<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Letter<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åº”è¯¥ç»§ç»­å°†å…¶ä½™æ‰€æœ‰çš„è¾…éŸ³è½¬æ¢ï¼Œéƒ½ä»¥æµ‹è¯•é©±åŠ¨çš„æ–¹å¼å¼€å‘ä¹ˆï¼Œæ˜¯å¦åº”è¯¥è¦†ç›–æ‰€æœ‰å¯èƒ½å‡ºé—®é¢˜çš„åœ°æ–¹ â“</p><p>è¯·æ³¨æ„æˆ‘ä»¬æ˜¯åœ¨è¿›è¡Œ<code>æµ‹è¯•é©±åŠ¨å¼€å‘</code>ï¼Œè€Œéæµ‹è¯•ã€‚TDD ç€åŠ›äºä»£ç è®¾è®¡ã€‚æµ‹è¯•ä¸»è¦ç”¨äºè¡¨è¿°ä½ è¦æ„å»ºçš„è¡Œä¸ºã€‚TDD è¿‡ç¨‹ä¸­ç¼–å†™çš„æµ‹è¯•å¤§éƒ½æ˜¯è¿™ä¸ªæµç¨‹çš„é™„å±äº§ç‰©ã€‚æœ‰äº†è¿™äº›æµ‹è¯•ï¼Œåœ¨æ¥ä¸‹æ¥æ”¹åŠ¨ä»£ç æ—¶ï¼Œä½ ä¼šæ›´æœ‰ä¿¡å¿ƒã€‚è€Œä¸” TDD çš„ä¸€ä¸ªé‡è¦æ–¹é¢å°±æ˜¯å¤Ÿç”¨å³å¯ï¼Œåœ¨å¼€å‘æ–°åŠŸèƒ½å³è¡Œä¸ºæ—¶ï¼Œç¼–å†™æµ‹è¯•è¦†ç›–ï¼Œè€Œé€»è¾‘ä»£ç ä¸åœ¨æ”¹å˜æ—¶ï¼Œå°±ä¸ç”¨ç¼–å†™æµ‹è¯•ä»£ç äº†ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¹ˆå…ˆå®Œæˆè½¬æ¢è¡¨ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">const</span> std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">></span> encodings <span class="token punctuation">{</span>    <span class="token punctuation">{</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'j'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>                                <span class="token punctuation">{</span> <span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">"3"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'t'</span><span class="token punctuation">,</span> <span class="token string">"3"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">"4"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">"5"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">"5"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">"6"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…³äºå¯¹åº”çš„æµ‹è¯•ç¨‹åº <code>Replace consonants with appropriate numbers</code> éœ€è¦æ€è€ƒå…¶ä¸­çš„ä¸‰ä¸ªæ–­è¨€æ˜¯å¦èƒ½å¢åŠ å¯¹äºæ­¤åŠŸèƒ½çš„ç‰¹æ€§ç†è§£ï¼Œæˆ–è€…å¯¹ç‰¹æ®Šçš„è¡Œä¸ºæœ‰æè¿°ã€‚å¦‚æœæ²¡æœ‰é‚£ä¹ˆå°±å¯ä»¥ç®—ä½œé‡å¤çš„æµ‹è¯•å°†å…¶åˆ é™¤äº†ï¼Œæœ€ç»ˆä½¿ç”¨æ–­è¨€å¹¶é€‰ä¸€ä¸ªä¸åŒçš„è¾…éŸ³æ¥è¿›è¡Œæµ‹è¯•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Replace consonants with appropriate numbers"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Ax"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A200"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¦‚æœå‡ºç°åˆ«çš„æƒ…å†µå‘¢"><a href="#å¦‚æœå‡ºç°åˆ«çš„æƒ…å†µå‘¢" class="headerlink" title="å¦‚æœå‡ºç°åˆ«çš„æƒ…å†µå‘¢"></a>å¦‚æœå‡ºç°åˆ«çš„æƒ…å†µå‘¢</h2><p>ç°åœ¨å®ç°çš„ encodedDigit æ˜¯å‡å®šèƒ½å¤Ÿåœ¨ encodings æ˜ å°„ä¸­æ‰¾åˆ°ä¼ å…¥çš„å­—æ¯ï¼Œä¹‹å‰ä¸ºäº†ä»¥æœ€ä½é™åº¦é€šè¿‡æµ‹è¯•æ‰€åšçš„å‡è®¾ï¼Œç°åœ¨éœ€è¦è€ƒè™‘å…¶ä»–çš„æƒ…å†µï¼Œå³æœ‰æ²¡æœ‰å¯èƒ½ä¼ å…¥çš„å­—æ¯æ²¡æœ‰åœ¨æ˜ å°„ä¸­æ‰¾åˆ°ï¼Ÿå‘ç”Ÿæ—¶å¦‚ä½•è§£å†³ã€‚</p><p>Soundex å¦‚ä½•è§£å†³ä¸èƒ½è¯†åˆ«çš„å­—æ¯ï¼Ÿå¯ä»¥é€šè¿‡å®¢æˆ·æˆ–è€… Wiki ç™¾ç§‘äº†è§£åˆ°ï¼Œå³å¿½ç•¥ã€‚è¾“å…¥ A# å¾—åˆ° A000ã€‚ç°åœ¨ä¸ºè¿™ä¸ªè¡Œä¸ºç¼–å†™ä¸€äº›åˆ—å¤–çš„æƒ…å½¢æµ‹è¯•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Ignore nonrecognition characters"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"A#"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ä»£ç ä»¥é€šè¿‡æµ‹è¯•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">/** * @brief è·å–ä¸€ä¸ªå­—ç¬¦å¯¹åº”çš„æ•°å­— * * @param Letter * @return std::string */</span>std<span class="token operator">::</span>string <span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token keyword">char</span> Letter<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// clang-format off</span>    <span class="token keyword">const</span> std<span class="token operator">::</span>unordered_map<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> std<span class="token operator">::</span>string<span class="token operator">></span> encodings <span class="token punctuation">{</span>        <span class="token punctuation">{</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'v'</span><span class="token punctuation">,</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'j'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>                                    <span class="token punctuation">{</span> <span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">"2"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">"3"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'t'</span><span class="token punctuation">,</span> <span class="token string">"3"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> <span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token string">"4"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">"5"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'n'</span><span class="token punctuation">,</span> <span class="token string">"5"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">"6"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// clang-format on</span>    <span class="token keyword">auto</span> it <span class="token operator">=</span> encodings<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Letter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> it <span class="token operator">==</span> encodings<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">""</span> <span class="token operator">:</span> it<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“é€šè¿‡ TDD å®Œæˆä¸€ä¸ªå‘¨æœŸçš„åŠŸèƒ½æ—¶ï¼Œå¾€å¾€åœ¨é‡æ„ç¯èŠ‚å°±å¯ä»¥å¼€å§‹è€ƒè™‘å®Œå–„è¿™ä¸ªåŠŸèƒ½ï¼Œå¦‚åŒæ­¤ä¾‹ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¤ä¸ºé’ˆå¯¹å•ä¸€å­—ç¬¦è¾“å…¥ä¸ºå‰æå¯ä»¥æ­£ç¡®çš„è¿›è¡Œè½¬æ¢äº†ã€‚</p><h2 id="ä¸€æ¬¡åªåšä¸€ä»¶äº‹"><a href="#ä¸€æ¬¡åªåšä¸€ä»¶äº‹" class="headerlink" title="ä¸€æ¬¡åªåšä¸€ä»¶äº‹"></a>ä¸€æ¬¡åªåšä¸€ä»¶äº‹</h2><p>å½“å®Œæˆå•ä¸€å­—ç¬¦çš„è½¬æ¢ï¼Œç°åœ¨éœ€è¦é€šè¿‡æµ‹è¯•é©±åŠ¨å¼€å‘å‡ºç”¨ä»¥è½¬æ¢ä¸€ä¸ªè¯æœ«å°¾å‰©ä¸‹çš„å­—æ¯äº†ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Replaces multiple consonants with digits"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Acdl"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A234"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç®€å•çš„åŠæ³•ä¾¿æ˜¯é™¤ç¬¬ä¸€ä¸ªå­—æ¯ï¼Œéå†å‰©ä¸‹çš„å­—æ¯å¹¶è½¬æ¢ã€‚ä½†æ˜¯å½“å‰çš„ä»£ç ç»“æ„å¹¶ä¸å®¹æ˜“æ”¯æŒï¼Œå¯ä»¥å…ˆé‡æ„ä¸‹ä»£ç ã€‚</p><p>ä½†æ˜¯è¯·æ³¨æ„ï¼Œ<strong>ä¸€æ¬¡åªåšä¸€ä»¶äº‹ã€‚æµ‹è¯•é©±åŠ¨å¼€å‘æ—¶ï¼Œè¦ä¿æŒæ¯ä¸€æ­¥éƒ½ä¸åŒ</strong>ã€‚åœ¨å†™æµ‹è¯•æ—¶ï¼Œä¸è¦è·‘å»é‡æ„ã€‚åŒæ ·ï¼Œåœ¨å°è¯•è®©æµ‹è¯•é€šè¿‡æ—¶ä¹Ÿä¸è¦å»é‡æ„ã€‚å¹¶è¡Œæ€»æ˜¯å®¹æ˜“å‡ºé”™ï¼Œä¸æ˜¯ä¹ˆ ğŸ›ã€‚</p><p>ä¸ºäº†ä¾¿äºé‡æ„ï¼Œå…ˆå°†æˆ‘ä»¬åˆšæ‰çš„æµ‹è¯•æ³¨é‡Šæ‰ï¼Œ<code>[.]</code> æ ‡è¯†ä¼šä½¿ Catch2 è·³è¿‡è¿™ä¸ªæµ‹è¯•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Replaces multiple consonants with digits"</span><span class="token punctuation">,</span> <span class="token string">"[.][SoundexEncoding]"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‡æ„ä¸‹å½“å‰è§£å†³æ–¹æ¡ˆã€‚ä¸è¦å°†æ•´ä¸ªè¯ä¼ å…¥ encodedDigits()ï¼Œè€Œæ˜¯å°†è¯å°¾ï¼ˆé™¤äº†ç¬¬ä¸€ä¸ªå­—æ¯å¤–çš„å…¶ä½™å­—æ¯ï¼‰ä¼ å…¥ encodedDigits()ï¼Œè¿™æ ·éå†æ›´åŠ ç®€æ´ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹     *     * @param word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token function">head</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token function">tail</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment" spellcheck="true">/**     * @brief è·å–å•è¯é™¤äº†ç¬¬ä¸€ä¸ªå­—æ¯å¤–çš„å…¶ä½™å­—æ¯     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">tail</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Word<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment" spellcheck="true">/**     * @brief è·å–é¦–å­—æ¯åå…¶ä»–å­—ç¬¦è½¬åŒ–çš„å¯¹åº”æ•°å­—     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Word<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>Word<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œä¸‹æµ‹è¯•ç¡®ä¿æ”¹åŠ¨ä¸ä¼šç ´è¯å…¶ä»–åŠŸèƒ½ã€‚å›åˆ° TDD å‘¨æœŸå¼€å§‹ï¼Œå¯ç”¨è¢«æš‚æ—¶ç¦æ‰çš„æµ‹è¯• <code>"Replaces multiple consonants with digits"</code> ï¼Œä½¿å…¶å¤±è´¥ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief è·å–é¦–å­—æ¯åå…¶ä»–å­—ç¬¦è½¬åŒ–çš„å¯¹åº”æ•°å­—     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        std<span class="token operator">::</span>string encoding<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> letter <span class="token operator">:</span> Word<span class="token punctuation">)</span>            encoding <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> encoding<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ for å¾ªç¯éå†æ¯ä¸ªå­—æ¯ï¼Œè¿™æ ·ä¸åœ¨éœ€è¦å¯¹ Word è¿›è¡Œåˆ¤ç©ºäº†ï¼Œåˆ é™¤ä¹‹ã€‚</p><h2 id="é™åˆ¶é•¿åº¦"><a href="#é™åˆ¶é•¿åº¦" class="headerlink" title="é™åˆ¶é•¿åº¦"></a>é™åˆ¶é•¿åº¦</h2><p>è§„åˆ™ 4 å£°æ˜ Soundex ç¼–ç ç»“æœå¿…é¡»æ˜¯ 4 ä¸ªå­—ç¬¦ï¼Œä¸ºæ­¤è¡Œä¸ºå¢åŠ æ–°çš„æµ‹è¯•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Limits length to four characters"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Dcdlb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å®šä½é—®é¢˜é•¿å¤„è¶…å‡ºï¼Œä¿®å¤é—®é¢˜ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief è·å–é¦–å­—æ¯åå…¶ä»–å­—ç¬¦è½¬åŒ–çš„å¯¹åº”æ•°å­—     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        std<span class="token operator">::</span>string encoding<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> letter <span class="token operator">:</span> Word<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>encoding<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> MaxCodeLength <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            encoding <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> encoding<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡æ„ä¸‹ä»£ç ï¼Œæ›´å¥½çš„è¡¨è¾¾å«ä¹‰ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief è·å–é¦–å­—æ¯åå…¶ä»–å­—ç¬¦è½¬åŒ–çš„å¯¹åº”æ•°å­—     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        std<span class="token operator">::</span>string encoding<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> letter <span class="token operator">:</span> Word<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isComplete</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            encoding <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> encoding<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @brief å®Œæˆå­—ç¬¦ä¸²çš„ Soundex è§„åˆ™ç¼–ç      *     * @param Encoding     * @return true     * @return false     */</span>    <span class="token keyword">bool</span> <span class="token function">isComplete</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Encoding<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> MaxCodeLength <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸¢æ‰å…ƒéŸ³"><a href="#ä¸¢æ‰å…ƒéŸ³" class="headerlink" title="ä¸¢æ‰å…ƒéŸ³"></a>ä¸¢æ‰å…ƒéŸ³</h2><p>è§„åˆ™ 1 è¯´è¦ä¸¢æ‰æ‰€æœ‰çš„å…ƒéŸ³ä»¥åŠ wã€h å’Œ yã€‚ç°åœ¨ä¸ºæ­¤åŠŸèƒ½æ·»åŠ æµ‹è¯•ç”¨ä¾‹ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Ignores Vowel like letters"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Baeiouhycdl"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"B234"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œä¸‹æµ‹è¯•å‘ç°æ˜¯é€šè¿‡çš„ï¼Œä¸»è¦æ˜¯ç”±äº encodedDigit() å¯¹äºè½¬æ¢è¡¨ä¸­æ‰¾ä¸åˆ°çš„å­—æ¯ä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼šå¦‚æœæ²¡æœ‰æ”¹åŠ¨ç±»å®šä¹‰ï¼Œæµ‹è¯•å°±é€šè¿‡äº†ï¼Œé‚£èƒŒåè‚¯å®šå¦æœ‰æ•…äº‹ï¼ˆå‚è§ 3.5ï¼‰ï¼Œå¦‚æœæ¥ä¸‹æ¥çš„æµ‹è¯•ä¹Ÿéƒ½ç»§ç»­é€šè¿‡ï¼Œé‚£ä¹ˆåº”è¯¥è€ƒè™‘å›æ»šæ‰ä»£ç æ”¹åŠ¨ã€‚æµ‹è¯•æå‰é€šè¿‡çš„åŸå› ï¼Œå¯èƒ½æ˜¯ä½ çš„æ­¥ä¼æœ‰ç‚¹å¤§ï¼Œä½†è¿™æ ·ä½ å¯èƒ½ä¸ä¼šæ„Ÿå—åˆ° TDD å¸¦æ¥çš„å¥½å¤„ã€‚</p><h2 id="è®©æµ‹è¯•è‡ªæˆ‘æ¾„æ¸…"><a href="#è®©æµ‹è¯•è‡ªæˆ‘æ¾„æ¸…" class="headerlink" title="è®©æµ‹è¯•è‡ªæˆ‘æ¾„æ¸…"></a>è®©æµ‹è¯•è‡ªæˆ‘æ¾„æ¸…</h2><p>æ¥ä¸‹æ¥å¤„ç†ä¸¤ä¸ªç›¸é‚»å­—æ¯æœ‰ç›¸åŒæ•°å­—ç¼–ç çš„æƒ…å†µã€‚æŒ‰ç…§è§„åˆ™ 3ï¼Œå°†ç”¨ä¸€ä¸ªæ•°å­—æ ‡è¯†è¿™äº›å­—æ¯ï¼Œè¿™æ¡è§„åˆ™ä¹Ÿé€‚ç”¨äºç¬¬ä¸€ä¸ªå­—æ¯ã€‚å…ˆç”¨æµ‹è¯•æè¿°ç¬¬ä¸€ä¸ªæƒ…å†µï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Combines duplicate encodings"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Abfcgdt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A123"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>b å’Œ f éƒ½ç¼–ç ä¸º 1ï¼Œc å’Œ g ç¼–ç ä¸º 2ï¼Œd å’Œ t ç¼–ç ä¸º 3ã€‚æœ€ç»ˆ Abfcgdt â€“&gt; A123ã€‚å¯ä»¥æ·»åŠ ä¸€äº›å‰ç½®æ¡ä»¶ï¼ˆpreconditionï¼‰æ–­è¨€ï¼Œä»¥å¸®åŠ©é˜…è¯»ä»£ç çš„äººå»ºç«‹è¿™ç§å…³è”ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Combines duplicate encodings"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token string">"g"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token string">"t"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Abfcgdt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"A123"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œå°±éœ€è¦å°† encodedDigit è½¬åŒ–æˆ public æ¥å£ï¼Œä»è€…è§ä»ã€æ™ºè€…è§æ™ºå§ï¼Œä¸ªäººè¿˜æ˜¯è®¤ä¸ºè™½ç„¶è¿™æ ·æ›´åŠ æ–¹ä¾¿äº†åç»­è¯»å–ï¼Œä½†æ˜¯ä»£ç çš„å°è£…æ€§åŒæ ·é‡è¦ï¼Œå®¢æˆ·ä¸éœ€è¦çš„æ¥å£å®Œå…¨æ²¡æœ‰å¿…è¦æš´éœ²å‡ºæ¥ï¼Œå†™ä¸ªæ³¨é‡Šä¿¡æ¯ä¸ä¹Ÿå¾ˆå¥½ä¹ˆã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief è·å– Encoding æœ€åä¸€ä¸ªå­—ç¬¦     *     * @param Encoding     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">lastDigit</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// string åˆå§‹åŒ–ä¸€ä¸ªå­—ç¬¦çš„æ–¹æ³•</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·³å‡ºæ¡æ¡æ¡†æ¡†æ¥æµ‹è¯•"><a href="#è·³å‡ºæ¡æ¡æ¡†æ¡†æ¥æµ‹è¯•" class="headerlink" title="è·³å‡ºæ¡æ¡æ¡†æ¡†æ¥æµ‹è¯•"></a>è·³å‡ºæ¡æ¡æ¡†æ¡†æ¥æµ‹è¯•</h2><p>è€ƒè™‘é‡å¤çš„ç¬¬äºŒç§æƒ…å†µï¼Œç¬¬äºŒä¸ªå­—æ¯ä¸ç¬¬ä¸€ä¸ªå­—æ¯é‡å¤ã€‚å¯ä»¥å‘ç°ç›®å‰æ‰€æœ‰çš„æµ‹è¯•éƒ½æ˜¯ä»¥ä¸€ä¸ªå¤§å†™å­—æ¯å¼€å§‹ï¼Œå…¶ä½™éƒ½æ˜¯å°å†™ï¼Œä½†è¿™ä¸ªç®—æ³•åº”è¯¥æ˜¯å¤§å°å†™æ— å…³çš„ï¼Œè¿™é‡Œå¯ä»¥å…ˆæŠŠé‡å¤çš„æµ‹è¯•æš‚åœï¼Œå…ˆå¤„ç†ä¸‹å¤§å°å†™çš„æµ‹è¯•ã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿã€ç®€å•åœ°æ¯”è¾ƒï¼ŒSoundex ç®—æ³•å°†ç±»ä¼¼çš„è¯ç¼–ç è‡³ç›¸åŒçš„ä»£ç ã€‚å­—æ¯çš„å¤§å°å†™å¹¶ä¸å½±å“å‘éŸ³ã€‚ä½†ä¸ºäº†ç®€åŒ–æ¯”è¾ƒ Soundex ç¼–ç ï¼Œæˆ‘ä»¬å°†è‡ªå§‹è‡³ç»ˆä½¿ç”¨ä¸€æ ·çš„å†™æ³•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Upper cases first letter"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹ encode å°†é¦–å­—æ¯å¤§å†™ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief æŒ‰ç…§ Soundex ç®—æ³•è½¬æ¢è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹     *     * @param word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token function">upperFront</span><span class="token punctuation">(</span><span class="token function">head</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token function">tail</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment" spellcheck="true">/**     * @brief è¿”å›ä¼ å…¥çš„å­—ç¬¦ä¸²é¦–å­—æ¯å¤§å†™     *     * @param String     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">upperFront</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> String<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> std<span class="token operator">::</span><span class="token function">toupper</span><span class="token punctuation">(</span><span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">></span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜å¯ä»¥ä¿®æ”¹ â€œIgnores Vowel like lettersâ€ ç”¨ä¾‹æ¥ç¡®è®¤åŠŸèƒ½ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Ignores Vowel like letters"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"BaAeEiIoOuUhHyYcdl"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"B234"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>encodedDigits() ä¸­çš„ä»£ç æœ‰ç‚¹éšæ™¦å’Œéš¾ä»¥ç†è§£ã€‚æˆ‘ä»¬å¿…é¡»æ·±å…¥è€ƒè™‘æ¥å‘ç°ä»¥ä¸‹å‡ ç‚¹ï¼š<ol><li>è®¸å¤šå­—æ¯æ²¡æœ‰å¯¹åº”çš„ç¼–ç ï¼›</li><li>encodedDigit() å¯¹äºä¸Šè¿°å­—æ¯ä¼šè¿”å›ç©ºå­—ç¬¦ä¸²ï¼›</li><li>å°†ä¸€ä¸ªç©ºå­—ç¬¦ä¸²å’Œ encodedDigits() ä¸­çš„å˜é‡ encodings è¿æ¥èµ·æ¥æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚</li></ol></li></ul><p>é‡æ„ä¸€ä¸‹ï¼Œä»¥ä¾¿ä»£ç æ›´åŠ æ˜äº†ã€‚å°†åˆ é™¤ç©ºå­—ç¬¦ä¸²ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¼ æ›¿ä»£ï¼Œæ˜¾å¼åˆ¤æ–­æ— ç”¨çš„å­—ç¬¦ä¸åœ¨è¿›è¡Œç©ºå­—ç¬¦ä¸²æ‹¼æ¥ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">const</span> std<span class="token operator">::</span>string <span class="token function">NotADigit</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>std<span class="token operator">::</span>string <span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token keyword">char</span> Letter<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">auto</span> it <span class="token operator">=</span> encodings<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Letter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> it <span class="token operator">==</span> encodings<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> NotADigit <span class="token operator">:</span> it<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    std<span class="token operator">::</span>string encoding<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> letter <span class="token operator">:</span> Word<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isComplete</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token keyword">auto</span> digit <span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>digit <span class="token operator">!=</span> NotADigit <span class="token operator">&amp;&amp;</span> digit <span class="token operator">!=</span> <span class="token function">lastDigit</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> encoding <span class="token operator">+</span><span class="token operator">=</span> digit<span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> encoding<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>std<span class="token operator">::</span>string <span class="token function">lastDigit</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> NotADigit<span class="token punctuation">;</span>    <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// string åˆå§‹åŒ–ä¸€ä¸ªå­—ç¬¦çš„æ–¹æ³•</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥å¤„ç†ä¸€ä¸ªè¾…éŸ³å¤§å°å†™çš„æµ‹è¯•ï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Ignores case when encoding consonants"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"BCDL"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Bcdl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å®ƒå£°æ˜äº†å¯¹â€BCDLâ€å’Œâ€Bcdlâ€çš„ç¼–ç ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒå®é™…çš„ç¼–ç æ˜¯ä»€ä¹ˆï¼Œåªè¦å¤§å†™çš„è¾“å…¥å’Œå°å†™çš„è¾“å…¥å¾—åˆ°çš„ç»“æœä¸€æ ·å°±è¡Œã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief è·å–ä¸€ä¸ªå­—ç¬¦å¯¹åº”çš„æ•°å­—     *     * @param Letter     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encodedDigit</span><span class="token punctuation">(</span><span class="token keyword">char</span> Letter<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token keyword">auto</span> it <span class="token operator">=</span> encodings<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">lower</span><span class="token punctuation">(</span>Letter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> it <span class="token operator">==</span> encodings<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> NotADigit <span class="token operator">:</span> it<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">private</span><span class="token operator">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment" spellcheck="true">/**     * @brief å°†è¾“å…¥çš„ char å­—ç¬¦è½¬æ¢ä¸ºå°å†™     *     * @param C     * @return char     */</span>    <span class="token keyword">char</span> <span class="token function">lower</span><span class="token punctuation">(</span><span class="token keyword">char</span> C<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">tolower</span><span class="token punctuation">(</span><span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">></span><span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¨€å½’æ­£ä¼ "><a href="#è¨€å½’æ­£ä¼ " class="headerlink" title="è¨€å½’æ­£ä¼ "></a>è¨€å½’æ­£ä¼ </h2><p>ç°åœ¨å¼€å§‹å¤„ç†ç¬¬äºŒä¸ªå­—ç¬¦ä¸ç¬¬ä¸€ä¸ªå­—ç¬¦ç›¸åŒçš„æƒ…å†µã€‚è¿™ä¸ªå°±æ˜¯ä¿ƒä½¿æˆ‘ä»¬å…ˆå°†ç®—æ³•æ”¹å†™ä¸ºå¤§å°å†™æ— å…³çš„ï¼Œç°åœ¨ç¼–å†™è¿™ä¸ªè¡Œä¸ºæµ‹è¯•ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Combines duplicate codes when 2nd letter duplicates 1st"</span><span class="token punctuation">,</span> <span class="token string">"[SoundexEncoding]"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Bbcd"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"B230"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å®ç°æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯å°†éœ€è¦ç¼–ç çš„è¯ä»ä¹‹å‰çš„ä¹‹å°†è¯å°¾ä¼ å…¥ encodedDigits() æ”¹ä¸ºå°†æ•´ä¸ªè¯éƒ½ä¼ å…¥å…¶ä¸­ï¼Œä½¿å…¶å¯ä»¥å…ˆåˆ†æé¦–å­—æ¯è½¬æ¢å®Œæˆåçš„æ•°å­—ï¼Œç„¶åæ¯”å¯¹ç¬¬äºŒä¸ªå­—æ¯æ˜¯å¦éœ€è¦ä¸¢å¼ƒï¼š</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    std<span class="token operator">::</span>string <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">zeroPad</span><span class="token punctuation">(</span><span class="token function">upperFront</span><span class="token punctuation">(</span><span class="token function">head</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">tail</span><span class="token punctuation">(</span><span class="token function">encodedDigits</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        std<span class="token operator">::</span>string encoding<span class="token punctuation">;</span>        encoding <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>Word<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> letter <span class="token operator">:</span> Word<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isComplete</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">auto</span> digit <span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>digit <span class="token operator">!=</span> NotADigit <span class="token operator">&amp;&amp;</span> digit <span class="token operator">!=</span> <span class="token function">lastDigit</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> encoding <span class="token operator">+</span><span class="token operator">=</span> digit<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> encoding<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é‡æ„è‡³å•ä¸€è´£ä»»çš„å‡½æ•°"><a href="#é‡æ„è‡³å•ä¸€è´£ä»»çš„å‡½æ•°" class="headerlink" title="é‡æ„è‡³å•ä¸€è´£ä»»çš„å‡½æ•°"></a>é‡æ„è‡³å•ä¸€è´£ä»»çš„å‡½æ•°</h2><p>æ˜¯æ—¶å€™è€ƒè™‘é‡æ„äº†ï¼Œè€ƒè™‘å•ä¸€è´£ä»»åŸåˆ™ï¼Œå‡½æ•° encodedDigits() å˜å¾—å¾ˆå¤æ‚ï¼Œå®ƒé€šè¿‡ä¸¤ä¸ªæ­¥éª¤å®Œæˆç®—æ³•ï¼š</p><ol><li>å®ƒé¦–å…ˆå°†é¦–å­—æ¯çš„ç¼–ç è¿½åŠ è‡³å˜é‡ encoding ä¸­ï¼›</li><li>ç„¶åéå†å‰©ä¸‹çš„å­—æ¯ï¼Œè¿½åŠ ç»“æœè‡³ encodingã€‚</li></ol><p>å¯ä»¥å°† encodedDigits() ä¸­çš„ä¸¤ä¸ªæ­¥éª¤æå–æˆä¸¤ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°å„è‡ªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µçš„å®ç°ç»†èŠ‚ã€‚å¦‚æ­¤ï¼ŒencodedDigits() ä¸­çš„ä»£ç åªæ˜¯å£°æ˜äº†è§£å†³æ–¹æ¡ˆçš„ç­–ç•¥ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief è·å–é¦–å­—æ¯åå…¶ä»–å­—ç¬¦è½¬åŒ–çš„å¯¹åº”æ•°å­—     *     * @param Word     * @return std::string     */</span>    std<span class="token operator">::</span>string <span class="token function">encodedDigits</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        std<span class="token operator">::</span>string encoding<span class="token punctuation">;</span>        <span class="token function">encodeHead</span><span class="token punctuation">(</span>encoding<span class="token punctuation">,</span> Word<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">encodeTail</span><span class="token punctuation">(</span>encoding<span class="token punctuation">,</span> Word<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> encoding<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @brief å¯¹è¯é¦–å­—æ¯è¿›è¡Œç¼–ç ç¿»è¯‘     *     * @param Encoding     * @param Word     */</span>    <span class="token keyword">void</span> <span class="token function">encodeHead</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> Encoding <span class="token operator">+</span><span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>Word<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @brief å¯¹è¯å°¾å­—ç¬¦è¿›è¡Œç¼–ç ç¿»è¯‘     *     * @param Encoding     * @param Word     */</span>    <span class="token keyword">void</span> <span class="token function">encodeTail</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> letter <span class="token operator">:</span> <span class="token function">tail</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isComplete</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">auto</span> digit <span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>letter<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>digit <span class="token operator">!=</span> NotADigit <span class="token operator">&amp;&amp;</span> digit <span class="token operator">!=</span> <span class="token function">lastDigit</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> Encoding <span class="token operator">+</span><span class="token operator">=</span> digit<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°† encodeTail() ä¸­çš„ for å¾ªç¯ä½“æå–å‡ºæ¥ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief å¯¹è¯å°¾å­—ç¬¦è¿›è¡Œç¼–ç ç¿»è¯‘     *     * @param Encoding     * @param Word     */</span>    <span class="token keyword">void</span> <span class="token function">encodeTail</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> letter <span class="token operator">:</span> <span class="token function">tail</span><span class="token punctuation">(</span>Word<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isComplete</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">encodeLetter</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">,</span> letter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @brief ç¿»è¯‘å•ä¸€å­—ç¬¦ letter å¹¶æ‹¼æ¥åˆ° Encoding     *     * @param Encoding     * @param Letter     */</span>    <span class="token keyword">void</span> <span class="token function">encodeLetter</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">,</span> <span class="token keyword">char</span> Letter<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">auto</span> digit <span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>Letter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>digit <span class="token operator">!=</span> NotADigit <span class="token operator">&amp;&amp;</span> digit <span class="token operator">!=</span> <span class="token function">lastDigit</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Encoding <span class="token operator">+</span><span class="token operator">=</span> digit<span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰è®¸å¤šä¼˜åŒ–ï¼Œè¯¦æƒ…å¯ä»¥çœ‹çœ‹ç¬”è®°é…å¥—çš„ç¨‹åºä»£ç ã€‚</p><h2 id="æ”¶å°¾å·¥ä½œ"><a href="#æ”¶å°¾å·¥ä½œ" class="headerlink" title="æ”¶å°¾å·¥ä½œ"></a>æ”¶å°¾å·¥ä½œ</h2><p>é‚£å…ƒéŸ³æ€ä¹ˆåŠå‘¢ï¼Ÿè§„åˆ™ 3 è¯´è¢«ä¸€ä¸ªå…ƒéŸ³ï¼ˆä¸æ˜¯ h æˆ– w ï¼‰åˆ†å¼€çš„ç›¸åŒç¼–ç ï¼Œåº”è¯¥ç¼–ç ä¸¤æ¬¡ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_CASE_METHOD</span><span class="token punctuation">(</span>FixtureSoundex<span class="token punctuation">,</span> <span class="token string">"Does not combine duplicate encodings separate by vowels"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">REQUIRE_THAT</span><span class="token punctuation">(</span>MSoundex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"Jbob"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">"J110"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹äº† encodeLetter() ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œåœ¨ä¸æ˜¯é‡å¤ç¼–ç æˆ–æœ€åä¸€ä¸ªå­—æ¯æ˜¯å…ƒéŸ³çš„æƒ…å†µä¸‹ï¼Œè¿½åŠ ä¸€ä¸ªæ•°å­—ã€‚è¿™ä¸ªå£°æ˜ä¹Ÿæ•¦ä¿ƒäº†ä¸€äº›å…¶ä»–çš„ç›¸åº”æ”¹åŠ¨ã€‚</p><pre class="line-numbers language-cpp"><code class="language-cpp">    <span class="token comment" spellcheck="true">/**     * @brief å¯¹è¯å°¾å­—ç¬¦è¿›è¡Œç¼–ç ç¿»è¯‘     *     * @param Encoding     * @param Word     */</span>    <span class="token keyword">void</span> <span class="token function">encodeTail</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Word<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> i <span class="token operator">=</span> <span class="token number">1u</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isComplete</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">encodeLetter</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">,</span> Word<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> Word<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @brief ç¿»è¯‘å•ä¸€å­—ç¬¦ letter å¹¶æ‹¼æ¥åˆ° Encoding     *     * @param Encoding     * @param Letter     */</span>    <span class="token keyword">void</span> <span class="token function">encodeLetter</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Encoding<span class="token punctuation">,</span> <span class="token keyword">char</span> Letter<span class="token punctuation">,</span> <span class="token keyword">char</span> LastLetter<span class="token punctuation">)</span> <span class="token keyword">const</span>    <span class="token punctuation">{</span>        <span class="token keyword">auto</span> digit <span class="token operator">=</span> <span class="token function">encodedDigit</span><span class="token punctuation">(</span>Letter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>digit <span class="token operator">!=</span> NotADigit <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">isDuplicateLetter</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">,</span> digit<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isVowel</span><span class="token punctuation">(</span>LastLetter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Encoding <span class="token operator">+</span><span class="token operator">=</span> digit<span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * @brief åˆ¤æ–­æ˜¯å¦æ˜¯å…ƒéŸ³å­—ç¬¦     *     * @param Letter     * @return true     * @return false     */</span>    <span class="token keyword">bool</span> <span class="token function">isVowel</span><span class="token punctuation">(</span><span class="token keyword">char</span> Letter<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"aeiouy"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">lower</span><span class="token punctuation">(</span>Letter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> std<span class="token operator">::</span>string<span class="token operator">::</span>npos<span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ¼äº†ä»€ä¹ˆæµ‹è¯•ç "><a href="#æ¼äº†ä»€ä¹ˆæµ‹è¯•ç " class="headerlink" title="æ¼äº†ä»€ä¹ˆæµ‹è¯•ç "></a>æ¼äº†ä»€ä¹ˆæµ‹è¯•ç </h2><p>æˆ‘ä»¬å¾ˆå°‘æ‹¥æœ‰æ‰€æœ‰çš„è§„èŒƒã€‚å¾ˆå°‘æœ‰äººä¼šå¦‚æ­¤å¹¸è¿ã€‚å³ä¾¿æ˜¯ Soundex çš„è§„åˆ™ï¼Œçœ‹ä¼¼å®Œæ•´ï¼Œå®é™…å´ä¸èƒ½è•´å«æ‰€æœ‰æƒ…å½¢ã€‚åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œä¸€äº›æµ‹è¯•æˆ–ä»£ç å®ç°ç»å¸¸ä¼šæ¿€å‘æˆ‘ä»¬è¿›è¡Œå…¶ä»–æ–¹é¢çš„æ€è€ƒã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè¦ä¹ˆæŠŠè¿™äº›æ€è€ƒç»“æœè®°åœ¨è„‘å­é‡Œï¼Œè¦ä¹ˆå†™åˆ°ä¸€ä¸ªåˆ—è¡¨æˆ–è®°äº‹æœ¬ä¸­ã€‚ä¸‹é¢å°±æ˜¯å¯¹ Soundex è¿›è¡Œæ€è€ƒè€Œå¾—åˆ°çš„åˆ—è¡¨ã€‚</p><ul><li>è‹¥ç»™å®šçš„è¯ä¸­å«æœ‰åˆ†éš”ç¬¦ï¼Œå¦‚å¥ç‚¹ï¼ˆä¾‹å¦‚ï¼ŒMr.Smithï¼‰ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿåº”è¯¥å¿½ç•¥å®ƒä»¬ï¼ˆå°±åƒç°åœ¨åšçš„è¿™æ ·ï¼‰ï¼ŒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼ˆå‡å®šå®¢æˆ·åº”è¯¥æŠŠè¯åˆç†åœ°åˆ†å¥½ï¼‰ï¼Œè¿˜æ˜¯åšäº›å…¶ä»–æ“ä½œï¼Ÿè¯´åˆ°å¼‚å¸¸ï¼Œæ€æ ·ä»¥æµ‹è¯•é©±åŠ¨çš„æ–¹æ³•åœ¨ä»£ç ä¸­åŠ å…¥å¼‚å¸¸å¤„ç†ï¼Ÿåœ¨ 4.4.5 èŠ‚ä¸­ï¼Œä½ å°†å­¦åˆ°æ€æ ·è®¾è®¡æœŸæœ›æŠ›å‡ºå¼‚å¸¸çš„æµ‹è¯•ã€‚</li><li>ç©ºå­—ç¬¦ä¸²è¯¥æ€æ ·ç¼–ç ?ï¼ˆæˆ–è€…è¯´ï¼Œå¯ä»¥å‡å®šä¸ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªç©ºå­—ç¬¦ä¸²è¾“å…¥å—ï¼Ÿï¼‰</li><li>è¯¥æ€æ ·å¤„ç†éè‹±è¯­å­—æ¯ä¸­çš„è¾…éŸ³ï¼ˆå¦‚ Ã±ï¼‰ï¼ŸSoundex ç®—æ³•ä¾ç„¶é€‚ç”¨å—ï¼ŸisVowel()å‡½æ•°éœ€è¦æ”¯æŒå¸¦å˜éŸ³ç¬¦çš„å…ƒéŸ³å—ï¼Ÿ</li></ul><p>å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜åº”å½“é€‚æ—¶çš„åšå‡ºè‡ªå·±çš„å†³å®šï¼Œæœ€å¥½çš„æ–¹æ³•å¾€å¾€æ—¶é—®é—®å®¢æˆ·ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåº”å…·å¤‡çš„ä¸€äº›é‡è¦ç‰¹å¾ã€‚</p><ul><li>å®ƒå®ç°äº†å®¢æˆ·çš„éœ€æ±‚ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆä¸ç®¡æ€æ ·ï¼Œå®ƒéƒ½ä¸æ˜¯å¥½çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨ TDD ä¸­ï¼Œä½ ç¼–å†™çš„æµ‹è¯•èƒ½å¤Ÿå¸®åŠ©ä½ äº†è§£ä½ çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸æ˜¯å®¢æˆ·è¦çš„ã€‚æ€§èƒ½å¯èƒ½æ˜¯ä¼—å¤šå®¢æˆ·éœ€æ±‚ä¸­çš„ä¸€é¡¹ã€‚ä½ çš„ä¸€éƒ¨åˆ†èŒè´£å°±æ˜¯ç†è§£ä»–ä»¬çš„æ€§èƒ½éœ€æ±‚ï¼Œå¦‚æœæ²¡å¿…è¦çš„è¯ï¼Œå°±ä¸è¦èŠ±è´¹æ—¶é—´å»åšæ€§èƒ½ä¼˜åŒ–ã€‚</li><li>å®ƒå¯ä»¥å·¥ä½œã€‚å¦‚æœä¸€ä¸ªè§£å†³æ–¹æ¡ˆæœ‰å¤§é‡çš„ç¼ºé™·ï¼Œé‚£ä¹ˆæ„å»ºå¾—å†ä¼˜é›…ï¼Œä¹Ÿä¸æ˜¯å¥½çš„è§£å†³æ–¹æ¡ˆã€‚TDD å¯ä»¥å¸®åŠ©ç¡®å®šæˆ‘ä»¬äº¤ä»˜çš„è½¯ä»¶èƒ½ä»¥æœŸæœ›çš„æ–¹å¼å·¥ä½œã€‚TDD ä¸æ˜¯é“¶å¼¹ã€‚ä½ äº¤ä»˜çš„è½¯ä»¶ä¾ç„¶ä¼šæœ‰ç¼ºé™·ï¼Œæ‰€ä»¥ç…§æ ·éœ€è¦è®¸å¤šå…¶ä»–æ–¹å¼çš„æµ‹è¯•ã€‚ä½†æ˜¯ï¼ŒTDD ä¼šè®©ä½ å‘å¸ƒçš„ä»£ç åŒ…å«éå¸¸å°‘çš„ç¼ºé™·ã€‚</li><li>å®ƒæ˜“äºç†è§£ã€‚å¯¹äºç¼–å†™å¾—ä¸å¥½çš„ä»£ç ï¼Œæ¯ä¸ªäººéƒ½éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å»ç†è§£ã€‚TDD è®©ä½ å¯ä»¥å®‰å…¨åœ°é‡æ–°ç»„ç»‡ä»£ç ä»¥æé«˜å¯è¯»æ€§ã€‚</li><li>å®ƒæ˜“äºä¿®æ”¹ã€‚é€šå¸¸ï¼Œå®¹æ˜“ä¿®æ”¹çš„ä»£ç æ„å‘³ç€é«˜è´¨é‡çš„è®¾è®¡ã€‚TDD ä½¿ä½ å¯ä»¥æŒç»­åœ°ä¿®æ”¹ï¼Œä»¥ä¿æŒè®¾è®¡çš„é«˜è´¨é‡ã€‚</li></ul><h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>è‡³æ­¤ï¼Œä¾¿å®Œæˆäº†ä¸€ä¸ªå®é™…çš„ TDD è¿‡ç¨‹ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>TDD çš„è·µè¡Œæ­¥éª¤ï¼š<ol><li>ç¼–è¯‘ä¸€ä¸ªæœ€åŸºæœ¬å•å…ƒåŠŸèƒ½çš„æµ‹è¯•ä»£ç ã€‚</li><li>æµ‹è¯•å¤±è´¥ã€‚</li><li>å®ç°åŠŸèƒ½ä»£ç <strong>æœ€ä½é™åº¦</strong>ä½¿å¾—æµ‹è¯•ä»£ç é€šè¿‡ã€‚</li><li>æµ‹è¯•æˆåŠŸã€‚</li><li>goto â¬† ç¬¬ä¸€æ­¥ã€‚</li><li>TDD çš„å„ä¸ªå‘¨æœŸéƒ½ä¼šä½¿ç”¨é‡æ„æ¥å®¡é˜…è®¾è®¡ã€‚</li></ol></li></ul><h3 id="è·µè¡Œæ­¥éª¤è§£æ"><a href="#è·µè¡Œæ­¥éª¤è§£æ" class="headerlink" title="è·µè¡Œæ­¥éª¤è§£æ"></a>è·µè¡Œæ­¥éª¤è§£æ</h3><ul><li><p>ç¼–å†™æœ€åŸºæœ¬çš„å•å…ƒåŠŸèƒ½æµ‹è¯•ä»£ç ï¼šè¯·è°¨è®°æˆ‘ä»¬è·µè¡Œçš„æ˜¯ TDDï¼Œè€Œéå•çº¯çš„æµ‹è¯•å·¥ä½œï¼Œåº”è¯¥æµ‹è¯•çš„æ˜¯ä»£ç è¡Œä¸ºï¼Œå½“å‘æµ‹è¯•ä»£ç æ·»åŠ é‡å¤çš„æ–­è¨€è¯­å¥æ—¶åº”è¯¥è‡ªé—®ä¸‹è¿™ä¸ªæ–­è¨€æ˜¯å¦å¯ä»¥æå‡å¯¹æµ‹è¯•å«ä¹‰ä»¥åŠåŠŸèƒ½çš„ç†è§£ã€‚</p></li><li><p>æµ‹è¯•å¤±è´¥ï¼šæ¯æ¬¡ä»¥æœ€å°çš„æ­¥ä¼å‘å‰æ¨è¿›ï¼Œå¼•èµ·é—®é¢˜åå°±å»è§£å†³æ‰å®ƒã€‚</p></li><li><p>å®ç°åŠŸèƒ½ä»£ç æœ€ä½é™åº¦çš„ä½¿å¾—æµ‹è¯•ä»£ç é€šè¿‡ï¼š</p><ul><li><code>æœ€ä½é™åº¦</code> å³åˆšåˆšå¥½æ»¡è¶³æµ‹è¯•ç”¨ä¾‹æ‰€éœ€è¦çš„åŠŸèƒ½ï¼Œå³ä½¿æ˜¯é€šè¿‡ç‰¹ä¾‹æ¥å®Œæˆçš„ã€‚å°±åƒ Soundex ä¸­å‡ºç°è¿‡å¤šæ¬¡ç‰¹ä¾‹ä¸€æ ·ï¼Œç»å¸¸ä½¿ç”¨ç‰¹ä¾‹çš„æ–¹æ³•æ¥å¿«é€Ÿé€šè¿‡æµ‹è¯•ä»£ç ã€‚</li><li>ä½†æ˜¯è¯·æ³¨æ„ç‰¹ä¾‹ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå°±åƒæ–‡æ¡£ä¸­æˆ‘æ‰€è®²çš„ <strong>ä¸è¦ä½¿ç”¨å·²æœ‰çš„å¤„ç†é€»è¾‘</strong>ï¼Œé¿å…ä½¿ç”¨å¤§é‡çš„ç‰¹ä¾‹æµªè´¹æ—¶é—´ï¼Œå½“ç¬¬äºŒæ¬¡æ·»åŠ çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå°±ä¸å¯ä»¥å†ä½¿ç”¨ä¸Šä¸€æ¬¡ä¸€æ ·çš„ç‰¹ä¾‹æ–¹æ³•äº†ï¼Œåº”è¯¥å¯»æ±‚æ›´åŠ é€šç”¨çš„å®ç°æ–¹æ³•ã€‚è¿™ä¸€æ­¥ä¸ä»…ä»…æ˜¯é‡æ„ï¼Œä¹Ÿæ˜¯ä½œä¸ºæˆ‘ä»¬ä»£ç å¼€å‘å‰è¿›çš„åŠ¨åŠ›ï¼Œæ˜¯å¯¹è¡Œä¸ºçš„ä¸€ç§å®Œå–„ã€‚</li></ul></li><li><p>æµ‹è¯•æˆåŠŸï¼šå¿…ç„¶ä¿è¯ä¹‹å‰å¤±è´¥çš„ç”¨ä¾‹è¦æ­£ç¡®çš„é€šè¿‡ï¼Œä¸”æ²¡æœ‰å½±å“å·²æœ‰çš„ç”¨ä¾‹ã€‚</p></li><li><p>å®¡è§†ä»£ç è¿›è¡Œé‡æ„ï¼šé‡æ„ä¸ä»…ä»…æ˜¯æŸä¸ªå•ä¸€æ­¥éª¤æ‰§è¡Œï¼Œè€Œæ˜¯å½“å†ç» TDD çš„å„ä¸ªå‘¨æœŸæ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨é‡æ„æ¥å®¡é˜…è®¾è®¡ï¼ŒåŒæ—¶ä¿®å¤å‡ºç°çš„æ‰€æœ‰é—®é¢˜ã€‚é‡æ„çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯æå‡è¡¨è¾¾èƒ½åŠ›ï¼Œå»é™¤é‡å¤ä»£ç ã€‚å°±ä»£ç çš„å¯ç»´æŠ¤æ€§æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªç‚¹æœ€æœ‰è£¨ç›Šã€‚</p></li><li><p>ä¸€æ¬¡åªè¿›è¡Œä¸€ä»¶äº‹ï¼šå½“å‘ç°ä¸€ä¸ªè¡Œä¸ºçš„å®ç°å¯èƒ½éœ€è¦å…ˆé‡æ„ä¸‹ä»£ç æ‰èƒ½æ›´æ–¹ä¾¿çš„æ”¯æŒï¼Œé‚£ä¹ˆå°±è¦å…ˆå°†è¿™ä¸ªè¡Œä¸ºå¤±è´¥çš„æµ‹è¯•æè¿°å…ˆæ³¨é‡Šæ‰ã€‚å½“å®Œæˆé‡æ„åå†æ‰“å¼€å¹¶å®Œæˆã€‚<strong>ä¸€æ¬¡åªåšä¸€ä»¶äº‹ã€‚æµ‹è¯•é©±åŠ¨å¼€å‘æ—¶ï¼Œè¦ä¿æŒæ¯ä¸€æ­¥éƒ½ä¸åŒ</strong>ã€‚å†å†™æµ‹è¯•æ—¶ï¼Œä¸è¦è·‘å»é‡æ„ã€‚åŒæ ·ï¼Œåœ¨å°è¯•è®©æµ‹è¯•é€šè¿‡æ—¶ä¹Ÿä¸è¦å»é‡æ„ã€‚</p></li><li><p>å¦‚æœå‡ºç°å¹¶æœªä¸»åŠ¨å®ç°å¯¹åº”è¡Œä¸ºä»£ç ï¼Œæ–°å¢åŠ çš„æµ‹è¯•ç”¨ä¾‹ç¡®æˆåŠŸäº†è¿™æ—¶å°±è¦è­¦æƒ•ï¼šå¦‚æœæ¥ä¸‹æ¥çš„æµ‹è¯•ä¹Ÿéƒ½ç»§ç»­é€šè¿‡ï¼Œé‚£ä¹ˆåº”è¯¥è€ƒè™‘å›æ»šæ‰ä»£ç æ”¹åŠ¨ã€‚æµ‹è¯•æå‰é€šè¿‡çš„åŸå› ï¼Œå¯èƒ½æ˜¯ä½ çš„æ­¥ä¼æœ‰ç‚¹å¤§ï¼Œä½†è¿™æ ·ä½ å¯èƒ½ä¸ä¼šæ„Ÿå—åˆ° TDD å¸¦æ¥çš„å¥½å¤„ã€‚</p></li></ul><hr><ul><li>ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåº”å…·å¤‡çš„ä¸€äº›é‡è¦ç‰¹å¾ã€‚<ul><li>å®ƒå®ç°äº†å®¢æˆ·çš„éœ€æ±‚ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆä¸ç®¡æ€æ ·ï¼Œå®ƒéƒ½ä¸æ˜¯å¥½çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨ TDD ä¸­ï¼Œä½ ç¼–å†™çš„æµ‹è¯•èƒ½å¤Ÿå¸®åŠ©ä½ äº†è§£ä½ çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸æ˜¯å®¢æˆ·è¦çš„ã€‚æ€§èƒ½å¯èƒ½æ˜¯ä¼—å¤šå®¢æˆ·éœ€æ±‚ä¸­çš„ä¸€é¡¹ã€‚ä½ çš„ä¸€éƒ¨åˆ†èŒè´£å°±æ˜¯ç†è§£ä»–ä»¬çš„æ€§èƒ½éœ€æ±‚ï¼Œå¦‚æœæ²¡å¿…è¦çš„è¯ï¼Œå°±ä¸è¦èŠ±è´¹æ—¶é—´å»åšæ€§èƒ½ä¼˜åŒ–ã€‚</li><li>å®ƒå¯ä»¥å·¥ä½œã€‚å¦‚æœä¸€ä¸ªè§£å†³æ–¹æ¡ˆæœ‰å¤§é‡çš„ç¼ºé™·ï¼Œé‚£ä¹ˆæ„å»ºå¾—å†ä¼˜é›…ï¼Œä¹Ÿä¸æ˜¯å¥½çš„è§£å†³æ–¹æ¡ˆã€‚TDD å¯ä»¥å¸®åŠ©ç¡®å®šæˆ‘ä»¬äº¤ä»˜çš„è½¯ä»¶èƒ½ä»¥æœŸæœ›çš„æ–¹å¼å·¥ä½œã€‚TDD ä¸æ˜¯é“¶å¼¹ã€‚ä½ äº¤ä»˜çš„è½¯ä»¶ä¾ç„¶ä¼šæœ‰ç¼ºé™·ï¼Œæ‰€ä»¥ç…§æ ·éœ€è¦è®¸å¤šå…¶ä»–æ–¹å¼çš„æµ‹è¯•ã€‚ä½†æ˜¯ï¼ŒTDD ä¼šè®©ä½ å‘å¸ƒçš„ä»£ç åŒ…å«éå¸¸å°‘çš„ç¼ºé™·ã€‚</li><li>å®ƒæ˜“äºç†è§£ã€‚å¯¹äºç¼–å†™å¾—ä¸å¥½çš„ä»£ç ï¼Œæ¯ä¸ªäººéƒ½éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å»ç†è§£ã€‚TDD è®©ä½ å¯ä»¥å®‰å…¨åœ°é‡æ–°ç»„ç»‡ä»£ç ä»¥æé«˜å¯è¯»æ€§ã€‚</li><li>å®ƒæ˜“äºä¿®æ”¹ã€‚é€šå¸¸ï¼Œå®¹æ˜“ä¿®æ”¹çš„ä»£ç æ„å‘³ç€é«˜è´¨é‡çš„è®¾è®¡ã€‚TDD ä½¿ä½ å¯ä»¥æŒç»­åœ°ä¿®æ”¹ï¼Œä»¥ä¿æŒè®¾è®¡çš„é«˜è´¨é‡ã€‚</li></ul></li></ul><h3 id="TDD-Q-amp-A"><a href="#TDD-Q-amp-A" class="headerlink" title="TDD Q&amp;A"></a>TDD Q&amp;A</h3><ol><li><p>æœ‰æ—¶ä¹Ÿä¼šæ‹…å¿ƒä¸€äº›å®ç°çš„ç»†èŠ‚å¹¶ä¸æ˜¯é‚£ä¹ˆå¥½ï¼Œæ˜¯å¦åº”è¯¥å†é‡æ„æ˜¯è€ƒè™‘ä¼˜åŒ–ï¼Ÿ</p><ul><li>å†æœªå®Œå…¨å®ç°åŠŸèƒ½è®¾è®¡ä¹‹å‰ï¼Œè¿™äº›éƒ½å±äºè¿‡æ—©ä¼˜åŒ–ã€‚è¿™ä¸ªæ—¶å€™ä¸€ä¸ªå¥½çš„è®¾è®¡æ›´é‡è¦ï¼Œä¸€æ—¦ä»¥ç‰¢é çš„è®¾è®¡å®ç°äº†æ­£ç¡®çš„è¡Œä¸ºåï¼Œå¹¶ä¸”æœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•æ¥ç»™ä½ æä¾›å‹‡æ°”åå†è¿›è¡Œä¼˜åŒ–å§ï¼</li></ul></li><li><p>æ²¡æœ‰è¢«å•å…ƒæµ‹è¯•ä»£ç æ‰€æè¿°çš„è¡Œä¸ºç®—æ­£ç¡®è¿˜æ˜¯é”™è¯¯ï¼Ÿ</p><ul><li>ä»»ä½•æ—¶å€™ï¼Œä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•é›†åˆå£°æ˜äº†ç³»ç»Ÿä¸­æœŸæœ›çš„è¡Œä¸ºã€‚è¿™é‡Œè•´å«ç€ä¸€ä¸ªæ½œå°è¯ï¼šå¦‚æœä¸€ä¸ªè¡Œä¸ºæ²¡æœ‰å¯¹åº”çš„æµ‹è¯•æ¥æè¿°ï¼Œé‚£è¿™ä¸ªè¡Œä¸ºè¦ä¹ˆä¸å­˜åœ¨ï¼Œè¦ä¹ˆä¸æ˜¯æœŸæœ›çš„ï¼ˆæˆ–è€…æµ‹è¯•æœ¬èº«æ²¡æœ‰å°½åˆ°æè¿°è¡Œä¸ºçš„èŒè´£ï¼‰ã€‚</li></ul></li><li><p>å¯¹äºæœ‰å¤§é‡çš„æ•°æ®ç»†èŠ‚æµ‹è¯•ï¼Œä¾‹å¦‚ Soundex ä¸­çš„è¾…éŸ³è¡¨ï¼Œæ˜¯å¦éœ€è¦å°†æ‰€æœ‰çš„è¡¨ä¿¡æ¯éƒ½è¿›è¡Œå•å…ƒæµ‹è¯•è¦†ç›–ï¼Ÿ</p><ul><li>è¯·æ³¨æ„æˆ‘ä»¬å®åœ¨è¿›è¡Œ<code>æµ‹è¯•é©±åŠ¨å¼€å‘</code>ï¼Œè€Œéæµ‹è¯•ã€‚TDD ç€åŠ›äºä»£ç è®¾è®¡ã€‚æµ‹è¯•ä¸»è¦ç”¨äºè¡¨è¿°ä½ è¦æ„å»ºçš„è¡Œä¸ºã€‚TDD è¿‡ç¨‹ä¸­ç¼–å†™çš„æµ‹è¯•å¤§éƒ½æ˜¯è¿™ä¸ªæµç¨‹çš„é™„å±äº§ç‰©ã€‚æœ‰äº†è¿™äº›æµ‹è¯•ï¼Œåœ¨æ¥ä¸‹æ¥æ”¹åŠ¨ä»£ç æ—¶ï¼Œä½ ä¼šæ›´æœ‰ä¿¡å¿ƒã€‚è€Œä¸” TDD çš„ä¸€ä¸ªé‡è¦æ–¹é¢å°±æ˜¯å¤Ÿç”¨å³å¯ï¼Œåœ¨å¼€å‘æ–°åŠŸèƒ½å³è¡Œä¸ºæ—¶ï¼Œç¼–å†™æµ‹è¯•è¦†ç›–ï¼Œè€Œé€»è¾‘ä»£ç ä¸åœ¨æ”¹å˜æ—¶ï¼Œå°±ä¸ç”¨ç¼–å†™æµ‹è¯•ä»£ç äº†ã€‚</li><li>ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ è¯»å–è¿™ä¸ªè¡¨æ•°æ®çš„è¡Œä¸ºå•ä¸€ï¼Œé‚£ä¹ˆå®ƒå°±ä¸éœ€è¦å…¨éƒ¨éƒ½è¦†ç›–åˆ°ã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ï¼ˆä¸€ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--ç¯å¢ƒè®¾ç½®</title>
      <link href="/2022/06/02/yi-ce-shi-qu-dong-kai-fa-ji-qiao-huan-jing-she-zhi/"/>
      <url>/2022/06/02/yi-ce-shi-qu-dong-kai-fa-ji-qiao-huan-jing-she-zhi/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒè®¾ç½®"><a href="#ç¯å¢ƒè®¾ç½®" class="headerlink" title="ç¯å¢ƒè®¾ç½®"></a>ç¯å¢ƒè®¾ç½®</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ–°å¼€ä¸ªå‘ï¼Œæœ¬ç³»åˆ—ä¸»è¦æ˜¯<code>ã€ŠC++ç¨‹åºè®¾è®¡å®è·µä¸æŠ€å·§ï¼šæµ‹è¯•é©±åŠ¨å¼€å‘ã€‹</code>ä¸€ä¹¦çš„å­¦ä¹ è®°å½•ï¼Œç”±äºç¬”è®°æ˜¯åœ¨ 2020 å¹´å°±å®Œæˆäº†ã€‚æœ¬æ¬¡å°†å…¶è¿›è¡Œäº†ä¸€äº›ç»†èŠ‚ä¿®è®¢ã€å›¾ç‰‡ä¼˜åŒ–ååŒæ­¥åˆ° blog ä¸Šï¼Œå› æ­¤æœ‰äº›æ—¶é—´ä¼šå¯¹ä¸ä¸Šï¼Œä¸è¦åœ¨æ„è¿™äº›ç»†èŠ‚æ— ä¼¤å¤§é›… ğŸ˜‚ã€‚</p><blockquote><p>å›¾åºŠæˆ‘æ˜¯è‡ªå»ºåœ¨ <a href="https://github.com/HATTER-LONG/Resource">github</a> ä¸Šç”¨çš„ CDN åŠ é€Ÿï¼Œå¦‚æœæœ‰å›¾ç‰‡åˆ·ä¸å‡ºæ¥çš„æƒ…å†µå¯ä»¥é‚®ä»¶æˆ‘ï¼Œçœ‹åˆ°äº†æˆ‘ä¼šå¤„ç†çš„ã€‚</p></blockquote><blockquote><p>æˆ–è€…ç›´æ¥çœ‹<a href="https://github.com/HATTER-LONG/NoteBook_ModernCppProgrammingWithTDD">æˆ‘çš„ç¬”è®°</a>ä¹Ÿå¯ä»¥ï¼Œè§‰å¾—ä¸é”™çš„æ¥ä¸ª star å§ ğŸ˜Šã€‚</p></blockquote><h2 id="å®ä¾‹ç¨‹åº"><a href="#å®ä¾‹ç¨‹åº" class="headerlink" title="å®ä¾‹ç¨‹åº"></a>å®ä¾‹ç¨‹åº</h2><p>ä¹¦ä¸­ä¸»è¦ä½¿ç”¨äº†ä¸¤ç§æµ‹è¯•æ¡†æ¶ GMock ä¸ CppUTestï¼Œä½†æ˜¯å­¦ä¹ è¿‡ç¨‹ä¸­å¸Œæœ› Catch æ›¿æ¢æ‰ CppUTest ä¸ GMock å¹¶å­˜çš„æ–¹å¼ã€‚</p><ul><li>Waitï¼Œæ²¡æƒ³åˆ°ä¸Šæ¥å°±æœ‰ä¸ªå¤§å·®å¼‚ï¼Œæœ€è¿‘ Catch2 å·²ç»å‘å¸ƒ v3 äº†ã€‚ä¸€æ¬¡å²æ— å‰ä¾‹çš„ç ´åæ€§æ›´æ–°ï¼Œæœ¬æ–‡è¿˜æ˜¯ç»§ç»­ä½¿ç”¨ v2 lastest ç¨³å®šç‰ˆæœ¬ï¼Œå¦‚æœæƒ³è¦å°è¯•åˆ‡æ¢å‚è€ƒå®˜æ–¹ç»™å‡ºçš„<a href="https://github.com/catchorg/Catch2/blob/devel/docs/migrate-v2-to-v3.md#top">ç§»æ¤å»ºè®®</a>ã€‚</li></ul><p><img src="https://fastly.jsdelivr.net/gh/HATTER-LONG/Resource@main/images/TDD/01_codeexample.png" alt="code_example"></p><h2 id="ç¼–è¯‘å™¨"><a href="#ç¼–è¯‘å™¨" class="headerlink" title="ç¼–è¯‘å™¨"></a>ç¼–è¯‘å™¨</h2><p>ä¸»è¦åœ¨ Ubuntu20.04 system ä¸‹ï¼Œä½¿ç”¨ Clang-11 ä¸ºç¼–è¯‘å™¨å‰ç«¯ï¼ŒGun çš„ ld ä¸ºè¿æ¥å™¨ã€‚</p><ul><li>ä¸¤å¹´è¿‡å»äº†ï¼Œæˆ‘ä¹ŸæŠ›å¼ƒäº† Ubuntu æ”¹ç”¨ Mac äº†ã€‚ä½ å˜æˆäº†ä½ æœ€è®¨åŒçš„æ ·å­ã€‚</li><li>è¯è¯´ LLVM éƒ½æ›´æ–°åˆ° 14 äº†ï¼ˆæ­¤æ–‡ç¼–å†™æ—¥ï¼‰ï¼Œ<code>ä¸è¿‡ä¸ç”¨æ‹…å¿ƒç¼–è¯‘å™¨é—®é¢˜</code>ï¼Œæœ¬ç³»åˆ—çš„ä»£ç æ²¡æœ‰éœ€è¦ç‰¹æ®Šè¯­æ³•çš„åœ°æ–¹ï¼Œå³ä½¿åˆ‡æ¢äº† Catch2 v3 ä¹Ÿåªéœ€è¦ C++14 æ ‡å‡†å³å¯ã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯è¦è¯´ LLVM æ°¸è¿œçš„ç¥ã€‚</li></ul><pre class="line-numbers language-shell"><code class="language-shell">~/WorkSpaceâ¯ ls /bin/ld -llrwxrwxrwx 1 root root 19 Apr  7  2020 /bin/ld -> x86_64-linux-gnu-ld~/WorkSpaceâ¯ clang -vclang version 11.0.0 (https://github.com/llvm/llvm-project.git 0160ad802e899c2922bc9b29564080c22eb0908c)Target: x86_64-unknown-linux-gnuThread model: posixInstalledDir: /usr/binFound candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/8Found candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/9Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/8Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/9Selected GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/9Candidate multilib: .;@m64Selected multilib: .;@m64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h2><p>ä½¿ç”¨ CMake æ”¯æŒè·¨å¹³å°ç¼–è¯‘ã€‚</p><pre class="line-numbers language-shell"><code class="language-shell">~/WorkSpaceâ¯ cmake -versioncmake version 3.16.3CMake suite maintained and supported by Kitware (kitware.com/cmake).<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Google-Mock-amp-Catch2"><a href="#Google-Mock-amp-Catch2" class="headerlink" title="Google Mock &amp; Catch2"></a>Google Mock &amp; Catch2</h2><p>å®‰è£…ä¸åœ¨èµ˜è¿°ï¼ŒGoogle Mock çš„ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-shell"><code class="language-shell">/usr/local/lib/cmake/GTestâ¯ lsGTestConfig.cmake  GTestConfigVersion.cmake  GTestTargets-noconfig.cmake  GTestTargets.cmake/usr/local/lib/cmake/GTestâ¯ dpkg -l | grep googletestii  googletest                             1.10.0-2                            all          Google's C++ test framework sources<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Catch2 ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-cxx"><code class="language-cxx">/usr/local/lib/cmake/Catch2â¯ lsCatch.cmake         Catch2ConfigVersion.cmake     Catch2Targets.cmake  ParseAndAddCatchTests.cmakeCatch2Config.cmake  Catch2Targets-noconfig.cmake  CatchAddTests.cmake/usr/local/lib/cmake/Catch2â¯ vim Catch2ConfigVersion.cmake>>> set(PACKAGE_VERSION "2.13.3")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ­å»ºè¿è¡Œ-GMock-ä¸-Catch2-çš„ç¯å¢ƒ"><a href="#æ­å»ºè¿è¡Œ-GMock-ä¸-Catch2-çš„ç¯å¢ƒ" class="headerlink" title="æ­å»ºè¿è¡Œ GMock ä¸ Catch2 çš„ç¯å¢ƒ"></a>æ­å»ºè¿è¡Œ GMock ä¸ Catch2 çš„ç¯å¢ƒ</h3><p>è¯¦è§æˆ‘çš„<a href="https://github.com/HATTER-LONG/TDD_Learning">é¡¹ç›®</a>ã€‚</p><ul><li>å¿«ç§ç§è¿™ä¸ªé’æ¶©çš„é¡¹ç›®ï¼ŒREADME å†™çš„ä¸€å¡Œç³Šæ¶‚ï¼Œç»™ä¸ª star å§ï¼Œè®©æˆ‘çŸ¥é“æœ‰äººåœ¨çœ‹æœ‰åŠ¨åŠ›ç¿»æ–°ä¸‹ã€‚</li></ul><h2 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h2><p>ä¸æ‰“ç®—ä½¿ç”¨ JsonCPP åˆ‡æ¢ä¸ºå¼€æºçš„ <code>Json for modern c++</code>ã€‚</p><ul><li>çˆ±ç”¨å“ªä¸ªéƒ½è¡Œï¼Œæ¢æˆ MDJSON çº¯ç²¹æ˜¯å–œæ¬¢ Only Headerã€‚</li></ul><pre class="line-numbers language-shell"><code class="language-shell">Install the project...-- Install configuration: ""-- Up-to-date: /usr/local/include-- Installing: /usr/local/include/nlohmann-- Installing: /usr/local/include/nlohmann/json.hpp-- Installing: /usr/local/lib/cmake/nlohmann_json/nlohmann_jsonConfig.cmake-- Installing: /usr/local/lib/cmake/nlohmann_json/nlohmann_jsonConfigVersion.cmake-- Installing: /usr/local/lib/cmake/nlohmann_json/nlohmann_jsonTargets.cmake-- Installing: /usr/local/lib/pkgconfig/nlohmann_json.pc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="libcurl"><a href="#libcurl" class="headerlink" title="libcurl"></a>libcurl</h2><p>å¼€æºä»£ç å®‰è£…</p><pre class="line-numbers language-shell"><code class="language-shell">~/Tools/curl-7.74.0/buildâ¯ sudo make install -j32[ 73%] Built target libcurl[100%] Built target curlInstall the project...-- Install configuration: ""-- Installing: /usr/local/lib/libcurl.a-- Installing: /usr/local/bin/curl-- Installing: /usr/local/bin/curl-config-- Installing: /usr/local/lib/pkgconfig/libcurl.pc-- Up-to-date: /usr/local/include/curl-- Up-to-date: /usr/local/include/curl/curl.h-- Up-to-date: /usr/local/include/curl/curlver.h-- Up-to-date: /usr/local/include/curl/easy.h-- Up-to-date: /usr/local/include/curl/mprintf.h-- Up-to-date: /usr/local/include/curl/multi.h-- Up-to-date: /usr/local/include/curl/options.h-- Up-to-date: /usr/local/include/curl/stdcheaders.h-- Up-to-date: /usr/local/include/curl/system.h-- Up-to-date: /usr/local/include/curl/typecheck-gcc.h-- Up-to-date: /usr/local/include/curl/urlapi.h-- Old export file "/usr/local/lib/cmake/CURL/CURLTargets.cmake" will be replaced.  Removing files [/usr/local/lib/cmake/CURL/CURLTargets-noconfig.cmake].-- Installing: /usr/local/lib/cmake/CURL/CURLTargets.cmake-- Installing: /usr/local/lib/cmake/CURL/CURLTargets-noconfig.cmake-- Installing: /usr/local/lib/cmake/CURL/CURLConfigVersion.cmake-- Installing: /usr/local/lib/cmake/CURL/CURLConfig.cmake<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Boost"><a href="#Boost" class="headerlink" title="Boost"></a>Boost</h2><p>Boost ç›´æ¥é€šè¿‡ apt-get å®‰è£…ç®¡ç†ï¼š</p><ul><li>è¢« apt ç‰ˆæœ¬ç®¡ç†æŠ˜ç£¨çš„é€€å‘ï¼Œæ˜¯æˆ‘ä¸é… ğŸ˜­ã€‚</li></ul><pre class="line-numbers language-shell"><code class="language-shell">~/Toolsâ¯ dpkg -l | grep boostii  libboost-atomic1.71-dev:amd64          1.71.0-6ubuntu6                     amd64        atomic data types, operations, and memory ordering constraintsii  libboost-atomic1.71.0:amd64            1.71.0-6ubuntu6                     amd64        atomic data types, operations, and memory ordering constraintsii  libboost-chrono1.71-dev:amd64          1.71.0-6ubuntu6                     amd64        C++ representation of time duration, time point, and clocksii  libboost-chrono1.71.0:amd64            1.71.0-6ubuntu6                     amd64        C++ representation of time duration, time point, and clocksii  libboost-container1.71-dev:amd64       1.71.0-6ubuntu6                     amd64        C++ library that implements several well-known containers - dev filesii  libboost-container1.71.0:amd64         1.71.0-6ubuntu6                     amd64        C++ library that implements several well-known containersii  libboost-context1.71-dev:amd64         1.71.0-6ubuntu6                     amd64        provides a sort of cooperative multitasking on a single threadii  libboost-context1.71.0:amd64           1.71.0-6ubuntu6                     amd64        provides a sort of cooperative multitasking on a single threadii  libboost-coroutine1.71-dev:amd64       1.71.0-6ubuntu6                     amd64        provides a sort of cooperative multitasking on a single threadii  libboost-coroutine1.71.0:amd64         1.71.0-6ubuntu6                     amd64        provides a sort of cooperative multitasking on a single threadii  libboost-date-time1.71-dev:amd64       1.71.0-6ubuntu6                     amd64        set of date-time libraries based on generic programming conceptsii  libboost-date-time1.71.0:amd64         1.71.0-6ubuntu6                     amd64        set of date-time libraries based on generic programming conceptsii  libboost-exception1.71-dev:amd64       1.71.0-6ubuntu6                     amd64        library to help write exceptions and handlersii  libboost-fiber1.71-dev:amd64           1.71.0-6ubuntu6                     amd64        cooperatively-scheduled micro-/userland-threadsii  libboost-fiber1.71.0:amd64             1.71.0-6ubuntu6                     amd64        cooperatively-scheduled micro-/userland-threadsii  libboost-filesystem1.71-dev:amd64      1.71.0-6ubuntu6                     amd64        filesystem operations (portable paths, iteration over directories, etc) in C++ii  libboost-filesystem1.71.0:amd64        1.71.0-6ubuntu6                     amd64        filesystem operations (portable paths, iteration over directories, etc) in C++ii  libboost-graph-parallel1.71-dev        1.71.0-6ubuntu6                     amd64        generic graph components and algorithms in C++ii  libboost-graph-parallel1.71.0          1.71.0-6ubuntu6                     amd64        generic graph components and algorithms in C++ii  libboost-graph1.71-dev:amd64           1.71.0-6ubuntu6                     amd64        generic graph components and algorithms in C++ii  libboost-graph1.71.0:amd64             1.71.0-6ubuntu6                     amd64        generic graph components and algorithms in C++ii  libboost-iostreams1.71-dev:amd64       1.71.0-6ubuntu6                     amd64        Boost.Iostreams Library development filesii  libboost-iostreams1.71.0:amd64         1.71.0-6ubuntu6                     amd64        Boost.Iostreams Libraryii  libboost-locale1.71-dev:amd64          1.71.0-6ubuntu6                     amd64        C++ facilities for localizationii  libboost-locale1.71.0:amd64            1.71.0-6ubuntu6                     amd64        C++ facilities for localizationii  libboost-log1.71-dev                   1.71.0-6ubuntu6                     amd64        C++ logging libraryii  libboost-log1.71.0                     1.71.0-6ubuntu6                     amd64        C++ logging libraryii  libboost-math1.71-dev:amd64            1.71.0-6ubuntu6                     amd64        Boost.Math Library development filesii  libboost-math1.71.0:amd64              1.71.0-6ubuntu6                     amd64        Boost.Math Libraryii  libboost-mpi-python1.71-dev            1.71.0-6ubuntu6                     amd64        C++ interface to the Message Passing Interface (MPI), Python Bindingsii  libboost-mpi-python1.71.0              1.71.0-6ubuntu6                     amd64        C++ interface to the Message Passing Interface (MPI), Python Bindingsii  libboost-mpi1.71-dev                   1.71.0-6ubuntu6                     amd64        C++ interface to the Message Passing Interface (MPI)ii  libboost-mpi1.71.0                     1.71.0-6ubuntu6                     amd64        C++ interface to the Message Passing Interface (MPI)ii  libboost-numpy1.71-dev                 1.71.0-6ubuntu6                     amd64        Boost.Python NumPy extensions development filesii  libboost-numpy1.71.0                   1.71.0-6ubuntu6                     amd64        Boost.Python NumPy extensionsii  libboost-program-options1.71-dev:amd64 1.71.0-6ubuntu6                     amd64        program options library for C++ii  libboost-program-options1.71.0:amd64   1.71.0-6ubuntu6                     amd64        program options library for C++ii  libboost-python1.71-dev                1.71.0-6ubuntu6                     amd64        Boost.Python Library development filesii  libboost-python1.71.0                  1.71.0-6ubuntu6                     amd64        Boost.Python Libraryii  libboost-random1.71-dev:amd64          1.71.0-6ubuntu6                     amd64        Boost Random Number Libraryii  libboost-random1.71.0:amd64            1.71.0-6ubuntu6                     amd64        Boost Random Number Libraryii  libboost-regex1.71-dev:amd64           1.71.0-6ubuntu6                     amd64        regular expression library for C++ii  libboost-regex1.71.0:amd64             1.71.0-6ubuntu6                     amd64        regular expression library for C++ii  libboost-serialization1.71-dev:amd64   1.71.0-6ubuntu6                     amd64        serialization library for C++ii  libboost-serialization1.71.0:amd64     1.71.0-6ubuntu6                     amd64        serialization library for C++ii  libboost-stacktrace1.71-dev:amd64      1.71.0-6ubuntu6                     amd64        library to capture and print stack traces - development filesii  libboost-stacktrace1.71.0:amd64        1.71.0-6ubuntu6                     amd64        library to capture and print stack tracesii  libboost-system1.71-dev:amd64          1.71.0-6ubuntu6                     amd64        Operating system (e.g. diagnostics support) libraryii  libboost-system1.71.0:amd64            1.71.0-6ubuntu6                     amd64        Operating system (e.g. diagnostics support) libraryii  libboost-test1.71-dev:amd64            1.71.0-6ubuntu6                     amd64        components for writing and executing test suitesii  libboost-test1.71.0:amd64              1.71.0-6ubuntu6                     amd64        components for writing and executing test suitesii  libboost-thread1.71-dev:amd64          1.71.0-6ubuntu6                     amd64        portable C++ multi-threadingii  libboost-thread1.71.0:amd64            1.71.0-6ubuntu6                     amd64        portable C++ multi-threadingii  libboost-timer1.71-dev:amd64           1.71.0-6ubuntu6                     amd64        C++ wall clock and CPU process timersii  libboost-timer1.71.0:amd64             1.71.0-6ubuntu6                     amd64        C++ wall clock and CPU process timersii  libboost-type-erasure1.71-dev:amd64    1.71.0-6ubuntu6                     amd64        C++ runtime polymorphism based on conceptsii  libboost-type-erasure1.71.0:amd64      1.71.0-6ubuntu6                     amd64        C++ runtime polymorphism based on conceptsii  libboost-wave1.71-dev:amd64            1.71.0-6ubuntu6                     amd64        C99/C++ preprocessor libraryii  libboost-wave1.71.0:amd64              1.71.0-6ubuntu6                     amd64        C99/C++ preprocessor libraryii  libboost1.71-all-dev                   1.71.0-6ubuntu6                     amd64        Boost C++ Libraries development files (ALL)ii  libboost1.71-dev:amd64                 1.71.0-6ubuntu6                     amd64        Boost C++ Libraries development filesii  libboost1.71-doc                       1.71.0-6ubuntu6                     all          Boost.org libraries documentation placeholderii  libboost1.71-tools-dev                 1.71.0-6ubuntu6                     amd64        Boost C++ Libraries development tools<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦å±•ç¤ºäº†åè¾¹æ–‡ç« ä¸­æ‰€éœ€è¦çš„ä¸€äº›ä¸‰æ–¹åº“ã€å®‰è£…ç­‰ç¤ºä¾‹ï¼Œç»§ç»­åæ§½ C++ æ²¡æœ‰ç»Ÿä¸€çš„åŒ…ç®¡ç†å™¨ï¼ˆå¯¹ç€ Cargo æµå£æ°´ï¼‰ã€‚</p><ul><li>çœ‹åˆ°ä»¥å‰å†™çš„ç¬”è®°è¿˜æ˜¯æ„Ÿæ…¨è‰¯å¤šã€‚æœ‰æ—¶çœ‹ä¹¦å®åœ¨å¤ªåŠŸåˆ©äº†ï¼Œæ€»æƒ³è¿™å»è¯»å¯¹è‡ªå·±æœ‰ç”¨çš„ï¼Œä½†æ˜¯å½“èƒ½åˆ¤æ–­å‡ºè¿™ä¹¦æœ‰ç”¨äº†å…¶å®åè€Œå¯¹äºçŸ¥è¯†ã€çœ¼ç•Œçš„æ‰©å±•æ˜¯æœ‰é™çš„ã€‚</li><li>åœ¨é˜…è¯»æœ¬ä¹¦æ—¶ï¼Œæ— è®ºå·¥ä½œå†…å®¹è¿˜æ˜¯ä»€ä¹ˆå…¶ä»–æ–¹é¢å®Œå…¨æ²¡æœ‰æµ‹è¯•ä»£ç çš„æ„è¯†ï¼Œåœ¨é’¢ä¸ä¸Šè¡Œèµ°å°å¿ƒç¿¼ç¿¼çš„ç»´æŠ¤è€…è„†å¼±çš„ä»£ç ã€‚éšç€ç»éªŒçš„å¢åŠ è¶Šæ¥è¶Šèƒ½ä½“ä¼šåˆ°æµ‹è¯•ä»£ç çš„é‡è¦æ€§ï¼Œå·²ç»è®°ä¸å¾—å½“æ—¶å­¦ä¹ è¿™æœ¬ä¹¦çš„åŠ¨æœºäº†ï¼Œä½†æ˜¯ä»¥ç°åœ¨çš„çœ¼å…‰æ¥çœ‹å½“æ—¶çš„å†³å®šå¯¹æˆ‘çš„å¸®åŠ©æ— ç–‘æ˜¯å·¨å¤§çš„ã€‚</li><li>æœ€åå¼•ç”¨ä¸€å¥å¿˜è®°äº†ä»é‚£æœ¬ä¹¦çœ‹åˆ°çš„è¯ï¼šä½ è¯»è¿‡çš„æ¯ä¸€æœ¬ä¹¦ï¼Œæœ€åéƒ½ä¼šå˜æˆä½ çš„è¡€ä¸è‚‰ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€ç¯‡åšå®¢</title>
      <link href="/2022/05/28/di-yi-pian-bo-ke/"/>
      <url>/2022/05/28/di-yi-pian-bo-ke/</url>
      
        <content type="html"><![CDATA[<h1 id="åšå®¢åŠŸèƒ½æµ‹è¯•"><a href="#åšå®¢åŠŸèƒ½æµ‹è¯•" class="headerlink" title="åšå®¢åŠŸèƒ½æµ‹è¯•"></a>åšå®¢åŠŸèƒ½æµ‹è¯•</h1><h2 id="ä»£ç é«˜äº®æµ‹è¯•"><a href="#ä»£ç é«˜äº®æµ‹è¯•" class="headerlink" title="ä»£ç é«˜äº®æµ‹è¯•"></a>ä»£ç é«˜äº®æµ‹è¯•</h2><ol><li>C++ ä»£ç ï¼š</li></ol><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">TFactory</span><span class="token operator">></span><span class="token keyword">auto</span> <span class="token function">REQUIRES</span><span class="token punctuation">(</span>m_mutex<span class="token punctuation">)</span> <span class="token function">getFactory</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> id<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">-</span><span class="token operator">></span>    <span class="token keyword">typename</span> FactoryDetails<span class="token operator">::</span>get_interface_const_ref<span class="token operator">&lt;</span>TFactory<span class="token operator">></span><span class="token operator">::</span>type<span class="token punctuation">{</span>    tComponentContItr componentPtr <span class="token operator">=</span> findComponentFactory<span class="token operator">&lt;</span>TFactory<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>componentPtr <span class="token operator">!=</span> m_componentCont<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">auto</span> factory <span class="token operator">=</span> componentPtr<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>factory <span class="token operator">!=</span> componentPtr<span class="token operator">-</span><span class="token operator">></span>second<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">using</span> tInterface <span class="token operator">=</span>                <span class="token keyword">typename</span> FactoryDetails<span class="token operator">::</span>get_interface<span class="token operator">&lt;</span>TFactory<span class="token operator">></span><span class="token operator">::</span>type<span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">static_cast</span><span class="token operator">&lt;</span>tInterface<span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>factory<span class="token operator">-</span><span class="token operator">></span>second<span class="token operator">-</span><span class="token operator">></span><span class="token function">getPtr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">throw</span> <span class="token function">FactoryNotRegisteredEx</span><span class="token punctuation">(</span><span class="token keyword">typeid</span><span class="token punctuation">(</span>TFactory<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>Rust ä»£ç ï¼š</li></ol><pre class="line-numbers language-rust"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token keyword">where</span>    T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token punctuation">,</span><span class="token punctuation">{</span>    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>calculation<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>        Cacher <span class="token punctuation">{</span>            calculation<span class="token punctuation">,</span>            value<span class="token punctuation">:</span> None<span class="token punctuation">,</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> arg<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>        <span class="token keyword">match</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token punctuation">{</span>            <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> v<span class="token punctuation">,</span>            None <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>calculation<span class="token punctuation">)</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>                v            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> simulated_user_specified_value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> simulated_random_number <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token function">generate_workout</span><span class="token punctuation">(</span>simulated_user_specified_value<span class="token punctuation">,</span> simulated_random_number<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">fn</span> <span class="token function">generate_workout</span><span class="token punctuation">(</span>intensity<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> random_number<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> åšå®¢å»ºè®¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åšå®¢åŠŸèƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
