<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="ï¼ˆäº”ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--æµ‹è¯•æ›¿èº«, null">
    <meta name="description" content="æµ‹è¯•æ›¿èº«åœ¨å‰é¢çš„ç« èŠ‚ä¸­äº†è§£äº† TDD çš„åŸºç¡€å†…å®¹ï¼Œä½†æ˜¯åœ¨çœŸå®çš„ç”Ÿäº§ç¯å¢ƒä¸­å¯¹è±¡å¿…é¡»ååŒå·¥ä½œï¼Œæœ‰æ—¶ä¾èµ–åˆä½œå¯¹è±¡ä½¿å¾— TDD å˜å¾—ä¸¾æ­¥ç»´è‰°ï¼Œæœ¬ç« å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨æµ‹è¯•æ›¿èº«æ¥è§£å†³ã€‚

æµ‹è¯•æ›¿èº«è§£ç­”äº†ä¸€ä¸ªå›°æƒ‘æˆ‘å¥½ä¹…çš„é—®é¢˜ï¼Œå°±æ˜¯ä»£ç è€¦åˆçš„æƒ…å†µä¸‹æˆ‘è¯¥å¦‚ä½•æµ‹">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    

    <title>ï¼ˆäº”ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--æµ‹è¯•æ›¿èº« | null</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/lightgallery/1.6.12/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span"></span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name"></div>
        <div class="logo-desc">
            
            éšæœºæ›´æ–°
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/HATTER-LONG" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/HATTER-LONG" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/4.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">ï¼ˆäº”ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--æµ‹è¯•æ›¿èº«</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/">
                                <span class="chip bg-color">æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/" class="post-category">
                                æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2022-06-02
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    10k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>é˜…è¯»æ—¶é•¿:&nbsp;&nbsp;
                    39 åˆ†
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>é˜…è¯»æ¬¡æ•°:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="æµ‹è¯•æ›¿èº«"><a href="#æµ‹è¯•æ›¿èº«" class="headerlink" title="æµ‹è¯•æ›¿èº«"></a>æµ‹è¯•æ›¿èº«</h1><p>åœ¨å‰é¢çš„ç« èŠ‚ä¸­äº†è§£äº† TDD çš„åŸºç¡€å†…å®¹ï¼Œä½†æ˜¯åœ¨çœŸå®çš„ç”Ÿäº§ç¯å¢ƒä¸­å¯¹è±¡å¿…é¡»ååŒå·¥ä½œï¼Œæœ‰æ—¶ä¾èµ–åˆä½œå¯¹è±¡ä½¿å¾— TDD å˜å¾—ä¸¾æ­¥ç»´è‰°ï¼Œæœ¬ç« å°†ä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨æµ‹è¯•æ›¿èº«æ¥è§£å†³ã€‚</p>
<ul>
<li>æµ‹è¯•æ›¿èº«è§£ç­”äº†ä¸€ä¸ªå›°æƒ‘æˆ‘å¥½ä¹…çš„é—®é¢˜ï¼Œå°±æ˜¯ä»£ç è€¦åˆçš„æƒ…å†µä¸‹æˆ‘è¯¥å¦‚ä½•æµ‹è¯•è¿™ä¸ªå‡½æ•°ä¼šæŒ‰ç…§è¦æ±‚è°ƒç”¨å…¶ä»–å…³è”ç»„ä»¶ã€‚æµ‹è¯•æ›¿èº«å³å¯ä»¥è®©ä½ ç¼–å†™ä»£ç æ¥æ„ŸçŸ¥åˆ°è°ƒç”¨ä»¥åŠè°ƒç”¨æ¬¡æ•°ï¼Œè¿˜ä¼šå€’é€¼ä½ å»å°è¯•æ³¨å…¥ä¾èµ–ç»„ä»¶ä»è€Œè¿›è¡Œè§£è—•ï¼Œç›¸ä¿¡çœ‹å®Œè¿™ä¸€ç« ä¼šæœ‰æ‰€æ„Ÿå—ã€‚</li>
<li>æœ¬ç« ä¼šæœ‰ä¸€äº›ä»£ç æ ‡æ³¨äº† git hash å€¼ï¼Œæ ‡è¯†æˆ‘æ˜¯é‚£æ¬¡ä¿®æ”¹å¯¹åº”çš„ä»£ç ï¼Œæ–¹ä¾¿å¯¹æ¯”ã€‚è¿™ä¸å¾—å¤¸ä¸‹å½“æ—¶æˆ‘å¯å¤ªæœ‰è€å¿ƒäº† ğŸ˜„ã€‚</li>
</ul>
<h2 id="ä¾èµ–é—®é¢˜"><a href="#ä¾èµ–é—®é¢˜" class="headerlink" title="ä¾èµ–é—®é¢˜"></a>ä¾èµ–é—®é¢˜</h2><ul>
<li>Storyï¼šä½ç½®æè¿°æœåŠ¡<ul>
<li>ä½œä¸ºä¸€ä¸ªåœ°å›¾åº”ç”¨å¼€å‘äººå‘˜ï¼Œæˆ‘éœ€è¦è¿™æ ·çš„æœåŠ¡ï¼Œå³å®ƒèƒ½åŸºäºç»™å®šçš„ä½ç½®ï¼ˆç»çº¬åº¦ï¼‰è¿”å›ä¸€è¡Œä¿¡æ¯æ¥æè¿°ç¦»å®ƒæœ€è¿‘çš„åœ°æ–¹ã€‚</li>
</ul>
</li>
</ul>
<p>æ„å»ºä½ç½®æè¿°æœåŠ¡ä¸­ä¸€ä¸ªé‡è¦çš„å·¥ä½œå°±æ˜¯å»è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨ APIï¼Œè¿™ä¸ª API èƒ½æ¥å—ä¸€ä¸ªä½ç½®ä¿¡æ¯ï¼Œå¹¶è¿”å›ä½ç½®æ•°æ®ã€‚ä¹¦ä¸­ä¸¾ä¾‹ REST æœåŠ¡ï¼Œç»™å®šä¸€ä¸ª GET URLï¼Œå®ƒä¼šä»¥ JSON æ ¼å¼è¿”å›ä½ç½®æ•°æ®ã€‚æµ‹è¯•é©±åŠ¨å¼€å‘ä½ç½®æè¿°æœåŠ¡ä¼šé‡åˆ°ä¸€ä¸ªéš¾é¢˜ã€‚è‡³å°‘å‡ºäºä»¥ä¸‹å‡ ç‚¹åŸå› ï¼Œå¯¹ REST è°ƒç”¨çš„ä¾èµ–ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li>é€šè¿‡ä¸€ä¸ª HTTP æ¥è°ƒç”¨ REST æœåŠ¡éå¸¸ç¼“æ…¢ï¼Œè¿™ä¹Ÿå¯¼è‡´æµ‹è¯•çš„è¿è¡Œé€Ÿåº¦å˜æ…¢ã€‚</li>
<li>REST æœåŠ¡å¯èƒ½ä¸æ˜¯ä¸€ç›´å¤„äºå¯ç”¨çŠ¶æ€ã€‚</li>
<li>REST æœåŠ¡è¿”å›çš„ç»“æœå¾—ä¸åˆ°ä¿è¯ã€‚</li>
</ol>
<p>ä¸ºä»€ä¹ˆè¿™äº›ä¾èµ–ä¼šä½¿å¾—æµ‹è¯•å˜å¾—å›°éš¾å‘¢ï¼Ÿ</p>
<ol>
<li>ä¾èµ–ä¸€ä¸ªæ…¢é€Ÿçš„åä½œå¯¹è±¡ä¼šè®©æµ‹è¯•æ…¢å¾—éš¾ä»¥å¿å—ã€‚</li>
<li>ä¾èµ–ä¸€ä¸ªä¸ç¨³å®šçš„æœåŠ¡ï¼ˆè¦ä¹ˆä¸å¯ç”¨ï¼Œè¦ä¹ˆæ¯æ¬¡è¿”å›ä¸åŒçš„ç»“æœï¼‰ä¼šå¯¼è‡´æµ‹è¯•é—´æ–­æ€§åœ°å¤±è´¥ã€‚</li>
</ol>
<p>è€Œä¸”å¦‚æœå½“å‰æ²¡æœ‰å‘èµ· HTTP è°ƒç”¨çš„ä»£ç ï¼Œå¯èƒ½æ˜¯è¢«äººè¿˜æ²¡æœ‰è®¾è®¡å®ç°å®Œæˆï¼ŒåŒæ—¶ä½ ä¹Ÿæ²¡æœ‰æ—¶é—´è‡ªå·±å»å®ç°ä¸€ä¸ª HTTP ç±»æ€ä¹ˆåŠï¼Ÿå¦‚æœè‡ªå·±å°±æ˜¯è´Ÿè´£ HTTP ç±»å®ç°çš„äººæ€ä¹ˆåŠï¼Ÿæˆ–è®¸å¯ä»¥å…ˆäº†è§£ä¸‹ä½ç½®æè¿°æœåŠ¡æ•´ä½“è®¾è®¡ä¸ä½¿ç”¨æ–¹æ³•ååœ¨è€ƒè™‘ HTTP å·¥å…·ç±»çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p>
<h2 id="æµ‹è¯•æ›¿èº«åŸç†"><a href="#æµ‹è¯•æ›¿èº«åŸç†" class="headerlink" title="æµ‹è¯•æ›¿èº«åŸç†"></a>æµ‹è¯•æ›¿èº«åŸç†</h2><p>åœ¨ä¸Šè¿°æåˆ°çš„é—®é¢˜ï¼Œå¯ä»¥åˆ©ç”¨<code>æµ‹è¯•æ›¿èº«</code>æ¥é¿å…è¢«è¿™ç±»é—®é¢˜é˜»å¡ã€‚æµ‹è¯•æ›¿èº«èµ·åˆ°ä»£æ›¿çš„ä½œç”¨ï¼šå®ƒä»£æ›¿äº†å®é™…äº§å“ä»£ç ä¸­çš„ç±»ã€‚</p>
<p>å¦‚ä¸Šæ–‡ HTTP ç±»å¸¦æ¥äº†å›°éš¾ï¼Œå¯ä»¥ä¸ºå…¶åˆ›å»ºæµ‹è¯•æ›¿èº«ï¼å½“å®¢æˆ·æäº¤ä¸€ä¸ª GET è¯·æ±‚è‡³ HTTP å¯¹è±¡æ—¶ï¼Œæµ‹è¯•æ›¿èº«èƒ½å¤Ÿè¿”å›é¢„å…ˆå‡†å¤‡çš„å“åº”ã€‚æµ‹è¯•æ›¿èº«åº”è¯¥è¿”å›ä»€ä¹ˆæ˜¯ç”±æµ‹è¯•è‡ªå·±å†³å®šçš„ã€‚</p>
<ul>
<li>å‡è®¾éœ€è¦æ„å»ºä¸€ä¸ªæœåŠ¡ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç±»å¯ä»¥å¤ç”¨ï¼ˆå½“å‰è¿˜æœªå®ç°ï¼‰ï¼š<ul>
<li>CurlHttpï¼Œå®ƒä½¿ç”¨ cURL å‘èµ· HTTP è¯·æ±‚ã€‚è¿™ä¸ªç±»æ´¾ç”Ÿè‡ªçº¯è™šåŸºç±» Httpï¼Œè¿™ä¸ªåŸºç±»å®šä¹‰ä¸¤ä¸ªå‡½æ•°ï¼šget() å’Œ initialize()ã€‚å®¢æˆ·ç«¯ä»£ç åœ¨è°ƒç”¨ get() å‰å¿…é¡»å…ˆè°ƒç”¨ initialize()ã€‚</li>
<li>Addressï¼Œä¸€ä¸ªåŒ…å«å‡ ä¸ªå­—æ®µçš„ç»“æ„ã€‚</li>
<li>AddressExtractorï¼Œå®ƒå€ŸåŠ© JsonCpp åº“ä»ä¸€ä¸ª JSON å­—ç¬¦ä¸²ä¸­æå–åœ°å€ (æœ¬æ–‡å°† Catch2 å®ç°ç‰ˆæœ¬ä»ä¹¦ä¸­çš„ JsonCpp åˆ‡æ¢æˆ nlohmann/json.hpp)ï¼Œå¹¶å¡«å†™ Address ç»“æ„ã€‚</li>
</ul>
</li>
</ul>
<p>å¯èƒ½çš„ä»£ç æµç¨‹ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">CurlHttp http<span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">auto</span> jsonResponse <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">createGetRequestUrl</span><span class="token punctuation">(</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

AddressExtractor extractor<span class="token punctuation">;</span>
<span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>jsonResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token function">summaryDescription</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="æ‰‹åŠ¨æ‰“é€ çš„æµ‹è¯•æ›¿èº«"><a href="#æ‰‹åŠ¨æ‰“é€ çš„æµ‹è¯•æ›¿èº«" class="headerlink" title="æ‰‹åŠ¨æ‰“é€ çš„æµ‹è¯•æ›¿èº«"></a>æ‰‹åŠ¨æ‰“é€ çš„æµ‹è¯•æ›¿èº«</h2><p><a target="_blank" rel="noopener" href="https://github.com/HATTER-LONG/TDD_Learning">é…å¥—å·¥ç¨‹</a>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (92c0b746c3b862199597c6a9eb2da93abca8a5aa)ï¼›</p>
<p>å¦‚æœæƒ³è¦ä½¿ç”¨æ›¿èº«ï¼Œé¦–å…ˆå¿…é¡»ä½¿å…¶å–ä»£ CurlHttp ç±»çš„è¡Œä¸ºã€‚C++æä¾›äº†è®¸å¤šä¸åŒçš„æ–¹æ³•ï¼Œå…¶ä¸­å¤šæ€çš„ä½¿ç”¨é¢‘ç‡æœ€é«˜ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ CurlHttp ç±»æ‰€å®ç°çš„åŸºç±» <a target="_blank" rel="noopener" href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/Include/Http.h">Http æ¥å£</a>ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Http</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>åˆ©ç”¨å¤šæ€åªéœ€è¦åœ¨æ´¾ç”Ÿç±»ä¸­è¦†å†™è™šå‡½æ•°ï¼Œå¹¶åœ¨è¿™ä¸ªè¦†å†™ä¸­æä¾›ç‰¹åˆ«çš„è¡Œä¸ºæ¥æ”¯æŒæµ‹è¯•ï¼Œç„¶åå°†åŸºç±»æŒ‡é’ˆä¼ é€’ç»™åœ°åæè¿°æœåŠ¡ã€‚ç°åœ¨æ¥è¿›è¡Œä¸€äº›<a target="_blank" rel="noopener" href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/test/Gmock/PlaceDescriptionServiceTest/PlaceDescriptionServiceTest.cpp">æµ‹è¯•</a>ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionService</span> <span class="token operator">:</span> <span class="token keyword">public</span> Test
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLatitude<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLongitude<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HttpStub httpStub<span class="token punctuation">;</span>
    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> description <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>description<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Drury Ln, Fountain, CO, US"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™é‡Œæˆ‘ä»¬æ‰€éœ€çš„æ›¿èº« HttpStub è¿˜æ²¡æœ‰å®ç°ï¼Œåœ¨æµ‹è¯•ä»£ç æ–‡ä»¶ä¸­å…ˆå®šä¹‰ä¸€ä¸ªã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">"???"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HttpStub httpStub<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿”å›é—®å·å­—ç¬¦ä¸²æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œå¯ä»¥å°è¯•ä¼šè¿”å›ä¸€ä¸ªæœç´¢æœåŠ¡çœŸå®çš„ Json å“åº”ï¼Œ<a target="_blank" rel="noopener" href="https://nominatim.org/release-docs/develop/api/Search/#parameters">å†…å®¹å¯ä»¥å°è¯•å‘ Nominatim æäº¤ Get è¯·æ±‚è·å–</a>ï¼Œè¿™é‡Œä¿æŒä¹¦ä¸­çš„ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> R<span class="token string">"({ "</span>address"<span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"Drury Ln"</span><span class="token punctuation">,</span>
         <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Fountain"</span><span class="token punctuation">,</span>
         <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">,</span>
         <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"US"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¥ä¸‹æ¥å°† HttpStub å®ä¾‹ä¼ é€’ç»™äº† PlaceDescriptionService çš„æ„é€ å‡½æ•°ã€‚å’ŒåŸå…ˆçš„é¢„æƒ³ç›¸æ¯”ï¼Œæˆ‘ä»¬æ­£åœ¨æ”¹å˜è®¾è®¡ã€‚<strong>æœåŠ¡å¯¹è±¡æœ¬èº«ä¸åˆ›å»ºç§æœ‰çš„ Http å®ä¾‹ï¼Œç›¸åï¼Œä½¿ç”¨è¯¥æœåŠ¡å¯¹è±¡çš„å®¢æˆ·ç«¯éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ª Http å®ä¾‹ï¼Œå¹¶æŠŠå®ƒä¼ ç»™æœåŠ¡å¯¹è±¡</strong>ã€‚<a target="_blank" rel="noopener" href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/Src/PlaceDescriptionService/PlaceDescriptionService.cpp">æœåŠ¡å¯¹è±¡</a>é€šè¿‡ä¸€ä¸ªåŸºç±»æŒ‡é’ˆæŒæœ‰è¿™ä¸ª Http å®ä¾‹ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">PlaceDescriptionService<span class="token operator">::</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span>Http<span class="token operator">*</span> IHttp<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">MHttp</span><span class="token punctuation">(</span>IHttp<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>åˆ©ç”¨å¤šæ€å®ç°äº†çµæ´»çš„æµ‹è¯•æ›¿èº«ï¼ŒåŠŸèƒ½ç±» <code>PlaceDescriptionService</code> ä¸æ¸…æ¥šå®ƒæŒæœ‰çš„ Http å®ä¾‹æ—¶ä¸€ä¸ªçœŸå®çš„è¿˜æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„å®ä¾‹ã€‚</p>
<p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (05f37b1b63764fdd54fe4d9555b3b9d276136d6d)ï¼›</strong></p>
<p>ç»§ç»­å‘ä¸‹ summaryDescription æ¥å£è°ƒç”¨çš„å‚æ•°æ˜¯éœ€è¦ä¼ å…¥ä¸¤ä¸ªåæ ‡ï¼Œè¿™é‡Œä¸º ValidLatitudeã€ValidLongitude è¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionService</span> <span class="token operator">:</span> <span class="token keyword">public</span> Test
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLatitude<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLongitude<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> string APlaceDescriptionService<span class="token operator">::</span><span class="token function">ValidLatitude</span><span class="token punctuation">(</span><span class="token string">"38.005"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> string APlaceDescriptionService<span class="token operator">::</span><span class="token function">ValidLongitude</span><span class="token punctuation">(</span><span class="token string">"-104.44"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™æ—¶ç¼–è¯‘æˆåŠŸå¯ä»¥è¿è¡Œä¸€ä¸‹å“ï¼Œä¸å‡ºæ„å¤–å¤±è´¥äº†è¿™æ—¶ç”±äºè¿˜æ²¡æœ‰å…·ä½“å®ç° summaryDescription æ¥å£çš„åŠŸèƒ½ã€‚</p>
<p>è‡³æ­¤ï¼Œå¯ä»¥ç¼–å†™ summaryDescription() äº†ã€‚ä½†æ˜¯é¦–å…ˆè¿˜éœ€è¦ä¸€ä¸ª AddressExtractorã€‚å®ƒèƒ½è§£æ JSON å“åº”ï¼Œå¹¶å¡«å†™ Address ç»“æ„ä½“ã€‚è¯¦ç»†çš„è¿‡ç¨‹ç•¥è¿‡ï¼Œå¯ä»¥æŸ¥é˜…<a target="_blank" rel="noopener" href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/Src/PlaceDescriptionService/AddressExtractor.cpp">æºç </a>ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">TEST_F</span><span class="token punctuation">(</span>AnAddressExtractor<span class="token punctuation">,</span> ReturnsPopulatedAddressForValidJsonResult<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">*</span> json <span class="token operator">=</span> R"<span class="token punctuation">(</span><span class="token punctuation">{</span>
         <span class="token string">"place_id"</span><span class="token operator">:</span><span class="token string">"15331615"</span><span class="token punctuation">,</span>
         <span class="token string">"address"</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"War Eagle Court"</span><span class="token punctuation">,</span>
            <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Colorado Springs"</span><span class="token punctuation">,</span>
            <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"Colorado"</span><span class="token punctuation">,</span>
            <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"United States of America"</span><span class="token punctuation">,</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">;</span>

    <span class="token keyword">auto</span> address <span class="token operator">=</span> Extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>Road<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"War Eagle Court"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>City<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Colorado Springs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>State<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Colorado"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>Country<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"United States of America"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ€åæˆ‘ä»¬å®ç° summaryDescription()ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">*</span> getRequestUrl <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> jsonResponse <span class="token operator">=</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>getRequestUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    AddressExtractor extractor<span class="token punctuation">;</span>
    <span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>jsonResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> address<span class="token punctuation">.</span>Road <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>City <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>State <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>Country<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ä¸‹è¾¹å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (432dedc2c1589fe7a8bfb3487879fec56997e6fa)ï¼›</strong></p>
<p>å½“æµ‹è¯•è°ƒç”¨ summaryDescription() æ—¶ï¼Œå¯¹ get() çš„è°ƒç”¨ä½œç”¨åˆ° HttpStub å®ä¾‹ä¸Šï¼Œè¿”å›æˆ‘ä»¬é¢„å…ˆç¡¬ç¼–ç çš„ Json å­—ç¬¦ä¸²ã€‚ä½†æ˜¯è¯·æ±‚çš„ URL åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œå½“æ­£åœ¨æ¥å—æµ‹è¯•çš„ä»£ç å’Œä¸€ä¸ªååŒå¯¹è±¡äº¤äº’æ—¶ï¼Œéœ€è¦ä¿è¯ç»™å®ƒä¼ é€’ä¸€ä¸ªæ­£ç¡®çš„å€¼ã€‚è¿”å›ç¡¬ç¼–ç å€¼çš„æµ‹è¯•æ›¿èº«å«ä½œå­˜æ ¹ï¼ˆstubï¼‰ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç§° get() ä¸ºå­˜æ ¹æ–¹æ³•ã€‚</p>
<p>å®é™…ä¸Šï¼Œå½“ä¼ ç»™ get() ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²æ—¶å°±å¯ä»¥è¿›è¡Œå¢é‡çš„å¼€å‘äº†ï¼Œæ¥ä¸‹æ¥ç¼–å†™èƒ½å¤Ÿæ­£ç¡®ç»™ getRequestUrl èµ‹å€¼çš„ä»£ç ã€‚<strong>åˆ©ç”¨ä¸‰è§’æ³•ï¼Œå¹¶ä¸ºç¬¬äºŒä¸ªä½ç½®æ·»åŠ ä¸€ä¸ªæ–­è¨€</strong>ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override
    <span class="token punctuation">{</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> R<span class="token string">"({ "</span>address"<span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"Drury Ln"</span><span class="token punctuation">,</span>
         <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Fountain"</span><span class="token punctuation">,</span>
         <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">,</span>
         <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"US"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">auto</span> <span class="token function">expectedArgs</span><span class="token punctuation">(</span><span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                          <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>Url<span class="token punctuation">,</span> <span class="token function">EndsWith</span><span class="token punctuation">(</span>expectedArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨è°ƒç”¨ get() æ—¶ï¼Œå­˜æ ¹å®ç°å¯ä»¥ç¡®ä¿å‚æ•°ç¬¦åˆé¢„æœŸï¼Œæ¥ä¸‹æ¥ä¿®æ”¹ä»£ç é€šè¿‡æµ‹è¯•ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> string<span class="token operator">&amp;</span> getRequestUrl <span class="token operator">=</span> <span class="token string">"lat="</span> <span class="token operator">+</span> Latitude <span class="token operator">+</span> <span class="token string">"&amp;lon="</span> <span class="token operator">+</span> Longitude<span class="token punctuation">;</span>
    <span class="token keyword">auto</span> jsonResponse <span class="token operator">=</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>getRequestUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    AddressExtractor extractor<span class="token punctuation">;</span>
    <span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>jsonResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> address<span class="token punctuation">.</span>Road <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>City <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>State <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>Country<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç”±äºå½“å‰ URL æ²¡æœ‰æŒ‡å®šæœåŠ¡å™¨è·¯å¾„ï¼Œä¿®æ”¹ verify() å‡½æ•°ï¼Œè®©å®ƒä¼ ç»™ get() ä¸€ä¸ªå®Œæ•´çš„ URL:</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    string <span class="token function">urlStart</span><span class="token punctuation">(</span><span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> <span class="token function">expectedArgs</span><span class="token punctuation">(</span>urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                        <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>Url<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span>expectedArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ€ç»ˆå®ç° summaryDescription() æ–¹æ³•åï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> request <span class="token operator">=</span> <span class="token function">createGetRequestUrl</span><span class="token punctuation">(</span>Latitude<span class="token punctuation">,</span> Longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> response <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">summaryDescription</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Response<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    AddressExtractor extractor<span class="token punctuation">;</span>
    <span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>Response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> address<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
string PlaceDescriptionService<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> RequestUrl<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>RequestUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string PlaceDescriptionService<span class="token operator">::</span><span class="token function">createGetRequestUrl</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    string server <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    string document <span class="token punctuation">{</span> <span class="token string">"nominatim/v1/reverse"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> server <span class="token operator">+</span> document <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"format"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span> <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> Latitude<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
           <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"lon"</span><span class="token punctuation">,</span> Longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string PlaceDescriptionService<span class="token operator">::</span><span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Key<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Value<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> Key <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> Value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ç°åœ¨ä»£ç ä¸­è¿˜æ¬ ç¼ºçš„åœ°æ–¹ï¼š<ol>
<li>é‡å¤ä»£ç ï¼šæµ‹è¯•ä¸­çš„æ–‡æœ¬å’Œäº§å“ä»£ç ä¸­çš„æ–‡æœ¬å®Œå…¨ä¸€æ ·ã€‚ç¬¬ä¸ƒç« ä¼šè®²è§£å¦‚ä½•å»é™¤è¿™ç§é‡å¤ã€‚</li>
<li>PlaceDescriptionService ä¸­çš„ä¸€äº›ç»“æ„æ˜¯å¯ä»¥å¤ç”¨çš„ã€‚å¯ä»¥è€ƒè™‘å¦‚ä½•è®¾è®¡æ›´åŠ æ–¹ä¾¿æ”¯æŒç¬¬äºŒä¸ªæœåŠ¡ã€‚</li>
</ol>
</li>
</ul>
<h2 id="åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶æå‡æµ‹è¯•çš„æŠ½è±¡ç¨‹åº¦"><a href="#åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶æå‡æµ‹è¯•çš„æŠ½è±¡ç¨‹åº¦" class="headerlink" title="åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶æå‡æµ‹è¯•çš„æŠ½è±¡ç¨‹åº¦"></a>åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶æå‡æµ‹è¯•çš„æŠ½è±¡ç¨‹åº¦</h2><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (71f934b009b744e4fd3d66d1a8d21792ad88471a)ï¼›</strong></p>
<p>åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶ï¼Œç”±äºæµ‹è¯•ä¸­æ¨¡ç³Šçš„ä¿¡æ¯å¢åŠ äº†è®¸å¤šç†è§£çš„éš¾åº¦ï¼Œä¾‹å¦‚ ReturnsDescriptionForValidLocation æµ‹è¯•ä¸­éšè—äº†è®¸å¤šç›¸å…³ä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆæœ€ç»ˆæ–­è¨€çš„æ¯”å¯¹ç›®æ ‡æ˜¯ Drury Ln, Fountain, CO, US è¿™äº›éƒ½ä¼šç»™é˜…è¯»æµ‹è¯•çš„äººæŸ¥çœ‹ HttpStub ä¸­ä¸ä¹‹ç›¸å…³çš„å®ç°ç»†èŠ‚æ‰èƒ½ç†è§£ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦é‡æ„æµ‹è¯•ï¼Œä½¿å®ƒå¯ä»¥è‡ªåŒ…å«ã€‚å¯ä»¥ä¿®æ”¹ HttpStub çš„å®ç°ï¼Œè®©æµ‹è¯•è´Ÿè´£è®¾å®š get() æ–¹æ³•çš„è¿”å›å€¼ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    string ReturnResponse<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override
    <span class="token punctuation">{</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ReturnResponse<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HttpStub httpStub<span class="token punctuation">;</span>
    httpStub<span class="token punctuation">.</span>ReturnResponse <span class="token operator">=</span> R<span class="token string">"({"</span>address"<span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"Drury Ln"</span><span class="token punctuation">,</span>
                                    <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Fountain"</span><span class="token punctuation">,</span>
                                    <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">,</span>
                                    <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"US"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">;</span>
    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> description <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>description<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Drury Ln, Fountain, CO, US"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™æ ·é˜…è¯»çš„äººå¯ä»¥å°†æ‘˜è¦æè¿°å’Œ HttpStub è¿”å›çš„ JSON å¯¹è±¡å¯¹åº”èµ·æ¥ï¼Œç±»ä¼¼çš„ï¼Œä¹Ÿå¯ä»¥å°† URL éªŒè¯ä»¥åˆ°æµ‹è¯•ä¸­ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    string ReturnResponse<span class="token punctuation">;</span>
    string ExpectedURL<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> override
    <span class="token punctuation">{</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ReturnResponse<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>Url<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span>ExpectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HttpStub httpStub<span class="token punctuation">;</span>
    httpStub<span class="token punctuation">.</span>ReturnResponse <span class="token operator">=</span> <span class="token comment" spellcheck="true">//....</span>

    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    httpStub<span class="token punctuation">.</span>ExpectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                           <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>

    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//.....</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç°åœ¨ï¼Œåœ¨æµ‹è¯•ä»£ç ä¸­å¯ä»¥æ¸…æ™°çš„è¡¨è¾¾å‡ºæ„å›¾ï¼ŒåŒæ—¶ HttpStub æ¶ˆå‡è‡³ä¸€ä¸ªå°ç±»ï¼Œè¿”å›éœ€è¦çš„å­˜æ ¹åŒæ—¶éªŒè¯æœŸæœ›çš„ä¿¡æ¯ã€‚ï¼Œä¸€ä¸ª HttpStub å¯¹è±¡éªŒè¯äº†è¿™æ ·çš„äº‹å®ï¼šä¼šæœ‰ä¸€ä¸ªæœŸæœ›çš„ URL ä¼ ç»™ HttpStubã€‚</p>
<h2 id="ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·"><a href="#ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·" class="headerlink" title="ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·"></a>ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·</h2><p>æœ¬ç»“å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Google Mock æ¥å®ç°å¯¹å¤šä¸ªç›¸ä¼¼çš„æ¨¡æ‹Ÿå¯¹è±¡è¾…åŠ©ç”Ÿæˆ Mock å¯¹è±¡çš„æ–¹æ³•ã€‚</p>
<h3 id="å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»"><a href="#å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»"></a>å®šä¹‰ä¸€ä¸ªæ´¾ç”Ÿç±»</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (74290eccd1b383da76082716ac070f7b06609a28)ï¼›</strong></p>
<p>ç°åœ¨å·²é‡æ–°å¼€å‘ summaryDescription() ä¸¾ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿ HTTP çš„æ–¹æ³•ï¼šget() å’Œ initialize()ã€‚</p>
<p>ä¸ºäº†ä½¿ç”¨ Google Mock è‡ªèº«çš„æ¨¡æ‹Ÿå¯¹è±¡ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ´¾ç”Ÿç±»ç”¨æ¥å£°æ˜æ‰€æ¨¡æ‹Ÿçš„æ–¹æ³•ã€‚Google Mock å…è®¸æˆ‘ä»¬ç®€æ´åœ°å®šä¹‰åä¸º HttpStub çš„æ´¾ç”Ÿç±»ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MOCK_METHOD0</span><span class="token punctuation">(</span>initialize<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// ä½¿ç”¨å®æ¥å£°æ˜æ¨¡æ‹Ÿçš„æ–¹æ³•</span>
    <span class="token function">MOCK_CONST_METHOD1</span><span class="token punctuation">(</span>get<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 1 æ ‡è¯†ä¸€ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æˆå‘˜å‡½æ•°åç§°ï¼Œç¬¬äºŒä¸ªå®å‚æ•°ç»™å‡ºæ–¹æ³•å…¶ä»–ä¿¡æ¯(è¿”å›å€¼å’Œå‚æ•°å£°æ˜)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>GoogleTest 1.10.x Release ç‰ˆæœ¬æ”¯æŒäº†ä¸€ä¸ªæ–°å®å®šä¹‰ï¼Œèˆå»äº†ç¹ççš„æ–¹æ³•ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MOCK_METHOD</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">,</span> initialize<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>override<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MOCK_METHOD</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> get<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> override<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
CmakeLists<span class="token punctuation">.</span>txt
<span class="token comment" spellcheck="true">//å½“å‰ä½¿ç”¨çš„ googletest ç‰ˆæœ¬ä¸º 1.10.x MOCK_METHOD å®åœ¨ç¼–è¯‘å™¨ä¸‹ä¼šæœ‰é”™è¯¯ä¿¡æ¯ï¼Œä¾æ® gmock issues æ— ç”¨æŠ¥é”™ å…³é—­ç›¸å…³è­¦å‘Š</span>
<span class="token function">add_definitions</span><span class="token punctuation">(</span><span class="token operator">-</span>Wno<span class="token operator">-</span>gnu<span class="token operator">-</span>zero<span class="token operator">-</span>variadic<span class="token operator">-</span>macro<span class="token operator">-</span>arguments<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Google Mock æŠŠä¸€ä¸ª mock å£°æ˜è½¬ä¸ºæ´¾ç”Ÿç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ã€‚Google Mock è¿˜åœ¨å¹•åå®ç°äº†è¿™ä¸ªå‡½æ•°ã€‚</p>
<h3 id="è®¾ç«‹æœŸæœ›"><a href="#è®¾ç«‹æœŸæœ›" class="headerlink" title="è®¾ç«‹æœŸæœ›"></a>è®¾ç«‹æœŸæœ›</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (8e49b0b7091856f6308584b40d1d8bdc2114c621)ï¼›</strong></p>
<p>é¦–å…ˆå±è”½æ‰ summaryDescription() çš„å…·ä½“å®ç°é‡æ–°å¼€å‘ä¸€æ¬¡ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HttpStub httpStub<span class="token punctuation">;</span>
    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>

    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡ EXPECT_CALL å®è®¾ç«‹æœŸæœ›ï¼Œè¿™ä¸ªå®é…ç½® Google Mock å»éªŒè¯ç»™å®šçš„ expectedURL å‚æ•°å»è°ƒç”¨ httpStub å¯¹è±¡çš„ get() é€»è¾‘æ˜¯å¦å»åˆã€‚å…¶æ–­è¨€ç”Ÿæ•ˆåœ¨æ¨¡æ‹Ÿå¯¹è±¡è·³å‡ºä½œç”¨åŸŸåå¼€å§‹éªŒè¯ï¼Œæ–­è¨€æ­¥éª¤è¢«éšå¼çš„æ‰§è¡Œäº†ã€‚</p>
<p>å¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥å¼ºåˆ¶ Google Mock åœ¨æ¨¡æ‹Ÿå¯¹è±¡è·³å‡ºä½œç”¨åŸŸå‰åšéªŒè¯: <code>Mock::VerifyAndClearExpectations(&amp;httpStub);</code></p>
<p>é¦–å…ˆç©ºå®ç° summaryDescription()ï¼Œè®©æµ‹è¯•å¯ä»¥ç¼–è¯‘è¿è¡Œï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œåï¼Œæµ‹è¯•å‡ºç°å¤±è´¥ä¿¡æ¯ï¼Œç›´åˆ°æµ‹è¯•ç»“æŸä¸ºæ­¢ï¼ŒhttpStub å¯¹è±¡çš„ get() ä¹Ÿæ²¡æœ‰è¢«è°ƒç”¨ã€‚ï¼š</p>
<pre class="line-numbers language-shell"><code class="language-shell">[----------] 1 test from APlaceDescriptionService
[ RUN      ] APlaceDescriptionService.ReturnsDescriptionForValidLocation
/home/caolei/WorkSpace/TDD_Learning/test/Gmock/PlaceDescriptionServiceTestByGMock/PlaceDescriptionServiceTest.cpp:36: Failure
Actual function call count doesn't match EXPECT_CALL(httpStub, get(expectedURL))...
         Expected: to be called once
           Actual: never called - unsatisfied and active
[  FAILED  ] APlaceDescriptionService.ReturnsDescriptionForValidLocation (0 ms)
[----------] 1 test from APlaceDescriptionService (0 ms total)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹ä»£ç ä½¿ä¹‹é€šè¿‡æµ‹è¯•ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    string server <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    string document <span class="token punctuation">{</span> <span class="token string">"nominatim/v1/reverse"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// clang-format off</span>
    string url <span class="token operator">=</span> server <span class="token operator">+</span> document <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span>
                    <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"format"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                    <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">,</span> Latitude<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                    <span class="token function">keyValue</span><span class="token punctuation">(</span><span class="token string">"lon"</span><span class="token punctuation">,</span> Longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// clang-format on</span>
    <span class="token keyword">auto</span> response <span class="token operator">=</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    AddressExtractor extractor<span class="token punctuation">;</span>
    <span class="token keyword">auto</span> address <span class="token operator">=</span> extractor<span class="token punctuation">.</span><span class="token function">addressFrom</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> address<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æ¾æ¨¡æ‹Ÿå’Œä¸¥æ¨¡æ‹Ÿ"><a href="#æ¾æ¨¡æ‹Ÿå’Œä¸¥æ¨¡æ‹Ÿ" class="headerlink" title="æ¾æ¨¡æ‹Ÿå’Œä¸¥æ¨¡æ‹Ÿ"></a>æ¾æ¨¡æ‹Ÿå’Œä¸¥æ¨¡æ‹Ÿ</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (46639a97cb73d0cd34071e70e1cc0bd05560fc94)ï¼›</strong></p>
<p>summaryDescription() çš„è§†çº¿ä¸­å¹¶æ²¡æœ‰éµé¡¼ CurlHttp æ¥å£è§„åˆ™ï¼Œå³åœ¨ä½¿ç”¨ get() å‰æ²¡æœ‰è¿›è¡Œ initialize åˆå§‹åŒ–ã€‚å¯ä»¥åœ¨æµ‹è¯•ä¸­æ–°å¢ä¸€ä¸ªæœŸæœ›æ¥ç¡®ä¿åˆå§‹åŒ–è¢«è°ƒç”¨ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HttpStub httpStub<span class="token punctuation">;</span>
    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>

    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¥ä¸‹æ¥ä¿æŒ summaryDescription() ä¸­ç­–ç•¥ä¸å˜ï¼Œå•ç‹¬æŠ½ç¦» get() æ¥å£æˆä¸ºå•ç‹¬çš„æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> MHttp<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æ¨¡æ‹Ÿå¯¹è±¡ä¸­çš„é¡ºåº"><a href="#æ¨¡æ‹Ÿå¯¹è±¡ä¸­çš„é¡ºåº" class="headerlink" title="æ¨¡æ‹Ÿå¯¹è±¡ä¸­çš„é¡ºåº"></a>æ¨¡æ‹Ÿå¯¹è±¡ä¸­çš„é¡ºåº</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (e1a51df6b0e5af65d328017b1e9c9ebb1b46b0ea)ï¼›</strong></p>
<p>initialize() å’Œ get() çš„è°ƒç”¨æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ GMOCK ä¸ä¼šéªŒè¯æ»¡è¶³è°ƒç”¨æœŸæœ›çš„é¡ºåºï¼Œå¦‚æœæƒ³è¦éªŒè¯ï¼Œå¯ä»¥å®šä¹‰ InSequence å®ä¾‹ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    InSequence forceExpectationOrder<span class="token punctuation">;</span>

    HttpStub httpStub<span class="token punctuation">;</span>
    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>

    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿˜å¯ä»¥æ›´åŠ ç²¾ç»†æ§åˆ¶ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥å‚è§ <a target="_blank" rel="noopener" href="https://github.com/google/googletest/blob/master/docs/gmock_cheat_sheet.md">GoogleMock DOC</a>ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HttpStub httpStub<span class="token punctuation">;</span>
    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>

    Expectation Expectations <span class="token operator">=</span> <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>Expectations<span class="token punctuation">)</span><span class="token punctuation">;</span>

    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="å·§å¦™çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§"><a href="#å·§å¦™çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§" class="headerlink" title="å·§å¦™çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§"></a>å·§å¦™çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (8478946c5e86720daeec8eba54ef1dd5438899a1)ï¼›</strong></p>
<p>EXPECT_CALL å®æ”¯æŒè®¸å¤šä¿®é¥°ç¬¦ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼ˆ?å’Œ<em>ä»£è¡¨æ¯ä¸ªä¿®é¥°ç¬¦çš„åŸºæ•°ï¼š?è¡¨ç¤ºå¯ä»¥é€‰ç”¨ä¿®é¥°ç¬¦ä¸€æ¬¡ï¼›</em>è¡¨ç¤ºå¯ä»¥å¤šæ¬¡ä½¿ç”¨ä¿®é¥°ç¬¦ã€‚ï¼‰ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>mock<span class="token operator">-</span>object<span class="token punctuation">,</span> <span class="token function">method</span> <span class="token punctuation">(</span>matchers<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span>multi<span class="token operator">-</span>argument<span class="token operator">-</span>matcher<span class="token punctuation">)</span>  <span class="token operator">?</span>
     <span class="token punctuation">.</span><span class="token function">Times</span><span class="token punctuation">(</span>cardinality<span class="token punctuation">)</span>            <span class="token operator">?</span>
     <span class="token punctuation">.</span><span class="token function">InSequence</span><span class="token punctuation">(</span>sequences<span class="token punctuation">)</span>         <span class="token operator">*</span>
     <span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>expectations<span class="token punctuation">)</span>           <span class="token operator">*</span>
     <span class="token punctuation">.</span><span class="token function">WillOnce</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>              <span class="token operator">*</span>
     <span class="token punctuation">.</span><span class="token function">WillRepeatedly</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>        <span class="token operator">?</span>
     <span class="token punctuation">.</span><span class="token function">RetiresOnSaturation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">?</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>GMOCK å·¥å…·å¯ä»¥æ”¯æŒå‡ ä¹æ‰€æœ‰çš„æ¨¡æ‹Ÿæ–¹å¼ï¼Œå¦‚ä¸‹ä¾‹æ¨¡æ‹Ÿè¾“å…¥å‚æ•°çš„å‡½æ•°å¹¶æŒ‡å®šä¸€ä¸ªè¿”å›å€¼ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">DifficultCollaborator</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span> Result<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token function">TEST</span><span class="token punctuation">(</span>ATarget<span class="token punctuation">,</span> ReturnsAnAmountWhenCalculatePasses<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    DifficultCollaboratorMock difficult<span class="token punctuation">;</span>
    Target calc<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//SetArgPointee&lt;0>(3) è¡¨ç¤º ç¬¬ 0 ä¸ªå‚æ•°å€¼ä¸º 3ã€‚</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>difficult<span class="token punctuation">,</span> <span class="token function">calculate</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WillOnce</span><span class="token punctuation">(</span><span class="token function">DoAll</span><span class="token punctuation">(</span>SetArgPointee<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> result <span class="token operator">=</span> calc<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>difficult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>GMOCK è¿˜æä¾›äº†è®¸å¤šåŠŸèƒ½æ”¯æŒï¼Œä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µåªéœ€è¦åŸºæœ¬çš„æœºåˆ¶å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœåœ¨ TDD è¿‡ç¨‹ä¸­ç»å¸¸é‡åˆ°è¦ç”¨æ€ªå¼‚çš„æ¨¡æ‹Ÿå·¥å…·ç‰¹æ€§ï¼Œè¯·æ£€æŸ¥ä¸‹è®¾è®¡æ˜¯å¦åšäº†è¿‡å¤šçš„äº‹æƒ…ã€‚</p>
<p>å½“ä½ å°è¯•ç€ä¸ºéæµ‹è¯•é©±åŠ¨çš„ã€ç»“æ„ä¸è‰¯çš„ç³»ç»Ÿç¼–å†™æµ‹è¯•å¹¶é‡åˆ°é—®é¢˜æ—¶ï¼Œæˆ–è®¸éœ€è¦ä½¿ç”¨æ¨¡æ‹Ÿå·¥å…·æä¾›çš„æ›´åŠ å¼ºå¤§çš„ç‰¹æ€§ã€‚æˆ‘ä»¬ä¼šåœ¨ç¬¬ 8 ç« ä¸­è®¨è®ºè¿™ç±»é—®é¢˜ã€‚</p>
<h3 id="æ’é™¤æ¨¡æ‹Ÿå¤±è´¥"><a href="#æ’é™¤æ¨¡æ‹Ÿå¤±è´¥" class="headerlink" title="æ’é™¤æ¨¡æ‹Ÿå¤±è´¥"></a>æ’é™¤æ¨¡æ‹Ÿå¤±è´¥</h3><ol>
<li>äº§å“ä»£ç ä¸­æ˜¯å¦æœ‰åˆç†è°ƒç”¨ï¼Ÿ</li>
<li>æ˜¯å¦æ­£ç¡®å®šä¹‰äº†æ¨¡æ‹Ÿæ–¹æ³•ï¼Ÿ</li>
<li>æœ‰æ²¡æœ‰å°†è¦æ¨¡æ‹Ÿçš„æˆå‘˜å‡½æ•°å£°æ˜ä¸ºè™šå‡½æ•°ï¼Ÿ</li>
<li>MOCK_METHOD() å£°æ˜æ­£ä¸æ­£ç¡®ï¼Ÿ</li>
<li>æ’é™¤å‚æ•°åŒ¹é…çš„æ‹…å¿§ï¼Œä¸ºæ‰€æœ‰å‚æ•°å’Œè¿”å›å€¼ä½¿ç”¨é€šé…ç¬¦ testing::_ ï¼Œå¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæœ‰ä¸€ä¸ªå‚æ•°ä¸èƒ½è¢«æ­£ç¡®åŒ¹é…ã€‚</li>
</ol>
<h3 id="ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªæµ‹è¯•"><a href="#ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªæµ‹è¯•" class="headerlink" title="ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªæµ‹è¯•"></a>ä¸€ä¸ªè¿˜æ˜¯ä¸¤ä¸ªæµ‹è¯•</h3><p>å½“ä½¿ç”¨æ‰‹å·¥åˆ›å»ºçš„æ¨¡æ‹Ÿå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬æœ€ç»ˆåªç”¨äº†ä¸€ä¸ªæµ‹è¯•æ¥éªŒè¯æœ€ç»ˆçš„ç›®æ ‡ï¼Œå³ä¸ºä¸€ä¸ªä½ç½®ç”Ÿæˆæ¦‚è¦ä¿¡æ¯æè¿°ã€‚ä½†æ˜¯ï¼Œåœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å´ç”¨äº†ä¸¤ä¸ªæµ‹è¯•ã€‚</p>
<p>æ‹¥æœ‰ä¸¤ä¸ªæµ‹è¯•è¿˜ä¼šæä¾›é¢å¤–çš„å¥½å¤„ã€‚ç¬¬ä¸€ï¼Œä¸€ä¸ªæ¨¡æ‹ŸéªŒè¯æ˜¯ä¸€ä¸ªæ–­è¨€ã€‚æˆ‘ä»¬å·²ç»ç”¨ä¸€ä¸ªæ–­è¨€æ¥éªŒè¯æ¦‚è¦ä¿¡æ¯å­—ç¬¦ä¸²äº†ã€‚å°†æµ‹è¯•åˆ†ä¸ºä¸¤ä¸ªï¼Œä¸ä¸€ä¸ªæ–­è¨€ä¸€ä¸ªæµ‹è¯•ä¿æŒä¸€è‡´ï¼ˆå‚è€ƒ 7.3 èŠ‚ï¼‰ã€‚ç¬¬äºŒï¼Œç‹¬ç«‹çš„æµ‹è¯•æ›´å…·å¯è¯»æ€§ã€‚ç”±äºåœ¨ Google Mock ä¸­è®¾ç«‹æœŸæœ›ä¼šå¯¼è‡´å¾ˆéš¾ç•Œå®šè®¾ç½®æ–­è¨€çš„ä½ç½®ï¼ˆè¿™ä¹Ÿå’Œ 4.2.4 èŠ‚ä¸€è‡´ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬ä¸ºç®€åŒ–åŸºäºæ¨¡æ‹Ÿçš„æµ‹è¯•çš„åŠªåŠ›æ˜¯å€¼å¾—çš„ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    HttpStub httpStub<span class="token punctuation">;</span>
    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>

    Expectation Expectations <span class="token operator">=</span> <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//  get(expectedURL) è¿™ä¸€æ­¥åŒæ—¶éªŒè¯äº†åº”è¯¥ä¼ ç»™ get çš„å‚æ•°ä¸ expectedURL ä¸€è‡´</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>Expectations<span class="token punctuation">)</span><span class="token punctuation">;</span>

    PlaceDescriptionService service <span class="token punctuation">{</span> <span class="token operator">&amp;</span>httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> FormatsRetrievedAddressIntoSummaryDescription<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    NiceMock<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> httpStub<span class="token punctuation">;</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">WillOnce</span><span class="token punctuation">(</span><span class="token function">Return</span><span class="token punctuation">(</span>
            R<span class="token string">"({ "</span>address"<span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">"road"</span><span class="token operator">:</span><span class="token string">"Drury Ln"</span><span class="token punctuation">,</span>
              <span class="token string">"city"</span><span class="token operator">:</span><span class="token string">"Fountain"</span><span class="token punctuation">,</span>
              <span class="token string">"state"</span><span class="token operator">:</span><span class="token string">"CO"</span><span class="token punctuation">,</span>
              <span class="token string">"country"</span><span class="token operator">:</span><span class="token string">"US"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>"<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    PlaceDescriptionService <span class="token function">service</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>httpStub<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">auto</span> description <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">ASSERT_THAT</span><span class="token punctuation">(</span>description<span class="token punctuation">,</span> <span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"Drury Ln, Fountain, CO, US"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="è®©æµ‹è¯•æ›¿èº«å„å°±å„ä½"><a href="#è®©æµ‹è¯•æ›¿èº«å„å°±å„ä½" class="headerlink" title="è®©æµ‹è¯•æ›¿èº«å„å°±å„ä½"></a>è®©æµ‹è¯•æ›¿èº«å„å°±å„ä½</h2><p>åœ¨å¼•å…¥ä¸€ä¸ªæµ‹è¯•æ›¿èº«æ—¶éœ€è¦åšä¸¤ä»¶äº‹ã€‚ç¬¬ä¸€ï¼Œç¼–å†™æµ‹è¯•æ›¿èº«ã€‚ç¬¬äºŒï¼Œåœ¨ç›®æ ‡æµ‹è¯•ä¸­ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ ·çš„åšæ³•åˆç§°ä½œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰ã€‚</p>
<p>ä»¥å‰æ–‡çš„ PlaceDescriptionService ä¸ºä¾‹ï¼Œå®ƒæ˜¯é€šè¿‡æ„é€ å‡½æ•°å°†æµ‹è¯•æ›¿èº«æ³¨å…¥å…¶ä¸­ï¼Œæœ‰äº›æƒ…å†µå¯èƒ½ä½¿ç”¨ setter æˆå‘˜å‡½æ•°æ¥æ³¨å…¥æµ‹è¯•æ›¿èº«æ›´åˆé€‚ï¼Œè¿™ç§æ–¹æ³•åˆç§°ä½œæ„é€ æ³¨å…¥æˆ– setter æ³¨å…¥ã€‚</p>
<h3 id="è¦†å†™å·¥å‚æ–¹æ³•å’Œè¦†å†™-Getter"><a href="#è¦†å†™å·¥å‚æ–¹æ³•å’Œè¦†å†™-Getter" class="headerlink" title="è¦†å†™å·¥å‚æ–¹æ³•å’Œè¦†å†™ Getter"></a>è¦†å†™å·¥å‚æ–¹æ³•å’Œè¦†å†™ Getter</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (fe19774356b4cb14d14e4041029c535b3619ebf3)ï¼›</strong></p>
<p>æƒ³è¦ä½¿ç”¨è¦†å†™å·¥å‚æ–¹æ³•ï¼Œé¦–å…ˆè¦ä¿®æ”¹äº§å“ä»£ç ä½¿ç”¨å·¥å‚æ¨¡å¼è·å–å†™ä½œç±»çš„å®ä¾‹ï¼š</p>
<p>é¦–å…ˆä¿®æ”¹ PlaceDescriptionService ä¸­çš„æˆå‘˜ Http* MHttpï¼Œä¸åœ¨ä»¥æˆå‘˜æ–¹å¼ä¿å­˜è€Œæ˜¯ httpService() è·å–ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//PlaceDescriptionService.h</span>
<span class="token keyword">class</span> <span class="token class-name">PlaceDescriptionService</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">summaryDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> Longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> <span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//PlaceDescriptionService.cpp</span>
string PlaceDescriptionService<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> http <span class="token operator">=</span> <span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    http<span class="token operator">-</span><span class="token operator">></span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> http<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> PlaceDescriptionService<span class="token operator">::</span><span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> make_shared<span class="token operator">&lt;</span>CurlHttp<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡ httpService è·å–å¯ä»¥çœ‹ä½œä½¿é€šè¿‡å·¥å‚æ¨¡å¼è·å–åˆ°åŠŸèƒ½ç±»ï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿ PlaceDescriptionService æ¥è¦†å†™ httpService ä¼ å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ Http åŠŸèƒ½ç±»ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">PlaceDescriptionServiceStubHttpService</span> <span class="token operator">:</span> <span class="token keyword">public</span> PlaceDescriptionService
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment" spellcheck="true">// è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªæ„é€ ç”¨äºä¼ å…¥è‡ªå®šä¹‰çš„ Http åŠŸèƒ½ç±»</span>
    <span class="token function">PlaceDescriptionServiceStubHttpService</span><span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> ParmHttpStub<span class="token punctuation">)</span>
            <span class="token operator">:</span> HttpStub <span class="token punctuation">{</span> ParmHttpStub <span class="token punctuation">}</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> <span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> override <span class="token punctuation">{</span> <span class="token keyword">return</span> HttpStub<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> HttpStub<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…·ä½“æµ‹è¯•ä»£ç äºä¹‹é—´å·®ä¸å¤šï¼Œå”¯ä¸€çš„å·®å¼‚å°±æ˜¯ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆè¿›è¡Œäº†å°è£…ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionService<span class="token punctuation">,</span> ReturnsDescriptionForValidLocation<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    shared_ptr<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> httpStub <span class="token punctuation">{</span> <span class="token keyword">new</span> HttpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>

    Expectation Expectations <span class="token operator">=</span> <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span><span class="token operator">*</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//  get(expectedURL) è¿™ä¸€æ­¥åŒæ—¶éªŒè¯äº†åº”è¯¥ä¼ ç»™ get çš„å‚æ•°ä¸ expectedURL ä¸€è‡´</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span><span class="token operator">*</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>Expectations<span class="token punctuation">)</span><span class="token punctuation">;</span>

    PlaceDescriptionServiceStubHttpService service <span class="token punctuation">{</span> httpStub <span class="token punctuation">}</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¦†å†™å·¥å‚æ–¹æ³•å±•ç¤ºäº†ä½¿ç”¨æµ‹è¯•æ›¿èº«æ‰€å¸¦æ¥çš„æµ‹è¯•è¦†ç›–ç‡æ¼æ´ã€‚ç”±äºæˆ‘ä»¬çš„æµ‹è¯•è¦†å†™äº†äº§å“ä»£ç ä¸­ httpService() çš„å®ç°ï¼Œå› æ­¤æµ‹è¯•å¹¶æ²¡æœ‰ä½¿ç”¨å®é™…äº§å“ä»£ç ä¸­çš„è¿™ä¸ªå‡½æ•°ã€‚æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œè¦ç¡®ä¿åœ¨é›†æˆæµ‹è¯•ä¸­ä½¿ç”¨å®é™…çš„æœåŠ¡ï¼åŒæ—¶ï¼Œä¸è¦åœ¨å·¥å‚æ–¹æ³•ä¸­åŠ å…¥å®é™…é€»è¾‘çš„ä»£ç ï¼Œå¦åˆ™ï¼Œæœªç»æµ‹è¯•çš„ä»£ç å°±ä¼šè¶Šæ¥è¶Šå¤šã€‚å·¥å‚æ–¹æ³•åº”å½“åªè¿”å›åä½œç±»å‹çš„ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>å…³äº Getter å…¶å®ä¸è¦†ç›–å·¥å‚å·®ä¸å¤šï¼ŒåŒºåˆ«å¦‚ä¸‹:</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">PlaceDescriptionService</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    std<span class="token operator">::</span>string <span class="token function">summaryDescription</span><span class="token punctuation">(</span>
    <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> longitude<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment" spellcheck="true">// ...</span>
    std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> http_<span class="token punctuation">;</span>

<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> <span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

PlaceDescriptionService<span class="token operator">::</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> http_<span class="token punctuation">{</span>make_shared<span class="token operator">&lt;</span>CurlHttp<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// ...</span>
shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> PlaceDescriptionService<span class="token operator">::</span><span class="token function">httpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> http_<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="ä½¿ç”¨å·¥å‚"><a href="#ä½¿ç”¨å·¥å‚" class="headerlink" title="ä½¿ç”¨å·¥å‚"></a>ä½¿ç”¨å·¥å‚</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (398ef02bf56e9484335f5f1aed0f07caf01424b1)ï¼›</strong></p>
<p>å·¥å‚ç±»æ˜¯ç”¨æ¥è´Ÿè´£åˆ›å»ºå’Œè¿”å›å®ä¾‹çš„ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ª HttpFactoryï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æµ‹è¯•ä¸­å‘Šè¯‰å®ƒè¿”å›ä¸€ä¸ª HttpStub å®ä¾‹è€Œé Http å®ä¾‹ã€‚æ³¨æ„ä¸è¦ä»…ä»…ä¸ºäº†æ”¯æŒæµ‹è¯•è€Œå¼•å…¥å·¥å‚æ¨¡å¼ã€‚</p>
<p>ä¸‹ä¾‹ä½¿å·¥å‚å®ç°ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"CurlHttp.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"HttpFactory.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;memory></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

HttpFactory<span class="token operator">::</span><span class="token function">HttpFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> HttpFactory<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> Instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> HttpFactory<span class="token operator">::</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Instance <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>CurlHttp<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> HttpFactory<span class="token operator">::</span><span class="token function">setInstance</span><span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>Http<span class="token operator">></span> NewInstance<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Instance <span class="token operator">=</span> NewInstance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹æµ‹è¯•ä»£ç ï¼Œåœ¨æµ‹è¯•æ‰§è¡Œå‰ï¼Œè°ƒç”¨ setInstance å°†å·¥å‚ä¸­äº§å“æ›¿æ¢æ‰ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionService</span> <span class="token operator">:</span> <span class="token keyword">public</span> Test
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLatitude<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLongitude<span class="token punctuation">;</span>

    shared_ptr<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> httpStub<span class="token punctuation">;</span>
    shared_ptr<span class="token operator">&lt;</span>HttpFactory<span class="token operator">></span> factory<span class="token punctuation">;</span>
    shared_ptr<span class="token operator">&lt;</span>PlaceDescriptionService<span class="token operator">></span> service<span class="token punctuation">;</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override
    <span class="token punctuation">{</span>
        factory <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>HttpFactory<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>PlaceDescriptionService<span class="token operator">></span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">TearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override
    <span class="token punctuation">{</span>
        factory<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpStub<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionServiceWithHttpMock</span> <span class="token operator">:</span> <span class="token keyword">public</span> APlaceDescriptionService
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> override
    <span class="token punctuation">{</span>
        APlaceDescriptionService<span class="token operator">::</span><span class="token function">SetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpStub <span class="token operator">=</span> make_shared<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token operator">-</span><span class="token operator">></span><span class="token function">setInstance</span><span class="token punctuation">(</span>httpStub<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionServiceWithHttpMock<span class="token punctuation">,</span> MakesHttpRequestToObtainAddress<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span><span class="token operator">*</span>httpStub<span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span><span class="token operator">*</span>httpStub<span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    service<span class="token operator">-</span><span class="token operator">></span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¿®æ”¹ summaryDescription() ä»£ç ï¼Œé€šè¿‡å·¥å‚è·å– Http å®ä¾‹ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">//æ„é€ ä¼ å…¥å·¥å‚å®ä¾‹</span>
PlaceDescriptionService<span class="token operator">::</span><span class="token function">PlaceDescriptionService</span><span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>HttpFactory<span class="token operator">></span> HttpFactory<span class="token punctuation">)</span>
        <span class="token operator">:</span> httpFactory_ <span class="token punctuation">{</span> HttpFactory <span class="token punctuation">}</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//å†²è·å–æ¥å£æ”¹ä¸ºä»å·¥å‚è·å¾—å®ä¾‹</span>
string PlaceDescriptionService<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> Url<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// auto http = httpService();</span>
    <span class="token keyword">auto</span> http <span class="token operator">=</span> httpFactory_<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    http<span class="token operator">-</span><span class="token operator">></span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> http<span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="é€šè¿‡æ¨¡æ¿å‚æ•°"><a href="#é€šè¿‡æ¨¡æ¿å‚æ•°" class="headerlink" title="é€šè¿‡æ¨¡æ¿å‚æ•°"></a>é€šè¿‡æ¨¡æ¿å‚æ•°</h3><p><strong>å‚è€ƒä»£ç ç‰ˆæœ¬ï¼šGit SHA (35932b820ad5de4a9bb584f1eeed6d4f6bfa86f4)ï¼›</strong></p>
<p>å¯ä»¥é€šè¿‡æ¨¡æ¿å‚æ•°è¿›è¡Œæ³¨å…¥ï¼Œå®ƒä¸éœ€è¦å®¢æˆ·ç¨‹åºä¼ é€’ä¸€ä¸ªåä½œç±»çš„å®ä¾‹ã€‚æŠŠ PlaceDescriptionService å£°æ˜ä¸ºä¸€ä¸ªæ¨¡æ¿ï¼Œå®ƒæœ‰ä¸€ä¸ªç±»å‹åç§°ï¼Œå³ HTTPã€‚åœ¨è¿™ä¸ªæ¨¡æ¿ä¸­åŠ å…¥ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œhttp_ï¼Œå…¶ç±»å‹ä¸º HTTPã€‚å› ä¸ºæˆ‘ä»¬æƒ³è®©å®¢æˆ·ä½¿ç”¨ç±»å PlaceDescriptionServiceï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ¨¡æ¿ç±»æ”¹åä¸º PlaceDescriptionServiceTemplateã€‚åœ¨å®šä¹‰æ¨¡æ¿ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ typedef æ¥å®šä¹‰ PlaceDescriptionServiceï¼Œå®ƒå°†äº§å“ç±» Http ä½œä¸º PlaceDescriptionServiceTemplate çš„æ¨¡æ¿å‚æ•°ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> HTTP<span class="token operator">></span>
<span class="token keyword">class</span> <span class="token class-name">PlaceDescriptionServiceTemplate</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment" spellcheck="true">// ...</span>
    <span class="token comment" spellcheck="true">// æµ‹è¯•ä¸­çš„mockéœ€è¦å¼•ç”¨</span>
    HTTP<span class="token operator">&amp;</span> <span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> http_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment" spellcheck="true">// ...</span>
    std<span class="token operator">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        http_<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> http_<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// ...</span>
    HTTP http_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Http</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> PlaceDescriptionServiceTemplate<span class="token operator">&lt;</span>Http<span class="token operator">></span> PlaceDescriptionService<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨æµ‹è¯•æ—¶ä¹Ÿæ˜¯é€šè¿‡å£°æ˜ä¸€ä¸ªæœåŠ¡æ¨¡æ‹Ÿç±»ï¼Œå³ HttpStubï¼Œä¸ºæ¨¡æ¿ PlaceDescriptionServiceTemplate çš„å‚æ•°ã€‚</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionService</span> <span class="token operator">:</span> <span class="token keyword">public</span> Test
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLatitude<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> string ValidLongitude<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">APlaceDescriptionServiceWithHttpMock</span> <span class="token operator">:</span> <span class="token keyword">public</span> APlaceDescriptionService
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    PlaceDescriptionServiceTemplate<span class="token operator">&lt;</span>HttpStub<span class="token operator">></span> service<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">TEST_F</span><span class="token punctuation">(</span>APlaceDescriptionServiceWithHttpMock<span class="token punctuation">,</span> MakesHttpRequestToObtainAddress<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    string urlStart <span class="token punctuation">{</span> <span class="token string">"http://open.mapquestapi.com/nominatim/v1/reverse?format=json&amp;"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">auto</span> expectedURL <span class="token operator">=</span> urlStart <span class="token operator">+</span> <span class="token string">"lat="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLatitude <span class="token operator">+</span> <span class="token string">"&amp;"</span> <span class="token operator">+</span>
                       <span class="token string">"lon="</span> <span class="token operator">+</span> APlaceDescriptionService<span class="token operator">::</span>ValidLongitude<span class="token punctuation">;</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">http</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get</span><span class="token punctuation">(</span>expectedURL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    service<span class="token punctuation">.</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>ValidLatitude<span class="token punctuation">,</span> ValidLongitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="æ³¨å…¥å·¥å…·"><a href="#æ³¨å…¥å·¥å…·" class="headerlink" title="æ³¨å…¥å·¥å…·"></a>æ³¨å…¥å·¥å…·</h3><p>ç”¨äºæ³¨å…¥åä½œå¯¹è±¡ä½œä¸ºä¾èµ–å¯¹è±¡çš„å·¥å…·åˆç§°ä¸ºä¾èµ–æ³¨å…¥å·¥å…·ã€‚é¦–å…ˆï¼Œä½ éœ€è¦æŒæ¡è¿™é‡Œæè¿°çš„æ‰‹å·¥æ³¨å…¥æŠ€å·§ã€‚å…¶æ¬¡ï¼Œå†å»è°ƒç ”ä¸€ä¸‹æ³¨å…¥å·¥å…·ï¼Œæ¥æ£€æŸ¥å®ƒä»¬èƒ½å¦å¸¦æ¥ä¸€äº›æ”¹å–„ã€‚ä¾èµ–æ³¨å…¥å·¥å…·é€šå¸¸åœ¨å®Œå…¨æ”¯æŒåå°„æœºåˆ¶çš„è¯­è¨€ä¸­æ›´åŠ æœ‰æ•ˆã€‚</p>
<h2 id="è®¾è®¡ä¼šå˜åŒ–"><a href="#è®¾è®¡ä¼šå˜åŒ–" class="headerlink" title="è®¾è®¡ä¼šå˜åŒ–"></a>è®¾è®¡ä¼šå˜åŒ–</h2><p>åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶ä¼šå‘ç°ï¼Œæ­£åœ¨æ”¹å˜ä½ çš„è®¾è®¡æ–¹æ³•ã€‚è¿™æ ·å¯èƒ½ä¼šä»¤ä½ ä¸å®‰ã€‚ä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼Œè¿™æ˜¯æ­£å¸¸çš„ååº”ã€‚</p>
<h3 id="å†…èšä¸è€¦åˆ"><a href="#å†…èšä¸è€¦åˆ" class="headerlink" title="å†…èšä¸è€¦åˆ"></a>å†…èšä¸è€¦åˆ</h3><p>åœ¨é¢å¯¹ä¸€äº›æ…¢é€Ÿæˆ–è€…ä¸ç¨³å®šçš„ååŒå¯¹è±¡ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯å°†å®ƒä»¬éš”ç¦»æˆå•ç‹¬çš„ç±»ã€‚ä¾‹å¦‚å‘é€ HTTP çš„è¯·æ±‚ï¼Œè™½ç„¶å®ƒå¹¶ä¸æ˜¯éå¸¸å¤æ‚ï¼Œæ”¾åˆ°ä¸€ä¸ªå°è€Œç‹¬ç«‹çš„ç±»ä¸­æœ‰äº›ä¸å€¼å¾—ï¼Œä½†æ˜¯é€‰æ‹©è¿™æ ·çš„æ–¹å¼å°†å¸¦æ¥å® ç”¨çš„æœºä¼šå’Œæ›´çµæ´»çš„è®¾è®¡å¼¹æ€§ï¼ˆå¯ä»¥åˆ©ç”¨å¤šæ€çš„æ–¹å¼æ¥æ›¿æ¢ï¼‰ã€‚</p>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºæ›´åŠ è¿‡ç¨‹åŒ–ã€å¼±å†…èšçš„ä»£ç ï¼Œåœ¨æµ‹è¯•åè¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ª PlaceDescriptionService çš„å…¸å‹è§£å†³æ–¹æ¡ˆï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp">string PlaceDescriptionService<span class="token operator">::</span><span class="token function">summaryDescription</span><span class="token punctuation">(</span>
      <span class="token keyword">const</span> string<span class="token operator">&amp;</span> latitude<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> longitude<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true">// retrieve JSON response via API</span>
   response_ <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> url <span class="token operator">=</span> <span class="token function">createGetRequestUrl</span><span class="token punctuation">(</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">curl_easy_setopt</span><span class="token punctuation">(</span>curl<span class="token punctuation">,</span> CURLOPT_URL<span class="token punctuation">,</span> url<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">curl_easy_perform</span><span class="token punctuation">(</span>curl<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">curl_easy_cleanup</span><span class="token punctuation">(</span>curl<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">// parse json response</span>
   Value location<span class="token punctuation">;</span>
   Reader reader<span class="token punctuation">;</span>
   reader<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>response_<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">auto</span> jsonAddress <span class="token operator">=</span> location<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">,</span> Value<span class="token operator">::</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">// populate address from json</span>
   Address address<span class="token punctuation">;</span>
   address<span class="token punctuation">.</span>road <span class="token operator">=</span> jsonAddress<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"road"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   address<span class="token punctuation">.</span>city <span class="token operator">=</span> jsonAddress<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"hamlet"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   address<span class="token punctuation">.</span>state <span class="token operator">=</span> jsonAddress<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   address<span class="token punctuation">.</span>country <span class="token operator">=</span> jsonAddress<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"country"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> address<span class="token punctuation">.</span>road <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>city <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span>
          address<span class="token punctuation">.</span>state <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> address<span class="token punctuation">.</span>country<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™æ˜¯å…¸å‹çš„åæµ‹è¯•ä»£ç ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥å°†å…¶æ‹†æˆå¤šä¸ªæ›´å°çš„å‡½æ•°ï¼Œå°±åƒç¨æ—©å‰çš„åšæ³•ä¸€æ ·ï¼Œä½†æ˜¯å¼€å‘äººå‘˜ä¸ä¼šè¿™ä¹ˆåšã€‚æµ‹è¯•åè¡Œçš„å¼€å‘è€…ä¸ä¹ æƒ¯å®šæœŸåšé‡æ„ï¼Œé€šå¸¸ï¼Œä»–ä»¬ä¸éœ€è¦ä½¿ç”¨å¿«é€Ÿçš„æµ‹è¯•æ¥è®©é‡æ„å˜å¾—æ›´å¿«ã€æ›´å®‰å…¨ã€‚</p>
<ul>
<li>ä»è®¾è®¡çš„è§’åº¦ï¼Œè¿™äºŒåå¤šè¡Œä»£ç è¿èƒŒäº†å•ä¸€è´£ä»»åŸåˆ™â€”â€”éœ€è¦ä¿®æ”¹ summaryDescription() çš„åŸå› æœ‰å¤šä¸ªï¼š<ol>
<li>é¦–å…ˆï¼Œè¿™ä¸ªå‡½æ•°ä¸ cURL ç´§å¯†è€¦åˆï¼›</li>
<li>å…¶æ¬¡ï¼Œè¿™äºŒåå¤šè¡Œä»£ç çš„å‡½æ•°ç®—ä½œå†—é•¿å‡½æ•°ï¼Œæƒ³è¦å®Œå…¨ç†è§£å®ƒä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚</li>
<li>å†è€…ï¼Œè¿™ç§å†—é•¿çš„å‡½æ•°ä¼šå¯¼è‡´ä¸å¿…è¦çš„ä»£ç é‡å¤ã€‚è®¸å¤šå¯é‡ç”¨çš„ä»£ç æ·±åŸ‹äºå†—é•¿çš„å‡½æ•°ä¸­ï¼Œé‚£ä¹ˆé‡ç”¨å°†ä¸ä¼šå‘ç”Ÿã€‚</li>
</ol>
</li>
</ul>
<p>å³ä½¿è¿™æ ·ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚ä½¿ç”¨ link substitution å†™ä¸€ä¸ªå¿«é€Ÿçš„å•å…ƒæµ‹è¯•ï¼ˆå‚è§ 8.9 èŠ‚ï¼‰ï¼Œæˆ–è€…å†™ä¸€ä¸ªèƒ½å‘èµ·ä¸€ä¸ªå³æ—¶çš„ REST æœåŠ¡è°ƒç”¨çš„é›†æˆæµ‹è¯•ã€‚</p>
<p>è€Œå½“è·µè¡Œ TDD æ—¶ï¼Œè‡ªç„¶è€Œç„¶çš„ä¼šå¯»æ±‚é«˜å†…èšã€ä½è€¦åˆçš„è®¾è®¡ã€‚ä½ ä¼šå¼€å§‹æ„è¯†åˆ°çµæ´»è®¾è®¡çš„å¥½å¤„ï¼Œä¹Ÿä¼šå¾ˆå¿«å‘ç°å¥½çš„è®¾è®¡æ˜¯æ€æ ·ä¸æµ‹è¯•å’Œè°å…±å­˜çš„ï¼Œè€Œä¸”è¿™äº›æµ‹è¯•å…·æœ‰ä½“é‡å°ï¼Œæ˜“äºç¼–å†™ã€é˜…è¯»å’Œç»´æŠ¤çš„ç‰¹ç‚¹ã€‚</p>
<h3 id="è½¬å«ç§æœ‰ä¾èµ–"><a href="#è½¬å«ç§æœ‰ä¾èµ–" class="headerlink" title="è½¬å«ç§æœ‰ä¾èµ–"></a>è½¬å«ç§æœ‰ä¾èµ–</h3><p>å¦‚æœä¸éœ€è¦æ–¹ä¾¿äºæµ‹è¯•ï¼ŒPlaceDescriptionService ä¸­çš„ HTTP è°ƒç”¨å¯ä»¥é€šè¿‡æˆå‘˜ä¿å­˜ä¸€ä¸ªç§æœ‰çš„å®ä¾‹ï¼Œä½¿å¾—å®¢æˆ·ç«¯è°ƒç”¨ä¸éœ€è¦å† setter æˆ–è€…æ„é€ æ³¨å…¥ã€‚åä¹‹ï¼Œéœ€è¦å®¢æˆ·ç«¯åˆ›å»º HTTP å¯¹è±¡ï¼Œå¹¶å°†å…¶ä¼ ç»™ PlaceDescriptionService å®ä¾‹ï¼Œå°±å°†å…¶å¯¹ HTTP çš„ä¾èµ–è½¬å«ç»™äº†å®¢æˆ·ç«¯ã€‚</p>
<p>Q: setter æˆ–æ„é€ å‡½æ•°æ³¨å…¥æ˜¯ä¸æ˜¯è¿åäº†ä¿¡æ¯éšè—ï¼Ÿ<br>A: ä»å®¢æˆ·ç«¯ç¨‹åºçš„è§’åº¦æ¥è¯´ï¼Œç¡®å®æ˜¯è¿åäº†ã€‚ä½†æ˜¯æœ‰å‡ ç§æ–¹æ³•æœ‰æ•ˆé¿å…ï¼š</p>
<ol>
<li>ä½¿ç”¨å…¶ä»–ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼Œä½¿å¾—æŸäººå³ä½¿åˆ©ç”¨äº†è¿™äº›æš´éœ²å‡ºçš„ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•é€ æˆä¸å¥½çš„å½±å“ã€‚</li>
<li>æä¾›æŸäººçš„å®ä¾‹ï¼Œå…ˆé…ç½®ä¸€ä¸ªé»˜è®¤çš„å®ä¾‹ï¼Œå¦‚æœæµ‹è¯•æä¾›äº† HttpStub å®ä¾‹ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æ›¿æ¢ã€‚è€ŒçœŸæ­£çš„å®¢æˆ·ç«¯æ—¶ä¸éœ€è¦åšä»€ä¹ˆæ”¹åŠ¨çš„ã€‚</li>
</ol>
<p>Q: å¦‚æœå¿ƒæ€€æ¶æ„çš„å¼€å‘è€…æä¾›ä¸€ä¸ªå…·æœ‰ç ´åæ€§çš„ Http å®ä¾‹å‘¢ï¼Ÿ<br>A: å¦‚æœäº§å“çš„å®¢æˆ·æ˜¯å›¢é˜Ÿä¹‹å¤–çš„äººï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©å…¶ä»–æ³¨å…¥å½¢å¼ã€‚å¦‚æœæ‹…å¿ƒå›¢é˜Ÿå†…éƒ¨çš„å¼€å‘è€…æœ‰æ„åˆ©ç”¨æ³¨å…¥ç‚¹åšäº›ä¸å¥½çš„äº‹ï¼Œé‚£ä½ å°†é¢ä¸´æ›´å¤§çš„é—®é¢˜ã€‚</p>
<p>Q: æˆ‘é€æ¸èƒ½å¤Ÿæµ‹è¯•é©±åŠ¨å¼€å‘äº†ï¼Œä½†æˆ‘æ‹…å¿ƒä»…ä»…ä¸ºäº†æµ‹è¯•çš„ç›®çš„è€Œæ”¹å˜æˆ‘çš„è®¾è®¡æ–¹æ³•ã€‚æˆ‘çš„å›¢é˜Ÿä¸­çš„å…¶ä»–äººå¯èƒ½ä¹Ÿä¼šè¿™ä¹ˆè§‰å¾—ã€‚<br>A: ç¡®åˆ‡åœ°äº†è§£è½¯ä»¶èƒ½å¦‚æœŸå·¥ä½œæ˜¯æ”¹å˜è®¾è®¡æ–¹å¼çš„é‡è¦åŸå› ã€‚ä½ å¯ä»¥è¿™æ ·å’ŒåŒäº‹è®²ï¼šâ€œæˆ‘æ›´å…³å¿ƒä»£ç æ˜¯å¦å¦‚æœŸå·¥ä½œã€‚åšå‡ºè¿™ä¹ˆä¸€ä¸ªå°çš„è®©æ­¥æ„å‘³ç€æˆ‘ä»¬èƒ½å¤Ÿæ›´å®¹æ˜“åœ°æµ‹è¯•ä»£ç ï¼Œä¹Ÿä¼šæœ‰æ›´å¤šçš„æµ‹è¯•èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“åœ°æ‰“ç£¨è®¾è®¡ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¯¹ä»£ç æ›´æœ‰ä¿¡å¿ƒã€‚æ‰€ä»¥ä½ ä»¬èƒ½é‡æ–°æ€è€ƒä¸‹æˆ‘ä»¬çš„æ ‡å‡†å—ï¼Ÿâ€</p>
<h2 id="ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ç­–ç•¥"><a href="#ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ç­–ç•¥" class="headerlink" title="ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ç­–ç•¥"></a>ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ç­–ç•¥</h2><p>ä½¿ç”¨æµ‹è¯•æ›¿èº«å’Œå…¶ä»–å·¥å…·ä¸€æ ·ï¼Œæœ€å¤§çš„æŒ‘æˆ˜ä¸æ˜¯å­¦ä¼šæ€ä¹ˆç”¨å®ƒä»¬ï¼Œè€Œæ˜¯çŸ¥é“ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ã€‚</p>
<h3 id="æ¢ç´¢è®¾è®¡"><a href="#æ¢ç´¢è®¾è®¡" class="headerlink" title="æ¢ç´¢è®¾è®¡"></a>æ¢ç´¢è®¾è®¡</h3><p>ç°åœ¨å‡è®¾ AddressExtractor ä¸å­˜åœ¨ï¼Œåœ¨æµ‹è¯•é©±åŠ¨å¼€å‘ summaryDescription() æ—¶ï¼Œè‚¯å®šä¼šæ„è¯†åˆ°éœ€è¦ä¸€äº›é€»è¾‘å»å¤„ç† JSON æ ¼å¼çš„å“åº”ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œé€šå¸¸å¼€å‘è€…å¯ä»¥åœ¨ PlaceDescriptionService ä¸­å…¨éƒ¨è‡ªå·±å®ç°ã€‚</p>
<p>ä½†æ˜¯è¿˜å¯ä»¥å¯»æ±‚æ½œåœ¨çš„é‡ç”¨æ€§ã€æ›´å¤§çš„çµæ´»æ€§å’Œæ˜“äºç†è§£çš„ä»£ç è®¾è®¡ï¼Œä¸ºäº†éµå®ˆå•ä¸€åŸåˆ™ï¼Œæˆ–è®¸å¯ä»¥å°†éœ€è¦çš„é€»è¾‘æ‹†åˆ†æˆä¸¤å—ï¼šè§£æ JSON æ ¼å¼çš„å“åº”å’Œæ ¼å¼åŒ–è¾“å‡ºã€‚</p>
<p>TDD ä¼šä¿ƒä½¿ä½ åœ¨ä»»ä½•æ—¶å€™éƒ½è¦åšå‡ºæ¸…é†’çš„è®¾è®¡é€‰æ‹©ã€‚ä¾‹å¦‚ä½ å¯ä»¥å…ˆå†™ä¸€ä¸ªæè¿° summaryDescription() æ€æ ·äºå¤–éƒ¨åä½œè€…äº¤äº’çš„æµ‹è¯•ã€‚è¿™ä¸ªåä½œè€…çš„å·¥ä½œæ˜¯å¾—åˆ°ä¸€ä¸ª JSON æ ¼å¼çš„å“åº”ï¼Œå¹¶è¿”å›ç›¸åº”çš„åœ°å€æ•°æ®ç»“æ„ã€‚ç›®å‰è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥å®ç°è¿™ä¸ªåä½œè€…çš„ç»†èŠ‚ï¼Œå…ˆé›†ä¸­ä½¿ç”¨ mock æ¥æµ‹è¯•é©±åŠ¨å¼€å‘ summaryDescription() ï¼Œå°±åƒå‰æ–‡ä¸­ HTTP å¯¹è±¡äº¤äº’ä¸€æ ·ã€‚</p>
<p>å½“ä»¥è¿™ç§æ–¹å¼å¼€å‘å®Œæˆæ—¶ï¼Œå¯ä»¥é€šè¿‡å¼•å…¥ mock æ¥æ›¿ä»£ç¼ºå¤±çš„åä½œè€…åŠŸèƒ½ã€‚<strong>åœ¨æŸä¸€æ—¶åˆ»ï¼Œä½ æˆ–å…¶ä»–äººå°†ä¼šå®ç°è¿™ä¸ªåä½œè€…ã€‚è¿™æ—¶ä½ å¯ä»¥ä½œå‡ºä»¥ä¸‹é€‰æ‹©ï¼šç§»é™¤ mockï¼Œä»¥ä¾¿å¾…æµ‹è¯•çš„ä»£ç ä½¿ç”¨äº§å“çº§çš„åä½œè€…ï¼›ä¿ç•™ mockã€‚</strong></p>
<p>ä¹Ÿè®¸ä½ å·²ç»ä½œå¥½äº†é€‰æ‹©ã€‚<strong>å¦‚æœåä½œè€…å¼•å…¥éº»çƒ¦çš„ä¾èµ–ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿ç•™ mockã€‚å¦åˆ™ï¼Œç§»é™¤ mock ä¼šé™ä½æµ‹è¯•çš„å¤æ‚åº¦ã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿè®¸é€‰æ‹©ä¿ç•™å®ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”¨å®ƒæ¥æè¿°ä¸åä½œè€…çš„äº¤äº’å¼è®¾è®¡ä¸­çš„é‡è¦æ–¹é¢ã€‚</strong><br>æˆ–è®¸æœ€å¥½çš„æŒ‡å¯¼æ–¹é’ˆéœ€è¦è€ƒè™‘ç»´æŠ¤å’Œç†è§£æµ‹è¯•æ‰€éœ€çš„ç²¾åŠ›ã€‚å¦‚æœæ²¡æœ‰ mockï¼Œäº‹æƒ…å¯èƒ½ä¼šç®€å•äº›ï¼Œä½†ä¸æ€»æ˜¯è¿™æ ·çš„ã€‚mock å¯èƒ½éœ€è¦å¤§é‡çš„ä»£ç æ¥åˆå§‹åŒ–ä¸€äº›åä½œè€…ï¼Œè¿™ä¹Ÿä¼šå¢åŠ ç»´æŠ¤æµ‹è¯•çš„æˆæœ¬ã€‚</p>
<h3 id="æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«"><a href="#æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«" class="headerlink" title="æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«"></a>æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«</h3><p>å¦‚æœä½ è¦å½»å¤´å½»å°¾åœ°æµ‹è¯•é©±åŠ¨å¼€å‘ä¸€ä¸ªå¸¦æœ‰å¿«é€Ÿæµ‹è¯•çš„ç³»ç»Ÿï¼Œè¿™å…¶ä¸­çš„å¤§éƒ¨åˆ†ç³»ç»Ÿéƒ½éœ€è¦ä½¿ç”¨æµ‹è¯•æ›¿èº«ã€‚åœ¨ä½¿ç”¨æµ‹è¯•æ›¿èº«æ—¶ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„å»ºè®®ï¼š</p>
<ul>
<li>é‡æ–°æ€è€ƒè®¾è®¡ï¼šä½ æ˜¯ä¸ºäº†ç®€åŒ–ä¾èµ–å¯¹è±¡çš„åˆ›å»ºè€Œä½¿ç”¨ mock çš„å—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆé‡æ–°ä¿®æ”¹ä¾èµ–ç»“æ„ã€‚ä½ æ˜¯ä¸æ˜¯åœ¨å¤šä¸ªåœ°æ–¹ä¸ºåŒä¸€ä¸ªä¸œè¥¿ä½¿ç”¨äº† mockï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆé‡æ–°è®¾è®¡æ¥æ¶ˆé™¤è¿™æ ·çš„é‡å¤ã€‚</li>
<li>æ„è¯†åˆ°å•å…ƒæµ‹è¯•è¦†ç›–ç‡ä¸Šçš„è®©æ­¥ã€‚ä¸€ä¸ªæµ‹è¯•æ›¿èº«ä»£è¡¨äº†ç³»ç»Ÿæµ‹è¯•è¦†ç›–ç‡çš„æ¼æ´ã€‚å› ä¸ºæµ‹è¯•æ›¿èº«æä¾›çš„é€»è¾‘æ­£æ˜¯å•å…ƒæµ‹è¯•æ‰€ä¸èƒ½è¦†ç›–çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦ç¡®ä¿å…¶ä»–æµ‹è¯•è¦†ç›–åˆ°è¿™éƒ¨åˆ†é€»è¾‘ã€‚</li>
<li>é‡æ„æµ‹è¯•ã€‚ä¸èƒ½è®©å¯¹ç¬¬ä¸‰æ–¹å·¥å…·çš„ä¾èµ–æˆä¸ºé—®é¢˜ã€‚ä½¿ç”¨éšæ„çš„æ–¹æ³•ä¼šå¯¼è‡´ mock çš„å¤§é‡å¢åŠ ï¼Œä¹Ÿä¼šå¯¼è‡´å¤§é‡çš„é‡å¤å’Œå¤æ‚éš¾æ‡‚çš„æµ‹è¯•ã€‚è¦åƒé‡æ„äº§å“ä»£ç é‚£æ ·å»é‡æ„æµ‹è¯•ï¼æŠŠæœŸæœ›å£°æ˜å°è£…è¿›ä¸€ä¸ªå…¬å…±çš„è¾…åŠ©å‡½æ•°èƒ½å¤Ÿæé«˜æŠ½è±¡ã€é™ä½ä¾èµ–åº¦ã€å‡å°‘é‡å¤ä»£ç ã€‚</li>
<li>è´¨ç–‘ä»¥è¿‡åº¦å¤æ‚çš„æ–¹å¼ä½¿ç”¨æµ‹è¯•æ›¿èº«ã€‚å¦‚æœä½ èº«é™· mockï¼Œé‚£å¯èƒ½æ˜¯å› ä¸ºä½ å°è¯•äº†è¿‡åº¦æµ‹è¯•æˆ–ä½ çš„è®¾è®¡æœ‰ç¼ºé™·ã€‚è¿™æ—¶ä½¿ç”¨å¤šçº§çš„ mock é€šå¸¸èƒ½è§£å†³é—®é¢˜ã€‚å¦‚æœé‡åˆ°äº†é—®é¢˜ï¼Œé‚£ä¹ˆå°±è¦å°†æµ‹è¯•åˆ†è§£ä¸ºå¤šä¸ªå°çš„æµ‹è¯•æ¥ç®€åŒ–é—®é¢˜ã€‚åŒæ ·ä¹Ÿè¦æ£€æµ‹ä¸€ä¸‹æ‰€æµ‹ä»£ç æ˜¯å¦å¯ä»¥æ‹†è§£ã€‚</li>
<li>è¡¨è¾¾åŠ›èƒœäºåŠŸèƒ½ã€‚é€‰æ‹© mock å·¥å…·æ˜¯å› ä¸ºå®ƒèƒ½å¸®åŠ©ä½ åˆ›å»ºé«˜åº¦æŠ½è±¡çš„æµ‹è¯•ï¼Œè¿™äº›æµ‹è¯•å¯ä»¥æ–‡æ¡£åŒ–ç³»ç»Ÿè¡Œä¸ºå’Œè®¾è®¡ï¼Œè€Œä¸ä»…ä»…æ˜¯å› ä¸ºå®ƒæœ‰å¾ˆé…·çš„åŠŸèƒ½ï¼Œå¯ä»¥åšç²¾å·§å’Œæ·±å¥¥çš„äº‹æƒ…ã€‚é™¤éå¿…è¦ï¼Œå¦åˆ™ä¸è¦ä½¿ç”¨è¿™äº›ç²¾å·§æ·±å¥¥çš„åŠŸèƒ½ã€‚</li>
</ul>
<h2 id="å…¶ä»–å…³äºæµ‹è¯•æ›¿èº«çš„ä¸»é¢˜"><a href="#å…¶ä»–å…³äºæµ‹è¯•æ›¿èº«çš„ä¸»é¢˜" class="headerlink" title="å…¶ä»–å…³äºæµ‹è¯•æ›¿èº«çš„ä¸»é¢˜"></a>å…¶ä»–å…³äºæµ‹è¯•æ›¿èº«çš„ä¸»é¢˜</h2><h3 id="ç§°å‘¼"><a href="#ç§°å‘¼" class="headerlink" title="ç§°å‘¼"></a>ç§°å‘¼</h3><p>æœ¬ç« ä¸­ä½¿ç”¨çš„æœ¯è¯­æœ‰æµ‹è¯•æ›¿èº«ã€mock å’Œ Stubã€‚è¿˜æœ‰ä»¥ä¸‹çš„å®šä¹‰ç§°å‘¼ï¼š</p>
<ul>
<li>æµ‹è¯•æ›¿èº«ï¼šä¸ºæµ‹è¯•è€Œæ¨¡æ‹Ÿäº§å“ä»£ç çš„ä»£ç ã€‚</li>
<li>Stubï¼šä¸€ä¸ªè¿”å›ç¡¬ç¼–ç å€¼çš„æµ‹è¯•æ›¿èº«ã€‚</li>
<li>Spyï¼šä¸€ä¸ªä¿å­˜æ¥å—ä¿¡æ¯ä»¥ä¾¿æ—¥åéªŒè¯çš„æµ‹è¯•æ›¿èº«ã€‚</li>
<li>mockï¼šä¸€ä¸ªåŸºäºæœŸæœ›è‡ªæˆ‘éªŒè¯çš„æµ‹è¯•æ›¿èº«ã€‚</li>
<li>Fakeï¼šæä¾›äº§å“ç±»è½»é‡çº§å®ç°çš„æµ‹è¯•æ›¿èº«ã€‚</li>
</ul>
<h3 id="æµ‹è¯•æ›¿èº«è¯¥æ”¾åœ¨å“ª"><a href="#æµ‹è¯•æ›¿èº«è¯¥æ”¾åœ¨å“ª" class="headerlink" title="æµ‹è¯•æ›¿èº«è¯¥æ”¾åœ¨å“ª"></a>æµ‹è¯•æ›¿èº«è¯¥æ”¾åœ¨å“ª</h3><p>ä¸€å¼€å§‹åœ¨ç›¸åŒçš„æµ‹è¯•æ–‡ä»¶ä¸­å®šä¹‰æµ‹è¯•æ›¿èº«ï¼Œä»¥ä¾¿å¼€å‘è€…çœ‹åˆ°ã€‚å½“å¤šä¸ª fixture ä½¿ç”¨åŒä¸€ä¸ªæµ‹è¯•æ›¿èº«æ—¶ï¼Œå†å°†å£°æ˜ç§»æ¤åˆ°å•ç‹¬çš„å¤´æ–‡ä»¶ä¸­ã€‚å½“ä¸å†éœ€è¦æŸ¥çœ‹æµ‹è¯•æ›¿èº«æ—¶ï¼Œåº”è¯¥æŠŠå®ƒä»¬ä»è§†é‡ä¸­ç§»é™¤ã€‚</p>
<h3 id="è™šå‡½æ•°è¡¨å’Œæ€§èƒ½"><a href="#è™šå‡½æ•°è¡¨å’Œæ€§èƒ½" class="headerlink" title="è™šå‡½æ•°è¡¨å’Œæ€§èƒ½"></a>è™šå‡½æ•°è¡¨å’Œæ€§èƒ½</h3><p>å¼•å…¥æµ‹è¯•æ›¿èº«æ˜¯ä¸ºäº†æµ‹è¯•é©±åŠ¨å¼€å‘ä¸€ä¸ªæœ‰å¤æ‚ä¾èµ–å…³ç³»çš„ç±»ã€‚è®¸å¤šåˆ›å»ºæµ‹è¯•æ›¿èº«çš„æŠ€æœ¯éƒ½éœ€è¦åˆ›å»ºæ´¾ç”Ÿç±»æ¥è¦†å†™è™šæˆå‘˜å‡½æ•°ã€‚å¦‚æœä¹‹å‰çš„äº§å“ç±»æ²¡æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆç°åœ¨ä¼šæœ‰ï¼Œå¹¶ä¸”ä¼šæœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨ã€‚è™šå‡½æ•°è¡¨å¸¦æ¥é¢å¤–çš„é—´æ¥æ€§æ˜¯æœ‰å¼€é”€çš„ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœä½ å¿…é¡»å¤§è§„æ¨¡åœ°è°ƒç”¨æ¨¡æ‹Ÿçš„äº§å“å‡½æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆå¾—åˆ°ä¸€äº›æ€§èƒ½æ•°æ®ã€‚å¦‚æœæ€§èƒ½é™åˆ°ä¸å¯æ¥å—çš„ç¨‹åº¦ï¼Œå°±è¦è€ƒè™‘ä¸åŒçš„æ¨¡æ‹Ÿæ–¹å¼ï¼ˆæˆ–è®¸åŸºäºæ¨¡æ¿çš„æ–¹æ¡ˆï¼‰ï¼Œé‡æ–°è®¾è®¡ï¼ˆå¯èƒ½çš„è¯ï¼Œé€šè¿‡ä¼˜åŒ–å…¶ä»–åœ°æ–¹æ¥è¡¥å¿æ€§èƒ½æŸå¤±ï¼‰ï¼Œæˆ–è€…å¼•å…¥é›†æˆæµ‹è¯•æ¥å¼¥è¡¥å•å…ƒæµ‹è¯•çš„ä¸è¶³ï¼ˆå‚è§ 10.2 èŠ‚ï¼‰ã€‚</p>
<h3 id="æ¨¡æ‹Ÿå…·ä½“çš„ç±»"><a href="#æ¨¡æ‹Ÿå…·ä½“çš„ç±»" class="headerlink" title="æ¨¡æ‹Ÿå…·ä½“çš„ç±»"></a>æ¨¡æ‹Ÿå…·ä½“çš„ç±»</h3><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å®ç°ä¸€ä¸ªçº¯è™šçš„ Http æ¥å£æ¥åˆ›å»ºä¸€ä¸ª mockã€‚å¾ˆå¤šç³»ç»Ÿä¸»è¦ç”±å…·ä½“çš„ç±»æ„æˆï¼Œå› æ­¤æ²¡æœ‰å¤šå°‘æ­¤ç±»æ¥å£ã€‚ä»è®¾è®¡çš„è§’åº¦è®²ï¼Œä½¿ç”¨æ¥å£æ˜¯å°†ç³»ç»Ÿä¸­çš„ä¸€éƒ¨åˆ†å’Œå¦ä¸€éƒ¨åˆ†éš”ç¦»çš„æ–¹å¼ã€‚</p>
<p>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼ŒDIPï¼‰æå€¡è®©å®¢æˆ·ç«¯ä¾èµ–æŠ½è±¡çš„æ¥å£è€Œéå…·ä½“çš„å®ç°ï¼Œä»è€Œè¾¾åˆ°æ¶ˆé™¤ä¾èµ–çš„ç›®çš„ã€‚ä»¥çº¯è™šç±»çš„æ–¹å¼å¼•å…¥è¿™ç§æŠ½è±¡ï¼Œèƒ½å¤ŸåŠ å¿«ç¼–è¯‘å¹¶éš”ç¦»å¤æ‚æ€§ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒä»¬èƒ½è®©æµ‹è¯•å˜å¾—ç®€å•ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ´¾ç”Ÿè‡ªä¸€ä¸ªå…·ä½“ç±»çš„ mockã€‚é—®é¢˜æ˜¯äº§ç”Ÿçš„ç±»æ··åˆäº†äº§å“ä»£ç å’Œæ¨¡æ‹Ÿçš„è¡Œä¸ºï¼Œè¿™åˆè¢«ç§°ä¸ºéƒ¨åˆ†æ¨¡æ‹Ÿã€‚å®ƒå¯ä»¥ä½“ç°å‡ºä¸¤æ–¹é¢é—®é¢˜ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œéƒ¨åˆ†æ¨¡æ‹Ÿé€šå¸¸èƒ½å‘Šè¯‰ä½ æ‰€æ¨¡æ‹Ÿçš„ç±»è¿‡å¤§ï¼Œå¦‚æœä½ åªéœ€è¦å…¶ä¸­çš„ä¸€éƒ¨åˆ†è€Œä¸æ˜¯å…¨éƒ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‰ç…§è¿™äº›è¾¹ç•Œå°†ç±»æ‹†åˆ†æˆä¸¤ä¸ªã€‚</li>
<li>å…¶æ¬¡ï¼Œä½¿ç”¨éƒ¨åˆ†æ¨¡æ‹Ÿå¾ˆå¯èƒ½ä½¿ä½ é™·å…¥éº»çƒ¦ï¼Œä»¥è‡³äºå¾ˆå¿«é™·å…¥æ¨¡æ‹Ÿåœ°ç‹±ã€‚åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿå¯èƒ½é‡åˆ°è¯¡ç§˜çš„é—®é¢˜ï¼šâ€œå•Šï¼æˆ‘åŸä»¥ä¸ºä»£ç æ­¤æ—¶ä¼šä¸æ¨¡æ‹Ÿçš„æ–¹æ³•äº¤äº’ï¼Œä½†æ˜¯çœ‹èµ·æ¥å®ƒä¸çœŸæ­£çš„æ–¹æ³•äº¤äº’äº†ã€‚â€</li>
</ol>
<p>ç»“è®ºä¾¿æ˜¯ï¼šå¦‚æœä½ ä½¿ç”¨è¯¸å¦‚éƒ¨åˆ†æ¨¡æ‹Ÿæ­¤ç±»éš¾ä»¥é©¾é©­çš„å·¥å…·ï¼Œé‚£ä¹ˆä½ çš„è®¾è®¡æ­£æ•£å‘ç€åå‘³ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸€ä¸ªå¹²å‡€çš„è®¾è®¡ä¼šé‡‡ç”¨å…·ä½“ç±»ç»§æ‰¿ä¸€ä¸ªæ¥å£çš„æ–¹å¼ã€‚è¿™æ ·ï¼Œæµ‹è¯•ä¹Ÿä¸å†éœ€è¦éƒ¨åˆ†æ¨¡æ‹Ÿäº†ï¼Œä¸ºè¿™ä¸ªæ¥å£åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ›¿èº«å³å¯ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><p>çœŸå®çš„ç”Ÿäº§ç¯å¢ƒä¸­å¯¹è±¡å¿…é¡»ååŒå·¥ä½œï¼Œæœ‰æ—¶ä¾èµ–åˆä½œå¯¹è±¡ä½¿å¾— TDD å˜å¾—ä¸¾æ­¥ç»´è‰°ï¼Œå¯ä»¥ä½¿ç”¨ MOCK æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚ç”±äº Catch2 æ²¡æœ‰æä¾› MOCK åŠŸèƒ½æ”¯æŒï¼Œæœ¬ç« èŠ‚ä¸»è¦çš„ä»£ç æ¼”ç¤ºå‡ä½¿ç”¨ GMOCKã€‚ä½†æ˜¯ Catch2 ä¹Ÿæ˜¯å¯ä»¥åˆ©ç”¨ GMOCK ç›¸å…³å®æ¥å®Œå–„æµ‹è¯•éœ€è¦ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/HATTER-LONG/TDD_Learning/tree/master/test/Catch2/PlaceDescriptionServiceTestByGMock">å…·ä½“ä½¿ç”¨</a>ã€‚</p>
</li>
<li><p>ä¾èµ–é—®é¢˜ï¼šå½“æ„å»ºäº§å“ä»£ç æ˜¯æ— æ³•é¿å…ä¸ç¬¬ä¸‰æ–¹è¿›è¡Œäº¤äº’ï¼Œè¿™æ—¶å°±ä¼šæœ‰è®¸å¤šä¸ç¡®å®šæ€§ï¼ˆæ¥å£ä¸ç¨³å®šã€é€Ÿåº¦æ…¢ã€ç”šè‡³æ²¡æœ‰å¼€å‘å®Œæˆç­‰ç­‰ï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥åˆ©ç”¨ MOCK æ›¿èº«æŠ€æœ¯æ¥é¿å…é˜»å¡ã€‚</p>
</li>
<li><p>ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡å·¥å…·ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">HttpStub</span> <span class="token operator">:</span> <span class="token keyword">public</span> Http
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MOCK_METHOD</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">,</span> initialize<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>override<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">MOCK_METHOD</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> get<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> override<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//CmakeLists.txt</span>
<span class="token comment" spellcheck="true">//å½“å‰ä½¿ç”¨çš„ googletest ç‰ˆæœ¬ä¸º 1.10.x MOCK_METHOD å®åœ¨ç¼–è¯‘å™¨ä¸‹ä¼šæœ‰é”™è¯¯ä¿¡æ¯ï¼Œä¾æ® gmock issues æ— ç”¨æŠ¥é”™ å…³é—­ç›¸å…³è­¦å‘Š</span>
<span class="token function">add_definitions</span><span class="token punctuation">(</span><span class="token operator">-</span>Wno<span class="token operator">-</span>gnu<span class="token operator">-</span>zero<span class="token operator">-</span>variadic<span class="token operator">-</span>macro<span class="token operator">-</span>arguments<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>è®¾ç«‹æœŸæœ›ï¼š</p>
<ul>
<li><p>é€šè¿‡ EXPECT_CALL å®è®¾ç«‹æœŸæœ›ï¼Œè¿™ä¸ªå®é…ç½® Google Mock å»éªŒè¯ä»¥ç»™å®šçš„å‚æ•°å»è°ƒç”¨ç›®æ ‡å¯¹è±¡é€»è¾‘æ˜¯å¦å»åˆã€‚</p>
</li>
<li><p>EXPECT_CALL å®æ”¯æŒè®¸å¤šä¿®é¥°ç¬¦ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼ˆ?å’Œ<em>ä»£è¡¨æ¯ä¸ªä¿®é¥°ç¬¦çš„åŸºæ•°ï¼š?è¡¨ç¤ºå¯ä»¥é€‰ç”¨ä¿®é¥°ç¬¦ä¸€æ¬¡ï¼›</em>è¡¨ç¤ºå¯ä»¥å¤šæ¬¡ä½¿ç”¨ä¿®é¥°ç¬¦ã€‚ï¼‰ï¼š</p>
<pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token function">EXPECT_CALL</span><span class="token punctuation">(</span>mock<span class="token operator">-</span>object<span class="token punctuation">,</span> <span class="token function">method</span> <span class="token punctuation">(</span>matchers<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">With</span><span class="token punctuation">(</span>multi<span class="token operator">-</span>argument<span class="token operator">-</span>matcher<span class="token punctuation">)</span>  <span class="token operator">?</span>
    <span class="token punctuation">.</span><span class="token function">Times</span><span class="token punctuation">(</span>cardinality<span class="token punctuation">)</span>            <span class="token operator">?</span>
    <span class="token punctuation">.</span><span class="token function">InSequence</span><span class="token punctuation">(</span>sequences<span class="token punctuation">)</span>         <span class="token operator">*</span>
    <span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>expectations<span class="token punctuation">)</span>           <span class="token operator">*</span>
    <span class="token punctuation">.</span><span class="token function">WillOnce</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>              <span class="token operator">*</span>
    <span class="token punctuation">.</span><span class="token function">WillRepeatedly</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>        <span class="token operator">?</span>
    <span class="token punctuation">.</span><span class="token function">RetiresOnSaturation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">?</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
</li>
<li><p>æ’é™¤æ¨¡æ‹Ÿå¤±è´¥çš„æ–¹æ³•ï¼š</p>
<ol>
<li>äº§å“ä»£ç ä¸­æ˜¯å¦æœ‰åˆç†è°ƒç”¨ï¼Ÿ</li>
<li>æ˜¯å¦æ­£ç¡®å®šä¹‰äº†æ¨¡æ‹Ÿæ–¹æ³•ï¼Ÿ</li>
<li>æœ‰æ²¡æœ‰å°†è¦æ¨¡æ‹Ÿçš„æˆå‘˜å‡½æ•°å£°æ˜ä¸ºè™šå‡½æ•°ï¼Ÿ</li>
<li><code>MOCK_METHOD()</code> å£°æ˜æ­£ä¸æ­£ç¡®ï¼Ÿ</li>
<li>æ’é™¤å‚æ•°åŒ¹é…çš„æ‹…å¿§ï¼Œä¸ºæ‰€æœ‰å‚æ•°å’Œè¿”å›å€¼ä½¿ç”¨é€šé…ç¬¦ testing::_ ï¼Œå¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæœ‰ä¸€ä¸ªå‚æ•°ä¸èƒ½è¢«æ­£ç¡®åŒ¹é…ã€‚</li>
</ol>
</li>
<li><p>ä½¿ç”¨æµ‹è¯•æ›¿èº«ï¼šåœ¨å¼•å…¥ä¸€ä¸ªæµ‹è¯•æ›¿èº«æ—¶éœ€è¦åšä¸¤ä»¶äº‹ã€‚ç¬¬ä¸€ï¼Œç¼–å†™æµ‹è¯•æ›¿èº«ã€‚ç¬¬äºŒï¼Œåœ¨ç›®æ ‡æµ‹è¯•ä¸­ä½¿ç”¨æµ‹è¯•æ›¿èº«çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™æ ·çš„åšæ³•åˆç§°ä½œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰ã€‚</p>
</li>
<li><p>å†…èšä¸è€¦åˆï¼šåœ¨å…¸å‹çš„åæµ‹è¯•ä»£ç æƒ…å†µï¼Œå¼€å‘è€…å¯èƒ½ä¸ä¼šç»å¸¸è¿›è¡Œé‡æ„ï¼Œé€šå¸¸ä»–ä»¬ä¹Ÿæ— æ³•ä½¿ç”¨å¿«é€Ÿçš„æµ‹è¯•è®©é‡æ„å˜å¾—æ›´å¿«æ›´å®‰å…¨ã€‚è¿™æ ·å¾€å¾€äº§ç”Ÿä¸€äº›å†—ä½™ä¸”è€¦åˆçš„ä»£ç ã€‚å³ä½¿è¿™æ ·ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œèƒ½å¤Ÿåˆ©ç”¨åˆ°çš„æŠ€æœ¯ï¼š</p>
</li>
<li><p>è½¬å«ç§æœ‰ä¾èµ–ï¼šæ³¨å…¥æ¨¡å¼å¾€å¾€éœ€è¦å¯¹å®¢æˆ·ç«¯è°ƒç”¨äº§ç”Ÿä¾èµ–å…³ç³»ï¼Œå³ setter æˆ–è€…æ„é€ æ³¨å…¥ã€‚</p>
</li>
<li><p>ä½¿ç”¨ mock çš„ç­–ç•¥ï¼šåœ¨å¼€å‘å‰æœŸï¼Œå¯ä»¥é€šè¿‡å¼•å…¥ mock æ¥æ›¿ä»£ç¼ºå¤±çš„åä½œè€…åŠŸèƒ½ã€‚<strong>åœ¨æŸä¸€æ—¶åˆ»ï¼Œä½ æˆ–å…¶ä»–äººå°†ä¼šå®ç°è¿™ä¸ªåä½œè€…ã€‚è¿™æ—¶ä½ å¯ä»¥ä½œå‡ºä»¥ä¸‹é€‰æ‹©ï¼šç§»é™¤ mockï¼Œä»¥ä¾¿å¾…æµ‹è¯•çš„ä»£ç ä½¿ç”¨äº§å“çº§çš„åä½œè€…ï¼›ä¿ç•™ mockã€‚</strong></p>
<ul>
<li><strong>å¦‚æœåä½œè€…å¼•å…¥éº»çƒ¦çš„ä¾èµ–ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿ç•™ mockã€‚å¦åˆ™ï¼Œç§»é™¤ mock ä¼šé™ä½æµ‹è¯•çš„å¤æ‚åº¦ã€‚ä½†æ˜¯ï¼Œä½ ä¹Ÿè®¸é€‰æ‹©ä¿ç•™å®ƒï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”¨å®ƒæ¥æè¿°ä¸åä½œè€…çš„äº¤äº’å¼è®¾è®¡ä¸­çš„é‡è¦æ–¹é¢ã€‚</strong></li>
</ul>
</li>
<li><p>æ˜æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«ï¼šå½“éœ€è¦ä»å¤´ TDD å¼€å‘ä¸€ä¸ªå¸¦æœ‰å¿«é€Ÿæµ‹è¯•çš„ç³»ç»Ÿï¼Œå¤§éƒ¨åˆ†ç³»ç»ŸåŠŸèƒ½éƒ½éœ€è¦ä½¿ç”¨æµ‹è¯•æ›¿èº«ï¼Œåœ¨ä½¿ç”¨æ—¶å¯ä»¥å‚è€ƒæ˜ç« èŠ‚#æ™ºåœ°ä½¿ç”¨æµ‹è¯•æ›¿èº«ã€‚</p>
</li>
</ul>
<h3 id="Q-x2F-A"><a href="#Q-x2F-A" class="headerlink" title="Q/A"></a>Q/A</h3><p>Q: setter æˆ–æ„é€ å‡½æ•°æ³¨å…¥æ˜¯ä¸æ˜¯è¿åäº†ä¿¡æ¯éšè—ï¼Ÿ<br>A: ä»å®¢æˆ·ç«¯ç¨‹åºçš„è§’åº¦æ¥è¯´ï¼Œç¡®å®æ˜¯è¿åäº†ã€‚ä½†æ˜¯æœ‰å‡ ç§æ–¹æ³•æœ‰æ•ˆé¿å…ï¼š</p>
<ol>
<li>ä½¿ç”¨å…¶ä»–ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼Œä½¿å¾—æŸäººå³ä½¿åˆ©ç”¨äº†è¿™äº›æš´éœ²å‡ºçš„ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•é€ æˆä¸å¥½çš„å½±å“ã€‚</li>
<li>æä¾›æŸäººçš„å®ä¾‹ï¼Œå…ˆé…ç½®ä¸€ä¸ªé»˜è®¤çš„å®ä¾‹ï¼Œå¦‚æœæµ‹è¯•æä¾›äº† HttpStub å®ä¾‹ï¼Œé‚£ä¹ˆå®ƒå°†è¢«æ›¿æ¢ã€‚è€ŒçœŸæ­£çš„å®¢æˆ·ç«¯æ—¶ä¸éœ€è¦åšä»€ä¹ˆæ”¹åŠ¨çš„ã€‚</li>
</ol>
<p>Q: å¦‚æœå¿ƒæ€€æ¶æ„çš„å¼€å‘è€…æä¾›ä¸€ä¸ªå…·æœ‰ç ´åæ€§çš„ Http å®ä¾‹å‘¢ï¼Ÿ<br>A: å¦‚æœäº§å“çš„å®¢æˆ·æ˜¯å›¢é˜Ÿä¹‹å¤–çš„äººï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©å…¶ä»–æ³¨å…¥å½¢å¼ã€‚å¦‚æœæ‹…å¿ƒå›¢é˜Ÿå†…éƒ¨çš„å¼€å‘è€…æœ‰æ„åˆ©ç”¨æ³¨å…¥ç‚¹åšäº›ä¸å¥½çš„äº‹ï¼Œé‚£ä½ å°†é¢ä¸´æ›´å¤§çš„é—®é¢˜ã€‚</p>
<p>Q: æˆ‘é€æ¸èƒ½å¤Ÿæµ‹è¯•é©±åŠ¨å¼€å‘äº†ï¼Œä½†æˆ‘æ‹…å¿ƒä»…ä»…ä¸ºäº†æµ‹è¯•çš„ç›®çš„è€Œæ”¹å˜æˆ‘çš„è®¾è®¡æ–¹æ³•ã€‚æˆ‘çš„å›¢é˜Ÿä¸­çš„å…¶ä»–äººå¯èƒ½ä¹Ÿä¼šè¿™ä¹ˆè§‰å¾—ã€‚<br>A: ç¡®åˆ‡åœ°äº†è§£è½¯ä»¶èƒ½å¦‚æœŸå·¥ä½œæ˜¯æ”¹å˜è®¾è®¡æ–¹å¼çš„é‡è¦åŸå› ã€‚ä½ å¯ä»¥è¿™æ ·å’ŒåŒäº‹è®²ï¼šâ€œæˆ‘æ›´å…³å¿ƒä»£ç æ˜¯å¦å¦‚æœŸå·¥ä½œã€‚åšå‡ºè¿™ä¹ˆä¸€ä¸ªå°çš„è®©æ­¥æ„å‘³ç€æˆ‘ä»¬èƒ½å¤Ÿæ›´å®¹æ˜“åœ°æµ‹è¯•ä»£ç ï¼Œä¹Ÿä¼šæœ‰æ›´å¤šçš„æµ‹è¯•èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“åœ°æ‰“ç£¨è®¾è®¡ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¯¹ä»£ç æ›´æœ‰ä¿¡å¿ƒã€‚æ‰€ä»¥ä½ ä»¬èƒ½é‡æ–°æ€è€ƒä¸‹æˆ‘ä»¬çš„æ ‡å‡†å—ï¼Ÿâ€</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Layton</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://hatter-long-blog.vercel.app/2022/06/02/wu-ce-shi-qu-dong-kai-fa-ji-qiao-ce-shi-ti-shen/">https://hatter-long-blog.vercel.app/2022/06/02/wu-ce-shi-qu-dong-kai-fa-ji-qiao-ce-shi-ti-shen/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="/about" target="_blank">Layton</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/">
                                    <span class="chip bg-color">æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2022/06/02/liu-ce-shi-qu-dong-kai-fa-ji-qiao-zeng-liang-she-ji/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="ï¼ˆå…­ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--å¢é‡è®¾è®¡">
                        
                        <span class="card-title">ï¼ˆå…­ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--å¢é‡è®¾è®¡</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-06-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/" class="post-category">
                                    æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/">
                        <span class="chip bg-color">æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/06/02/si-ce-shi-qu-dong-kai-fa-ji-qiao-ce-shi-jie-gou/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/2.jpg" class="responsive-img" alt="ï¼ˆå››ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--æµ‹è¯•ç»“æ„">
                        
                        <span class="card-title">ï¼ˆå››ï¼‰æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§--æµ‹è¯•ç»“æ„</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-06-02
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/" class="post-category">
                                    æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%B5%8B%E8%AF%95%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/">
                        <span class="chip bg-color">æµ‹è¯•é©±åŠ¨å¼€å‘æŠ€å·§</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022</span>
            
            <a href="/about" target="_blank">Layton</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;ç«™ç‚¹æ€»å­—æ•°:&nbsp;<span
                        class="white-color">66.2k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- è¿è¡Œå¤©æ•°æé†’. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "5";
                        var startDate = "31";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // åŒºåˆ†æ˜¯å¦æœ‰å¹´ä»½.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = 'æœ¬ç«™å·²å‹‰å¼ºè¿è¡Œ ' + diffDays + ' å¤© áƒ¦ã‚â—¡â•¹)ãƒâ™¡';
                            } else if (language === 'zh-HK') {
                                daysTip = 'æœ¬ç«™å·²é‹è¡Œ ' + diffDays + ' å¤©';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = 'æœ¬ç«™å·²è¿è¡Œ ' + diffYears + ' å¹´ ' + diffDays + ' å¤©';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = 'æœ¬ç«™å·²é‹è¡Œ ' + diffYears + ' å¹´ ' + diffDays + ' å¤©';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/HATTER-LONG" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:caolei6767@163.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=985001640" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 985001640" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.bootcss.com/masonry/4.2.2/masonry.pkgd.min.js"></script>
    <script src="https://cdn.bootcss.com/aos/3.0.0-beta.6/aos.js"></script>
    <script src="https://cdn.bootcss.com/scrollprogress/3.0.2/scrollProgress.min.js"></script>
    <script src="https://cdn.bootcss.com/lightgallery/1.10.0/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- é›ªèŠ±ç‰¹æ•ˆ -->
    

    <!-- é¼ æ ‡æ˜Ÿæ˜Ÿç‰¹æ•ˆ -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--è…¾è®¯å…”å°å·¢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
